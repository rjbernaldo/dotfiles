var TubeBuddyTranscriptions=function(){var e=false;var t;var i;var n;var o=function(){};var a=function(){var e=TBGlobal.host+"/ModuleManager/transcriptions/transcriptions?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/transcriptions.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/transcriptions.html"}TBExtension.Get(e,"CRTBLoadTranscriptionsTranscriptions")};var s=function(){jQuery(document).on("click",".tb-transcriptions-order",function(){var e=$(this);jQuery("#tb-transcriptions").hide();TubeBuddyMenu.HideBackground();TBUtilities.AddAction(null,TBUtilities.ActionTypes.CaptionsService_Order,"captionsservice")});jQuery(document).on("click",".tb-transcriptions-close, .tb-transcriptions-closex",function(){jQuery("#tb-transcriptions").hide();TubeBuddyMenu.HideBackground()})};var r=function(){jQuery(document.body).on("CRTBLoadTranscriptionsTranscriptions",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);l()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTranscriptions] CRTBLoadTranscriptionsTranscriptions"})}})};var l=function(){jQuery("#tb-transcriptions").show();jQuery(".tb-transcriptions-order").attr("href",TBGlobal.host+"/account/TranscriptionOrder?videoid="+t);jQuery("#tb-transcriptions-video-thumbnail").attr("src",n);jQuery("#tb-transcriptions-video-link").text(i);jQuery("#tb-transcriptions-video-link").attr("href","https://www.youtube.com/watch?v="+t)};return{Show:function(o,d,c){if(TBGlobal.IsAuthenticated()){t=o;i=d;n=c;if(!e){r();a();s();e=true}else{l()}}}}}();var TubeBuddyAnnotationsUpdate=function(){var e={method:3,specificVideoIds:[],specificVideos:[],playlistId:"",search:"",selectedVideo:{},currentVideo:null,isStopped:false,failedVideos:[],step:1,videosWithFoundAnnotations:[],destinationVideos:[],hasFinished:false,errorCount:0,successCount:0,totalDestinationVideos:0,selectedAutotationCount:0,authToken:null,actionVideosSearched:0};var t=false;var i=null;var n=function(){var e=TBGlobal.host+"/ModuleManager/annotationsupdate/annotationsupdate?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/annotationsupdate.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/annotationsupdate.html"}TBExtension.Get(e,"CRTBLoadAnnotationsUpdateTemplate")};var o=function(){jQuery(document).on("click","#tb-annotations-update-error-copy-container",function(){jQuery(this).attr("src","https://www.tubebuddy.com/images/icons/check.png");window.setTimeout(function(){jQuery("#tb-annotations-update-error-copy").attr("src","https://www.tubebuddy.com/images/icons/copy.png")},1500)});jQuery(document).on("click","#tb-annotations-update-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-annotations-update-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-annotations-update-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change",".tb-annotations-update-filter",function(){jQuery(".tb-annotations-update-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-annotations-update-destination-row[data-privacy="private"]').hide();jQuery('.tb-annotations-update-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-annotations-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-annotations-update-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-annotations-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-annotations-update-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-annotations-update-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-annotations-update-destination-row[data-privacy="public"]').hide();break}jQuery(".tb-annotations-update-destination-selected-count").text(jQuery(".tb-annotations-update-destination-list").find(".tb-annotations-update-checkbox-include").filter(":visible").filter(":checked").length)});jQuery(document).on("click",".tb-annotations-update-checkbox-include",function(){try{if(jQuery(this).is(":checked")){if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-annotations-update-destination-list").find(".tb-annotations-update-checkbox-include").filter(":visible").filter(":checked").length>1){jQuery(this).prop("checked",false);TBGlobal.ShowUpgradePage("Sorry, you cannot update annotations in bulk (more than 1 video at a time) unless you upgrade your TubeBuddy License.",TBGlobal.limitation.updateAnnotations);return}jQuery(this).closest(".tb-annotations-update-destination-row").addClass("tb-annotations-update-destination-row-selected")}else{jQuery(this).closest(".tb-annotations-update-destination-row").removeClass("tb-annotations-update-destination-row-selected")}var t=b();e.selectedAutotationCount=t;jQuery(".tb-annotations-update-destination-selected-count").text(t);jQuery(".tb-annotations-update-count").text(t);if(jQuery(".tb-annotations-update-count").text()=="1")jQuery(".tb-annotations-update-count-s").hide();else jQuery(".tb-annotations-update-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateAnnotations] [click] tb-annotations-update-checkbox-include"})}});jQuery(document).on("click",".tb-annotations-update-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-annotations-update-destination-list").find(".tb-annotations-update-checkbox-include").filter(":visible").filter(":checked").length>1){TBGlobal.ShowUpgradePage("Sorry, you cannot update annotations in bulk (more than 1 video at a time) unless you upgrade your TubeBuddy License.",TBGlobal.limitation.updateAnnotations);return}jQuery(".tb-annotations-update-checkbox-include").prop("checked",true);jQuery(".tb-annotations-update-destination-row").addClass("tb-annotations-update-destination-row-selected");var e=b();jQuery(".tb-annotations-update-destination-selected-count").text(e);jQuery(".tb-annotations-update-count").text(e);if(jQuery(".tb-annotations-update-count").text()=="1")jQuery(".tb-annotations-update-count-s").hide();else jQuery(".tb-annotations-update-count-s").show()});jQuery(document).on("click",".tb-annotations-update-select-no-checkboxes",function(){jQuery(".tb-annotations-update-checkbox-include").prop("checked",false);jQuery(".tb-annotations-update-destination-row").removeClass("tb-annotations-update-destination-row-selected");var e=b();jQuery(".tb-annotations-update-destination-selected-count").text(e);jQuery(".tb-annotations-update-count").text(e);if(jQuery(".tb-annotations-update-count").text()=="1")jQuery(".tb-annotations-update-count-s").hide();else jQuery(".tb-annotations-update-count-s").show()});jQuery(document).on("click","input[name=tb-annotations-update-target-option]",function(){jQuery(".tb-annotations-update-target-input").prop("disabled",true);jQuery(".tb-annotations-update-target-input").val("");jQuery(this).siblings(".tb-annotations-update-target-input:first").prop("disabled",false)});jQuery(document).on("click",".tb-annotations-update-action-option",function(){var e=jQuery(this).is(":checked");if(e){jQuery(this).siblings(".tb-annotations-update-action-input:first").prop("disabled",false);jQuery(this).siblings(".tb-annotations-update-action-input:first").val("")}else{jQuery(this).siblings(".tb-annotations-update-action-input:first").prop("disabled",true);jQuery(this).siblings(".tb-annotations-update-action-input:first").val("")}});jQuery(document).on("click","#tb-annotations-update-close, #tb-annotations-update-cancel, .tb-annotations-update-closex",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-annotations-update-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] [click] tb-annotations-close"})}});jQuery(document).on("click",".tb-annotations-update-continue",function(){try{switch(e.step){case 1:{if(jQuery(".tb-annotations-update-target-input-field").val()==""){TBUtilities.Alert("Enter your search criteria");return}if(jQuery(".tb-annotations-update-action-option").is(":checked").length==0){TBUtilities.Alert("Select what you'd like to update on the matching annotations");return}if(jQuery(".tb-annotations-update-action-url").is(":checked")&&jQuery(".tb-annotations-update-action-url-input").val()==""){TBUtilities.Alert("Enter a url to update");return}if(jQuery(".tb-annotations-update-action-text").is(":checked")&&jQuery(".tb-annotations-update-action-text-input").val()==""){TBUtilities.Alert("Enter a text to update");return}a(2);break}case 2:{switch(parseInt(e.method)){case 0:if(e.specificVideoIds.length==0){jQuery("#tb-annotations-input-ids-status").css("color","red");jQuery("#tb-annotations-input-ids-status").text("No videos detected");jQuery("#tb-annotations-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&e.specificVideoIds.length>1){TBGlobal.ShowUpgradePage("Sorry, you cannot update annotations in bulk (more than 1 video at a time) unless you upgrade your TubeBuddy License",TBGlobal.limitation.updateAnnotations);return}TBGlobal.AddUserDebugInfo("Video Selection Method: Video IDs "+JSON.stringify(e.specificVideoIds));g();break;case 1:if(e.playlistId==""){jQuery("#tb-annotations-input-playlist-status").css("color","red");jQuery("#tb-annotations-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-annotations-input-playlist-status").show();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Playlist ["+e.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(e.playlistId,null,y,Q);break;case 2:if(e.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Search ["+e.search+"]");jQuery("#tb-annotations-destination").show();TBYouTubeApi.GetChannelVideosSearch(e.search,null,y,Q);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var t=null;if(jQuery("#tb-annotations-update-onlyLoadFirstPage").is(":checked")){var i=/^\+?\d+$/.test(jQuery("#tb-annotations-update-onlyLoadFirstPage-number").val());if(i==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}t=parseInt(jQuery("#tb-annotations-update-onlyLoadFirstPage-number").val());if(t<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,y,Q,t,null,e.selectedVideo.id);break}jQuery(".tb-annotations-update-loading-count").text("0");jQuery(".tb-annotations-update-loading-count-total").text("?");jQuery(".tb-annotations-update-loading-text").text("Loading your videos...");jQuery(".tb-annotations-update-loading-text-search").text("");jQuery(".tb-annotations-loading-count-container").show();a(3);break}case 3:{if(jQuery(".tb-annotations-update-checkbox-include").filter(":visible").filter(":checked").length==0){TBUtilities.Alert("Please select at least 1 video to update annotations.");return}jQuery(".tb-annotations-update-checkbox-include").filter(":visible").filter(":checked").each(function(){if(jQuery(this).is(":checked")){var t=jQuery(this).attr("data-video-id");jQuery.each(e.videosWithFoundAnnotations,function(i,n){if(n.id==t){e.destinationVideos.push(n)}})}});jQuery("#tb-annotations-update-queue-list").empty();jQuery("#tb-annotations-update-completed-list").empty();a(4);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] [click] #tb-annotations-continue, #tb-annotations-kickoff"})}});jQuery(document).on("click",".tb-annotations-update-kickoff",function(){if(!jQuery(".tb-annotations-update-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to update the annotations");return}try{TBUtilities.AddAction({VideoCount:e.destinationVideos.length,AnnotationCount:e.selectedAutotationCount},TBUtilities.ActionTypes.BulkUpdateAnnotations_Update,"bulkupdateannotations")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationUpdae] [addAction]"})}jQuery(".tb-annotations-update-status").show();jQuery(".tb-annotations-update-confirm").hide();jQuery("#tb-annotations-update-stop").show();jQuery(".tb-annotations-update-cancel").hide();jQuery(".tb-annotations-update-back").hide();jQuery(".tb-annotations-update-kickoff").hide();jQuery(".tb-annotations-update-continue").hide();jQuery("#tb-annotations-update-close").hide();s();if(e.authToken){r();l()}else{f(e.destinationVideos[0].id)}});jQuery(document).on("click",".tb-annotations-update-back",function(){if(e.step>1){var t=e.step;e.step=e.step-1;a(e.step,t)}});jQuery(document).on("click","#tb-annotations-update-method-ids, #tb-annotations-update-method-playlist, #tb-annotations-update-method-search, #tb-annotations-update-method-full",function(t){e.method=parseInt(jQuery(this).attr("data-method"));switch(e.method){case 0:jQuery("#tb-annotations-update-input-ids").removeAttr("disabled","disabled");jQuery("#tb-annotations-update-input-playlist").attr("disabled","disabled");jQuery("#tb-annotations-update-input-search").attr("disabled","disabled");break;case 1:jQuery("#tb-annotations-update-input-ids").attr("disabled","disabled");jQuery("#tb-annotations-update-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-annotations-update-input-search").attr("disabled","disabled");break;case 2:jQuery("#tb-annotations-update-input-ids").attr("disabled","disabled");jQuery("#tb-annotations-update-input-playlist").attr("disabled","disabled");jQuery("#tb-annotations-update-input-search").removeAttr("disabled","disabled");break;case 3:jQuery("#tb-annotations-update-input-ids").attr("disabled","disabled");jQuery("#tb-annotations-update-input-playlist").attr("disabled","disabled");jQuery("#tb-annotations-update-input-search").attr("disabled","disabled");break}});jQuery(document).on("change keypress keyup paste keydown blur","#tb-annotations-update-input-playlist",function(t){e.playlistId="";var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-annotations-update-input-playlist-status").hide();return}if(i.indexOf("list=")>0){i=i.substring(i.indexOf("list=")+5)}if(i.length!=18&&i.length!=34||i.substring(0,2)!="PL"){jQuery("#tb-annotations-update-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-annotations-update-input-playlist-status").css("color","red")}else{jQuery("#tb-annotations-update-input-playlist-status").text("Valid Playlist Id");jQuery("#tb-annotations-update-input-playlist-status").css("color","green");e.playlistId=i}jQuery("#tb-annotations-update-input-playlist-status").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-annotations-update-input-search",function(t){e.search=jQuery(this).val().trim()});jQuery(document).on("click","#tb-annotations-update-stop",function(){e.isStopped=true;jQuery("#tb-annotations-update-stop").hide();jQuery("#tb-annotations-update-close").show();jQuery("#tb-annotations-update-working").hide();jQuery("#tb-annotations-update-stopped").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-annotations-update-input-ids",function(t){var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-annotations-update-input-ids-status").hide();return}jQuery("#tb-annotations-update-input-ids-status").show();e.specificVideoIds=[];if(i.indexOf(",")>-1){e.specificVideoIds=i.split(",")}else{e.specificVideoIds=i.split(" ")}for(var n=0;n<e.specificVideoIds.length;n++){e.specificVideoIds[n]=e.specificVideoIds[n].trim();e.specificVideoIds[n]=e.specificVideoIds[n].replace("https://www.youtube.com/watch?v=","");e.specificVideoIds[n]=e.specificVideoIds[n].replace("https://youtu.be/","");if(e.specificVideoIds[n].length!=11){e.specificVideoIds.splice(n,1);n--}}if(e.specificVideoIds.length==0){jQuery("#tb-annotations-update-input-ids-status").text("No videos detected");jQuery("#tb-annotations-update-input-ids-status").css("color","red")}else if(e.specificVideoIds.length==1){jQuery("#tb-annotations-update-input-ids-status").text("1 video detected");jQuery("#tb-annotations-update-input-ids-status").css("color","green");jQuery("#tb-annotations-update-method-ids").prop("checked",true);jQuery("#tb-annotations-update-method-ids").trigger("click")}else{jQuery("#tb-annotations-update-input-ids-status").text(e.specificVideoIds.length+" videos detected");jQuery("#tb-annotations-update-input-ids-status").css("color","green");jQuery("#tb-annotations-update-method-ids").prop("checked",true);jQuery("#tb-annotations-update-method-ids").trigger("click")}})};var a=function(t,i){try{jQuery(".tb-annotations-update-step1").hide();jQuery(".tb-annotations-update-step2").hide();jQuery(".tb-annotations-update-step3").hide();jQuery(".tb-annotations-update-step4").hide();jQuery(".tb-annotations-update-kickoff").hide();jQuery(".tb-annotations-update-continue").hide();jQuery(".tb-annotations-update-back").hide();jQuery("#tb-annotations-update-stop").hide();switch(t){case 1:{jQuery(".tb-annotations-update-step1").show();jQuery(".tb-annotations-update-continue").show();e.step=1;break}case 2:{e.specificVideoIds=[];e.specificVideos=[];e.playlistId="";e.search="";jQuery(".tb-annotations-update-step2").show();jQuery(".tb-annotations-update-continue").show();jQuery(".tb-annotations-update-back").show();jQuery("#tb-annotations-update-input-ids").val("");jQuery("#tb-annotations-update-input-playlist").val("");jQuery("#tb-annotations-update-input-search").val("");jQuery("#tb-annotations-update-input-ids-status").empty();jQuery("#tb-annotations-update-input-playlist-status").empty();e.step=2;break}case 3:{jQuery(".tb-annotations-update-step3").show();jQuery(".tb-annotations-update-continue").show();jQuery(".tb-annotations-update-back").show();if(i&&i==4){}else{jQuery(".tb-annotations-update-destination-list").empty();jQuery(".tb-annotations-update-destination-list").hide();jQuery(".tb-annotations-update-destination-selected-count").text("0");jQuery(".tb-annotations-update-count").text("0")}e.step=3;break}case 4:{jQuery(".tb-annotations-update-step4").show();jQuery(".tb-annotations-update-continue").hide();jQuery(".tb-annotations-update-kickoff").show();jQuery(".tb-annotations-update-back").show();jQuery(".tb-annotations-update-confirm").show();jQuery(".tb-annotations-update-status").hide();jQuery(".tb-annotations-update-continue").hide();e.step=4;break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] showstep "})}};var s=function(){var t=jQuery(".tb-annotations-update-target-select").val();var i=jQuery(".tb-annotations-update-target-input-field").val().toUpperCase();jQuery.each(e.destinationVideos,function(t,i){jQuery(i.annotations).each(function(){e.actionVideosSearched++;if(jQuery(".tb-annotations-update-action-url").is(":checked")&&jQuery(".tb-annotations-update-action-url-input").val()!=""){if(jQuery(this).find("url").length>0){jQuery(this).find("url").attr("value",jQuery(".tb-annotations-update-action-url-input").val())}}if(jQuery(".tb-annotations-update-action-text").is(":checked")&&jQuery(".tb-annotations-update-action-text-input").val()!=""){if(jQuery(this).find("TEXT").length>0){jQuery(this).find("TEXT").html(TBUtilities.GetHtmlEncoded(jQuery(".tb-annotations-update-action-text-input").val()))}}})})};var r=function(){TBUtilities.Log("startProcessing");try{e.totalDestinationVideos=e.destinationVideos.length;e.hasFinished=false;e.errorCount=0;e.successCount=0;jQuery("#tb-annotations-update-update-queue-list").empty();jQuery("#tb-annotations-update-completed-list").empty();jQuery("#tb-annotations-update-queue-list2").empty();jQuery("#tb-annotations-update-completed-list2").empty();jQuery("#tb-annotations-update-error-list2").empty();jQuery("#tb-annotations-update-error-list2").hide();jQuery("#tb-annotations-update-error-none-list2").show();jQuery("#tb-annotations-update-working").show();jQuery("#tb-annotations-update-done").hide();jQuery("#tb-annotations-update-stopped").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] [startProcessing]"})}};var l=function(){TBUtilities.Log("processNextVideo");try{jQuery("#tb-annotations-update-progress-container").html("Start &rarr;");if(e.isStopped)return;if(e.destinationVideos.length==0&&e.hasFinished==false){TBUtilities.Log("processNextVideo done");e.hasFinished=true;jQuery("#tb-annotations-update-status-count").html("<b>"+e.totalDestinationVideos+"</b> of <b>"+e.totalDestinationVideos+"</b> videos complete");jQuery("#tb-annotations-update-progress-container").hide();if(e.currentVideo){if(!e.currentVideo.error)c(e.currentVideo.video);else u(e.currentVideo.video)}d();jQuery("#tb-annotations-update-working").hide();jQuery("#tb-annotations-update-done").show();jQuery("#tb-annotations-update-stop").hide();jQuery("#tb-annotations-update-close").show();return}var t=e.destinationVideos[0].id;if(e.currentVideo){if(!e.currentVideo.error)c(e.currentVideo.video);else u(e.currentVideo.video)}var i=TBUtilities.RemoveFromArray(e.destinationVideos,"id",t);e.currentVideo=i[0];TBUtilities.Log(e.currentVideo);jQuery("#tb-annotations-update-status-count").html("<b>"+parseInt(e.totalDestinationVideos-e.destinationVideos.length)+"</b> of <b>"+e.totalDestinationVideos+"</b> videos complete");jQuery("#tb-annotations-update-progress-container").html(jQuery("#tb-annotations-update-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+t+'">'+t+"</a> &rarr;");d();TBGlobal.AddUserDebugInfo("Updating annotations for video: "+e.currentVideo.id);p(e.currentVideo)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] [processNextVideo]"});jQuery("#tb-annotations-update-progress-container").html(jQuery("#tb-annotations-update-progress-container").html()+"Error: "+e.message);TBUtilities.Alert('Sorry, there was an error: "'+e.message+'"');jQuery("#tb-annotations-update-stop").trigger("click");jQuery("#tb-annotations-update-stop").trigger("click")}};var d=function(){TBUtilities.Log("showNextToBeProcessed");jQuery("#tb-annotations-update-queue-list2").empty();jQuery("#tb-annotations-update-queue-complete-list2").hide();var t=0;jQuery.each(e.destinationVideos,function(e,i){var n=jQuery(".tb-annotations-update-processing-template2:last")[0].outerHTML;n=n.replace("#THUMBNAILURL#",i.video.snippet.thumbnails.default.url);n=TBUtilities.ReplaceAll(n,"#VIDEOID#",i.id);n=n.replace("#VIDEOTITLE#",i.video.snippet.title);n=n.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);n=n.replace("display: none","display:block");jQuery("#tb-annotations-update-queue-list2").prepend(n);t++;if(t==3)return false});if(t==0){jQuery("#tb-annotations-update-queue-complete-list2").show();jQuery("#tb-annotations-update-queue-list2").hide()}else{jQuery("#tb-annotations-update-queue-list2").show()}};var c=function(t){TBUtilities.Log("addCompletedSuccess");var i=jQuery(".tb-annotations-update-processed-success:last")[0].outerHTML;i=TBUtilities.ReplaceAll(i,"#VIDEOID#",t.id);i=i.replace("#VIDEOTITLE#",t.snippet.title);i=i.replace("#HREF#","https://www.youtube.com/my_videos_annotate?video_referrer=watch&v="+t.id);i=i.replace("display:none","display:block");jQuery("#tb-annotations-update-completed-list2").prepend(i);jQuery("#tb-annotations-update-completed-none-list2").hide();jQuery("#tb-annotations-update-completed-list2").show();e.successCount++;jQuery("#tb-annotations-update-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(e.successCount))};var u=function(t){try{jQuery("#tb-annotations-update-error-copy-container").show();var i=jQuery("#tb-annotations-update-error-copy").attr("data-clipboard-text");var n=[];if(i!=""){n=i.split(",");if(n.indexOf(t.id)==-1){n.push(t.id)}}else{n.push(t.id)}jQuery("#tb-annotations-update-error-copy").attr("data-clipboard-text",n.join(","))}catch(e){}TBUtilities.Log("addCompletedError");var o=jQuery(".tb-annotations-update-processed-error:last")[0].outerHTML;o=TBUtilities.ReplaceAll(o,"#VIDEOID#",t.id);o=o.replace("#VIDEOTITLE#",t.snippet.title);o=o.replace("#ERROR#",t.error);o=o.replace("#HREF#","https://www.youtube.com/my_videos_annotate?video_referrer=watch&v="+t.id);o=o.replace("display:none","display:block");jQuery("#tb-annotations-update-error-list2").prepend(o);jQuery("#tb-annotations-update-error-list2").show();jQuery("#tb-annotations-update-error-none-list2").hide();e.errorCount++;jQuery("#tb-annotations-update-error-list2-count").text(TBUtilities.FormatNumberWithCommas(e.errorCount))};var p=function(t){var i='<?xml version="1.0" encoding="UTF-8" ?><document>';i+='<requestHeader video_id="'+t.id+'"/>';i+='<authenticationHeader video_id="'+t.id+'" '+'auth_token="'+e.authToken+'"/>';i+="<updatedItems>";jQuery(t.annotations).each(function(){i+=this.outerHTML});i+="</updatedItems>";i+="</document>";i=TBUtilities.ReplaceAll(i,"highlightfontcolor","highlightFontColor");i=TBUtilities.ReplaceAll(i,"textsize","textSize");i=TBUtilities.ReplaceAll(i,"fgcolor","fgColor");i=TBUtilities.ReplaceAll(i,"borderalpha","borderAlpha");i=TBUtilities.ReplaceAll(i,"spacerelative","spaceRelative");i=TBUtilities.ReplaceAll(i,"bgalpha","bgAlpha");i=TBUtilities.ReplaceAll(i,"bgcolor","bgColor");i=TBUtilities.ReplaceAll(i,"anchoredregion","anchoredRegion");i=TBUtilities.ReplaceAll(i,"movingregion","movingRegion");i=TBUtilities.ReplaceAll(i,"rectregion","rectRegion");i=TBUtilities.ReplaceAll(i,"></appearance>","/>");i=TBUtilities.ReplaceAll(i,"</text>","</TEXT>");i=TBUtilities.ReplaceAll(i,"<text>","<TEXT>");i=TBUtilities.ReplaceAll(i,"></condition>","/>");i=TBUtilities.ReplaceAll(i,"></appearance>","/>");i=TBUtilities.ReplaceAll(i,"></rectregion>","/>");var n="https://www.youtube.com/annotations_auth/update2";TBExtension.Post(n,i,"CRTBAnnotationsUpdatePost",{xml:i,auth_token:e.authToken,video_id:t.id})};var b=function(){var t=0;jQuery(".tb-annotations-update-checkbox-include").filter(":visible").filter(":checked").each(function(){if(jQuery(this).is(":checked")){var i=jQuery(this).attr("data-video-id");jQuery.each(e.videosWithFoundAnnotations,function(e,n){if(n.id==i){t+=n.annotationCount}})}});return t};var y=function(t){try{e.actionVideosSearched=t.length;if(t==null){if(e.method==0)TBUtilities.Alert("No valid Video IDs found");else if(e.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(e.method==2)TBUtilities.Alert("No videos matching your search");else if(e.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-annotations-update-back").trigger("click");return}else if(t.length==0){if(e.method==0)TBUtilities.Alert("No valid Video IDs found");else if(e.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(e.method==2)TBUtilities.Alert("No videos matching your search");else if(e.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-annotations-update-update-back").trigger("click");return}jQuery(".tb-annotations-update-destination-list").empty();jQuery(".tb-annotations-update-destination-list").hide();jQuery(".tb-annotations-update-no-videos").hide();jQuery(".tb-annotations-update-loading-videos").show();jQuery(".tb-annotations-update-loading-text").html("Hang Tight!<br /><br />We are currently looking through the videos you selected to find Annotations that match your search criteria. This generally takes a couple seconds per video meaning it may take up to 30 minutes per 1,000 videos you have.");jQuery(".tb-annotations-loading-count-container").hide();jQuery(".tb-annotations-update-loading-text-search").text("");e.videosWithFoundAnnotations=[];var i=0;jQuery.each(t,function(n,o){if(o.id.videoId!=null){o.id=o.id.videoId}if(o.snippet.resourceId!=null)o.id=o.snippet.resourceId.videoId;if(o.snippet!=null&&o.snippet.title=="Deleted video"&&o.snippet.thumbnails==null)return;jQuery.ajaxQueue({url:"https://www.youtube.com/annotations_auth/read2?video_id="+o.id,type:"GET",dataType:"html",success:function(n){jQuery(".tb-annotations-update-loading-text-search").html("Searching annotations for video "+o.id);var a=h(n);if(a.length>0){var s=TBUtilities.GetInArray(e.videosWithFoundAnnotations,"id",o.id);if(!s){e.videosWithFoundAnnotations.push({video:o,annotations:a,id:o.id,error:"",annotationCount:a.length});var r=jQuery("#tb-annotations-update-destination-template").html();var l="annotations";if(a.length==1){l="annotation"}var d=r.formatTemplate(o.id,o.snippet.thumbnails.default.url,"https://www.youtube.com/my_videos_annotate?feature=vm&v="+o.id,o.snippet.title,a.length.toString(),l,o.status.privacy);jQuery(".tb-annotations-update-destination-list").prepend(d)}}i++;if(i>=t.length){m()}},error:function(e,n,a){TBUtilities.Log("Failed to search annotations for video "+o.id);jQuery(".tb-annotations-update-loading-text-search").html("Failed to search annotations for video "+o.id);i++;if(i>=t.length){m()}}})})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] [gotVideoList]"})}};var m=function(){if(e.method==0||e.method==1)jQuery("#tb-annotations-update-select-all-checkboxes").trigger("click");jQuery(".tb-annotations-update-loading-videos").hide();if(e.videosWithFoundAnnotations.length==0){jQuery(".tb-annotations-update-no-videos").show();jQuery(".tb-annotations-update-destination-list").hide();jQuery(".tb-annotations-update-continue").hide()}else{jQuery(".tb-annotations-update-destination-list").show();jQuery(".tb-annotations-update-continue").show()}};var h=function(e){var t=[];var i=jQuery(".tb-annotations-update-target-select").val();var n=jQuery(".tb-annotations-update-target-input-field").val().toUpperCase();try{jQuery(e).find("annotation").each(function(){if(i=="url"){if(jQuery(this).find("url").length>0&&(jQuery(this).find("url").attr("value").toUpperCase()===n||jQuery(this).find("url").attr("value").toUpperCase()===n.replace(/^https:\/\//i,"http://").toUpperCase())){t.push(this);return true}}if(i=="text"){if(jQuery(this).find("TEXT").length>0&&jQuery(this).find("TEXT").html().toUpperCase()===n){t.push(this);return true}}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] searchAnnotations"})}return t};var f=function(e){try{var t="https://www.youtube.com/my_videos_annotate?feature=vm&v="+e;TBExtension.Get(t,"CRTBUpdatAnnotationsGetList")}catch(e){}};var v=function(e){var t=null;var i=e.match(/"auth_token": "(\S+)"/);if(i!==null)t=i[1];else{var n=e.indexOf('"auth_token":"')+'"auth_token":"'.length;var o=e.indexOf('"',n);t=e.substring(n,o)}return t};var g=function(){var t=e.specificVideoIds[0];e.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(t,"contentDetails, snippet, id, status",T)};var T=function(t){if(t!=null)e.specificVideos.push(t);if(e.specificVideoIds.length>0){g()}else{y(e.specificVideos)}};var j=function(){jQuery(document.body).on("CRTBUpdatAnnotationsGetList",function(t,i){try{if(i.success){var n=v(i.response);if(n){e.authToken=n;r();l()}}}catch(e){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyAnnotationsUpdate] CRTBUpdatAnnotationsGetList"})}});jQuery(document.body).on("CRTBLoadAnnotationsUpdateTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] CRTBLoadAnnotationsUpdateTemplate"})}});jQuery(document.body).on("CRTBAnnotationsUpdatePost",function(t,i){TBUtilities.Log("In CRTBAnnotationsUpdatePost");try{if(i.success){TBUtilities.Log(i);var n='<document><requestHeader video_id="'+i.data.video_id+'"/><authenticationHeader video_id="'+i.data.video_id+'" auth_token="'+i.data.auth_token+'"/></document>';TBUtilities.Log(n);var o="https://www.youtube.com/annotations_auth/publish2";TBExtension.Post(o,n,"CRTBAnnotationsPublish2Post",{})}else{e.currentVideo.error="Failed to update annotations";l()}}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyAnnotationsUpdate] CRTBAnnotationsUpdatePost"});l()}});jQuery(document.body).on("CRTBAnnotationsPublish2Post",function(t,i){TBUtilities.Log("In CRTBAnnotationsPublish2Post");TBUtilities.Log(i);try{if(i.success){l()}else{e.currentVideo.error="Failed to update annotations";l()}}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyAnnotationsUpdate] CRTBAnnotationsUpdatePost"});l()}})};var Q=function(e){if(e.totalCount-e.loaded>50){jQuery(".tb-annotations-update-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-annotations-update-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-annotations-update-onlyLoadFirstPage-number").val())}jQuery(".tb-annotations-update-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery(".tb-annotations-update-loading-count"))}else{jQuery(".tb-annotations-update-rendering").show();jQuery(".tb-annotations-update-loading-count-container").hide()}};var B=function(){try{jQuery("#tb-annotations-update-error-copy-container").hide();jQuery("#tb-annotations-update-error-copy").prop("data-clipboard-text","");var t=new ClipboardJS("#tb-annotations-update-error-copy");e.destinationVideos=[];e.videosWithFoundAnnotations=[];e.specificVideos=[];e.currentVideo=null;e.isStopped=false;e.authToken=null;e.specificVideoIds=[];jQuery('input[type="radio"][value="url"]').prop("checked",true);jQuery(".tb-annotations-update-target-input").prop("disabled",true);jQuery(".tb-annotations-update-target-url").prop("disabled",false);jQuery(".tb-annotations-update-target-input").val("");jQuery(".tb-annotations-update-action-input").val("");jQuery(".tb-annotations-update-action-input").prop("disabled",true);jQuery(".tb-annotations-update-action-option").prop("checked","");jQuery(".tb-annotations-kickoff").hide();jQuery(".tb-annotations-update-filter").val("all");jQuery(".tb-annotations-update-confirm-checkbox").prop("checked","");jQuery(".tb-annotations-update-no-videos").hide();jQuery(".tb-annotations-update-loading-videos").show();jQuery(".tb-annotations-update-loading-count").text("0");jQuery(".tb-annotations-update-loading-count-total").text("?");jQuery(".tb-annotations-update-loading-text-search").text("");jQuery(".tb-annotations-update-loading-text").text("Loading your videos...");jQuery(".tb-annotations-loading-count-container").show();jQuery(".tb-annotations-update-target-input-field").val("");jQuery("#tb-annotations-update-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-annotations-update-onlyLoadFirstPage").prop("checked",false);e.step=1;a(e.step);jQuery("#tb-annotations-update-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsUpdate] prepareDialog"})}};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!t){j();n();o();t=true}}},Show:function(){B()}}}();var TubeBuddyVideoMenu=function(){var e=false;var t=function(){if(jQuery(".tb-video-tools-menu-dropdown").length>0){jQuery(".creator-editor-nav-aside").prepend(jQuery(".tb-video-tools-menu-dropdown")[0].outerHTML.replace("display:none;",""))}};var i=function(){jQuery(".tb-video-menu-overview").toggleClass("tb-hid")};var n=function(){var e=TBGlobal.host+"/ModuleManager/videomenu/videomenu?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/videomenu.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/videomenu.html"}TBExtension.Get(e,"CRTBLoadVideoMenuVideoMenu")};var o=function(){if(TBUtilities.GetUrlParameter("video_id"))return TBUtilities.GetUrlParameter("video_id");else return TBUtilities.GetUrlParameter("v")};var a=function(){if(jQuery("#creator-editor-title-link").length>0)return jQuery("#creator-editor-title-link").attr("title");return""};var s=function(){if(jQuery(".video-settings-description").length>0)return jQuery(".video-settings-description").text().trim();return""};var r=function(){if(jQuery(".video-view-count").find(".video-info-text").length>0)return jQuery(".video-view-count").find(".video-info-text").text().trim();return""};var l=function(){return new Promise(function(e){var t=o();if(TBUtilities.GetCookie("tb-edit-video-hide-menu")!="true"){var i=setInterval(function(){if(jQuery("#tb-editvideo-nav-list img").length>0){clearInterval(i);var n=jQuery('#tb-editvideo-nav-list img[data-videoid="'+t+'"]').attr("src");if(n.length>0){e(n)}else{e(jQuery(".selectable-thumb-selected img").attr("src"))}}},100)}else{e(jQuery(".selectable-thumb-selected img").attr("src"))}})};var d=function(e){jQuery(".tb-video-list-playlists-container").html('<span class="tb-spinner"></span> Loading Playlists...');TBExtension.Get("https://www.youtube.com/edit?o=U&video_id="+e,"CRTBLoadVideosMenuEditPage",{videoId:e})};var c=function(){jQuery(document).on("click",".tb-video-tools-menu-dropdown-ab-test",function(){var e=o();var t=a();i(true);l().then(function(i){window.open(TBGlobal.host+"/channel/abtestcreate/"+TBGlobal.CurrentChannelId()+"?videoid="+e+"&videotitle="+t+"&videothumbnail="+i,"_blank")})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-comments",function(){var e=jQuery(this).attr("data-id");TBUtilities.Confirm("Are you sure you want to export all comments (1,000 max) from this video to a CSV file?\n\nThis process can take up to 2 MINUTES to complete based on how many comments you have (so be patient).",function(){if(!TBGlobal.CanAccessLevel3Tools()){TBGlobal.ShowUpgradePage("export video comments",TBGlobal.limitation.exportComments);return false}var t=TBGlobal.host+"/youtubechannel/ExportVideoComments?channelId="+TBGlobal.CurrentChannelId()+"&videoId="+e;var i=window.open(t,"_blank");i.focus()},null)});jQuery(document).on("click",".tb-video-tools-menu-seo-studio",function(){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddySeoStudio.ShowSeoStudio(null,o(),a())});jQuery(document).on("click",".tb-video-id-copy",function(){jQuery(".tb-video-id-copy").text("Copied");window.setTimeout(function(){jQuery(".tb-video-id-copy").text("Copy")},1500)});jQuery(document).on("click",".tb-video-link-copy",function(){jQuery(".tb-video-link-copy").text("Copied");window.setTimeout(function(){jQuery(".tb-video-link-copy").text("Copy")},1500)});jQuery(document).on("click",".tb-video-menu-playlist-copy",function(){jQuery(this).text("Copied");window.setTimeout(function(){jQuery(".tb-video-menu-playlist-copy").text("Copy")},1500)});jQuery(document).on("click",".tb-video-menu-item-url",function(e){var t=jQuery(this).find("a").attr("href");var i=window.open(t,"_blank")});jQuery(document).on("click",".tb-video-tools-menu-dropdown",function(e){var t=o();var i=a();if(jQuery(".tb-video-tools-menu-dropdown").find(".tb-video-menu-overview").length==0){var n=jQuery("#tb-video-tools-menu-dropdown-template").html();var s=n.formatTemplate(t,i);jQuery(".tb-video-tools-menu-dropdown").append(s);var r=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoStatus+"?videoId="+o();TBExtension.Get(r,"CRTBEditVideoAnnotationsLoadVideoStatus")}jQuery(".tb-video-tools-menu-dropdown").find(".tb-video-menu-overview").toggleClass("tb-hid");e.stopPropagation()});jQuery(document).on("click","#tb-videosmenu-info-tab",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-videosmenu-tab-header",function(e){e.stopPropagation();jQuery(this).parent().find(".tb-videosmenu-tab-header, .tb-tab-icon-selected").removeClass("selected tb-tab-icon-selected");jQuery(this).addClass("selected");jQuery(this).find(".tb-tab-icon").addClass("tb-tab-icon-selected");jQuery(this).parent().parent().find(".tb-videosmenu-tab-container").hide();jQuery(this).parent().parent().find("#"+jQuery(this).attr("data-tab-id")).show();var t=o();var i=a();var n="https://img.youtube.com/vi/"+t+"/mqdefault.jpg";jQuery(this).closest("div").find(".tb-videos-list-info-video-id").val(t);jQuery(this).closest("div").find(".tb-videos-list-info-video-link").val("https://youtu.be/"+t);jQuery(".tb-video-id-copy").attr("data-clipboard-text",t);var s=new ClipboardJS(".tb-video-id-copy");jQuery(".tb-video-link-copy").attr("data-clipboard-text","https://youtu.be/"+t);var r=new ClipboardJS(".tb-video-link-copy");if(jQuery(this).parent().parent().find(".tb-video-list-playlists-container").html().trim().length==0)d(t)});jQuery(document).on("click",".tb-video-tools-menu-video-overview",function(e){e.stopPropagation()});jQuery(document).on("click","#page",function(){jQuery("div.tb-video-menu-overview").addClass("tb-hid")});jQuery(document).on("change",".tb-video-tools-menu-comment-filters",function(e){if(jQuery(this).val()=="filter")return;var t=window.open("https://www.youtube.com/comments?filter="+o()+"&tbfilter="+jQuery(this).val(),"_blank");jQuery(this).val("filter");e.stopPropagation()});jQuery(document).on("click",".tb-video-tools-menu-dropdown-promote",function(e){var t=o();var n=a();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyV2VPromote.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-twitter",function(e){var t=o();var n=a();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTwitterPost.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-captions",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTranscriptions.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-social-monitor",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddySocialMonitor.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-copy-cards",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyCards.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-embed",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyEmbed.ShowForVideo(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-share-tracker",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyShareTracker.ShowForVideo(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-search-ranking",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddySearchRanking.Show(t,e,n)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-suggested-tags",function(e){if(window.location.href.indexOf("edit")>-1){e.preventDefault();var t=o();var n=a();TubeBuddyMenu.ShowBackgroundSticky();TubeBuddySuggestedTags.Show(t,n,jQuery(this));i();e.stopPropagation()}});jQuery(document).on("click",".tb-video-tools-menu-dropdown-tag-translator",function(e){if(window.location.href.indexOf("edit")>-1){e.preventDefault();var t=[];jQuery(".video-settings-tag-chips-container").find(".yt-chip").each(function(e){t.push(jQuery(this).find("span:first").text())});TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagTranslator.Show(t);i();e.stopPropagation()}});jQuery(document).on("click",".tb-video-tools-menu-dropdown-thumbnail-creator",function(e){var t=o();var n=a();var d=r();var c=s();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyThumbnailCreator.Show(t,n,e,c,d)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-pick-a-winner",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyPickAWinner.Show(t,e,n)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-export-to-facebook",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyCopyToFacebook.Show(t,e,n)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-sunset-video",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddySunsetVideo.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-golive-video",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyGoLiveVideo.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-scheduled-video-update-video",function(e){var t=o();var n=a;i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyScheduledMetaUpdates.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-gif-generator",function(e){var t=o();var n=a();var s="https://img.youtube.com/vi/"+t+"/mqdefault.jpg";TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyGifGenerator.Show(t,n,s);i();e.stopPropagation()});jQuery(document).on("click",".tb-video-tools-menu-dropdown-apply-card-template",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyCardTemplates.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-copy-endscreen",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyEndScreens.Show(t,n,e)})});jQuery(document).on("click",".tb-video-tools-menu-dropdown-apply-endscreen-template",function(e){var t=o();var n=a();i();e.stopPropagation();i();e.stopPropagation();l().then(function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyEndScreenTemplates.Show(t,n,e)})})};var u=function(){jQuery(document.body).on("CRTBLoadVideosMenuEditPage",function(e,t){if(t.success){var i=t.response.indexOf("{'X-YouTube-Identity-Token': \"")+"{'X-YouTube-Identity-Token': \"".length;var n=t.response.indexOf('"',i+2);var o=t.response.substring(i,n);var a={video_ids:t.data.videoId,session_token:o,src_playlist_id:""};TBExtension.Post("https://www.youtube.com/addto_ajax?action_get_dropdown=1&hide_watch_later=true&feature=edit",jQuery.param(a),"CRTBLoadVideosMenuPlaylistData",{videoId:t.data.videoId},{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}else{}});jQuery(document.body).on("CRTBLoadVideosMenuPlaylistData",function(e,t){var i=false;if(t.success){$(".tb-video-list-playlists-container").empty();var n=t.data.videoId;var o=DOMPurify.sanitize(t.response,DOMPurifyConfig);jQuery(o).find("li").each(function(){var e=jQuery(this).find(".playlist-name:first").html();var t=jQuery(this).find("button:first").attr("aria-checked");var o=jQuery(this).attr("data-full-list-id");if(t=="checked"){$(".tb-video-list-playlists-container").append('<div style="padding:0 0 10px"><b>Playlist Link - "'+e+'"</b><br /> <input class="tb-material-input" style="width:50% !important;" type="text" value="https://www.youtube.com/watch?v='+n+"&list="+o+'" /><button id="tb-video-menu-playlist-copy-'+o+'" class="tb-btn-blue tb-video-menu-playlist-copy" data-clipboard-text="https://www.youtube.com/watch?v='+n+"&list="+o+'">Copy</button></div>');i=true;new ClipboardJS("#tb-video-menu-playlist-copy-"+o)}});if(!i){$(".tb-video-list-playlists-container").append('<div style="padding:15px 0 10px 5px; color:coral;">This video was not found in any of your Playlists.</div>')}}else{}});jQuery(document.body).on("CRTBLoadVideoMenuVideoMenu",function(e,i){try{if(i.success){i.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i.response,DOMPurifyConfig));jQuery("body").append(i.response);t()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideoMenu] CRTBLoadVideoMenuVideoMenu"})}});jQuery(document.body).on("CRTBEditVideoAnnotationsLoadVideoStatus",function(e,t){if(t.success){var i=JSON.parse(t.response);if(i.DateThumbnailGeneratedLocal){jQuery(".tb-video-tools-menu-thumbnail-generated-date").text(i.DateThumbnailGeneratedLocal);jQuery(".tb-video-tools-menu-thumbnail-generated").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.IsCardTemplate){jQuery(".tb-video-tools-menu-is-card-template").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.DateFacebookPostedLocal){jQuery(".tb-video-tools-menu-facebook-date").text(i.DateFacebookPostedLocal);jQuery(".tb-video-tools-menu-view-facebook").attr("href","https://www.facebook.com/video/video.php?v="+i.FacebookVideoId);jQuery(".tb-video-tools-menu-facebook").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.ScheduledGoLiveLocal){jQuery(".tb-video-tools-menu-golive-date").text(i.ScheduledGoLiveLocal);jQuery(".tb-video-tools-menu-golive").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.DateWentLiveLocal){jQuery(".tb-video-tools-menu-wentlive-date").text(i.DateWentLiveLocal);jQuery(".tb-video-tools-menu-wentlive").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.DateSunsetLocal){jQuery(".tb-video-tools-menu-sunset-date").text(i.DateSunsetLocal);jQuery(".tb-video-tools-menu-sunset").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.DateSunsettedLocal){jQuery(".tb-video-tools-menu-sunsetted-date").text(i.DateSunsettedLocal);jQuery(".tb-video-tools-menu-sunsetted").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.DateScheduledMetaUpdate){jQuery(".tb-video-tools-menu-scheduledmetaupdate-date").text(i.DateScheduledMetaUpdateLocal);jQuery(".tb-video-tools-menu-scheduledmetaupdate").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.DateScheduledMetaUpdated){jQuery(".tb-video-tools-menu-scheduledmetaupdated-date").text(i.DateScheduledMetaUpdatedLocal);jQuery(".tb-video-tools-menu-scheduledmetaupdated").show();jQuery(".tb-video-tools-menu-notes").show()}if(i.SharedWithNetworks!=null){jQuery(".tb-video-tools-menu-share-tracker-items").show();jQuery.each(i.SharedWithNetworks,function(e,t){jQuery(".tb-video-tools-menu-share-tracker-items-list").append('<img src="'+TBGlobal.host+"/images/icons/social/"+t+'.png" style="height:12px;" /> ')});jQuery(".tb-video-tools-menu-notes").show()}}else{}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();n();c();e=true}else{t()}}}}}();var TubeBuddyAnnotationTemplates=function(){var e=false;var t;var i;var n;var o=[];var a={videoId:"",annotations:[],selectedAnnotations:[]};var s;var r;var l;var d;var c=0;var u=0;var p=function(){jQuery("#tb-annotation-templates-list-container").html('<div style="padding:20px;"><img src="'+TBGlobal.host+'/images/general/loading1.gif" style="position:relative; top:2px;" /> Loading...</div>');var e=TBUtilities.GetInArray(o,"Id",jQuery("#tb-annotation-templates-select").val());jQuery("#tb-annotation-templates-edit-template").attr("href","https://www.youtube.com/my_videos_annotate?v="+e.Id);TBYouTubeApi.GetVideoDetails(e.Id,null,b)};var b=function(e){d=new timelord(e.contentDetails.duration).ticks();a.videoId=e.id;var t="https://www.youtube.com/annotations_auth/read2?video_id="+e.id;TBExtension.Get(t,"CRTBTemplatesLoadAnnotationsForVideo")};var y=function(){var e=TBGlobal.host+"/ModuleManager/annotationtemplates/annotationtemplates?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/annotationtemplates.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/annotationtemplates.html"}TBExtension.Get(e,"CRTBLoadAnnotationTemplateTemplate")};var m=function(){var e="https://www.youtube.com/my_videos_annotate?feature=vm&v="+r;TBExtension.Get(e,"CRTBAnnotationTemplatesLoadAnnotationsGetList")};var h=function(e){TubeBuddyYouTubeActions.DeleteAnnotations(l.id,e,m)};var f=function(){jQuery(document).on("click",".tb-annotations-default-setting",function(e){e.stopPropagation()});jQuery(document).on("change","#tb-annotation-templates-select",function(){p()});jQuery(document).on("click","#tb-annotation-templates-delete-template",function(){TBUtilities.Confirm("Are you sure you want to delete this Annotation Template?",g,null)});jQuery(document).on("click","#tb-annotation-templates-reload-templates",function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoAnnotationTemplates;TBExtension.Get(e,"CRAnnotationTemplatesGetVideoAnnotationTemplates",null)});jQuery(document).on("click","#tb-annotation-templates-apply",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("Sorry, you cannot apply Annotation Templates unless upgrade your TubeBuddy License.",TBGlobal.limitation.annotationTemplates);return}jQuery("#tb-annotations-template-working").show();jQuery(this).hide();if(jQuery("#tb-annotation-templates-delete-all").prop("checked")){TubeBuddyYouTubeActions.GetAnnotations(l,h)}else{m()}});jQuery(document).on("click","#tb-annotation-templates-close, .tb-annotation-templates-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-annotation-templates-container").hide()});jQuery(document).on("click","#tb-annotation-templates-test-import",function(){var e=jQuery("#tb-import-test").val();alert(e);var t={};t.response=e;t.success=true;jQuery(document.body).trigger("CRTBTemplatesLoadAnnotationsForVideo",e)});jQuery(document).on("click",".tb-annotation-templates-annotations-item",function(){try{var e=jQuery(this).attr("data-index");var t=TBUtilities.GetInArray(a.selectedAnnotations,"index",e);if(t==null){var i=TBUtilities.GetInArray(a.annotations,"index",e);a.selectedAnnotations.push(i);if(i.ref){var n=TBUtilities.GetInArray(a.annotations,"id",i.ref);a.selectedAnnotations.push(n)}jQuery(this).addClass("tb-annotation-templates-annotations-item-selected")}else{TBUtilities.RemoveFromArray(a.selectedAnnotations,"index",e);if(t.ref){TBUtilities.RemoveFromArray(a.selectedAnnotations,"id",t.ref)}jQuery(this).removeClass("tb-annotation-templates-annotations-item-selected")}var o=jQuery(".tb-annotation-templates-annotations-item-selected").length;jQuery("#tb-annotation-templates-how-many").text(o+" of "+c+" selected");if(a.selectedAnnotations.length==0)jQuery("#tb-annotation-templates-apply").hide();else jQuery("#tb-annotation-templates-apply").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotations] [click] tb-annotations-annotations-item"})}})};var v=function(){location.reload()};var g=function(e){var e=jQuery("#tb-annotation-templates-select").val();var t=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleAnnotationTemplate;var i={Id:e,Enabled:false,Title:""};TBExtension.Post(t,JSON.stringify(i),"CRTBAnnotationTemplateAnnotationsTemplateToggle",null,"application/json")};var T=function(e){try{l=e;s=new timelord(e.contentDetails.duration).ticks();var t=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoAnnotationTemplates;TBExtension.Get(t,"CRAnnotationTemplatesGetVideoAnnotationTemplates",null)}catch(e){TBUtilities.LogError({Exception:e,Location:"[AnnotationTemplates] [api callback] destinationVideoDetailsCallback"})}};var j=function(e,t,i){jQuery("#tb-annotation-templates-loading-container").show();jQuery("#tb-annotation-templates-none").hide();jQuery("#tb-annotation-templates-apply-container").hide();jQuery("#tb-annotation-templates-apply").hide();TBYouTubeApi.GetVideoDetails(e,null,T);r=e;jQuery("#tb-annotation-templates-container").fadeIn();jQuery("#tb-annotation-templates-how-many").text("");jQuery("#tb-annotation-templates-thumbnail").attr("src",i);jQuery("#tb-annotation-templates-title").text(t);jQuery("#tb-annotation-templates-title").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-annotations-template-working").hide()};var Q=function(){jQuery(document.body).on("CRTBAnnotationTemplateAnnotationsTemplateToggle",function(e,t){var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoAnnotationTemplates;TBExtension.Get(i,"CRAnnotationTemplatesGetVideoAnnotationTemplates",null)});jQuery(document.body).on("CRTBAnnotationTemplatesLoadAnnotationsGetList",function(e,t){var i="[Start]";try{if(t.success){var n="";var o=t.response.match(/"auth_token": "(\S+)"/);if(o!==null)n=o[1];else{var s=t.response.indexOf('"auth_token":"')+'"auth_token":"'.length;var r=t.response.indexOf('"',s);n=t.response.substring(s,r);if(n.indexOf("html")>=0){TBGlobal.AddUserDebugInfo("NO AUTH TOKEN FULL HTML: "+t.response)}}var d='<?xml version="1.0" encoding="UTF-8" ?><document>';d+='<requestHeader video_id="'+l.id+'"/>';d+='<authenticationHeader video_id="'+l.id+'" '+'auth_token="'+n+'"/>';d+="<updatedItems>";var c=new timelord(l.contentDetails.duration);var u=c.ticks();try{TBUtilities.AddAction({AnnotationCount:a.selectedAnnotations.length},TBUtilities.ActionTypes.AnnotationTemplates_Applied,"annotationtemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[CardTemplates] [applyCards]"})}jQuery.each(a.selectedAnnotations,function(e,t){t.fullXML=t.fullXMLOriginal;if(t.refTimeUpdated==null){t.refTimeUpdated=false;TBGlobal.AddUserDebugInfo("YES REF NULL")}else{TBGlobal.AddUserDebugInfo("NO NOT NULL - "+t.refTimeUpdated)}if(t.ref!=""&&t.ref!=null&&(t.startTime=="never"||t.endTime=="0:00.000")){for(var i=0;i<a.annotations.length;i++){var n=a.annotations[i];if(n.id==t.ref){t.startTime=n.startTime;t.endTime=n.endTime;t.totalTimeMiliseconds=n.totalTimeMiliseconds;t.distanceFromEnd=n.distanceFromEnd;t.dockAtEnd=n.dockAtEnd;t.dockAtStart=n.dockAtStart;t.refTimeUpdated=true;TBGlobal.AddUserDebugInfo("-Is Ref New Start Time: "+JSON.stringify(t.startTime))}}}var o=[];var s=0;var r=[];var l=0;var c=0;var p=0;var b=new TimeSpan(0,0,0,0);if(t.startTime!="never"&&t.endTime!="0:00.000"){o=t.startTime.split(".");s=parseInt(o[1]);r=o[0].split(":");l=0;c=0;p=0;if(r.length==3){l=parseInt(r[0]);c=parseInt(r[1]);p=parseInt(r[2])}else{c=parseInt(r[0]);p=parseInt(r[1])}b=new TimeSpan(s,p,c,l);o=t.endTime.split(".");s=parseInt(o[1]);r=o[0].split(":");l=0;c=0;p=0;if(r.length==3){l=parseInt(r[0]);c=parseInt(r[1]);p=parseInt(r[2])}else{c=parseInt(r[0]);p=parseInt(r[1])}var y=new TimeSpan(s,p,c,l);t.totalTimeMiliseconds=y.totalMilliseconds()-b.totalMilliseconds();TBGlobal.AddUserDebugInfo("-item.totalTimeMiliseconds: "+t.totalTimeMiliseconds);TBGlobal.AddUserDebugInfo("-thisVideoTotalMiliseconds: "+u);if(b.totalMilliseconds()>u){y=new TimeSpan(u,0,0);var m=u-t.totalTimeMiliseconds;if(m<0)m=0;TBGlobal.AddUserDebugInfo("-Starts After Video Ends. New Start Time: "+m);b=new TimeSpan(m,0,0)}else if(y.totalMilliseconds()>u){TBGlobal.AddUserDebugInfo("-Ending After Video Ends. Adjusting to fit end.");y=new TimeSpan(u,0,0)}if(t.dockAtEnd==true){TBGlobal.AddUserDebugInfo("-Yes, is Docked to the End.");var h=u-t.distanceFromEnd;y=new TimeSpan(h,0,0,0,0);var f=h-t.totalTimeMiliseconds;if(f<0)f=0;b=new TimeSpan(f,0,0,0,0);TBGlobal.AddUserDebugInfo("-> New Time to start: "+f);TBGlobal.AddUserDebugInfo("-> New Time to end: "+h)}if(t.dockAtStart==true){TBGlobal.AddUserDebugInfo("-Yes, is Docked to the Start.");if(t.ref!=null&&t!=""){for(var i=0;i<a.annotations.length;i++){var n=a.annotations[i];if(n.id==t.ref){var v=n.startTimeTimeMiliseconds;b=new TimeSpan(v,0,0,0,0);TBUtilities.Log("Inside Ref StartTime")}}}else{TBUtilities.Log("Outside Ref StartTime");var g=t.startTimeTimeMiliseconds;b=new TimeSpan(g,0,0,0,0)}TBGlobal.AddUserDebugInfo("-> New Time to start: "+g)}if(t.refTimeUpdated!=true){TBGlobal.AddUserDebugInfo("-Reference Time was not updated");var T=t.fullXML;var j=T.indexOf(' t="')+4;var Q=T.indexOf('"',j);var B=t.fullXML.substring(0,j);B+=b.hours()+":"+b.minutes()+":"+b.seconds()+"."+b.milliseconds();B+=t.fullXML.substring(Q,t.fullXML.length);TBGlobal.AddUserDebugInfo("-> Inserting Start: "+JSON.stringify(b));var k=B.indexOf(' t="',Q)+4;var w=B.indexOf('"',k);t.fullXML=B.substring(0,k);var x=y.hours()+":"+y.minutes()+":"+y.seconds()+"."+y.milliseconds();t.fullXML+=x;t.fullXML+=B.substring(w,B.length);TBGlobal.AddUserDebugInfo("-> Inserting End: "+x)}}var U=jQuery("textarea[data-annotation-default-id="+t.id+"]").val();if(!U)U="";U=TBUtilities.GetXmlEncoded(U);t.fullXML=t.fullXML.replace("<TEXT>"+TBUtilities.GetHtmlEncoded(t.text)+"</TEXT>","<TEXT>"+U+"</TEXT>");if(jQuery("input[data-annotation-default-id="+t.id+"]").length>0){var L=jQuery("input[data-annotation-default-id="+t.id+"]").val();t.fullXML=t.fullXML.replace(t.url,L);t.fullXML=t.fullXML.replace(TBUtilities.ReplaceAll(t.url,"&","&amp;"),TBUtilities.ReplaceAll(L,"&","&amp;"))}else{}if(t.ref!=null&&t!=""){t.fullXML=t.fullXML.replace("<segment>",'<segment spaceRelative="'+t.ref.trim()+'">')}if(t.ref!=null&&t!=""){for(var i=0;i<a.annotations.length;i++){var n=a.annotations[i];if(n.id==t.ref){referenceItem=n;d+='<annotation author="'+referenceItem.author+'" id="'+referenceItem.id+'" type="'+referenceItem.type+'" style="'+referenceItem.style+'">';referenceItem.fullXML=referenceItem.fullXML.replace('movingRegion type="rect"','movingRegion type="rect" pattern="fixed"');referenceItem.fullXML=referenceItem.fullXML.replace('pattern="fixed" pattern="fixed"','pattern="fixed"');if(jQuery("input[data-annotation-default-id="+referenceItem.id+"]").length>0){var C=jQuery("input[data-annotation-default-id="+referenceItem.id+"]").val();referenceItem.fullXML=referenceItem.fullXML.replace(referenceItem.url,C)}else{}if(t.refTimeUpdated==true){TBGlobal.AddUserDebugInfo("-Yes, Reference Time was updated");var T=referenceItem.fullXML;var j=T.indexOf(' t="')+4;var Q=T.indexOf('"',j);var B=referenceItem.fullXML.substring(0,j);B+=b.hours()+":"+b.minutes()+":"+b.seconds()+"."+b.milliseconds();B+=referenceItem.fullXML.substring(Q,referenceItem.fullXML.length);TBGlobal.AddUserDebugInfo("-> Inserting Start: "+JSON.stringify(b));var k=B.indexOf(' t="',Q)+4;var w=B.indexOf('"',k);referenceItem.fullXML=B.substring(0,k);var x=y.hours()+":"+y.minutes()+":"+y.seconds()+"."+y.milliseconds();referenceItem.fullXML+=x;referenceItem.fullXML+=B.substring(w,B.length);TBGlobal.AddUserDebugInfo("-> Inserting End: "+x)}d+=referenceItem.fullXML;d+="</annotation>";break}}}d+='<annotation author="'+t.author+'" id="'+t.id+'" type="'+t.type+'" style="'+t.style+'">';d+=t.fullXML;d+="</annotation>"});d+="</updatedItems>";d+="</document>";d=TBUtilities.ReplaceAll(d,"spacerelative=","spaceRelative=");d=TBUtilities.ReplaceAll(d,"></rectRegion>","/>");d=TBUtilities.ReplaceAll(d,"highlightwidth","highlightWidth");if(d.indexOf('borderAlpha="0.0"')>0){d=TBUtilities.ReplaceAll(d,'borderAlpha="0.0"','borderAlpha="0"')}TBGlobal.AddUserDebugInfo(d);var p="https://www.youtube.com/annotations_auth/update2";TBExtension.Post(p,d,"CRTBAnnotationTemplateLoadAnnotationsUpdatePost",{xml:d})}else{showCopyError("[LAGL1]")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotations] CRTBUploadLoadAnnotationsGetList"+TBGlobal.UserDebugCode()});showCopyError("[LAGL2 - "+e.message+"]")}});jQuery(document.body).on("CRAnnotationTemplatesGetVideoAnnotationTemplates",function(e,t){try{jQuery("#tb-annotation-templates-select").show();jQuery("#tb-annotation-templates-select").find("option").remove();if(t.success){o=jQuery.parseJSON(t.response);if(o.length>0){jQuery("#tb-annotation-templates-select").empty();jQuery.each(o,function(){jQuery("#tb-annotation-templates-select").append(jQuery("<option></option>").text(this.AnnotationTemplateName).val(this.Id))});p();jQuery("#tb-annotation-templates-loading-container").hide();jQuery("#tb-annotation-templates-none").hide();jQuery("#tb-annotation-templates-apply-container").show()}else{jQuery("#tb-annotation-templates-loading-container").hide();jQuery("#tb-annotation-templates-none").show();jQuery("#tb-annotation-templates-apply-container").hide();jQuery("#tb-annotation-templates-apply").hide()}}}catch(e){jQuery("#tb-annotation-templates-loading-container").hide();jQuery("#tb-annotation-templates-none").show();jQuery("#tb-annotation-templates-apply-container").hide();jQuery("#tb-annotation-templates-apply").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUploads] CRAnnotationTemplatesGetVideoAnnotationTemplates"})}});jQuery(document.body).on("CRTBLoadAnnotationTemplateTemplate",function(e,o){try{if(o.success){o.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(o.response,DOMPurifyConfig));jQuery("body").append(o.response);j(t,i,n)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[AnnotationTemplates] CRTBLoadAnnotationTemplateTemplate"})}});jQuery(document.body).on("CRTBAnnotationTemplateLoadAnnotationsUpdatePost",function(e,t){try{if(t.success){var i="https://www.youtube.com/annotations_auth/publish2";TBExtension.Post(i,t.data.xml,"CRTBAnnotationTemplateLoadAnnotationsPublishPost",{xml:t.data.xml})}else{TBUtilities.Alert("Sorry, there was an error applying your annotations...(A)",function(){jQuery(".tb-annotation-templates-closex").trigger("close")})}}catch(e){e.resultData=t;TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotations] CRTBAnnotationTemplateLoadAnnotationsUpdatePost"+debug});TBUtilities.Alert("Sorry, there was an error applying your annotations...(B)",function(){jQuery(".tb-annotation-templates-closex").trigger("close")})}});jQuery(document.body).on("CRTBAnnotationTemplateLoadAnnotationsPublishPost",function(e,t){if(t.success){if(document.URL.indexOf("my_videos_annotate")>0){TBUtilities.Confirm("Success! \n\n In order for your Annotations to show up, we need to re-load the page.\n\nShould we reload now?",v,null);jQuery(".tb-annotation-templates-closex").trigger("close")}else{TBUtilities.Alert("Annotations successfully applied!",function(){jQuery(".tb-annotation-templates-closex").trigger("click")})}}else{TBUtilities.Alert("There was an error applying your annotations...(C)")}});jQuery(document.body).on("CRTBTemplatesLoadAnnotationsForVideo",function(e,t){jQuery("#tb-annotation-templates-list-container").html("");var i="";c=0;u=0;try{if(t.success){a.annotations=[];a.selectedAnnotations=[];var n=0;TBGlobal.AddUserDebugInfo("Annotation XML: "+t.response);var o=DOMPurify.sanitize(t.response,DOMPurifyConfig);jQuery(o).find("annotation").each(function(){i+="0";var e={};e.id=jQuery(this).attr("id");e.author=jQuery(this).attr("author");if(e.author==null)e.author="";e.index=n;n=n+1;e.type=jQuery(this).attr("type");e.style=jQuery(this).attr("style");e.log_data=jQuery(this).attr("log_data");e.logable=jQuery(this).attr("logable");e.text=jQuery(this).find("TEXT").text();e.ref=jQuery(this).find("condition").attr("ref");e.url=jQuery(this).find("url").attr("value");e.dockAtStart=false;e.dockAtEnd=false;if(e.url==null)e.url=jQuery(this).find("action").find("url").attr("value");TBUtilities.Log("item.style: "+e.style);switch(e.style){case"anchored":e.display="Speech Bubble";c++;break;case"popup":e.display="Note";c++;break;case"title":e.display="Title";c++;break;case"highlightText":case"highlighttext":e.display="Spotlight";c++;break;case"label":e.display="Label";c++;break;default:e.display="Spotlight Text";break}i+="[Display: "+e.display+"]";e.startTime=jQuery(this).find("movingRegion rectRegion:nth-child(1)").attr("t");if(!e.startTime){e.startTime=jQuery(this).find("movingRegion anchoredRegion:nth-child(1)").attr("t")}if(!e.startTime){e.startTime="never"}var t=[];var o="";var s=[];var r=0;var l=0;var u=0;if(e.startTime!="never"&&e.endTime!="0:00.000"){t=e.startTime.split(".");o=parseInt(t[1]);s=t[0].split(":");r=0;l=0;u=0;if(s.length==3){r=parseInt(s[0]);l=parseInt(s[1]);u=parseInt(s[2])}else{l=parseInt(s[0]);u=parseInt(s[1])}e.startTimeTimeSpan=new TimeSpan(o,u,l,r);e.startTimeTimeMiliseconds=e.startTimeTimeSpan.totalMilliseconds();e.dockAtStart=e.startTimeTimeMiliseconds<d*.15}e.endTime=jQuery(this).find("movingRegion rectRegion:nth-child(2)").attr("t");if(!e.endTime)e.endTime=jQuery(this).find("movingRegion anchoredRegion:nth-child(2)").attr("t");if(!e.endTime)e.endTime="never";var t=[];var o="";var s=[];var r=0;var l=0;var u=0;if(e.startTime!="never"&&e.endTime!="0:00.000"){t=e.startTime.split(".");o=parseInt(t[1]);s=t[0].split(":");r=0;l=0;u=0;if(s.length==3){r=parseInt(s[0]);l=parseInt(s[1]);u=parseInt(s[2])}else{l=parseInt(s[0]);u=parseInt(s[1])}}if(e.endTime!="never"&&e.endTime!="0:00.000"){t=e.endTime.split(".");o=parseInt(t[1]);s=t[0].split(":");r=0;l=0;u=0;if(s.length==3){r=parseInt(s[0]);l=parseInt(s[1]);u=parseInt(s[2])}else{l=parseInt(s[0]);u=parseInt(s[1])}e.endTimeTimeSpan=new TimeSpan(o,u,l,r);e.endTimeTimeMiliseconds=e.endTimeTimeSpan.totalMilliseconds();e.dockAtEnd=e.endTimeTimeMiliseconds>d*.85;e.distanceFromEnd=d-e.endTimeTimeMiliseconds;if(e.distanceFromEnd<0)e.distanceFromEnd=0;TBUtilities.AddDebug("item.endTimeTimeMiliseconds "+e.endTimeTimeMiliseconds);TBUtilities.AddDebug("Dest length: "+d);TBUtilities.AddDebug("distanceFromEnd: "+e.distanceFromEnd);TBUtilities.AddDebug("item.dockAtEnd: "+e.dockAtEnd)}if(e.startTimeTimeMiliseconds!=null){if(e.endTimeTimeMiliseconds!=null)e.totalTimeMiliseconds=e.endTimeTimeMiliseconds-e.startTimeTimeMiliseconds;else e.totalTimeMiliseconds=d-e.startTimeTimeMiliseconds}else if(e.endTimeTimeMiliseconds!=null){e.totalTimeMiliseconds=e.endTimeTimeMiliseconds}e.fullXML=jQuery(this).html();e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"highlightfontcolor","highlightFontColor");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"textsize","textSize");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"fgcolor","fgColor");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"borderalpha","borderAlpha");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"spacerelative","spaceRelative");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"bgalpha","bgAlpha");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"bgcolor","bgColor");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"anchoredregion","anchoredRegion");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"movingregion","movingRegion");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"rectregion","rectRegion");if(e.fullXML.indexOf('"></padding>')>0||e.fullXML.indexOf(" ></padding>")>0)e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"></padding>","/>");if(e.fullXML.indexOf('"></appearance>')>0||e.fullXML.indexOf(" ></appearance>")>0)e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"></appearance>","/>");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"</text>","</TEXT>");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"<text>","<TEXT>");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"></condition>","/>");if(e.fullXML.indexOf('"></appearance>')>0||e.fullXML.indexOf(" ></appearance>")>0)e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"></appearance>","/>");e.fullXML=TBUtilities.ReplaceAll(e.fullXML,"></rectregion>","/>");e.fullXMLOriginal=e.fullXML;e.videoId=a.videoId;if(e.type!="branding"&&e.type!="promotion"&&e.type!="card"&&e.type!="drawer"){a.annotations.push(e);a.selectedAnnotations.push(e)}});i+="[Outloop]";var s=a.annotations.length;for(var r=0;r<s;r++){var l=a.annotations[r];switch(l.display){case"Speech Bubble":case"Note":case"Title":case"Label":i+="[TopSwitch]";if(l.url!=null)jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><div style="border-bottom:solid 1px #ccc; padding-bottom:5px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+'</b></div><span style="position:relative; top:-17px; font-weight:bold">Text:</span> <textarea style="font-size:11px;  margin-top:5px; color:#444;height:26px; padding:1px; width:240px;" class="tb-annotations-default-setting" data-annotation-default-id="'+l.id+'">'+l.text+'</textarea><div style="width: 280px; max-width: 280px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; position:relative; top:-3px;"><b>Link:</b> <input class="tb-annotations-default-setting" type="text" style="font-size:11px; height:13px; padding:1px; width:240px; color:#444;" data-annotation-default-id="'+l.id+'" value="'+l.url+'" /></div><b>Time:</b> <i>'+l.startTime+" to "+l.endTime+"</i></div>");else jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><div style="border-bottom:solid 1px #ccc; padding-bottom:5px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+'</b></div><span style="position:relative; top:-17px; font-weight:bold">Text:</span> <textarea style="font-size:11px;  margin-top:5px; color:#444;height:26px; padding:1px; width:240px;" class="tb-annotations-default-setting" data-annotation-default-id="'+l.id+'">'+l.text+"</textarea><br /><b>Link:</b> (none)</div>");break;case"Spotlight":i+="[SpotSwitch]";var p;for(var b=0;b<s;b++){var y=a.annotations[b];if(y.id==a.annotations[r].ref){p=y}}if(p!=null){if(p.url!=null)jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><div style="border-bottom:solid 1px #ccc; padding-bottom:5px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+'</b></div><span style="position:relative; top:-17px; font-weight:bold">Text:</span> <textarea style="font-size:11px;  margin-top:5px; color:#444;height:26px; padding:1px; width:240px;" class="tb-annotations-default-setting" data-annotation-default-id="'+l.id+'">'+l.text+'</textarea><div style="width: 280px; max-width: 280px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; position:relative; top:-3px;"><b>Link:</b> <input class="tb-annotations-default-setting" type="text" style="font-size:11px; height:13px; padding:1px; width:240px; color:#444;" data-annotation-default-id="'+p.id+'" value="'+p.url+'" /></div><b>Time:</b> <i>'+p.startTime+" to "+p.endTime+"</i></div>");else jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><div style="border-bottom:solid 1px #ccc; padding-bottom:5px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+'</b></div><span style="position:relative; top:-17px; font-weight:bold">Text:</span> <textarea style="font-size:11px;  margin-top:5px; color:#444;height:26px; padding:1px; width:240px;" class="tb-annotations-default-setting" data-annotation-default-id="'+l.id+'">'+l.text+"</textarea><br ><b>Time:</b> <i>"+p.startTime+" to "+p.endTime+"</i><br />Link: (none)</div>")}else{if(l.url!=null)jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><div style="border-bottom:solid 1px #ccc; padding-bottom:5px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+'</b></div><span style="position:relative; top:-17px; font-weight:bold">Text:</span> <textarea style="font-size:11px;  margin-top:5px; color:#444;height:26px; padding:1px; width:240px;" class="tb-annotations-default-setting" data-annotation-default-id="'+l.id+'">'+l.text+'</textarea><div style="width: 280px; max-width: 280px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; position:relative; top:-3px;"><b>Link:</b> <input class="tb-annotations-default-setting" type="text" style="font-size:11px; height:13px; padding:1px; width:240px; color:#444;" data-annotation-default-id="'+l.id+'" value="'+l.url+'" /></div><b>Time:</b> <i>'+l.startTime+" to "+l.endTime+"</i></div>");else jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><div style="border-bottom:solid 1px #ccc; padding-bottom:5px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+'</b></div><span style="position:relative; top:-17px; font-weight:bold">Text:</span> <textarea  style="font-size:11px;  margin-top:5px; color:#444;height:26px; padding:1px; width:240px;" class="tb-annotations-default-setting" data-annotation-default-id="'+l.id+'">'+l.text+"</textarea><br ><b>Time:</b> <i>"+l.startTime+" to "+l.endTime+"</i><br />(none)</div>")}break;case"Spotlight Text":var m=false;for(var b=0;b<s;b++){var y=a.annotations[b];if(y.ref==a.annotations[r].id)m=true}if(!m){if(l.url!=null)jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+"</b><br/>Text: <i>"+l.text+"</i><br >Time: <i>"+l.startTime+" to "+l.endTime+'</i><div style="width: 280px; max-width: 280px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Link: <a href="'+l.url+'" target="_blank">'+l.url+"</a></div></div>");else jQuery("#tb-annotation-templates-list-container").append('<div class="tb-annotation-templates-annotations-item tb-annotation-templates-annotations-item-selected" data-index="'+l.index+'" style="margin-bottom:10px;"><img style="position:relative; top:2px;" src="'+TBGlobal.host+"/images/icons/annotations/"+l.style+'.png" /> <b style="font-size:16px">'+l.display+"</b><br/>Text: <i>"+l.text+"</i><br >Time: <i>"+l.startTime+" to "+l.endTime+"</i><br />(none)</div>")}else{u++}break}}i+="[Done]";jQuery("#tb-annotations-fetching").hide();if(n==0){jQuery("#tb-annotation-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any Annotations</div>');jQuery("#tb-annotation-templates-apply").hide()}else{jQuery("#tb-annotation-templates-apply").show();jQuery("#tb-annotations-has").show();jQuery("#tb-annotations-cancel").show();jQuery("#tb-annotations-continue").show();jQuery("#tb-annotations-close").hide()}jQuery("#tb-annotation-templates-how-many").text(a.selectedAnnotations.length-u+" of "+c+" selected")}else{if(t.data!=null&&t.data.secondTry!=null){jQuery("#tb-annotation-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any Annotations</div>');jQuery("#tb-annotation-templates-apply").hide()}else{var h="https://www.youtube.com/annotations_invideo?features=1&legacy=1&video_id="+a.videoId;TBExtension.Get(h,"CRTBTemplatesLoadAnnotationsForVideo",{secondTry:true})}}}catch(e){e.resultData=t;TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotations] CRTBTemplatesLoadAnnotationsForVideo"+i})}})};return{Show:function(o,a,s){if(TBGlobal.IsAuthenticated()){t=o;i=a;n=s;if(!e){Q();y();f();e=true}else{j(t,i,n)}}}}}();var TubeBuddyGifGenerator=function(){var e=false;var t;var i;var n;var o;var a=[];var s;var r;var l;var d;var c;var u=false;var p=false;var b=null;var y=10;var m=1;var h=[];var f=function(){var e=TBGlobal.host+"/ModuleManager/GifGenerator/GifGenerator?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/gifgenerator.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/gifgenerator.html"}TBExtension.Get(e,"CRTBLoadGifGeneratorTemplate")};var v=function(){};var g=function(){WebFont.load({google:{families:["Permanent Marker","Archivo Black","Press Start 2P","Coda"]}})};var T=function(e){e.set({opacity:0,selectable:false})};var j=function(e){e.set({opacity:1,selectable:true})};var Q=function(){try{o.pauseVideo()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] pauseVideo"})}};var B=function(){try{if(p)o.mute();o.playVideo()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] playVideo"})}};var k=function(e){try{if(e==0){e=0}o.seekTo(e,true)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] seekTo"})}};var w=function(){try{TBUtilities.Log("TubeBuddyGifGenerator - advanceVideo");var e=o.getCurrentTime();TBUtilities.Log("video current time = "+e);var t=30;var i=3;var n=1/t*i;var a=e+n;TBUtilities.Log("seeking to = "+a);r=e;k(a)}catch(e){TBUtilities.Log(e)}};var x=function(){try{TBUtilities.Log("TubeBuddyGifGenerator - checkPlayerTime");var e=o.getCurrentTime();var t=jQuery("#tb-gif-generator-time-input-end").val();t=parseFloat(Math.round(t*100)/100).toFixed(2);TBUtilities.Log("video current time = "+e);TBUtilities.Log("clip end time = "+t);TBUtilities.Log("_lastAdvanceTime = "+r);if(r!=null&&r!=e){var i=A(parseFloat(Math.round(e*100)/100).toFixed(2));if(i!=null){a.push(i)}if(e>t){D()}else{w();setTimeout(x,100)}}else{setTimeout(x,100)}}catch(e){TBUtilities.Log(e)}};var U=function(){try{s.deactivateAll().renderAll();TBUtilities.Log("TubeBuddyGifGenerator - checkPreviewTime");var e=o.getCurrentTime();var t=jQuery("#tb-gif-generator-time-input-end").val();t=parseFloat(Math.round(t*100)/100).toFixed(2);TBUtilities.Log("video current time = "+e);TBUtilities.Log("clip end time = "+t);if(u){TBUtilities.Log("text added = true");var i=jQuery("#tb-gif-generator-time-input-textstart").val();var n=jQuery("#tb-gif-generator-time-input-textend").val();TBUtilities.Log("text start = "+i);TBUtilities.Log("text end = "+n);if(e>=i&&e<=n){TBUtilities.Log("show text");s.forEachObject(function(e){if(e.get("type")=="i-text"){j(e)}})}else{TBUtilities.Log("hide text");s.forEachObject(function(e){if(e.get("type")=="i-text"){T(e)}})}s.renderAll()}if(e>=t){if(u){s.forEachObject(function(e){if(e.get("type")=="i-text"){j(e)}});s.renderAll()}jQuery(".tb-gif-generator-preview-play").show();jQuery(".tb-gif-generator-preview-stop").hide();jQuery(this).attr("data-state","play");p=false;TBUtilities.Log("preview end reached");Q();var a=jQuery("#tb-gif-generator-time-input-start").val();k(a)}else{if(p){setTimeout(U,100)}else{var a=jQuery("#tb-gif-generator-time-input-start").val();k(a)}}}catch(e){TBUtilities.Log(e.toString())}};var L=function(){jQuery(document).on("input",".tb-gif-generator-twitter-text",function(e){var t=116-twttr.txt.getTweetLength(jQuery(".tb-gif-generator-twitter-text").val());jQuery(".tb-gif-generator-tweet-length").text(t);if(t<=0){jQuery(".tb-gif-generator-tweet-length").css("color","red");jQuery(".tb-gif-generator-tweet-length").css("font-weight","bold");jQuery(".tb-gif-generator-twitter-post").prop("disabled",true)}else{jQuery(".tb-gif-generator-tweet-length").css("color","#666");jQuery(".tb-gif-generator-tweet-length").css("font-weight","normal");jQuery(".tb-gif-generator-twitter-post").prop("disabled",false)}});jQuery(document).on("click",".tb-gif-generator-twitter-refresh-accounts",function(e){var t=TBGlobal.host+TBGlobal.apiUrls.socialAccountsGetTwitter;TBExtension.Get(t,"CRTBGifGeneratorTwitterLoadAccounts")});jQuery(document).on("click",".tb-gif-generator-twitter-post",function(e){jQuery(this).prop("disabled",true);jQuery("#tb-gif-generator-another").prop("disabled",true);var t='<img class="tb-move-down2 tb-margin-right3" src="'+TBGlobal.host+'/images/general/loading1.gif" />'+'<span class="tb-gif-generator-loading-message" style="font-size: 100%;">Posting to Twitter...</span>';jQuery(".tb-gif-generator-twitter-container").block({centerX:false,centerY:false,message:t,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.1,cursor:"unavailable"},onBlock:function(){}});var i=TBGlobal.host+TBGlobal.apiUrls.socialAccountsPostAnimatedGifToTwitter;var n={SocialAccountId:jQuery(".tb-gif-generator-twitter-accounts").val(),Message:jQuery(".tb-gif-generator-twitter-text").val(),GifUrl:b};TBUtilities.Log(n);TBExtension.Post(i,JSON.stringify(n),"CRTBGifGeneratorPostGifToTwitter",null,{contentType:"application/json"})});jQuery(document).on("click",".tb-gif-generator-share",function(e){TBUtilities.AddAction(null,TBUtilities.ActionTypes.AnimatedGifGenerator_Share,"animatedgifgenerator")});jQuery(document).on("click","#tb-gif-generator-container-upgrade-link",function(e){TBGlobal.ShowUpgradePage(null,"animatedgifgenerator")});jQuery(document).on("click","#tb-gif-generator-another",function(e){E()});jQuery(document).on("click",".tb-gif-generator-preview",function(e){var t=jQuery(this).attr("data-state");var i=jQuery("#tb-gif-generator-time-input-start").val();var n=jQuery("#tb-gif-generator-time-input-end").val();if(t=="play"){jQuery(this).attr("data-state","stop");jQuery(".tb-gif-generator-preview-play").hide();jQuery(".tb-gif-generator-preview-stop").show();p=true;k(i);s.forEachObject(function(e){T(e)});B();setTimeout(U,100)}else{jQuery(".tb-gif-generator-preview-play").show();jQuery(".tb-gif-generator-preview-stop").hide();p=false;jQuery(this).attr("data-state","play");Q();k(i)}});jQuery(document).on("click",".tb-gif-generator-add-text-done",function(e){u=true;var t=new fabric.IText("",{left:60,top:200});t.set({fill:M()});t.fontFamily=P();t.setFontSize(F());t.setText(jQuery("#tb-gif-generator-text").val());if(jQuery(".tb-gif-generator-bold").hasClass("yt-uix-button-active")){t.setFontWeight("bold")}if(jQuery(".tb-gif-generator-underline").hasClass("yt-uix-button-active")){t.set("textDecoration","underline")}if(jQuery(".tb-gif-generator-outline").hasClass("yt-uix-button-active")){t.setStroke("#000000");t.setStrokeWidth(2)}if(jQuery(".tb-gif-generator-leftAlign").hasClass("yt-uix-button-active")){t.setTextAlign("left")}if(jQuery(".tb-gif-generator-centerAlign").hasClass("yt-uix-button-active")){t.setTextAlign("center")}if(jQuery(".tb-gif-generator-rightAlign").hasClass("yt-uix-button-active")){t.setTextAlign("right")}s.add(t);jQuery(".tb-gif-generator-text-container").addClass("tb-hid");jQuery(".tb-gif-generator-add-layer-text").attr("disabled",true);jQuery(".tb-gif-generator-add-text-done").addClass("tb-hid")});jQuery(document).on("click",".tb-gif-generator-underline",function(e){jQuery(this).toggleClass("yt-uix-button-active");var t=O();if(t&&t.get("type")=="i-text"){if(t.getTextDecoration()==""){t.set("textDecoration","underline")}else{t.set("textDecoration","")}s.renderAll()}});jQuery(document).on("click",".tb-gif-generator-outline",function(e){jQuery(this).toggleClass("yt-uix-button-active");var t=O();if(t&&t.get("type")=="i-text"){if(t.getStroke()==null){t.setStroke("#000000");t.setStrokeWidth(2)}else{t.setStroke(null);t.setStrokeWidth(0)}s.renderAll()}});jQuery(document).on("click",".tb-gif-generator-bold",function(e){jQuery(this).toggleClass("yt-uix-button-active");var t=O();if(t&&t.get("type")=="i-text"){if(t.getFontWeight()=="bold"){t.setFontWeight("normal")}else{t.setFontWeight("bold")}s.renderAll()}});jQuery(document).on("click",".tb-gif-generator-leftAlign",function(e){jQuery(this).toggleClass("yt-uix-button-active");jQuery(".tb-gif-generator-centerAlign").removeClass("yt-uix-button-active");jQuery(".tb-gif-generator-rightAlign").removeClass("yt-uix-button-active");var t=O();if(t&&t.get("type")=="i-text"){t.setTextAlign("left");s.renderAll()}});jQuery(document).on("click",".tb-gif-generator-centerAlign",function(e){jQuery(this).toggleClass("yt-uix-button-active");jQuery(".tb-gif-generator-leftAlign").removeClass("yt-uix-button-active");jQuery(".tb-gif-generator-rightAlign").removeClass("yt-uix-button-active");var t=O();if(t&&t.get("type")=="i-text"){t.setTextAlign("center");s.renderAll()}});jQuery(document).on("click",".tb-gif-generator-rightAlign",function(e){jQuery(this).toggleClass("yt-uix-button-active");jQuery(".tb-gif-generator-leftAlign").removeClass("yt-uix-button-active");jQuery(".tb-gif-generator-centerAlign").removeClass("yt-uix-button-active");var t=O();if(t&&t.get("type")=="i-text"){t.setTextAlign("right");s.renderAll()}});jQuery(document).on("keyup","#tb-gif-generator-text",function(){var e=O();if(e&&e.type=="i-text"){e.setText(jQuery(this).val());s.renderAll()}});jQuery(document).on("change",".tb-gif-generator-font",function(){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-font - click");var e=O();var t=P();if(e&&e.get("type")==="i-text"){e.fontFamily=t;s.renderAll()}});jQuery(document).on("change",".tb-gif-generator-font-size",function(){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-font-size - click");var e=O();if(e&&e.get("type")==="i-text"){e.setFontSize(F());s.renderAll()}});jQuery(document).on("change","#tb-gif-generator-picker-text",function(){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-picker-text - click");var e=O();if(e&&e.get("type")==="i-text"){e.setFill(M());s.renderAll()}});jQuery(document).on("click",".tb-gif-generator-delete",function(e){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-delete - click");var t=O();if(t){s.remove(t);var i=t.get("type");if(i=="i-text"){u=false;jQuery(".tb-gif-generator-layer-container").addClass("tb-hid");jQuery(".tb-gif-generator-add-layer-text").attr("disabled",false);jQuery(".tb-gif-generator-add-text-done").removeClass("tb-hid")}}});jQuery(document).on("click",".tb-gif-generator-front",function(e){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-front - click");var t=O();if(t){s.bringToFront(t)}});jQuery(document).on("click",".tb-gif-generator-back",function(e){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-back - click");var t=O();if(t){t.sendToBack()}});jQuery(document).on("click",".tb-gif-generator-add-layer",function(e){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-add-layer-text - click");var t=jQuery(this).attr("data-type");jQuery(".tb-gif-generator-layer-container").addClass("tb-hid");jQuery(".tb-gif-generator-tip").addClass("tb-hid");TBUtilities.Log(t);s.deactivateAll().renderAll();switch(t){case"text":{var i=jQuery("#tb-gif-generator-time-input-start").val();var n=jQuery("#tb-gif-generator-time-input-end").val();c.noUiSlider.set([i,n]);jQuery("#tb-gif-generator-text").val("Enter Text Here");jQuery(".tb-gif-generator-text-container").removeClass("tb-hid");jQuery(".tb-gif-generator-add-layer-text-done").removeClass("tb-hid");jQuery("#tb-gif-generator-text").focus();jQuery("#tb-gif-generator-text").select();break}case"image":{jQuery(".tb-gif-generator-layer-branding-container").removeClass("tb-hid");break}}});jQuery(document).on("click",".tb-gif-generator-close, .tb-gif-generator-closex",function(e){TBUtilities.Log("TubeBuddyGifGenerator - tb-gif-generator-close, .tb-gif-generator-closex - click");TubeBuddyMenu.HideBackground();jQuery("#tb-gif-generator-container").hide()});jQuery(document).on("change","#tb-gif-generator-time-input-textstart",function(e){TBUtilities.Log("TubeBuddyGifGenerator - #tb-gif-generator-time-input-textstart - change");var t=jQuery("#tb-gif-generator-time-input-textstart").val();var i=jQuery("#tb-gif-generator-time-input-textend").val();TBUtilities.Log(t);k(t);c.noUiSlider.set([t,i])});jQuery(document).on("change","#tb-gif-generator-time-input-textend",function(e){TBUtilities.Log("TubeBuddyGifGenerator - #tb-gif-generator-time-input-textend - change");TBUtilities.Log(jQuery(this).val());var t=jQuery("#tb-gif-generator-time-input-textstart").val();var i=jQuery("#tb-gif-generator-time-input-textend").val();c.noUiSlider.set([t,i])});jQuery(document).on("change","#tb-gif-generator-time-input-start",function(e){TBUtilities.Log("TubeBuddyGifGenerator - #tb-gif-generator-time-input-start - change");var t=jQuery("#tb-gif-generator-time-input-start").val();var i=jQuery("#tb-gif-generator-time-input-end").val();TBUtilities.Log(t);k(t);d.noUiSlider.set([t,i]);c.noUiSlider.updateOptions({range:{min:t,max:i}});C()});jQuery(document).on("change","#tb-gif-generator-time-input-end",function(e){TBUtilities.Log("TubeBuddyGifGenerator - #tb-gif-generator-time-input-end - change");TBUtilities.Log(jQuery(this).val());var t=jQuery("#tb-gif-generator-time-input-start").val();var i=jQuery("#tb-gif-generator-time-input-end").val();d.noUiSlider.set([t,i]);c.noUiSlider.updateOptions({range:{min:t,max:i}});C()});jQuery(document).on("click","#tb-gif-generator-start",function(){TBUtilities.AddAction(null,TBUtilities.ActionTypes.AnimatedGifGenerator_Generate,"animatedgifgenerator");TBUtilities.Log("TubeBuddyGifGenerator - #tb-gif-generator-start - click");jQuery("#tb-gif-generator-start").hide();var e='<img class="tb-move-down2" src="'+TBGlobal.host+'/images/general/loading1.gif" />'+'<span class="tb-gif-generator-loading-message" style="font-size: 130%; margin-left:5px;">Step 1 of 3<Br><br>&nbsp;&nbsp;Rendering...</span>';jQuery("#tb-gif-generator-container-settings").block({centerX:false,centerY:false,message:e,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:1,cursor:"unavailable"},onBlock:function(){jQuery("#tb-gif-generator-container-settings-step1").hide();jQuery("#tb-gif-generator-container-settings-step2").show()}});s.deactivateAll().renderAll();w();setTimeout(x,100)})};var C=function(){var e=jQuery("#tb-gif-generator-time-input-start").val();var t=jQuery("#tb-gif-generator-time-input-end").val();var i=parseFloat(e).toFixed(2);var n=parseFloat(t).toFixed(2);var o=n-i;var a=parseFloat(o).toFixed(0);if(o>y||o<m){jQuery(".tb-gif-generator-total-time-container").css("background-color","#ff3232");jQuery("#tb-gif-generator-start").attr("disabled",true)}else{jQuery(".tb-gif-generator-total-time-container").css("background-color","#3db651");jQuery("#tb-gif-generator-start").attr("disabled",false)}jQuery(".tb-gif-generator-total-time").text(a+"/"+y+" Seconds Used")};var E=function(){jQuery("#tb-gif-generator-container").show();jQuery("#tb-gif-generator-disabled").show();jQuery(".tb-gifcom-link").attr("href"," https://gifs.com/?source="+"https://youtube.com/watch?v="+t);return};var S=function(e){TBUtilities.Log("TubeBuddyGifGenerator - canvasObjectSelected");jQuery(".tb-gif-generator-layer-selected-title").addClass("tb-hid");jQuery(".tb-gif-generator-layer-container").addClass("tb-hid");jQuery(".tb-gif-generator-layer-options-container").addClass("tb-hid");if(e.target){jQuery(".tb-gif-generator-layer-selected-title").removeClass("tb-hid");jQuery(".tb-gif-generator-layer-options-container").removeClass("tb-hid");TBUtilities.Log(e.target.type);switch(e.target.type){case"i-text":{jQuery(".tb-gif-generator-add-layer-text-done").addClass("tb-hid");jQuery(".tb-gif-generator-text-container").removeClass("tb-hid");if(e.target.getStroke()==null){jQuery(".tb-gif-generator-outline").removeClass("yt-uix-button-active")}else{jQuery(".tb-gif-generator-outline").addClass("yt-uix-button-active")}if(e.target.getFontWeight()=="normal"){jQuery(".tb-gif-generator-bold").removeClass("yt-uix-button-active")}else{jQuery(".tb-gif-generator-bold").addClass("yt-uix-button-active")}if(e.target.getTextDecoration()!="underline"){jQuery(".tb-gif-generator-underline").removeClass("yt-uix-button-active")}else{jQuery(".tb-gif-generator-underline").addClass("yt-uix-button-active")}jQuery(".tb-gif-generator-font").val(e.target.getFontFamily());jQuery("#tb-gif-generator-text").val(e.target.getText());jQuery("#tb-gif-generator-picker-text").spectrum("set",e.target.getFill());break}}}};var I=function(e){jQuery(".tb-gif-generator-layer-selected-title").addClass("tb-hid");jQuery(".tb-gif-generator-layer-container").addClass("tb-hid");jQuery(".tb-gif-generator-layer-options-container").addClass("tb-hid")};var A=function(e){var t=null;try{TBUtilities.Log("TubeBuddyGifGenerator - getStillFromVideo");TBUtilities.Log("Capturing image from clip time = "+e);jQuery("#screenshotPlayerGifGenerator").contents().find(".video-stream").attr("crossorigin","anonymous");var i=jQuery("#screenshotPlayerGifGenerator").contents().find(".html5-main-video:first");var n=i[0];var o=jQuery("#tb-gif-generator-temp-canvas")[0];var a=o.getContext("2d");o.width=480;o.height=270;a.fillRect(0,0,480,270);var s=document.getElementById("tb-gif-generator-fabric-canvas");var r=s.getContext("2d");a.drawImage(n,0,0,o.width,o.height);if(u){var l=jQuery("#tb-gif-generator-time-input-textstart").val();var d=jQuery("#tb-gif-generator-time-input-textend").val();TBUtilities.Log("Current time ="+e);TBUtilities.Log("Text start ="+l);TBUtilities.Log("Text end ="+d);if(parseFloat(e)>=parseFloat(l)&&parseFloat(e)<=parseFloat(d)){TBUtilities.Log("adding text layer");a.drawImage(s,0,0,o.width,o.height)}}t=o.toDataURL()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] getStillFromVideo"})}return t};var G=function(){jQuery(document.body).on("CRTBGifGeneratorPostGifToTwitter",function(e,t){try{TBUtilities.Log("TubeBuddyGifGenerator - CRTBGifGeneratorPostGifToTwitter");jQuery("#tb-gif-generator-another").prop("disabled",false);jQuery(".tb-gif-generator-twitter-container").unblock();jQuery(".tb-gif-generator-twitter-post").prop("disabled",false);if(t.success){var i=jQuery.parseJSON(t.response);jQuery(".tb-gif-generator-twitter-accounts");jQuery(".tb-gif-generator-twitter-sucesss").show();jQuery(".tb-gif-generator-twitter-sucesss-tweet").attr("href",i)}else{TBUtilities.Alert("There was an error posting your GIF to Twitter.  Please try again...")}}catch(e){TBUtilities.Alert("There was an error posting your GIF to Twitter.  Please try again...");TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] CRTBGifGeneratorPostGifToTwitter"})}});jQuery(document.body).on("CRTBGifGeneratorTwitterLoadAccounts",function(e,t){try{TBUtilities.Log("TubeBuddyGifGenerator - CRTBGifGeneratorTwitterLoadAccounts");TBUtilities.Log(t);if(t.success){h=jQuery.parseJSON(t.response);if(h.length>0){jQuery(".tb-gif-generator-twitter-none").hide();jQuery(".tb-gif-generator-twitter-has").show();var i=jQuery(".tb-gif-generator-twitter-accounts");i.empty();jQuery.each(h,function(e,t){i.append(jQuery("<option>").attr("value",t.Id).text(t.Name))})}else{jQuery(".tb-gif-generator-twitter-none").show();jQuery(".tb-gif-generator-twitter-has").hide()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] CRTBGifGeneratorTwitterLoadAccounts"})}});jQuery(document.body).on("CRTBGifGeneratorPostGif",function(e,i){TBUtilities.Log("TubeBuddyGifGenerator - CRTBGifGeneratorPostGif");TBUtilities.Log(i);try{if(i.success){jQuery("#tb-gif-generator-container-settings").unblock();var n=jQuery.parseJSON(i.response);var o=document.createElement("img");o.src=n.ImageUrl;b=n.ImageUrl;var a=document.getElementById("tb-gif-generator-container-settings-step2-image");a.appendChild(o);jQuery("#tb-gif-generator-download").attr("href",n.ImageUrl+"?download=true");jQuery("#tb-gif-generator-download").attr("download",t);jQuery("#tb-gif-generator-another").removeClass("tb-hid");jQuery("#tb-gif-generator-share-googleplus").attr("href","https://plus.google.com/share?url="+encodeURIComponent(n.SiteUrl));jQuery("#tb-gif-generator-share-pinterest").attr("href","http://pinterest.com/pin/create/button/?url="+encodeURIComponent(n.SiteUrl)+"&media="+encodeURIComponent(n.ImageUrl));jQuery("#tb-gif-generator-container-settings-step2-IframeEmbed").val('<iframe src="'+n.SiteUrl+'" width="500" height="290" frameBorder="0" allowFullScreen></iframe>');jQuery("#tb-gif-generator-container-settings-step2-imageHtml").val('<a href="'+"https://www.youtube.com/watch?v="+t+'"><img title="animated gif" src="'+n.ImageUrl+'" title="made by tubebuddy"/></a>');jQuery(".tb-gif-generator-container-settings-step2-size").text(n.Size);if(n.SizeInBytes>=35e5){jQuery("#tb-gif-generator-container-settings-step2-twitterSize").removeClass("tb-hid");jQuery(".tb-gif-generator-twitter-post").prop("disabled",true)}else{jQuery(".tb-gif-generator-twitter-post").prop("disabled",false)}}else{jQuery("#tb-gif-generator-container-settings").unblock();TBUtilities.Alert("There was an error saving your image");E()}}catch(e){jQuery("#tb-gif-generator-container-settings").unblock();TBUtilities.Alert("There was an error saving your image");E();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] CRTBGifGeneratorPostGif"})}});jQuery(document.body).on("CRTBLoadGifGeneratorTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);E()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] CRTBLoadGifGeneratorTemplate"})}});jQuery(document.body).on("CRTBGifGeneratorLoadBrandings",function(e,t){try{if(t.success){jQuery("#tb-gif-generator-brandings-container").find(".tb-tgif-generator-brandingImage-creator").remove();_brandingImages=jQuery.parseJSON(t.response);if(TBGlobal.CanAccessLevel1Tools()||_brandingImages.length<1&&TBGlobal.CanAccessLevel1Tools()==false){_allowMoreBranding=true;if(_brandingImages.length>=10){_maxBranding=true;jQuery(".tb-thumbnail-creator-imgLoader").addClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").removeClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-imgLoader").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid")}}else{_allowMoreBranding=false}jQuery.each(_brandingImages,function(e,t){var i=jQuery("#tb-thumbnail-creator-brandingImage").html();var n=i.formatTemplate(t.Id,t.Image);jQuery("#tb-brandings-container").append(n)})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] CRTBThumbnailLoadBrandings"})}})};var R=function(e){TBUtilities.Log("TubeBuddyGifGenerator - loadYTPlayer");if(o){o.destroy()}o=new YT.Player("screenshotPlayerGifGenerator",{width:"480",height:"270",videoId:t,playerVars:{autohide:0,fs:0,color:"white",controls:0,enablejsapi:1,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0,theme:"light",wmode:"transparent",autoplay:0},events:{onReady:TubeBuddyGifGenerator.OnYouTubePlayerAPIReady,onStateChange:TubeBuddyGifGenerator.OnPlayerStateChange}})};var V=function(e){TBUtilities.Log("TubeBuddyGifGenerator - gotVideoDetails");TBUtilities.Log(e);try{l=e;if(d){d.noUiSlider.destroy()}d=document.getElementById("tb-gif-generator-slider-time");noUiSlider.create(d,{behaviour:"drag",connect:true,start:[0,5],margin:m,range:{min:[0],max:l.contentDetails.durationInSeconds}});jQuery("#tb-gif-generator-time-input-start").attr({max:l.contentDetails.durationInSeconds,min:0});jQuery("#tb-gif-generator-time-input-end").attr({max:l.contentDetails.durationInSeconds,min:0});d.noUiSlider.on("update",function(e,t){var i=e[0];var n=e[1];k(i);jQuery("#tb-gif-generator-time-input-start").val(i);jQuery("#tb-gif-generator-time-input-end").val(n);c.noUiSlider.updateOptions({margin:m,range:{min:parseFloat(i),max:parseFloat(n)}});C()});c.noUiSlider.on("update",function(e,t){var i=e[0];var n=e[1];jQuery("#tb-gif-generator-time-input-textstart").val(i);jQuery("#tb-gif-generator-time-input-textend").val(n)});jQuery("#tb-gif-generator-container-settings-loading").hide();jQuery("#tb-gif-generator-container-settings-step1").show();jQuery("#tb-gif-generator-container-settings").unblock();jQuery("#tb-gif-generator-start").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] gotVideoDetails"})}};var D=function(){try{TBUtilities.Log("TubeBuddyGifGenerator - convertImagesToAnimatedGif");TBUtilities.Log("image count = "+a.length);jQuery(".tb-gif-generator-loading-message").html("Step 2 of 3<br><Br>&nbsp; Creating Animated GIF...");if(gifshot.isSupported()){TBUtilities.Log("Browser is supported by gifshot")}else{TBUtilities.Log("Browser is NOT supported by gifshot")}gifshot.createGIF({gifWidth:480,gifHeight:270,images:a,numWorkers:10},function(e){if(!e.error){jQuery("#tb-gif-generator-container-settings-step1").hide();jQuery("#tb-gif-generator-container-settings-step2").show();var i=e.image.replace("data:image/gif;base64,","");var n=TBGlobal.host+TBGlobal.apiUrls.gifAdd;var o={VideoId:t,ImageData:i};TBUtilities.Log(o);jQuery(".tb-gif-generator-loading-message").html("Step 3 of 3<br><Br>&nbsp; Uploading Animated GIF...");TBExtension.Post(n,JSON.stringify(o),"CRTBGifGeneratorPostGif",null,{contentType:"application/json"})}else{TBUtilities.Alert("There was a problem creating the animated GIF");E()}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGifGenerator] convertImagesToAnimatedGif"})}};var M=function(){return jQuery("#tb-gif-generator-picker-text").spectrum("get").toHexString()};var P=function(){return jQuery(".tb-gif-generator-font").val()};var F=function(){var e=jQuery(".tb-gif-generator-font-size").val();if(e){return parseInt(e)}else{return 12}};var O=function(){return s.getActiveObject()==null?s.getActiveGroup():s.getActiveObject()};return{Initialize:function(){},Show:function(o,a,s){TBUtilities.Log("TubeBuddyGifGenerator - Show");if(TBGlobal.IsAuthenticated()){t=o;i=a;n=s;if(!e){G();f();L();e=true}else{E()}}TBGlobal.ClearUserDebugInfo()},OnYouTubePlayerAPIReady:function(e){TBUtilities.Log("TubeBuddyGifGenerator - OnYouTubePlayerAPIReady");_apiReady=true;TBYouTubeApi.GetVideoDetails(t,"id,contentDetails",V)},OnPlayerStateChange:function(e){TBUtilities.Log("TubeBuddyGifGenerator - OnPlayerStateChange");try{switch(e.data){case YT.PlayerState.UNSTARTED:TBUtilities.Log("unstarted");break;case YT.PlayerState.ENDED:TBUtilities.Log("ended");break;case YT.PlayerState.PLAYING:TBUtilities.Log("playing");if(p==false){Q()}break;case YT.PlayerState.PAUSED:TBUtilities.Log("paused");break;case YT.PlayerState.BUFFERING:e.target.setPlaybackQuality("medium");TBUtilities.Log("buffering");break;case YT.PlayerState.CUED:TBUtilities.Log("video cued");break}}catch(e){TBUtilities.Log(e)}}}}();var TubeBuddyCommentsCannedResponse=function(){var t=false;var n=null;var o=null;var a=null;var s=false;var r="";var l="";var d="";var c=false;var u=function(){var e=TBGlobal.host+"/ModuleManager/CommentsCannedResponse/CommentsCannedResponse?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/commentscannedresponse.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/commentscannedresponse.html"}TBExtension.Get(e,"CRTBLoadCommentsCannedResponseTemplate")};var p=function(){jQuery(document).on("click","#page",function(){TBUtilities.Log("CommentsCannedResponse #page click");y()});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponseEmpty",function(){var t=window.open(TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId(),"_blank");t.focus();e.stopPropagation()});jQuery(document).on("click",".show-more, .tb-comment-filter-show-more-wrap",function(){if(a){clearTimeout(a)}a=setTimeout(b,50)});jQuery(document).on("click",".tb-commentsCannedResponse-chart",function(){var e=jQuery(this).closest(".comment-item");var t=jQuery(e).find("a:first").attr("href");var i=t.lastIndexOf("/");var n=t.substring(i+1);var o=e.find(".user-name:first").text();var a=e.find(".user-photo:first").attr("src");TubeBuddyChannelytics.ShowForChannel(n,o,a)});jQuery(document).on("click",".tb-commentsCannedResponse-heart-it",function(e){var t={action:r,session_token:d};TBExtension.Post("https://www.youtube.com/comment_service_ajax?action_perform_comment_action=1",jQuery.param(t),"CRTBCannedResponseHeartComment",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});jQuery(".tb-commentsCannedResponse-heart-processing").show();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").hide();e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-heart-ed",function(e){var t={action:l,session_token:d};TBExtension.Post("https://www.youtube.com/comment_service_ajax?action_perform_comment_action=1",jQuery.param(t),"CRTBCannedResponseUnHeartComment",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});jQuery(".tb-commentsCannedResponse-heart-processing").show();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").hide();e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-refresh-cannedResponses",function(e){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeOut();var t=TBGlobal.host+TBGlobal.apiUrls.campaignGetByYouTubeChannelId+"?id="+TBGlobal.CurrentChannelId();TBExtension.Get(t,"CRTBCannedResponseGetCannedResponses");e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponse",function(e){TBUtilities.Log("CommentsCannedResponse tb-commentsCannedResponse-menu-cannedResponse click");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.CannedResponses_Use,"cannedresponses");y();var t=jQuery(this).attr("data-id");var i=jQuery(this).closest(".comment-footer-actions");var n=jQuery(i).siblings().find(".yt-commentbox-text");if(n.length==0||n.parent().parent().hasClass("hid")){var a=i.find(".yt-commentbox-show-reply");a.click()}var s=TBUtilities.GetInArray(o,"Id",t);TBUtilities.Log(s);var r=s.Template;var l=jQuery(i).parent().siblings().find(".user-name").text();TBUtilities.Log(l);if(l){r=TBUtilities.ReplaceAll(r,"{N}",l);r=TBUtilities.ReplaceAll(r,"{n}",l)}TBUtilities.Log(r);n=jQuery(i).siblings().find(".yt-commentbox-text");jQuery(n).append(r);var a=jQuery(i).siblings().find(".yt-commentbox-button");a.removeAttr("disabled");e.stopPropagation()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-menu-cannedResponse click"})}});jQuery(document).on("click",".tb-commentsCannedResponse-cannedResponse-menu-icon",function(e){TBUtilities.Log("CommentsCannedResponse tb-commentsCannedResponse-cannedResponse-menu-icon click");if(jQuery("#yt-comments-paginator").length>0)if(jQuery("#yt-comments-paginator").closest("form").length>0)jQuery("#yt-comments-paginator").closest("form").css("padding-bottom","400px");y();var t=jQuery(this).closest(".comment-entry");if(t.is(":last-child")){t.css("height","200px")}var i=jQuery(this).siblings(".tb-commentsCannedResponse-cannedResponse-menu-list");var n=jQuery(this).closest(".tb-commentsCannedResponse-cannedResponse-menu").position().left;TBUtilities.Log(n);jQuery(i).css({left:n+"px"});if(jQuery(i).hasClass("tb-hid")){jQuery(i).removeClass("tb-hid").show();var o=jQuery(this).closest(".comment-item");var a=jQuery(o).attr("data-cid");var s=jQuery(o).attr("data-vid");var r=TBGlobal.host+TBGlobal.apiUrls.topicsGetCommentAudienceSuggestedTopic+"?commentId="+a;TBExtension.Get(r,"CRTBCannedResponseGetCommentAudienceSuggestedTopic",a)}e.stopPropagation()});jQuery(document).on("change",".tb-commentsCannedResponse-topicgenerator-input",function(e){TBUtilities.Log("tb-commentsCannedResponse-topicgenerator-input change");try{var t=jQuery(this).is(":checked");if(s==false&&t==true){TBGlobal.ShowUpgradePage("have more than 5 comment suggestions","videotopicplanner");return}if(t){TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_SaveComment,"videotopicplanner")}var i=jQuery(this).closest(".comment-item");var n=jQuery(i).attr("data-cid");var o=jQuery(i).attr("data-vid");var a=jQuery(i).attr("data-name");var r=jQuery(i).find("a:first").attr("href");var l=r.lastIndexOf("/");var d=r.substring(l+1);var c=jQuery(i).find(".comment-text-content").text();var u=jQuery(i).find(".user-photo").attr("src");var p={VideoId:o,CommentId:n,CommentorChannelId:d,CommentorName:a,Comment:c,CommentorPhoto:u};TBUtilities.Log(p);var b=TBGlobal.host+TBGlobal.apiUrls.topicsToggleCommentAudienceSuggestedTopic;TBExtension.Post(b,JSON.stringify(p),null,null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-topicgenerator-input change"})}});jQuery(document).on("click",".tb-commentsCannedResponse-topicgenerator-input",function(e){e.stopPropagation()})};var b=function(){TBUtilities.Log("lookForMore");clearTimeout(a);if(jQuery("#yt-comments-paginator:visible").length==0){m()}else if(jQuery("#yt-comments-paginator:visible").length==1&&jQuery("#yt-comments-paginator > .show-more").is(":visible")){m()}else{a=setTimeout(b,50)}};var y=function(){jQuery(".tb-commentsCannedResponse-cannedResponse-menu-list").addClass("tb-hid").hide()};var m=function(){var e=jQuery("#tb-commentsCannedResponse-channelInfoTemplate").html();var t=jQuery("#tb-commentsCannedResponse-subscriberCountTemplate").html();var n=jQuery("#tb-commentsCannedResponse-facebookTemplate").html();var o=jQuery("#tb-commentsCannedResponse-twitterTemplate").html();var a=jQuery("#tb-commentsCannedResponse-instagramTemplate").html();jQuery(".comment-entry").each(function(s,r){jQuery(this).find(".comment-item").each(function(s,r){if(jQuery(this).closest(".comment-item").hasClass("channel-owner")==false){var l=jQuery(this);if(TBGlobal.Profile().SettingsShowCommentSubscriberCount==true){if(l.find(".tb-commentsCannedResponse-channelInfo").length==0){var d=jQuery(this).find("a:first").attr("href");var c="https://www.youtube.com"+d;var u=jQuery(this).find("a:first");TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(c,function(s){if(s.success==true){var r="";if(s.subscribersFormatted!=null){r=t.formatTemplate(s.subscribersFormatted)}var d="";var c="";var u="";for(i=0;i<s.socialProfiles.length;i++){var p=s.socialProfiles[i];if(p.url!==undefined&&p.url.indexOf("twitter.com")!==-1){c=o.formatTemplate(p.url)}else if(p.url!==undefined&&p.url.indexOf("facebook.com")!==-1&&p.url.indexOf("youtube.com")===-1){d=n.formatTemplate(p.url)}else if(p.url!==undefined&&p.url.indexOf("instagram.com")!==-1){u=a.formatTemplate(p.url)}}var b=e.formatTemplate(r,d,c,u);if(l.find(".tb-commentsCannedResponse-channelInfo").length==0){l.find(".time").after(b)}}})}}l.find(".comment-footer-actions:first").each(function(e,t){if(jQuery(this).find(".tb-commentsCannedResponse-cannedResponse-menu").length==0){jQuery(this).append(h())}})}})})};var h=function(){if(n){return n}else{var e="";try{o=TBGlobal.Profile().Campaigns;var t=jQuery("#tb-commentsCannedResponse-menuTemplate").html();var i=f();e=t.formatTemplate(i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] getMenuHtml"})}n=e;return n}};var f=function(){var e=jQuery("#tb-commentsCannedResponse-menuButtonTemplate").html();var t="";if(o.length>0){jQuery.each(o,function(i,n){t+=e.formatTemplate(n.Id,n.Name)})}else{t=jQuery("#tb-commentsCannedResponse-menuButtonTemplateEmpty").html()}return t};var v=function(){jQuery(document.body).on("CRTBCannedResponseHeartComment",function(e,t){try{if(t.success){if(t.success){jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").show();jQuery(".tb-commentsCannedResponse-heart-it").hide()}else{TBUtilities.Alert("There was an error!\n\n"+t.response);jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").show()}}}catch(e){}});jQuery(document.body).on("CRTBCannedResponseUnHeartComment",function(e,t){try{if(t.success){jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").show()}else{TBUtilities.Alert("There was an error!\n\n"+t.response);jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").show();jQuery(".tb-commentsCannedResponse-heart-it").hide()}}catch(e){}});jQuery(document.body).on("CRTBCannedResponseGetSpecificComment",function(e,t){try{if(t.success){var i=t.response;var n=i.indexOf(t.data.commentId);var o=i.indexOf("creator-heart-big-",n)+"creator-heart-big-".length;var a=i.substring(o,o+1);c=a=="h";jQuery(".tb-commentsCannedResponse-heart-processing").hide();if(!c){jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").show()}else{jQuery(".tb-commentsCannedResponse-heart-ed").show();jQuery(".tb-commentsCannedResponse-heart-it").hide()}var s=i.indexOf("yt-uix-creator-heart-button",n);n=i.indexOf("data-action-heart=",s)+"data-action-heart=".length+1;var u=i.indexOf('"',n);r=i.substring(n,u);n=i.indexOf("data-action-unheart=",s)+"data-action-unheart=".length+1;u=i.indexOf('"',n);l=i.substring(n,u);d=TBUtilities.GetSessionToken(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetSpecificComment"})}});jQuery(document.body).on("CRTBCannedResponseGetCommentAudienceSuggestedTopic",function(e,t){try{if(t.success){var i=JSON.parse(t.response);var n=jQuery(".comment-item[data-cid='"+t.data+"']");var o=jQuery(n).find(".tb-commentsCannedResponse-topicgenerator-input");s=i.CanAdd;jQuery(o).removeAttr("disabled");jQuery(o).attr("checked",i.IsSuggestedTopic)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCommentAudienceSuggestedTopic"})}});jQuery(document.body).on("CRTBCannedResponseGetCannedResponses",function(e,t){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeIn();try{if(t.success){o=JSON.parse(t.response);var i=f();jQuery(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(".tb-commentsCannedResponse-cannedResponses-container").html(i);n=null}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCannedResponses"})}});jQuery(document.body).on("CRTBLoadCommentsCannedResponseTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response).append(function(){TubeBuddyCommentsCannedResponse.PopulateMenus()})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBLoadCommentsCannedResponseTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!t){v();if(TBGlobal.Profile().SettingsShowCommentCannedResponses){var e=TBUtilities.GetUrlParameter("tab");if(e==null||e=="inbox"){u();p()}}t=true}}},PopulateMenus:function(){m();jQuery(".tb-commentsCannedResponse-manage-cannedResponses").attr("href",TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId())}}}();var TubeBuddyBulkCopyToFacebook=function(){var e=false;var t=[];var n={method:3,specificVideoIds:[],specificVideos:[],playlistId:"",search:"",videoEntity:null,selectedVideo:{},annotations:[],selectedAnnotations:[],videos:[],destinationVideos:[],currentVideo:null,isStopped:false,annotationIdsToDelete:[],isDeleteOnly:false,totalDestinationVideos:0,isAutoSelect:false,hasFinished:false,errorCount:0,successCount:0,step:1};var o=function(){var e=TBGlobal.host+"/ModuleManager/BulkCopyToFacebook/BulkCopyToFacebook?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/bulkcopytofacebook.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/bulkcopytofacebook.html"}TBExtension.Get(e,"CRTBLoadBulkCopyToFacebookTemplate")};var a=function(){var e=TBGlobal.host+TBGlobal.apiUrls.socialAccountsGetFacebook;TBExtension.Get(e,"CRTBBulkCopyToFacebookLoadAccounts")};var s=function(){try{TBUtilities.Log("Opening bulk publish to facebook");jQuery(".tb-bulk-copy-to-facebook-settings-container").show();jQuery(".tb-bulk-copy-to-facebook-off").hide();if(TBGlobal.Profile().LegacyEnabled==true){jQuery("#tb-bulk-copy-to-facebook-error-copy-container").hide();jQuery("#tb-bulk-copy-to-facebook-error-copy").prop("data-clipboard-text","");var e=new ClipboardJS("#tb-bulk-copy-to-facebook-error-copy");n.step=1;n.currentVideo=null;_publishIntervals=[];n.isStopped=false;jQuery(".tb-bulk-copy-to-facebook-step1").hide();jQuery(".tb-bulk-copy-to-facebook-step2").hide();jQuery(".tb-bulk-copy-to-facebook-step3").hide();jQuery(".tb-bulk-copy-to-facebook-step4").hide();jQuery(".tb-bulk-copy-to-facebook-step5").hide();jQuery(".tb-bulk-copy-to-facebook-autherror").hide();jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage").prop("checked",false);jQuery("#tb-bulk-copy-to-facebook-stopped").hide();jQuery(".tb-bulk-copy-to-facebook-button").hide();jQuery(".tb-bulk-copy-to-facebook-close").show();jQuery(".tb-bulk-copy-to-facebook-tabs").hide();jQuery(".tb-bulk-copy-to-facebook-publishorder-container").hide();jQuery("#tb-bulk-copy-to-facebook-error-none-list2").show();jQuery("#tb-bulk-copy-to-facebook-error-list2").hide();jQuery("#tb-bulk-copy-to-facebook-completed-none-list2").show();jQuery("#tb-bulk-copy-to-facebook-completed-list2").hide();jQuery("#tb-bulk-copy-to-facebook-completed-list2").empty();jQuery("#tb-bulk-copy-to-facebook-error-list2").empty();jQuery("#tb-bulk-copy-to-facebook-queue-list2").empty();jQuery(".tb-bulk-copy-to-facebook-container-upgrade").hide();jQuery("#tb-bulk-copy-to-facebook-progress-container").show();jQuery("#tb-bulk-copy-to-facebook-working").show();jQuery("#tb-bulk-copy-to-facebook-done").hide();if(TBGlobal.Profile().UserIdForLoginLink!=null)jQuery(".tb-bulk-copy-to-facebook-accounts-manage").attr("href",TBGlobal.host+"/account?UserIdForLoginLink="+TBGlobal.Profile().UserIdForLoginLink+"&tab=facebook");else jQuery(".tb-bulk-copy-to-facebook-accounts-manage").attr("href",TBGlobal.host+"/account?EmailHint="+TBGlobal.Profile().GoogleEmail+"&tab=facebook");jQuery(".tb-bulk-copy-to-facebook-loading-video").show();jQuery(".tb-bulk-copy-to-facebook-none").hide();jQuery(".tb-bulk-copy-to-facebook-filter").val("publicunlisted");jQuery(".tb-bulk-copy-to-facebook-publishorder").val("oldest");jQuery("#tb-bulk-copy-to-facebook-container").show();jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-now").click();if(TBGlobal.CanAccessLevel3Tools()==false){jQuery(".tb-bulk-copy-to-facebook-loading-video").hide();jQuery(".tb-bulk-copy-to-facebook-container-upgrade").show()}else{a();var t=jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-interval-number");t.empty();for(i=1;i<=30;i++){t.append(jQuery("<option></option>").val(i).html(i));if(i==2){jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-interval-number option:last-child").attr("selected","selected")}}jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-options").hide();var o=jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-date").datepick({minDate:new Date});var s=new Date;var r=new Date(s);r.setDate(s.getDate()+1);jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-date").datepick("setDate",r);jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-timezones").timezones();jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-timezones").timezones()}}else{jQuery(".tb-bulk-copy-to-facebook-close").show();jQuery("#tb-bulk-copy-to-facebook-container").show();jQuery(".tb-bulk-copy-to-facebook-cancel").hide();jQuery(".tb-bulk-copy-to-facebook-next").hide();jQuery(".tb-bulk-copy-to-facebook-copy").hide();jQuery(".tb-bulk-copy-to-facebook-stop").hide();jQuery(".tb-bulk-copy-to-facebook-settings-container").hide();jQuery(".tb-bulk-copy-to-facebook-off").show()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] prepareDialog"})}};var r=function(){jQuery(document).on("click","#tb-bulk-copy-to-facebook-error-copy-container",function(){jQuery(this).attr("src","https://www.tubebuddy.com/images/icons/check.png");window.setTimeout(function(){jQuery("#tb-bulk-copy-to-facebook-error-copy").attr("src","https://www.tubebuddy.com/images/icons/copy.png")},1500)});jQuery(document).on("click","#tb-bulk-copy-to-facebook-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("click",".tb-bulk-copy-to-facebook-stop",function(){n.isStopped=true;jQuery(".tb-bulk-copy-to-facebook-stop").hide();jQuery(".tb-bulk-copy-to-facebook-close").show();jQuery("#tb-bulk-copy-to-facebook-working").hide();jQuery("#tb-bulk-copy-to-facebook-stopped").show()});jQuery(document).on("click",".tb-bulk-copy-to-facebook-upgrade-link",function(e){TBUtilities.AddActivityLog(null,TBUtilities.ActivityLogTypes.BulkPublishToFacebook_UpgradeClick,"bulkpublishtofacebook");TBGlobal.ShowUpgradePage("",TBGlobal.limitation.bulkCopyToFacebook)});jQuery(document).on("change",".tb-bulk-copy-to-facebook-publishorder",function(){TBUtilities.Log(".tb-bulk-copy-to-facebook-publishorder change");if(jQuery("input[name=scheduledPublishOption]:checked").val()=="interval"){k()}});jQuery(document).on("click",".tb-bulk-copy-to-facebook-copy",function(e){TBUtilities.Log(".tb-bulk-copy-to-facebook-copy click");if(!jQuery("#tb-bulk-copy-to-facebook-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to bulk publish to Facebook");return}try{TBUtilities.AddAction({VideoCount:n.destinationVideos.length},TBUtilities.ActionTypes.BulkPublishToFacebook_Publish,"bulkpublishtofacebook")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] [click] .tb-bulk-copy-to-facebook-copy - AddAction"})}l(5);h();return false});jQuery(document).on("click",".tb-bulk-copy-to-facebook-checkbox-include",function(){try{TBUtilities.Log("tb-bulk-copy-to-facebook-checkbox-include click");if(jQuery(this).is(":checked")){Q(this,true)}else{B(this,true)}w()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] [click] tb-bulk-copy-to-facebook-checkbox-include"})}});jQuery(document).on("click","#tb-bulk-copy-to-facebook-select-all-checkboxes",function(){TBUtilities.Log("#tb-bulk-copy-to-facebook-select-all-checkboxes click");jQuery("input.tb-bulk-copy-to-facebook-checkbox-include[type=checkbox]").each(function(){if(jQuery(this).is(":checked")==false){jQuery(this).attr("checked",true);Q(this,false)}});w();if(jQuery("input[name=scheduledPublishOption]:checked").val()=="interval"){k()}});jQuery(document).on("click","#tb-bulk-copy-to-facebook-select-no-checkboxes",function(){TBUtilities.Log("#tb-bulk-copy-to-facebook-select-no-checkboxes click");jQuery("input.tb-bulk-copy-to-facebook-checkbox-include[type=checkbox]").each(function(){if(jQuery(this).is(":checked")==true){jQuery(this).attr("checked",false);B(this)}});w()});jQuery(document).on("change",".tb-bulk-copy-to-facebook-filter",function(){TBUtilities.Log(".tb-bulk-copy-to-facebook-filter change");jQuery(".tb-bulk-copy-to-facebook-destination-row").show();switch(jQuery(this).val()){case"public":jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="private"]').hide();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="unlisted"]').hide();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="public"]').show();break;case"unlisted":jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="public"]').hide();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="private"]').hide();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="unlisted"]').show();break;case"publicunlisted":jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="private"]').hide();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="unlisted"]').hide();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="public"]').show();jQuery('.tb-bulk-copy-to-facebook-destination-row[data-privacy="unlisted"]').show();break}w();if(jQuery("input[name=scheduledPublishOption]:checked").val()=="interval"){k()}});jQuery(document).on("click",".tb-bulk-copy-to-facebook-next",function(){TBUtilities.Log(".tb-bulk-copy-to-facebook-next click");TBUtilities.Log("current step = "+n.step);try{if(n.step==1){var e=jQuery(".tb-bulk-copy-to-facebook-accounts").val();var i=TBUtilities.GetInArray(t,"Id",e);n.step=2}else if(n.step==2){switch(parseInt(n.method)){case 0:if(n.specificVideoIds.length==0){jQuery("#tb-bulk-copy-to-facebook-input-ids-status").css("color","red");jQuery("#tb-bulk-copy-to-facebook-input-ids-status").text("No videos detected");jQuery("#tb-bulk-copy-to-facebook-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}TBUtilities.Log("Video Selection Method: Video IDs "+JSON.stringify(n.specificVideoIds));y();break;case 1:if(n.playlistId==""){jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").css("color","red");jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").show();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)");return}TBUtilities.Log("Video Selection Method: Playlist ["+n.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(n.playlistId,null,p,b);break;case 2:if(n.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBUtilities.Log("Video Selection Method: Search ["+n.search+"]");jQuery("#tb-bulk-copy-to-facebook-destination").show();TBYouTubeApi.GetChannelVideosSearch(n.search,null,p,b);break;case 3:TBUtilities.Log("Video Selection Method: All");var o=null;if(jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage").is(":checked")){var a=/^\+?\d+$/.test(jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage-number").val());if(a==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}o=parseInt(jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage-number").val());if(o<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,p,b,o,null,n.selectedVideo.id);break}n.step=3}else if(n.step==3){n.destinationVideos=[];if(jQuery(".tb-bulk-copy-to-facebook-checkbox-include").filter(":visible").filter(":checked").length==0&&n.destinationVideos.length==0){TBUtilities.Alert("Please select at least 1 video to publish to facebook.");return}jQuery(".tb-bulk-copy-to-facebook-checkbox-include").filter(":visible").filter(":checked").each(function(){if(jQuery(this).is(":checked")){var e=jQuery(this).attr("data-video-id");jQuery.each(n.videos,function(t,i){if(i.id==e){n.destinationVideos.push(i)}})}});TBUtilities.Log("destination video count = "+n.destinationVideos.length);n.step=4}l(n.step)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] [click] #tb-bulk-copy-to-facebook-continue"})}});jQuery(document).on("click",".tb-bulk-copy-to-facebook-back",function(){TBUtilities.Log(".tb-bulk-copy-to-facebook-back click");TBUtilities.Log(n.step);if(n.step==2){n.step=1}else if(n.step==3){n.step=2}else if(n.step==4){n.step=3}l(n.step,n.step+1)});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulk-copy-to-facebook-input-playlist",function(e){n.playlistId="";var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").hide();return}if(t.indexOf("list=")>0){t=t.substring(t.indexOf("list=")+5)}if(t.length!=18&&t.length!=34||t.substring(0,2)!="PL"){jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").css("color","red")}else{jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").text("Valid Playlist Id");jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").css("color","green");n.playlistId=t}jQuery("#tb-bulk-copy-to-facebook-input-playlist-status").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulk-copy-to-facebook-input-search",function(e){n.search=jQuery(this).val().trim()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulk-copy-to-facebook-input-ids",function(e){var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-bulk-copy-to-facebook-input-ids-status").hide();return}jQuery("#tb-bulk-copy-to-facebook-input-ids-status").show();n.specificVideoIds=[];if(t.indexOf(",")>-1){n.specificVideoIds=t.split(",")}else{n.specificVideoIds=t.split(" ")}for(var i=0;i<n.specificVideoIds.length;i++){n.specificVideoIds[i]=n.specificVideoIds[i].trim();n.specificVideoIds[i]=n.specificVideoIds[i].replace("https://www.youtube.com/watch?v=","");n.specificVideoIds[i]=n.specificVideoIds[i].replace("https://youtu.be/","");if(n.specificVideoIds[i].length!=11){n.specificVideoIds.splice(i,1);i--}}if(n.specificVideoIds.length==0){jQuery("#tb-bulk-copy-to-facebook-input-ids-status").text("No videos detected");jQuery("#tb-bulk-copy-to-facebook-input-ids-status").css("color","red")}else if(n.specificVideoIds.length==1){jQuery("#tb-bulk-copy-to-facebook-input-ids-status").text("1 video detected");jQuery("#tb-bulk-copy-to-facebook-input-ids-status").css("color","green");jQuery("#tb-bulk-copy-to-facebook-method-ids").prop("checked",true)}else{jQuery("#tb-bulk-copy-to-facebook-input-ids-status").text(n.specificVideoIds.length+" videos detected");jQuery("#tb-bulk-copy-to-facebook-input-ids-status").css("color","green");jQuery("#tb-bulk-copy-to-facebook-method-ids").prop("checked",true)}});jQuery(document).on("click","#tb-bulk-copy-to-facebook-method-ids, #tb-bulk-copy-to-facebook-method-playlist, #tb-bulk-copy-to-facebook-method-search, #tb-bulk-copy-to-facebook-method-full",function(e){n.method=parseInt(jQuery(this).attr("data-method"));switch(n.method){case 0:jQuery("#tb-bulk-copy-to-facebook-input-ids").removeAttr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-playlist").attr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-search").attr("disabled","disabled");break;case 1:jQuery("#tb-bulk-copy-to-facebook-input-ids").attr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-search").attr("disabled","disabled");break;case 2:jQuery("#tb-bulk-copy-to-facebook-input-ids").attr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-playlist").attr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-search").removeAttr("disabled","disabled");break;case 3:jQuery("#tb-bulk-copy-to-facebook-input-ids").attr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-playlist").attr("disabled","disabled");jQuery("#tb-bulk-copy-to-facebook-input-search").attr("disabled","disabled");break}});jQuery(document).on("change","input[type=radio][name=scheduledPublishOption]",function(e){jQuery(".tb-bulk-copy-to-facebook-publishorder-container").hide();var t=jQuery(this).val();switch(t){case"now":jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-options").slideUp("fast",function(){});jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-options").slideUp("fast",function(){});break;case"nowdraft":jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-options").slideUp("fast",function(){});jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-options").slideUp("fast",function(){});break;case"allon":jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-options").slideUp("fast",function(){jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-options").slideDown("fast",function(){})});break;case"interval":jQuery(".tb-bulk-copy-to-facebook-publishorder-container").show();jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-options").slideUp("fast",function(){jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-options").slideDown("fast",function(){})});break}});jQuery(document).on("click",".tb-bulk-copy-to-facebook-close, .tb-bulk-copy-to-facebook-closex, .tb-bulk-copy-to-facebook-close, .tb-bulk-copy-to-facebook-cancel",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-bulk-copy-to-facebook-container").hide()});jQuery(document).on("change",".tb-bulk-copy-to-facebook-accounts",function(e){var i=jQuery(".tb-bulk-copy-to-facebook-accounts").val();var n=TBUtilities.GetInArray(t,"Id",i);if(n.SocialAccountType==1){c()}else{u()}})};var l=function(e,t){jQuery(".tb-bulk-copy-to-facebook-step1").hide();jQuery(".tb-bulk-copy-to-facebook-step2").hide();jQuery(".tb-bulk-copy-to-facebook-step3").hide();jQuery(".tb-bulk-copy-to-facebook-step4").hide();jQuery(".tb-bulk-copy-to-facebook-step5").hide();jQuery("#tb-bulk-copy-to-facebook-container").find(".tb-tab-header").removeClass("selected");jQuery("#tb-bulk-copy-to-facebook-container").find(".subnav").removeClass("tb-hid");jQuery("#tb-bulk-copy-to-facebook-container").find('.tb-tab-header[data-tab-id="'+e+'"]').addClass("selected");switch(e){case 1:{jQuery(".tb-bulk-copy-to-facebook-step1").show();break}case 2:{n.specificVideoIds.length=0;n.specificVideos.length=0;jQuery("#tb-bulk-copy-to-facebook-input-ids").val("");jQuery("#tb-bulk-copy-to-facebook-input-ids-status").hide();jQuery(".tb-bulk-copy-to-facebook-step2").show();break}case 3:{if(t&&t==4){jQuery(".tb-bulk-copy-to-facebook-step3").show()}else{jQuery("#tb-bulk-copy-to-facebook-loading-videos").show();jQuery("#tb-bulk-copy-to-facebook-destination-list").empty();jQuery("#tb-bulk-copy-to-facebook-destination-list").hide();jQuery(".tb-bulk-copy-to-facebook-step3").show()}break}case 4:{jQuery("#tb-bulk-copy-to-facebook-completed-list2").empty();jQuery("#tb-bulk-copy-to-facebook-error-list2").empty();jQuery("#tb-bulk-copy-to-facebook-queue-list2").empty();jQuery("#tb-bulk-copy-to-facebook-copy-destination-count").text(n.destinationVideos.length);jQuery("#tb-bulk-copy-to-facebook-destination-selected-count").text(n.destinationVideos.length);if(jQuery("#tb-bulk-copy-to-facebook-copy-destination-count").text()=="1")jQuery("#tb-bulk-copy-to-facebook-copy-destination-count-s").hide();else jQuery("#tb-bulk-copy-to-facebook-copy-destination-count-s").show();jQuery("#tb-bulk-copy-to-facebook-method").hide();jQuery("#tb-bulk-copy-to-facebook-confirm-checkbox").attr("checked",false);jQuery(".tb-bulk-copy-to-facebook-step4").show();break}case 5:{n.totalDestinationVideos=n.destinationVideos.length;n.hasFinished=false;n.errorCount=0;n.successCount=0;jQuery(".tb-bulk-copy-to-facebook-step5").show();break}}d(e)};var d=function(e){jQuery(".tb-bulk-copy-to-facebook-button").hide();switch(e){case 1:{jQuery(".tb-bulk-copy-to-facebook-cancel").show();jQuery(".tb-bulk-copy-to-facebook-next").show();break}case 2:{jQuery(".tb-bulk-copy-to-facebook-cancel").show();jQuery(".tb-bulk-copy-to-facebook-back").show();jQuery(".tb-bulk-copy-to-facebook-next").show();break}case 3:{jQuery(".tb-bulk-copy-to-facebook-cancel").show();jQuery(".tb-bulk-copy-to-facebook-back").show();jQuery(".tb-bulk-copy-to-facebook-next").show();break}case 4:{jQuery(".tb-bulk-copy-to-facebook-cancel").show();jQuery(".tb-bulk-copy-to-facebook-back").show();jQuery(".tb-bulk-copy-to-facebook-copy").show();break}case 5:{jQuery(".tb-bulk-copy-to-facebook-stop").show();break}case 6:{jQuery(".tb-bulk-copy-to-facebook-close").show();break}}};var c=function(){jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-interval").attr("disabled",false);jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-all-on").attr("disabled",false);jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-nowdraft").attr("disabled",false);jQuery("#tb-bulk-copy-to-facebook-thumbnailContainer").show()};var u=function(){jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-now").click();jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-interval").attr("disabled",true);jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-all-on").attr("disabled",true);jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-option-nowdraft").attr("disabled",true);jQuery("#tb-bulk-copy-to-facebook-thumbnailContainer").hide();jQuery(".tb-bulk-copy-to-facebook-call-to-action").hide()};var p=function(e){try{if(e==null){if(n.method==0)TBUtilities.Alert("No valid Video IDs found");else if(n.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(n.method==2)TBUtilities.Alert("No videos matching your search");else if(n.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-bulk-copy-to-facebook-back").trigger("click");return}else if(e.length==0){if(n.method==0)TBUtilities.Alert("No valid Video IDs found");else if(n.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(n.method==2)TBUtilities.Alert("No videos matching your search");else if(n.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-bulk-copy-to-facebook-back").trigger("click");return}n.videos=[];jQuery("#tb-bulk-copy-to-facebook-destination-list").empty();var t=jQuery("#tb-bulk-copy-to-facebook-destination-template").html();var i=0;jQuery.each(e,function(e,o){if(o.snippet.resourceId!=null)o.id=o.snippet.resourceId.videoId;if(o.id.videoId!=null){o.id=o.id.videoId}n.videos.push(o);var a="none";if(o.status.privacy=="public"||o.status.privacy=="unlisted"){a="block";i++}var s=t.formatTemplate(o.id,o.snippet.thumbnails.default.url,"https://www.youtube.com/watch&v="+o.id,o.snippet.title,o.status.privacy,a,o.snippet.publishedAtUnix);jQuery("#tb-bulk-copy-to-facebook-destination-list").append(s)});if(n.method==0||n.method==1)jQuery("#tb-bulk-copy-to-facebook-select-all-checkboxes").trigger("click");jQuery("#tb-bulk-copy-to-facebook-loading-videos").hide();jQuery("#tb-bulk-copy-to-facebook-destination-list").show();if(i==0){TBUtilities.Alert("No videos matching your search");jQuery("#tb-bulk-copy-to-facebook-back").trigger("click")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] [gotVideoList]"})}};var b=function(e){if(e.totalCount-e.loaded>50){jQuery("#tb-bulk-copy-to-facebook-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-bulk-copy-to-facebook-onlyLoadFirstPage-number").val())}jQuery("#tb-bulk-copy-to-facebook-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery("#tb-bulk-copy-to-facebook-loading-count"))}else{jQuery("#tb-bulk-copy-to-facebook-rendering").show();jQuery("#tb-bulk-copy-to-facebook-loading-count-container").hide()}};var y=function(){var e=n.specificVideoIds[0];n.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails, snippet, id, status",m)};var m=function(e){if(e!=null)n.specificVideos.push(e);if(n.specificVideoIds.length>0){y()}else{p(n.specificVideos)}};var h=function(){try{TBUtilities.Log("TubeBuddyBulkCopyToFacebook - process next video");jQuery("#tb-bulk-copy-to-facebook-progress-container").html("Start &rarr;");if(n.isStopped)return;if(n.destinationVideos.length==0&&!n.hasFinished){f();return}if(n.currentVideo){if(!n.currentVideo.error)g(n.currentVideo);else T(n.currentVideo)}v();jQuery("#tb-bulk-copy-to-facebook-status-count").html("<b>"+parseInt(n.totalDestinationVideos-n.destinationVideos.length)+"</b> of <b>"+n.totalDestinationVideos+"</b> videos complete");var e=n.destinationVideos[0].id;TBUtilities.Log("Remove video with id from destination videos "+e);jQuery("#tb-bulk-copy-to-facebook-progress-container").html(jQuery("#tb-bulk-copy-to-facebook-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+e+'">'+e+"</a> &rarr;");var t=TBUtilities.RemoveFromArray(n.destinationVideos,"id",e)[0];n.currentVideo=t;var i='https://www.youtube.com/my_videos?o=U&sq="'+t.id+'"';TBExtension.Get(i,"CRTBBulkCopyToFacebookCheckVideo",{videoId:t.id})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] [processNextVideo]"})}};var f=function(e){n.hasFinished=true;jQuery("#tb-bulk-copy-to-facebook-status-count").html("<b>"+n.totalDestinationVideos+"</b> of <b>"+n.totalDestinationVideos+"</b> videos complete");jQuery("#tb-bulk-copy-to-facebook-progress-container").hide();if(n.currentVideo){if(!n.currentVideo.error)g(n.currentVideo);else T(n.currentVideo)}v();jQuery("#tb-bulk-copy-to-facebook-progress-container").hide();jQuery("#tb-bulk-copy-to-facebook-working").hide();jQuery("#tb-bulk-copy-to-facebook-done").show();d(6)};var v=function(){jQuery("#tb-bulk-copy-to-facebook-queue-list2").empty();jQuery("#tb-bulk-copy-to-facebook-queue-complete-list2").hide();var e=0;jQuery.each(n.destinationVideos,function(t,i){var n=jQuery("#tb-bulk-copy-to-facebook-processing-template").html();var o=n.formatTemplate(i.id,i.snippet.thumbnails.default.url,"https://www.youtube.com/watch?v="+i.id,i.snippet.title);jQuery("#tb-bulk-copy-to-facebook-queue-list2").prepend(o);e++;if(e==3)return false});if(e==0){jQuery("#tb-bulk-copy-to-facebook-queue-complete-list2").show();jQuery("#tb-bulk-copy-to-facebook-queue-list2").hide()}else{jQuery("#tb-bulk-copy-to-facebook-queue-list2").show()}};var g=function(e){var t=jQuery("#tb-bulk-copy-to-facebook-processed-success").html();var i=t.formatTemplate(e.facebooklink,e.snippet.title);jQuery("#tb-bulk-copy-to-facebook-completed-list2").prepend(i);jQuery("#tb-bulk-copy-to-facebook-completed-none-list2").hide();jQuery("#tb-bulk-copy-to-facebook-completed-list2").show();n.successCount++;jQuery("#tb-bulk-copy-to-facebook-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(n.successCount))};var T=function(e){try{jQuery("#tb-bulk-copy-to-facebook-error-copy-container").show();var t=jQuery("#tb-bulk-copy-to-facebook-error-copy").attr("data-clipboard-text");var i=[];if(t!=""){i=t.split(",");if(i.indexOf(e.id)==-1){i.push(e.id)}}else{i.push(e.id)}jQuery("#tb-bulk-copy-to-facebook-error-copy").attr("data-clipboard-text",i.join(","))}catch(e){}var o=jQuery("#tb-bulk-copy-to-facebook-processed-error").html();var a=o.formatTemplate(e.id,e.snippet.title,"https://www.youtube.com/watch&v="+e.id,e.error);jQuery("#tb-bulk-copy-to-facebook-error-list2").prepend(a);jQuery("#tb-bulk-copy-to-facebook-error-list2").show();jQuery("#tb-bulk-copy-to-facebook-error-none-list2").hide();n.errorCount++;jQuery("#tb-bulk-copy-to-facebook-error-list2-count").text(TBUtilities.FormatNumberWithCommas(n.errorCount))};var j=function(e){TBUtilities.Log("TubeBuddyCopyToFacebook - postVideoToServer");try{var i=jQuery(".tb-bulk-copy-to-facebook-accounts").val();var o=TBUtilities.GetInArray(t,"Id",i);var a=jQuery("#tb-bulk-copy-to-facebook-container").find('.tb-bulk-copy-to-facebook-destination-row[data-video-id="'+e+'"]');if(a){var s=jQuery(a).attr("data-publishtype");var r=jQuery(a).attr("data-publishdate");var l=false;if(o.SocialAccountType==1&&jQuery("#tb-bulk-copy-to-facebook-useYouTubeThumbnail").is(":checked")){l=true}var d=!jQuery("#tb-bulk-copy-to-facebook-addToTimeline").is(":checked");var c={VideoId:e,SocialAccountId:o.Id,Thumbnail:l,PublishDate:r,AddToTimeLine:d,PublishType:s};TBUtilities.Log(c);var u=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosBulkPublishToFacebook;TBExtension.Post(u,JSON.stringify(c),"CRTBBulkCopyToFacebookPublishToFacebook",null,{contentType:"application/json"})}else{n.currentVideo.error="Error reading publish date";h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] [postVideoToServer]"})}};var Q=function(e,t){var i=jQuery(e).closest(".tb-bulk-copy-to-facebook-destination-row");jQuery(i).addClass("tb-bulk-copy-to-facebook-destination-row-selected");var n=jQuery(i).find(".tb-bulk-copy-to-facebook-destination-row-publishDate");var o=jQuery("input[name=scheduledPublishOption]:checked").val();TBUtilities.Log(o);jQuery(i).attr("data-publishtype",o);switch(o){case"now":{jQuery(n).text("now");break}case"nowdraft":{jQuery(n).text("now (draft)");jQuery(i).attr("data-publishdate",-1);break}case"allon":{var a=jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-all-on-date").val();var s=jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-all-on-time").val();var r=jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-timezones").val();TBUtilities.Log("date = "+a);TBUtilities.Log("time = "+s);TBUtilities.Log("zone = "+r);var l=moment.tz(a+" "+s,"MM/DD/YYYY HH:mm",r);var d=l.unix();var c=l.format("MM/DD/YYYY h:mm a");jQuery(n).text(c);jQuery(i).attr("data-publishdate",d);break}case"interval":{if(t){k()}break}}};var B=function(e){var t=jQuery(e).closest(".tb-bulk-copy-to-facebook-destination-row");jQuery(t).removeClass("tb-bulk-copy-to-facebook-destination-row-selected");var i=jQuery(t).find(".tb-bulk-copy-to-facebook-destination-row-publishDate");jQuery(t).removeAttr("data-publishdate");jQuery(t).removeAttr("data-publishtype");jQuery(i).text("")};var k=function(e){TBUtilities.Log("TubeBuddyBulkCopyToFacebook getIntervals");var t=jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-date-interval").val();var i=jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-interval-time").val();var n=jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-interval-timezones").val();TBUtilities.Log("date = "+t);TBUtilities.Log("time = "+i);TBUtilities.Log("zone = "+n);var o=moment.tz(t+" "+i,"MM/DD/YYYY HH:mm",n);var a=o.unix();var s=[];jQuery("#tb-bulk-copy-to-facebook-destination-list").find(".tb-bulk-copy-to-facebook-checkbox-include").filter(":visible").filter(":checked").each(function(e){var t=jQuery(this).attr("data-video-id");var i=jQuery(this).attr("data-publishedat");var n={Id:t,PublishedAt:i};s.push(n)});var r={Videos:s,Interval:jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-interval-number").val(),Type:jQuery("#tb-bulk-copy-to-facebook-video-settings-publish-interval-rate").val(),Sort:jQuery(".tb-bulk-copy-to-facebook-publishorder").val(),PublishStartDateUnix:a};TBUtilities.Log(r);var l=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetPublishInterval;TBExtension.Post(l,JSON.stringify(r),"CRTBLoadBulkCopyToFacebookLoadIntervals",null,{contentType:"application/json"})};var w=function(){jQuery("#tb-bulk-copy-to-facebook-destination-selected-count").text(jQuery("#tb-bulk-copy-to-facebook-destination-list").find(".tb-bulk-copy-to-facebook-checkbox-include").filter(":visible").filter(":checked").length);jQuery("#tb-bulk-copy-to-facebook-copy-count").text(jQuery("#tb-bulk-copy-to-facebook-destination-list").find(".tb-bulk-copy-to-facebook-checkbox-include").filter(":visible").filter(":checked").length);if(jQuery("#tb-bulk-copy-to-facebook-destination-selected-count").text()=="1")jQuery("#tb-bulk-copy-to-facebook-copy-count-s").hide();else jQuery("#tb-bulk-copy-to-facebook-copy-count-s").show()};var x=function(e){TBUtilities.Log("TubeBuddyBulkCopyToFacebook populateIntervals");jQuery(".tb-bulk-copy-to-facebook-destination-row-publishDate").text("");jQuery("[data-publishdate]").each(function(e){jQuery(this).removeAttr("data-publishdate")});var t=jQuery(".tb-bulk-copy-to-facebook-video-settings-publish-all-on-timezones").val();jQuery.each(e,function(e,i){jQuery("#tb-bulk-copy-to-facebook-destination-list").find('.tb-bulk-copy-to-facebook-checkbox-include[data-video-id="'+i.VideoId+'"]').each(function(e){if(jQuery(this).is(":checked")&&jQuery(this).is(":visible")){TBUtilities.Log(parseInt(i.DateUnix)*1e3);TBUtilities.Log(t);var n=moment(parseInt(i.DateUnix)*1e3);TBUtilities.Log(n);var o=n.tz(t).format("MM/DD/YYYY hh:mm a");TBUtilities.Log(o);jQuery(this).parent().siblings().find(".tb-bulk-copy-to-facebook-destination-row-publishDate").text(o);var a=jQuery(this).closest(".tb-bulk-copy-to-facebook-destination-row");jQuery(a).attr("data-publishdate",i.DateUnix)}})})};var U=function(e,t){var i=false;jQuery.each(e.response.split("download_my_video"),function(e,n){var o=n.toString().indexOf('"');var a=n.toString().indexOf("v="+t);if(a>=0&&a<o){i=true;return false}});if(!i){TBUtilities.Log("Download link not found");TBUtilities.AddActivityLog({Data:"VideoId="+t},TBUtilities.ActivityLogTypes.PublishToFacebook_Blocked,"publishtofacebook");i=false}else{i=true}return i};var L=function(e){var t=true;TBUtilities.Log("checking video length");var i=jQuery.parseHTML(DOMPurify.sanitize(e.response,DOMPurifyConfig));var n=jQuery(i).find("span.video-time").text();TBUtilities.Log(n);TBUtilities.Log(e.response.indexOf("video-time"));t=false;return t};var C=function(){jQuery(document.body).on("CRTBBulkCopyToFacebookPublishToFacebook",function(e,i){try{TBUtilities.Log("TubeBuddyBulkCopyToFacebook - CRTBBulkCopyToFacebookPublishToFacebook");TBUtilities.Log(i);if(n.isStopped){return}if(i.success){var o=jQuery(".tb-bulk-copy-to-facebook-accounts").val();var a=TBUtilities.GetInArray(t,"Id",o);n.currentVideo.facebooklink="https://www.facebook.com/"+a.ExternalId+"/videos/"+i.response.replace(/['"]+/g,"");h()}else{if(i.response==501){jQuery(".tb-bulk-copy-to-facebook-autherror").show()}n.currentVideo.error="Error publishing video";h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] CRTBBulkCopyToFacebookPublishToFacebook"})}});jQuery(document.body).on("CRTBBulkCopyToFacebookCheckVideo",function(e,t){try{var i=t.data.videoId;TBUtilities.Log("TubeBuddyBulkCopyToFacebook - CRTBBulkCopyToFacebookCheckVideo");TBUtilities.Log(t);if(t.success){if(U(t,i)==true){TBYouTubeApi.GetVideoDetails(i,"contentDetails",function(e){if(e!=null||e.contentDetails.durationInSeconds<=2700){TBUtilities.Log("video length in seconds is "+e.contentDetails.durationInSeconds);j(i)}else{n.currentVideo.error="Video is longer than 45 minutes";h()}})}else{n.currentVideo.error="You don't own the content for this video";h()}}else{throw new Error("result.success == false")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] CRTBBulkCopyToFacebookCheckVideo"});if(n.currentVideo){n.currentVideo.error="Error checking video meta data"}h()}});jQuery(document.body).on("CRTBLoadBulkCopyToFacebookTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);s()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] CRTBLoadBulkCopyToFacebookTemplate"})}});jQuery(document.body).on("CRTBBulkCopyToFacebookLoadAccounts",function(e,i){try{TBUtilities.Log("TubeBuddyCopyToFacebook - CRTBBulkCopyToFacebookLoadAccounts");TBUtilities.Log(i);jQuery(".tb-bulk-copy-to-facebook-loading-video").hide();l(n.step);if(i.success){t=jQuery.parseJSON(i.response);if(t.length>0){jQuery(".tb-bulk-copy-to-facebook-none").hide();jQuery(".tb-bulk-copy-to-facebook-step1ready").show();jQuery(".tb-bulk-copy-to-facebook-tabs").show();var o=jQuery(".tb-bulk-copy-to-facebook-accounts");o.empty();var a=null;jQuery.each(t,function(e,t){if(a==null&&t.SocialAccountType==1){a=t;o.append(jQuery("<option>").attr("value",t.Id).text(t.Name).attr("selected","selected"))}else{o.append(jQuery("<option>").attr("value",t.Id).text(t.Name))}});if(a!=null){c()}else{u()}}else{jQuery(".tb-bulk-copy-to-facebook-none").show();jQuery(".tb-bulk-copy-to-facebook-next").hide();jQuery(".tb-bulk-copy-to-facebook-step1ready").hide()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] CRTBBulkCopyToFacebookLoadAccounts"})}});jQuery(document.body).on("CRTBLoadBulkCopyToFacebookLoadIntervals",function(e,t){try{TBUtilities.Log("TubeBuddyBulkCopyToFacebook - CRTBLoadBulkCopyToFacebookLoadIntervals");TBUtilities.Log(t);if(t.success){var i=jQuery.parseJSON(t.response);x(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopyToFacebook] CRTBLoadBulkCopyToFacebookLoadIntervals"})}})};return{Show:function(){TBGlobal.ClearUserDebugInfo();if(TBGlobal.IsAuthenticated()){if(!e){C();o();r();e=true}else{s()}}}}}();var TubeBuddyCardTemplates=function(){var t=false;var i=null;var n=null;var o=null;var a=null;var s=null;var r=null;var l={};var d;var c;var u;var p;var b=null;var y={videoId:"",cards:[],selectedCards:[]};var m=function(){var e=TBGlobal.host+"/ModuleManager/CardTemplates/CardsTemplates?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/cardtemplates.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/cardtemplates.html"}TBExtension.Get(e,"CRTBLoadCardsTemplatesTemplate")};var h=function(){jQuery(document).on("click","#tb-card-templates-apply",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("apply Card Templates","cardtemplates");return}jQuery("#tb-card-templates-working").show();jQuery(this).hide();jQuery.each(y.selectedCards,function(e,t){switch(t.type){case"fundraising":case"merch":case"product":case"associated":{if(t.image_url){if(!l[t.image_url]){l[t.image_url]=null}}break}}});if(jQuery("#tb-card-templates-delete-all").prop("checked")){TBUtilities.Log("Delete all selected");if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}TBUtilities.Log("Session token ="+i);TubeBuddyYouTubeActions.DeleteAllCards(a,i,TubeBuddyCardTemplates.DeleteAllCardsCallBack)}else{k()}});jQuery(document).on("click","#tb-card-templates-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-card-templates-container").hide()});jQuery(document).on("change","#tb-card-templates-select",function(){jQuery(".tb-card-templates-template-name").text(jQuery("#tb-card-templates-select option:selected").text());p=jQuery("#tb-card-templates-select option:selected").text().trim();g()});jQuery(document).on("change",".tb-card-templates-placeholders",function(){var e=jQuery(this).is(":checked");if(e&&!TBGlobal.CanAccessLevel3Tools()){jQuery(this).prop("checked",false);TBGlobal.ShowUpgradePage("use Placeholders","legend");return}});jQuery(document).on("click","#tb-card-templates-delete-template",function(){TBUtilities.Confirm("Are you sure you want to delete this Card Template?",B,null)});jQuery(document).on("click","#tb-card-templates-reload-templates",function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoCardTemplates;TBExtension.Get(e,"CRCardTemplatesGetVideoCardTemplates",null)});jQuery(document).on("click","#tb-card-templates-select-all",function(){y.selectedCards=[];y.cards.forEach(function(e){y.selectedCards.push(e)});jQuery(".tb-card-templates-cards-item-inner").addClass("tb-card-templates-card-item-inner-selected");jQuery("#tb-card-templates-how-many").text("Selected ("+y.selectedCards.length+"/"+y.cards.length+")")});jQuery(document).on("click","#tb-card-templates-select-none",function(){y.selectedCards=[];jQuery(".tb-card-templates-cards-item-inner").removeClass("tb-card-templates-card-item-inner-selected");jQuery("#tb-card-templates-how-many").text("Selected (0/"+y.cards.length+")")});jQuery(document).on("click",".tb-cards-template-input",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-card-templates-cards-item",function(){try{var e=jQuery(this).attr("data-template-card-default-id");TBUtilities.Log("Card selected with key id =");TBUtilities.Log(e);var t=TBUtilities.GetInArray(y.selectedCards,"key",e);TBUtilities.Log(t);TBUtilities.Log("Selected cards before modifying");TBUtilities.Log(y.selectedCards);if(t==null){var i=TBUtilities.GetInArray(y.cards,"key",e);y.selectedCards.push(i);jQuery(this).find(".tb-card-templates-cards-item-inner").addClass("tb-card-templates-card-item-inner-selected");TBUtilities.Log("Selected cards after adding");TBUtilities.Log(y.selectedCards)}else{TBUtilities.RemoveFromArray(y.selectedCards,"key",e);jQuery(this).find(".tb-card-templates-cards-item-inner").removeClass("tb-card-templates-card-item-inner-selected");TBUtilities.Log("Selected cards after removing");TBUtilities.Log(y.selectedCards)}jQuery("#tb-card-templates-how-many").text("Selected ("+y.selectedCards.length+"/"+y.cards.length+")");if(y.selectedCards.length==0)jQuery("#tb-card-templates-apply").hide();else jQuery("#tb-card-templates-apply").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardTemplates] [click] tb-card-templates-cards-item"})}})};var f=function(){jQuery(document.body).on("CRTBTemplateGetImageBytes",function(e,t){try{if(t.success){var i=JSON.parse(t.response);l[t.data.Url]=i}else{l[t.data.Url]=""}var n=0;for(var o in l){var a=l[o];if(a!=null){n++}}if(Object.keys(l).length==n){k()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCards] CRTBGetImageBytes"})}});jQuery(document.body).on("CRCardTemplatesSession",function(e,t){try{TBUtilities.Log("CRCardTemplatesSession");var n=DOMPurify.sanitize(t.response,DOMPurifyConfig);var o=jQuery.parseHTML(n);i=TBUtilities.GetSessionToken(n);TBUtilities.Log(i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsTemplates] CRCardTemplatesSession"})}});jQuery(document.body).on("CRTBCardTemplateCardsTemplateToggle",function(e,t){var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoCardTemplates;TBExtension.Get(i,"CRCardTemplatesGetVideoCardTemplates",null)});jQuery(document.body).on("CRTBLoadCardsTemplatesTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(t.response);if(b){b.append(t.response)}else{jQuery("body").append(DOMPurify.sanitize(t.response,DOMPurifyConfig))}v(d,c,u)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsTemplates] CRTBLoadCardsTemplatesTemplate"})}});jQuery(document.body).on("CRCardTemplatesGetVideoCardTemplates",function(e,t){try{jQuery("#tb-card-templates-select").show();jQuery("#tb-card-templates-select").find("option").remove();if(t.success){_videoCardTemplates=jQuery.parseJSON(t.response);if(_videoCardTemplates.length>0){jQuery("#tb-card-templates-select").empty();jQuery.each(_videoCardTemplates,function(){jQuery("#tb-card-templates-select").append(jQuery("<option></option>").text(this.CardTemplateName).val(this.Id))});jQuery("#tb-card-templates-loading-container").hide();jQuery("#tb-card-templates-none").hide();jQuery("#tb-card-templates-apply-container").show();g()}else{jQuery("#tb-card-templates-loading-container").hide();jQuery("#tb-card-templates-none").show();jQuery("#tb-card-templates-apply-container").hide();jQuery("#tb-card-templates-apply").hide()}}}catch(e){jQuery("#tb-card-templates-loading-container").hide();jQuery("#tb-card-templates-none").show();jQuery("#tb-card-templates-apply-container").hide();jQuery("#tb-card-templates-apply").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUploads] CRAnnotationTemplatesGetVideoAnnotationTemplates"})}})};var v=function(t,n,o){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML);if(!i){try{TBExtension.Get("https://www.youtube.com/account",function(e,t,n){if(e){i=TBUtilities.GetSessionToken(n)}},null,{contentType:"text"})}catch(t){TBUtilities.LogError({Exception:e,Location:"[CardTemplates] [get session token from account page]"})}}jQuery("#tb-card-templates-loading-container").show();jQuery("#tb-card-templates-none").hide();jQuery("#tb-card-templates-apply-container").hide();jQuery("#tb-card-templates-apply").hide();a=t;jQuery("#tb-card-templates-container").fadeIn();jQuery("#tb-card-templates-how-many").text("");jQuery("#tb-card-templates-thumbnail").attr("src",o);jQuery("#tb-card-templates-title").text(n);jQuery("#tb-card-templates-title").attr("href","https://www.youtube.com/watch?v="+t);jQuery("#tb-card-templates-working").hide();s=0;r=0;var l=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoCardTemplates;TBExtension.Get(l,"CRCardTemplatesGetVideoCardTemplates",null)};var g=function(){jQuery("#tb-card-templates-list-container").html('<div style="padding:20px;"><span class="tb-spinner"></span> Loading...</div>');TBYouTubeApi.GetVideoDetails(a,null,T)};var T=function(e){try{o=e;var t=TBUtilities.GetInArray(_videoCardTemplates,"Id",jQuery("#tb-card-templates-select").val());y.videoId=t.Id;jQuery("#tb-card-templates-edit-template").attr("href","https://www.youtube.com/cards?feature=vm&v="+y.videoId);TBYouTubeApi.GetVideoDetails(y.videoId,null,j);p=jQuery("#tb-card-templates-select option:selected").text().trim()}catch(e){TBUtilities.LogError({Exception:e,Location:"[CardTemplates] [api callback] destinationVideoDetailsCallback"})}};var j=function(e){try{n=e;TubeBuddyYouTubeActions.GetCardsList(y.videoId,TubeBuddyCardTemplates.GetCardsListCallback)}catch(e){TBUtilities.LogError({Exception:e,Location:"[CardTemplates] [api callback] sourceVideoDetailsCallback"})}};var Q=function(e){jQuery("#tb-card-templates-list-container").html("");try{if(e.feature_templates.length==0){jQuery("#tb-card-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any Cards</div>');jQuery("#tb-card-templates-apply").hide();return}else{y.cards=e.feature_templates.slice();y.selectedCards=e.feature_templates.slice()}jQuery("#tb-card-templates-list-container").html("");TBUtilities.Log("TubeBuddyCardTemplates - Cards Returned");TBUtilities.Log(JSON.stringify(e));var t=y.cards.length;for(var i=0;i<t;i++){var n=y.cards[i];switch(n.type){case"collaborator":{var o=n.teaser_text;if(o==null||o.length===0){o=n.custom_message}jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'" ><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"> <div class="tb-card-template-type">Channel</div><div class="tb-card-template-input-label">Title</div><input class="tb-cards-default-setting tb-cardTemplate-collaborator-title tb-material-input tb-cards-template-input" type="text" maxlength="50" data-template-card-default-id="'+n.key+'" value="'+n.title+'" /><div class="tb-card-template-input-label">Channel Url</div><input class="tb-cards-default-setting tb-cardTemplate-collaborator-channelurl tb-material-input tb-cards-template-input" type="text" maxlength="60" data-template-card-default-id="'+n.key+'" value="'+n.channel_url+'" /><div class="tb-card-template-input-label">Custom Message</div><input class="tb-cards-default-setting tb-cardTemplate-collaborator-custom-message tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+n.custom_message+'" /><div class="tb-card-template-input-label">Teaser Text</div><input class="tb-cards-default-setting tb-cardTemplate-collaborator-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+o+'" /><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left10 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"product":case"associated":{var o=n.teaser_text;if(o==null||o.length===0){o=n.custom_message}jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'"><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type"><img style="height:20px; float:right;" src="'+n.image_url+'"/>Associated website</div><div></div><div class="tb-card-template-input-label">Title</div> <input class="tb-cards-default-setting tb-cardTemplate-associated-title tb-material-input tb-cards-template-input" type="text" maxlength="50" data-template-card-default-id="'+n.key+'" value="'+n.title+'" /><div class="tb-card-template-input-label">Call to Action</div> <input class="tb-cards-default-setting tb-cardTemplate-associated-custom-message tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+n.custom_message+'" /><div class="tb-card-template-input-label">URL</div> <input class="tb-cards-default-setting tb-cardTemplate-associated-target-url tb-material-input tb-cards-template-input" type="text" data-template-card-default-id="'+n.key+'" value="'+n.target_url+'" /><div class="tb-card-template-input-label">Teaser Text</div> <input class="tb-cards-default-setting tb-cardTemplate-associated-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+o+'" /><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left10 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"fundraising":{var a=n.teaser_text;if(a==null||a.length===0){a=n.custom_message}jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'"><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type"><img style="height:20px; float:right;" src="'+n.image_url+'"/>Fundraising</div><div></div><div class="tb-card-template-input-label">Title</div><input class="tb-cards-default-setting tb-cardTemplate-fundraising-title tb-material-input tb-cards-template-input" type="text" maxlength="50" data-template-card-default-id="'+n.key+'" value="'+n.title+'" /><div class="tb-card-template-input-label">Call to Action</div><input class="tb-cards-default-setting tb-cardTemplate-fundraising-custom-message tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+n.custom_message+'" /><div class="tb-card-template-input-label">URL</div><input class="tb-cards-default-setting tb-cardTemplate-fundraising-target-url tb-material-input tb-cards-template-input" type="text" data-template-card-default-id="'+n.key+'" value="'+n.target_url+'" /><div class="tb-card-template-input-label">Teaser Text</div><input class="tb-cards-default-setting tb-cardTemplate-fundraising-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+a+'" /><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left10 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"merch":{var s=n.teaser_text;if(s==null||s.length===0){s=n.custom_message}jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'"  ><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type"><img style="height:20px; float:right;" src="'+n.image_url+'"/>Merchandise</div><div></div><div class="tb-card-template-input-label">Title</div><input class="tb-cards-default-setting tb-cardTemplate-merch-title tb-material-input tb-cards-template-input" type="text"  maxlength="50" data-template-card-default-id="'+n.key+'" value="'+n.title+'" /><div class="tb-card-template-input-label">Call to Action</div><input class="tb-cards-default-setting tb-cardTemplate-merch-custom-message tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+n.custom_message+'" /><div class="tb-card-template-input-label">URL</div><input class="tb-cards-default-setting tb-cardTemplate-merch-target-url tb-material-input tb-cards-template-input" type="text" data-template-card-default-id="'+n.key+'" value="'+n.target_url+'" /><div class="tb-card-template-input-label">Teaser Text</div><input class="tb-cards-default-setting tb-cardTemplate-merch-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+s+'" /><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left10 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"video":{jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'"><div class="tb-card-templates-cards-item-inner  tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type">Video</div><div class="tb-card-template-input-label">URL</div><input class="tb-cards-default-setting tb-cardTemplate-video-url tb-material-input tb-cards-template-input" type="text" data-template-card-default-id="'+n.key+'" value="'+n.target_url+'" /><div class="tb-card-template-input-label">Custom Message</div><input class="tb-cards-default-setting tb-cardTemplate-video-custom-message tb-material-input tb-cards-template-input" type="text" maxlength="30" data-card-default-id="'+n.key+'" value="'+n.custom_message+'" /><div class="tb-card-template-input-label">Teaser Text</div><input class="tb-cards-default-setting tb-cardTemplate-video-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-card-default-id="'+n.key+'" value="'+n.teaser_text+'" /><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left5 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"playlist":{jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'"  ><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type">Playlist</div><div class="tb-card-template-input-label">URL</div><input class="tb-cards-default-setting tb-cardTemplate-playlist-url tb-material-input tb-cards-template-input" type="text" data-template-card-default-id="'+n.key+'" value="'+n.target_url+'" /><div class="tb-card-template-input-label">Custom Message</div><input class="tb-cards-default-setting tb-cardTemplate-playlist-custom-message tb-material-input tb-cards-template-input" type="text" maxlength="30" data-card-default-id="'+n.key+'" value="'+n.custom_message+'" /><div class="tb-card-template-input-label">Teaser Text</div><input class="tb-cards-default-setting tb-cardTemplate-playlist-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-card-default-id="'+n.key+'" value="'+n.teaser_text+'" /><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left5 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"tip":{jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item" data-template-card-default-id="'+n.key+'"><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type">Fan Funding</div><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-top5 tb-margin-left5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}case"poll":{var r="";jQuery.each(n.choices,function(e,t){r+='<input class="tb-cards-default-setting tb-cardTemplate-poll-choice tb-material-input tb-cards-template-input" type="text" maxlength="30" value="'+t+'" />'});jQuery("#tb-card-templates-list-container").append('<div class="tb-card-templates-cards-item " data-template-card-default-id="'+n.key+'"><div class="tb-card-templates-cards-item-inner tb-card-templates-card-item-inner-selected"><div class="tb-card-template-type">Poll</div><div class="tb-card-template-input-label">Title</div><input class="tb-cards-default-setting tb-cardTemplate-poll-title tb-material-input tb-cards-template-input" type="text" maxlength="50" data-template-card-default-id="'+n.key+'" value="'+n.title+'" /><div class="tb-card-template-input-label">Teaser Text</div><input class="tb-cards-default-setting tb-cardTemplate-poll-teaser tb-material-input tb-cards-template-input" type="text" maxlength="30" data-template-card-default-id="'+n.key+'" value="'+n.teaser_text+'" /><div class="tb-card-template-input-label">Poll Choices</div><div style="margin-left:5px;max-height: 50px; overflow: auto;">'+r+'</div><div><div class="tb-card-template-input-label">Start Time</div><div class="tb-margin-left5 tb-margin-top5">'+TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(n.start_ms),":"," ")+"</div></div></div></div>");break}}}jQuery("#tb-card-templates-apply").show();jQuery("#tb-card-templates-how-many").text("Selected ("+y.selectedCards.length+"/"+y.cards.length+")")}catch(t){jQuery("#tb-card-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any Cards</div>');jQuery("#tb-card-templates-apply").hide();t.resultData=e;TBUtilities.LogError({Exception:t,Location:"[TubeBuddyCardTemplates] getCardsListCallback"})}};var B=function(e){var e=jQuery("#tb-card-templates-select").val();var t=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleCardTemplate;var i={Id:e,Enabled:false,Title:""};TBExtension.Post(t,JSON.stringify(i),"CRTBCardTemplateCardsTemplateToggle",null,{contentType:"application/json"})};var k=function(){var e=0;for(var t in l){var s=l[t];if(s!=null){e++}}if(Object.keys(l).length!=0&&e!=Object.keys(l).length){for(t in l){var r=TBGlobal.host+TBGlobal.apiUrls.imageGetBytes+"?url="+encodeURIComponent(t);TBExtension.Get(r,"CRTBTemplateGetImageBytes",{Url:t})}return}jQuery.each(y.selectedCards,function(e,t){switch(t.type){case"product":case"associated":{if(t.image_url&&l[t.image_url]){t.imagefile=l[t.image_url]}break}}});if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}var d=0;try{TBUtilities.AddAction({CardCount:y.selectedCards.length},TBUtilities.ActionTypes.CardTemplates_Apply,"cardtemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[CardTemplates] [applyCards]"})}jQuery.each(y.selectedCards,function(e,t){d++;var s=jQuery("div[data-template-card-default-id='"+t.key+"']");var r=jQuery.extend({},t);w(r,s);var l=timelord(o.contentDetails.duration).ticks();var c=timelord(n.contentDetails.duration).ticks();TubeBuddyCards.CheckCardStartMs(r,c,l);var u=TubeBuddyCards.CardCopyDelay()*e;setTimeout(function(){TubeBuddyYouTubeActions.CopyCard(a,r,i,TubeBuddyCardTemplates.CopyCardsCallBack)},u)})};var w=function(e,t){TBUtilities.Log("copyFromTemplateToCard before");TBUtilities.Log(e);switch(e.type){case"product":case"associated":{e.title=jQuery(t).find(".tb-cardTemplate-associated-title").val();e.custom_message=jQuery(t).find(".tb-cardTemplate-associated-custom-message").val();e.target_url=jQuery(t).find(".tb-cardTemplate-associated-target-url").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-associated-teaser").val();try{if(jQuery(".tb-card-templates-placeholders").is(":checked")){TBUtilities.Log("Doing placeholder replace");e.target_url=TBUtilities.ReplaceAll(e.target_url,"((youtubevideoid))",d,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"{videoid}",d,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"((templatename))",p,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"{template}",p,true)}}catch(e){}if(e.image_url&&l[e.image_url]){e.imagefile=l[e.image_url]}break}case"fundraising":{e.title=jQuery(t).find(".tb-cardTemplate-fundraising-title").val();e.custom_message=jQuery(t).find(".tb-cardTemplate-fundraising-custom-message").val();e.target_url=jQuery(t).find(".tb-cardTemplate-fundraising-target-url").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-fundraising-teaser").val();try{if(jQuery(".tb-card-templates-placeholders").is(":checked")){TBUtilities.Log("Doing placeholder replace");e.target_url=TBUtilities.ReplaceAll(e.target_url,"((youtubevideoid))",d,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"{videoid}",d,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"((templatename))",p,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"{template}",p,true)}}catch(e){}if(e.image_url&&l[e.image_url]){e.imagefile=l[e.image_url]}break}case"video":{e.target_url=jQuery(t).find(".tb-cardTemplate-video-url").val();e.custom_message=jQuery(t).find(".tb-cardTemplate-video-custom-message").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-video-teaser").val();break}case"playlist":{e.target_url=jQuery(t).find(".tb-cardTemplate-playlist-url").val();e.custom_message=jQuery(t).find(".tb-cardTemplate-playlist-custom-message").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-playlist-teaser").val();break}case"merch":{e.title=jQuery(t).find(".tb-cardTemplate-merch-title").val();e.custom_message=jQuery(t).find(".tb-cardTemplate-merch-custom-message").val();e.target_url=jQuery(t).find(".tb-cardTemplate-merch-target-url").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-merch-teaser").val();try{if(jQuery(".tb-card-templates-placeholders").is(":checked")){TBUtilities.Log("Doing placeholder replace");e.target_url=TBUtilities.ReplaceAll(e.target_url,"((youtubevideoid))",d,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"{videoid}",d,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"((templatename))",p,true);e.target_url=TBUtilities.ReplaceAll(e.target_url,"{template}",p,true)}}catch(e){}if(e.image_url&&l[e.image_url]){e.imagefile=l[e.image_url]}break}case"tip":{break}case"collaborator":{e.title=jQuery(t).find(".tb-cardTemplate-collaborator-title").val();e.custom_message=jQuery(t).find(".tb-cardTemplate-collaborator-custom-message").val();e.channel_url=jQuery(t).find(".tb-cardTemplate-collaborator-channelurl").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-collaborator-teaser").val();break}case"poll":{e.title=jQuery(t).find(".tb-cardTemplate-poll-title").val();e.teaser_text=jQuery(t).find(".tb-cardTemplate-poll-teaser").val();var i=new Array;jQuery(t).find(".tb-cardTemplate-poll-choice").each(function(){var e=jQuery(this).val();i.push(e)});e.choices=i;break}}TBUtilities.Log("copyFromTemplateToCard after");TBUtilities.Log(e)};var x=function(e,t,i){TBUtilities.Log("TubeBuddyCardTemplates - deleteAllCardsCallBack cards from video + "+t+" success = "+e);if(e){k()}else{TBUtilities.Alert("There was an error deleting cards from the video.");v(d,c,u)}};var U=function(e,t,i,n){if(e==true){s++}else{r++}var o=s+r;if(o>=y.selectedCards.length){if(s==y.selectedCards.length){if(document.URL.indexOf("cards")>0||document.URL.indexOf("live_dashboard")>0){TBUtilities.Confirm("Success! \n\n In order for your Cards to show up, we need to re-load the page. Any unsaved changes on this page will be lost. \n\nShould we reload now?",L,null);jQuery(".tb-module-close").trigger("close")}else{TBUtilities.Alert("Cards successfully applied!",function(){jQuery(".tb-module-close").trigger("click")})}}else{var a="There was an error applying card template.";if(n){a+="<br>"+n}TBUtilities.Alert(a);v(d,c,u)}}};var L=function(){location.reload()};return{Show:function(e,i,n,o){if(TBGlobal.IsAuthenticated()){d=e;c=i;u=n;if(o){b=o}else{b=null}if(!t){f();m();h();t=true}else if(t&&(o&&jQuery(".tb-card-templates-modal").length===0)){m()}else{v(d,c,u)}}},GetCardsListCallback:function(e){Q(e)},DeleteAllCardsCallBack:function(e,t,i){x(e,t,i)},CopyCardsCallBack:function(e,t,i,n){U(e,t,i,n)}}}();var TubeBuddyTopicGenerator=function(){var e=false;var t;var n;var o=1;var a=function(){jQuery("#tb-topic-generator-container").show();s("ideas");t=null;jQuery("#tb-topic-generator-video-topics-loading").show();jQuery("#tb-topic-generator-video-topics").hide();jQuery("#tb-topic-generator-update-container").hide();var e=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(e,"CRTBTopicGeneratorGetVideoTopics");if(TBExtension.GetType()!="firefox"){jQuery("#tbtopicgeneratorselectededitor").wysiwyg({controls:{subscript:{visible:false},superscript:{visible:false},undo:{visible:false},redo:{visible:false},insertHorizontalRule:{visible:false},createLink:{visible:false},unLink:{visible:false},insertImage:{visible:false},h1:{visible:false},h2:{visible:false},h3:{visible:false},html:{visible:false},removeFormat:{visible:false},insertTable:{visible:false},code:{visible:false}},iFrameClass:"tb-topic-generator-editor",css:"https://www.tubebuddy.com/assets/js/jquery-emoji-picker/tb.css"});jQuery("#tbtopicgeneratorselectededitor").wysiwyg("clear");jQuery(".wysiwyg").css("border","2px solid #ccc")}else{jQuery("#tbtopicgeneratorselectededitor").val("")}};var s=function(e){jQuery("#tb-topic-generator-update-container").hide();jQuery(".tb-topic-generator-tab-ideas").hide();switch(e){case"ideas":{jQuery(".tb-topic-generator-tab-ideas").show();break}case"update":{jQuery("#tb-topic-generator-update-container").show();break}}};var r=function(){var e=TBGlobal.host+"/ModuleManager/TopicGenerator/TopicGenerator?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/topicgenerator.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/topicgenerator.html"}TBExtension.Get(e,"CRTBLoadTopicGeneratorTemplate")};var l=function(e,i){jQuery(".tb-topic-generator-list-content").removeClass("tb-topic-generator-list-content-select");jQuery("#"+e).find(".tb-topic-generator-list-content").addClass("tb-topic-generator-list-content-select");jQuery(".tb-topic-generator-save").show();if(i){jQuery("#tb-topic-generator-video-topics-list").scrollTo("#"+e,500)}var n=TBUtilities.GetInArray(t,"Id",e);var o="";switch(n.SourceType){case 0:{var a=d("v",n.SourceUrl);var s=jQuery("#tb-topic-generator-source-type-relatedVideo").html();o=s.formatTemplate(n.SourceUrl,a);break}case 1:{var s=jQuery("#tb-topic-generator-source-type-comment").html();o=s.formatTemplate("https://youtube.com/watch?v="+n.AudienceSuggestedTopic.VideoId,n.AudienceSuggestedTopic.CommentorName,"https://www.youtube.com/channel/"+n.AudienceSuggestedTopic.CommentorChannelId);break}case 2:{var s=jQuery("#tb-topic-generator-source-type-googletrends").html();o=s.formatTemplate(n.SourceUrl,n.Title);break}case 3:{var s=jQuery("#tb-topic-generator-source-type-custom").html();o=s.formatTemplate("");break}}jQuery(".tb-topic-generator-selected-source-container").empty();jQuery(".tb-topic-generator-selected-source-container").append(o);jQuery("#tb-topic-generator-title-update").val(n.Title);jQuery("#tb-topic-generator-isComplete-update").prop("checked",n.IsComplete);if(TBExtension.GetType()=="firefox"){jQuery("#tbtopicgeneratorselectededitor").val(n.Notes)}else{jQuery("#tbtopicgeneratorselectededitor").wysiwyg("setContent",n.Notes)}jQuery(".tb-topic-generator-list-remove").prop("data-id",n.Id)};var d=function(e,t){if(!t)t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))};var c=function(){if(jQuery("#tb-topic-generator-title-update").val().length==0){TBUtilities.Alert("Please enter a title for your video topic");return}var e=jQuery(".tb-topic-generator-list-content-select").closest("li").attr("id");var i=TBUtilities.GetInArray(t,"Id",e);i.Notes=TBExtension.GetType()=="firefox"?jQuery("#tbtopicgeneratorselectededitor").val():jQuery("#tbtopicgeneratorselectededitor").wysiwyg("getContent");i.Title=jQuery("#tb-topic-generator-title-update").val();i.IsComplete=jQuery("#tb-topic-generator-isComplete-update:checked").length>0;var n=TBGlobal.host+TBGlobal.apiUrls.topicsUpdateVideoTopic;TBExtension.Post(n,JSON.stringify(i),"CRTBTopicGeneratorNotesSaved",i.Id,{contentType:"application/json"})};var u=function(e){var t=e;t.IsComplete=!t.IsComplete;var i=TBGlobal.host+TBGlobal.apiUrls.topicsUpdateVideoTopic;TBExtension.Post(i,JSON.stringify(t),"CRTBTopicGeneratorNotesSaved",t.Id,{contentType:"application/json"})};var p=function(e){var i=jQuery("#tb-topic-generator-video-topics-list-sortable li");var n=1;i.each(function(e,i){var o=jQuery(i);var a=TBUtilities.GetInArray(t,"Id",o.attr("id"));a.Priority=n;n++});var o=TBGlobal.host+TBGlobal.apiUrls.topicsUpdateVideoTopicsOrder;TBExtension.Post(o,JSON.stringify(t),null,null,{contentType:"application/json"})};var b=function(){jQuery(document).on("click","#tb-topic-generator-launch-keyword-explorer",function(e){jQuery("#tb-topic-generator-container").hide();var t=jQuery(this);TubeBuddyTagExplorer.ShowTagExplorer(null,t,null)});jQuery(document).on("click",".tb-topic-generator-list-remove",function(e){var i;if(jQuery(this).hasClass("tb-topic-generator-list-item-action")){i=jQuery(this).attr("data-id")}else{i=jQuery(this).prop("data-id")}if(i){TBUtilities.Confirm("Are you sure you want to delete this topic?",function(){var e=TBUtilities.GetInArray(t,"Id",i);jQuery("#tb-topic-generator-video-topics-loading").show();jQuery("#tb-topic-generator-video-topics").hide();var n=TBGlobal.host+TBGlobal.apiUrls.topicsDeleteVideoTopic;TBExtension.Post(n,JSON.stringify(e),"CRTBVideoTopicDelete",null,{contentType:"application/json"})},function(){})}});jQuery(document).on("click",".tb-topic-generator-video-topics-list-filter",function(e){jQuery(".tb-topic-generator-video-topics-list-filter").removeClass("tb-topic-generator-list-filter--selected");jQuery(this).addClass("tb-topic-generator-list-filter--selected");o=jQuery(this).attr("data-filter-type");TBUtilities.Log("tb-topic-generator-video-topics-list-filter change");try{var t=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(t,"CRTBTopicGeneratorGetVideoTopics")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBVideoTopicDelete"})}});jQuery(document).on("click",".tb-topic-generator-list-item-toggle-complete",function(){var e=jQuery(this).closest(".tb-topic-generator-list-item").attr("id");var i=TBUtilities.GetInArray(t,"Id",e);u(i)});jQuery(document).on("click","#tb-topic-generator-cancel-update",function(){s("ideas")});jQuery(document).on("click","#tb-topic-generator-insert",function(){try{var e=jQuery("#tb-topic-generator-title-input").val();if(e.length==0){TBUtilities.Alert("Please enter a title for your video topic");return}var t=jQuery(this).attr("data-url");var i=jQuery(this).attr("data-type");if(!t){t=""}if(!i){i=3}var o=jQuery(this).attr("data-audience-id");var a=null;var s=null;if(typeof o!==typeof undefined&&o!==false){a=TBUtilities.GetInArray(n,"Id",o);s='"'+a.Comment+'"';y(a.CommentId,a.Id)}var r={Title:e,SourceUrl:t,SourceType:i,AudienceSuggestedTopic:a,Notes:s};var l=TBGlobal.host+TBGlobal.apiUrls.topicsAddVideoTopic;TBExtension.Post(l,JSON.stringify(r),"CRTBTopicGeneratorAddVideoTopic",null,{contentType:"application/json"});jQuery("#tb-topic-generator-insert").removeAttr("data-title");jQuery("#tb-topic-generator-insert").removeAttr("data-url");jQuery("#tb-topic-generator-insert").removeAttr("data-type");jQuery("#tb-topic-generator-insert").removeAttr("data-audience-id");TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_Use,"videotopicplanner")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] tb-topic-generator-add [click]"})}});jQuery(document).on("click","#tb-topic-generator-add-topic",function(e){try{var t=jQuery("#tb-topic-generator-title-update").val();var i=null;var n=3;if(t.length==0){TBUtilities.Alert("Please enter a title for your video topic");return}if(TBExtension.GetType()!="firefox"){i=jQuery("#tbtopicgeneratorselectededitor").wysiwyg("getContent")}else{i=jQuery("#tbtopicgeneratorselectededitor").val()}var o={Title:t,Notes:i,SourceType:n,SourceUrl:"",AudienceSuggestedTopic:null};var a=TBGlobal.host+TBGlobal.apiUrls.topicsAddVideoTopic;TBExtension.Post(a,JSON.stringify(o),"CRTBTopicGeneratorAddVideoTopic",null,{contentType:"application/json"});TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_Use,"videotopicplanner")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] tb-topic-generator-add-topic [click]"})}});jQuery(document).on("click",".tb-topic-generator-save",function(e){c()});jQuery(document).on("click",".tb-topic-generator-list-edit",function(e){jQuery("#tb-topic-generator-add-topic").hide();jQuery("#tb-topic-planner-save-changes").show();jQuery("#tb-topic-planner-delete-button").show();try{var t=jQuery(this).closest(".tb-topic-generator-list-item").attr("id");l(t);s("update")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] tb-topic-generator-list-edit click"})}});jQuery(document).on("click",".tb-topic-generator-addVideoTopic",function(e){jQuery("#tb-topic-planner-save-changes").hide();jQuery("#tb-topic-planner-delete-button").hide();jQuery(".tb-topic-generator-selected-source-container").hide();jQuery("#tb-topic-generator-add-topic").show();jQuery("#tb-topic-generator-isComplete-update").prop("checked",false);if(TBGlobal.CanAccessLevel1Tools()==false&&t.length>=5){TBGlobal.ShowUpgradePage("have more than 5 topics","videotopicplanner");return}m();s("update")});jQuery(document).on("click",".tb-topic-generator-comments-remove",function(e){var t=jQuery(this).attr("data-commentid");TBUtilities.Confirm("Are you sure you want to remove this comment as a suggestion?",function(){y(t)},function(){})});jQuery(document).on("mouseover",".tb-topic-generator-list-item",function(e){var t=jQuery(".tb-topic-generator-sortable-chosen").length>0;if(!t)jQuery(this).addClass("tb-topic-generator-list-item--active")});jQuery(document).on("mouseout",".tb-topic-generator-list-item",function(e){jQuery(this).removeClass("tb-topic-generator-list-item--active")})};var y=function(e,t){var i={CommentId:e,Id:t};TBUtilities.Log(i);jQuery("#tb-topic-generator-comments-loading").show();jQuery("#tb-topic-generator-comments-list").empty();var n=TBGlobal.host+TBGlobal.apiUrls.topicsToggleCommentAudienceSuggestedTopic;TBExtension.Post(n,JSON.stringify(i),"CRTBGetAudienceSuggestedDelete",null,{contentType:"application/json"})};var m=function(){jQuery("#tb-topic-generator-title-update").val("");if(TBExtension.GetType()!="firefox"){jQuery("#tbtopicgeneratorselectededitor").wysiwyg("setContent","")}else{jQuery("#tbtopicgeneratorselectededitor").val("")}};var h=function(){jQuery(document.body).on("CRTBLoadTopicGeneratorTemplate",function(e,t){TBUtilities.Log("CRTBLoadTopicGeneratorTemplate");try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);a()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBLoadTopicGeneratorTemplate"})}});jQuery(document.body).on("CRTBVideoTopicDelete",function(e,t){TBUtilities.Log("CRTBVideoTopicDelete");TBUtilities.Log(t);try{s("ideas");var i=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(i,"CRTBTopicGeneratorGetVideoTopics")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBVideoTopicDelete"})}});jQuery(document.body).on("CRTBGetAudienceSuggestedDelete",function(e,t){TBUtilities.Log("CRTBGetAudienceSuggestedDelete");TBUtilities.Log(t);try{if(t.success){var i=TBGlobal.host+TBGlobal.apiUrls.topicsGetAudienceSuggestedTopics;TBExtension.Get(i,"CRTBGetAudienceSuggestedTopics")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBGetTopRelatedVideos"})}});jQuery(document.body).on("CRTBGetAudienceSuggestedTopics",function(e,t){TBUtilities.Log("CRTBGetAudienceSuggestedTopics");TBUtilities.Log(t);try{if(t.success){jQuery("#tb-topic-generator-comments-list").empty();jQuery("#tb-topic-generator-comments-list-empty").hide();n=jQuery.parseJSON(t.response);if(n.length>0){var o="";for(i=0;i<n.length;i++){var a=jQuery("#tb-topic-generator-comments-template").html();rowTemplate=a.formatTemplate(n[i].Comment,n[i].CommentorChannelId,n[i].VideoId,n[i].CommentorPhoto,n[i].CommentId,n[i].Id);o+=rowTemplate}}else{jQuery("#tb-topic-generator-comments-list-empty").show()}jQuery("#tb-topic-generator-comments-loading").hide();jQuery("#tb-topic-generator-comments-list").append(o)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBGetTopRelatedVideos"})}});jQuery(document.body).on("CRTBGetTopRelatedVideos",function(e,t){TBUtilities.Log("CRTBGetTopRelatedVideos");TBUtilities.Log(t);try{jQuery("#tb-topic-generator-related-loading").hide();if(t.success){var n=jQuery.parseJSON(t.response);if(n.length>0){var o="";for(i=0;i<n.length;i++){var a=jQuery("#tb-topic-generator-related-template").html();rowTemplate=a.formatTemplate(n[i].snippet.title,n[i].url,n[i].snippet.thumbnails.thumbnailMedium,TBUtilities.FormatNumberAbbreviated(n[i].statistics.ViewCount),n[i].snippet.description);o+=rowTemplate}jQuery("#tb-topic-generator-related-list").append(o)}else{jQuery("#tb-topic-generator-related-list-empty").show()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBGetTopRelatedVideos"})}});jQuery(document.body).on("CRTBTopicGeneratorAddVideoTopic",function(e,t){TBUtilities.Log("CRTBTopicGeneratorAddVideoTopic");TBUtilities.Log(t);try{if(t.success){var i=jQuery.parseJSON(t.response);var n=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(n,"CRTBTopicGeneratorGetVideoTopics",i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBLoadTopicGeneratorTemplate"})}});jQuery(document.body).on("CRTBTopicGeneratorGetVideoTopics",function(e,n){TBUtilities.Log("CRTBTopicGeneratorGetVideoTopics");try{if(n.success){jQuery("#tb-topic-generator-video-topics-list-sortable").empty();jQuery("#tb-topic-generator-video-topics-loading").hide();jQuery("#tb-topic-generator-video-topics").show();t=jQuery.parseJSON(n.response);if(t.length==0){s("ideas");jQuery("#tb-topic-generator-video-topics-list").hide();jQuery("#tb-topic-generator-video-topics-empty").show()}else{var a=jQuery.grep(t,function(e,t){return e.IsComplete}).length;var r=t.length-a;var d=o;jQuery("#tb-topic-generator-video-topics-list-filter-"+d).addClass("tb-topic-generator-list-filter--selected");jQuery("#tb-topic-generator-video-topics-list-sortable").empty();var c="";for(i=0;i<t.length;i++){var u="display: none;";var b=t[i].IsComplete?"Mark Incomplete":"Mark Complete";var y=t[i].IsComplete?"check_box":"check_box_outline_blank";var m=t[i].Title.replace(/<[^>]*>?/gm,"");var h=t[i].Notes.replace(/<[^>]*>?/gm,"");if(d==0||d==1&&!t[i].IsComplete||d==2&&t[i].IsComplete){u=""}var f=jQuery("#tb-topic-generator-topic-template").html();rowTemplate=f.formatTemplate(t[i].Id,m,u,h,t[i].IsComplete,b,y);c+=rowTemplate}jQuery("#tb-topic-generator-video-topics-list-sortable").append(c);var v=document.getElementById("tb-topic-generator-video-topics-list-sortable");var g=Sortable.create(v,{handle:".tb-topic-generator-list-handle",chosenClass:"tb-topic-generator-sortable-chosen",onSort:p,animation:150,filter:".tb-topic-generator-list-edit"});jQuery("#tb-topic-generator-video-topics-empty").hide();jQuery("#tb-topic-generator-video-topics-list").show();if(n.data){s("ideas");l(n.data,true)}else{var T=jQuery(".tb-topic-generator-list-item:visible:first");if(T&&T.length>0){var j=T.attr("id");l(j,true)}else{l(t[0].Id,true)}}}}else{jQuery("#tb-topic-generator-video-topics-empty").show();jQuery("#tb-topic-generator-video-topics-list").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBTopicGeneratorHotTrend"})}});jQuery(document.body).on("CRTBTopicGeneratorNotesSaved",function(e,t){TBUtilities.Log("CRTBTopicGeneratorNotesSaved");TBUtilities.Log(t);try{if(t.success){jQuery("#tb-topic-generator-saved-icon").fadeIn().delay(2e3).fadeOut();var i=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(i,"CRTBTopicGeneratorGetVideoTopics",t.data)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBTopicGeneratorNotesSaved"})}})};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){h();b();r();e=true}else{a()}}}}}();$.fn.filterNode=function(e){return this.find("*").filter(function(){return this.nodeName===e})};jQuery.fn.scrollTo=function(e,t){$(this).animate({scrollTop:$(this).scrollTop()-$(this).offset().top+$(e).offset().top},t==undefined?1e3:t);return this};var TubeBuddyEndScreens=function(){var e=false;var t=null;var i={method:3,specificVideoIds:[],specificVideos:[],validPlaylistIds:[],playlistId:"",search:"",selectedVideo:{},elements:[],selectedElements:[],videos:[],destinationVideos:[],currentVideo:null,isStopped:false,elementIdsToDelete:[],isDeleteOnly:false,totalDestinationVideos:0,videosWithDeletedEndscreens:[],hasFinished:false,errorCount:0,successCount:0,channelVideoCount:0,fromBulkSelectMenu:false,imageConversionDic:{}};var n={deleteAll:false,deleteUrl:"",deleteText:"",deleteWebsite:false,deleteFundraising:false,deleteMerchandice:false,deleteVideOrPlaylist:false,deleteChannel:false,includePartialMatches:false,includePartialTextMatches:false};var o=function(){try{jQuery("#tb-endscreens-back-bulk").hide();jQuery("#tb-endscreens-fetching").show();if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-back-bulk").show()}jQuery(".tb-endscreens-destination-row").removeClass("tb-endscreens-destination-row--selected");jQuery("#tb-endscreens-error-copy-container").hide();jQuery("#tb-endscreens-error-copy").prop("data-clipboard-text","");var e=new ClipboardJS("#tb-endscreens-error-copy");jQuery("#tb-endscreens-selected-count").text("0");jQuery("#tb-endscreens-total-count").text("0");jQuery("#tb-endscreens-destination-selected-count").text("0");jQuery("#tb-endscreens-destination-total-count").text("0");jQuery("#tb-endscreens-header-image").attr("src",i.selectedVideo.thumbnail);jQuery("#tb-endscreens-featured-thumbnail").attr("src",i.selectedVideo.thumbnail);jQuery("#tb-endscreens-method").hide();jQuery(".tb-endscreens-filter").val("all");jQuery("#tb-endscreens-completed-list2-count").text("0");jQuery("#tb-endscreens-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-endscreens-onlyLoadFirstPage").prop("checked",false);if(i.isDeleteOnly){jQuery("#tb-endscreens-thumbnail").hide();jQuery("#tb-endscreens-title").hide();jQuery("#tb-endscreens-help-link").attr("href",TBGlobal.host+"/tools?tool=bulkdeleteendscreen");jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 1");jQuery(".tb-module-embed-video").hide();jQuery("#tb-endscreens-stop").text("Stop Deleting")}else{jQuery("#tb-endscreens-thumbnail").attr("src",i.selectedVideo.thumbnail);jQuery("#tb-endscreens-title").text(i.selectedVideo.title);jQuery("#tb-endscreens-title").attr("href","https://www.youtube.com/watch?v="+i.selectedVideo.id);jQuery("#tb-endscreens-thumbnail").show();jQuery("#tb-endscreens-title").show();jQuery(".tb-module-embed-video").show();jQuery("#tb-endscreens-help-link").attr("href",TBGlobal.host+"/tools?tool=bulkcopyendscreen");if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 1")}jQuery("#tb-endscreens-stop").text("Stop Copying")}jQuery("#tb-endscreens-status").hide();jQuery("#tb-endscreens-confirm").hide();jQuery("#tb-endscreens-bulk-description-updates-container").hide();jQuery("#tb-endscreens-featured-content-container").hide();jQuery("#tb-endscreens-kickoff").hide();jQuery("#tb-endscreens-summary-container").hide();jQuery("#tb-endscreens-featured-video-status-complete").hide();jQuery("#tb-endscreens-featured-video-status-processing").hide();jQuery("#tb-endscreens-bulk-descriptions-status-complete").hide();jQuery("#tb-endscreens-bulk-descriptions-status-processing").hide();jQuery("#tb-endscreens-success").hide();jQuery("#tb-endscreens-back").hide();jQuery("#tb-endscreens-container").fadeIn();jQuery("#tb-endscreens-methods-container").fadeIn();jQuery("#tb-endscreens-none").hide();jQuery("#tb-endscreens-has").hide();jQuery("#tb-endscreens-stop").hide();jQuery("#tb-endscreens-done-close").hide();jQuery("#tb-endscreens-destination").hide();jQuery("#tb-endscreens-source").show();jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").text("");jQuery("#tb-endscreens-method-full").prop("checked","checked");var t=jQuery("#tb-endscreens-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(e){i.playlistId=e}}).data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();jQuery("#tb-endscreens-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-endscreens-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");t.disable();if(!i.isDeleteOnly){jQuery("#tb-cs-step-2-title").text("Which videos do you want to copy the selected End Screen Element(s) to?");jQuery("#tb-endscreens-what-videos2").text("Which videos do you want to copy the selected End Screen Element(s) to?");jQuery("#tb-endscreens-additional-options-containers").show();jQuery("#tb-endscreens-delete-existing").prop("checked",false);jQuery("#tb-endscreens-skip-existing").prop("checked",false);jQuery("#tb-endscreens-header-image").hide();jQuery("#tb-endscreens-confirm-statement").show();jQuery("#tb-endscreens-confirm-text").text("copying");jQuery("#tb-endscreens-kickoff").text("Start Copying!");jQuery("#tb-endscreens-delete-existing-warning").text("WARNING: You have chosen to automatically delete all existing End Screen Elements from the destination videos before copying new Elements to them.");jQuery("#tb-endscreens-delete-options").hide();jQuery("#tb-endscreens-source").show()}else{jQuery("#tb-endscreens-step-2-title").text("Which videos do you want to Delete End Screen Element(s) from?");jQuery("#tb-endscreens-what-videos2").text("Which videos do you want to Delete End Screen Element(s) from?");jQuery("#tb-endscreens-additional-options-containers").hide();jQuery("#tb-endscreens-delete-existing").prop("checked",true);jQuery("#tb-endscreens-skip-existing").prop("checked",false);jQuery("#tb-endscreens-header-image").hide();jQuery("#tb-endscreens-confirm-statement").hide();jQuery("#tb-endscreens-confirm-text").text("delete");jQuery("#tb-endscreens-kickoff").text("Start Deleting!");jQuery("#tb-endscreens-continue").show();jQuery("#tb-endscreens-delete-options").show();jQuery("#tb-endscreens-source").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] prepareDialog"})}};var a=function(){try{if(!i.isDeleteOnly){TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Loading Video Details");if(window.location.href.indexOf("studio.youtube.com")!==-1){TubeBuddyYouTubeActions.GetVideoDetailStudio(i.selectedVideo.id).then(function(e){TBUtilities.Log(e);TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - GetVideoDetailStudio");i.totalVideoMiliseconds=e.videoDurationMs;s()}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [loadData]"})})}else{TubeBuddyYouTubeActions.GetVideoDuration(i.selectedVideo.id).then(function(e){TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - GetVideoDetailStudio - classic");i.totalVideoMiliseconds=e.videoDurationMs;s()}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [loadData]"})})}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [loadData]"})}};var s=function(){TubeBuddyYouTubeActions.GetEndScreenList(i.selectedVideo.id,TubeBuddyEndScreens.GetEndScreenListCallback)};var r=function(e){try{TBUtilities.Log(e);i.allData=e.for_editor;if(e.for_editor.elements.length==0){i.elements=[];jQuery("#tb-endscreens-none").show();jQuery("#tb-endscreens-continue").hide();jQuery("#tb-endscreens-done-close").show()}else{i.elements=e.for_editor.elements;jQuery("#tb-endscreens-has").show();jQuery("#tb-endscreens-continue").show();jQuery("#tb-endscreens-done-close").hide()}jQuery("#tb-endscreens-list").empty();TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - End Screen list Returned");TBGlobal.AddUserDebugInfo(JSON.stringify(e));var t=i.elements.length;jQuery("#tb-endscreens-total-count").text(i.elements.length);for(var n=0;n<t;n++){var o=i.elements[n];switch(o.type){case"CHANNEL":{var a="";var s=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");if(o.isSubscribe){var r=jQuery("#tb-endscreens-elementType-subscribe-template").html();a=r.formatTemplate(o.id,s,o.title)}else{var r=jQuery("#tb-endscreens-elementType-channel-template").html();a=r.formatTemplate(o.id,o.targetUrl,o.metadata,s)}jQuery("#tb-endscreens-list").append(a);break}case"WEBSITE":{var s=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var r=jQuery("#tb-endscreens-elementType-website-template").html();var a=r.formatTemplate(o.id,o.title,o.cta,s,o.targetUrl);jQuery("#tb-endscreens-list").append(a);break}case"VIDEO":{switch(o.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{var s=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var r=jQuery("#tb-endscreens-elementType-recent_upload-template").html();var a=r.formatTemplate(o.id,s);jQuery("#tb-endscreens-list").append(a);break}case"VIDEO_TYPE_FIXED":{var s=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var r=jQuery("#tb-endscreens-elementType-fixed-template").html();var a=r.formatTemplate(o.id,o.targetUrl,s);jQuery("#tb-endscreens-list").append(a);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{var s=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var r=jQuery("#tb-endscreens-elementType-best_for_viewer-template").html();var a=r.formatTemplate(o.id,s);jQuery("#tb-endscreens-list").append(a);break}}break}case"PLAYLIST":{var s=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var r=jQuery("#tb-endscreens-elementType-playlist-template").html();var a=r.formatTemplate(o.id,o.targetUrl,s);jQuery("#tb-endscreens-list").append(a);break}}}var l=jQuery("#tb-endscreens-select-all-elements");l.click();jQuery("#tb-endscreens-fetching").hide()}catch(t){TBUtilities.LogError("There was an error retrieving the end screen...");t.resultData=e;TBUtilities.LogError({Exception:t,Location:"[TubeBuddyEndScreens] CRTBLoadCardsForVideo"})}};var l=function(){var e=TBGlobal.host+"/ModuleManager/EndScreens/EndScreens?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/endscreens.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/endscreens.html"}TBExtension.Get(e,"CRTBLoadEndScreensTemplate")};var d=function(e,t){TBUtilities.Log("copyFromTemplateToElement before");TBUtilities.Log(e);switch(e.type){case"CHANNEL":{if(e.isSubscribe){}else{e.targetUrl=jQuery(t).find(".tb-endscreens-elementType-channel-channelurl").val();e.metadata=jQuery(t).find(".tb-endscreens-elementType-channel-custom-message").val()}break}case"WEBSITE":{e.title=jQuery(t).find(".tb-endscreens-elementType-website-title").val();e.targetUrl=jQuery(t).find(".tb-endscreens-elementType-website-url").val();if(e.displayImages.thumbnails[0].url&&i.imageConversionDic[e.displayImages.thumbnails[0].url]){e.imagefile=i.imageConversionDic[e.displayImages.thumbnails[0].url]}break}case"VIDEO":{switch(e.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{break}case"VIDEO_TYPE_FIXED":{var n=jQuery(t).find(".tb-endscreens-elementType-fixed-url").val();var o=TBUtilities.ParseVideoIdFromUrl(n);if(o!=null){e.targetUrl=n;e.videoId=o}break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{break}}break}case"PLAYLIST":{var a=jQuery(t).find(".tb-endscreens-elementType-playlist-url").val();var s=TBUtilities.ParsePlaylistIdFromUrl(a);if(s!=null){e.targetUrl=a;e.playlistId=s}break}}TBUtilities.Log("copyFromTemplateToElement after");TBUtilities.Log(e)};var c=function(e,t){var n=TBUtilities.GetInArray(i.elements,"id",e);i.selectedElements.push(n);jQuery(t).find(".tb-card-item-inner").addClass("tb-card-item-inner-selected");jQuery("#tb-endscreens-selected-count").text(i.selectedElements.length);jQuery("#tb-endscreens-copy-count").text(i.selectedElements.length);p()};var u=function(e,t){TBUtilities.RemoveFromArray(i.selectedElements,"id",e);jQuery(t).find(".tb-card-item-inner").removeClass("tb-card-item-inner-selected");p()};var p=function(){jQuery("#tb-endscreens-selected-count").text(i.selectedElements.length);jQuery("#tb-endscreens-copy-count").text(i.selectedElements.length);if(i.selectedElements.length==1)jQuery("#tb-endscreens-copy-count-s").hide();else jQuery("#tb-endscreens-copy-count-s").show()};var b=function(e){if(e.totalCount-e.loaded>50){jQuery("#tb-endscreens-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-endscreens-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-endscreens-onlyLoadFirstPage-number").val())}jQuery("#tb-endscreens-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery("#tb-endscreens-loading-count"))}else{jQuery("#tb-endscreens-rendering").show();jQuery("#tb-endscreens-loading-count-container").hide()}};var y=function(e){try{if(e==null){if(i.method==0)TBUtilities.Alert("No valid Video IDs found");else if(i.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(i.method==2)TBUtilities.Alert("No videos matching your search");else if(i.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-endscreens-back").trigger("click");return}else if(e.length==0){if(i.method==0)TBUtilities.Alert("No valid Video IDs found");else if(i.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(i.method==2)TBUtilities.Alert("No videos matching your search");else if(i.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-endscreens-back").trigger("click");return}i.videos=[];jQuery("#tb-endscreens-destination-list").empty();var t=jQuery(".tb-endscreens-destination-row:last")[0].outerHTML;jQuery.each(e,function(e,n){var o=false;if(n.id==i.selectedVideo.id)o=true;if(n.snippet.resourceId!=null)if(n.snippet.resourceId.videoId==i.selectedVideo.id)o=true;if(n.id.videoId!=null){n.id=n.id.videoId}if(!o){if(n.snippet.resourceId!=null)n.id=n.snippet.resourceId.videoId;if(n.snippet!=null&&n.snippet.title=="Deleted video"&&n.snippet.thumbnails==null)return;i.videos.push(n);var a=t;var s=n.snippet.thumbnails.thumbnailMedium?n.snippet.thumbnails.thumbnailMedium:n.snippet.thumbnails.thumbnailDefault;a=a.replace("#VIDEOTITLE#",n.snippet.title);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",n.id);a=a.replace("#VIDEOTHUMBNAIL#",s);if(n.status){a=a.replace("#PRIVACY#",n.status.privacy)}if(i.isDeleteOnly){a=TBUtilities.ReplaceAll(a,"#CUSTOMDISPLAY#","display:none;");jQuery(".tb-bulk-expand").hide()}else{a=TBUtilities.ReplaceAll(a,"#CUSTOMDISPLAY#","");jQuery(".tb-bulk-expand").show()}var r="";jQuery.each(i.selectedElements,function(e,t){var i=null;switch(t.type){case"CHANNEL":{if(t.isSubscribe){var o=jQuery(".tb-endscreens-destination-option-subscribe-row:last")[0].outerHTML;i=o.replace("#TITLE#",t.title);i=i.replace("#data-element-default-id#",t.id)}else{var o=jQuery(".tb-endscreens-destination-option-channel-row:last")[0].outerHTML;i=o.replace("#CHANNELURL#",t.targetUrl);i=i.replace("#METADATA#",t.metadata);i=i.replace("#data-element-default-id#",t.id)}break}case"WEBSITE":{var o=jQuery(".tb-endscreens-destination-option-website-row:last")[0].outerHTML;i=o.replace("#TITLE#",t.title);i=i.replace("#URL#",t.targetUrl);i=i.replace("#data-element-default-id#",t.id);break}case"VIDEO":{switch(t.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{var o=jQuery(".tb-endscreens-destination-option-video-mostrecent-row:last")[0].outerHTML;i=o;i=i.replace("#data-element-default-id#",t.id);break}case"VIDEO_TYPE_FIXED":{var o=jQuery(".tb-endscreens-destination-option-video-fixed-row:last")[0].outerHTML;i=o.replace("#VIDEOURL#",t.targetUrl);i=i.replace("#data-element-default-id#",t.id);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{var o=jQuery(".tb-endscreens-destination-option-video-bestforviewer-row")[0].outerHTML;i=o;i=i.replace("#data-element-default-id#",t.id);break}}break}case"PLAYLIST":{var o=jQuery(".tb-endscreens-destination-option-playlist-row:last")[0].outerHTML;i=o.replace("#PLAYLISTURL#",t.targetUrl);i=i.replace("#data-element-default-id#",t.id);break}}i=i.replace("#VIDEOID#",n.id);r+=i});r=r.replace("#VIDEOID#",n.id);a=a.replace("#OPTIONS#",r);jQuery("#tb-endscreens-destination-list").append(a)}});jQuery("#tb-endscreens-destination").show();jQuery("#tb-endscreens-method").hide();jQuery("#tb-endscreens-destination-list").show();jQuery("#tb-endscreens-destination-total-count").text(i.videos.length);jQuery("#tb-endscreens-loading-videos").hide();if(i.method==0||i.method==1){jQuery("#tb-endscreens-select-all-checkboxes").trigger("click")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [gotVideoList]"})}};var m=function(){var e=i.specificVideoIds[0];i.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails, snippet, id",h)};var h=function(e){if(e!=null)i.specificVideos.push(e);if(i.specificVideoIds.length>0){m()}else{y(i.specificVideos)}};var f=function(){try{i.totalDestinationVideos=i.destinationVideos.length;i.hasFinished=false;i.errorCount=0;i.successCount=0;jQuery("#tb-endscreens-queue-list").empty();jQuery("#tb-endscreens-completed-list").empty();jQuery("#tb-endscreens-queue-list2").empty();jQuery("#tb-endscreens-completed-list2").empty();jQuery("#tb-endscreens-error-list2").empty();jQuery("#tb-endscreens-error-list2").hide();jQuery("#tb-endscreens-error-none-list2").show();jQuery("#tb-endscreens-working").show();jQuery("#tb-endscreens-done").hide();jQuery("#tb-endscreens-stopped").hide();jQuery.each(i.elements,function(e,t){switch(t.type){case"WEBSITE":{if(t.displayImages.thumbnails[0].url){if(!i.imageConversionDic[t.displayImages.thumbnails[0].url]){i.imageConversionDic[t.displayImages.thumbnails[0].url]=null}}break}}});if(Object.keys(i.imageConversionDic).length>0){for(key in i.imageConversionDic){var e=TBGlobal.host+TBGlobal.apiUrls.imageGetBytes+"?url="+encodeURIComponent(key);TBExtension.Get(e,"CRTBEndScreenGetImageBytes",{Url:key})}}else{j();v()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [startProcessing]"})}};var v=function(){jQuery("#tb-endscreens-queue-list2").empty();jQuery("#tb-endscreens-queue-complete-list2").hide();var e=0;jQuery.each(i.destinationVideos,function(t,i){var n=jQuery(".tb-endscreens-processing-template2:last")[0].outerHTML;n=n.replace("#THUMBNAILURL#",i.snippet.thumbnails.default.url);n=TBUtilities.ReplaceAll(n,"#VIDEOID#",i.id);n=n.replace("#VIDEOTITLE#",i.snippet.title);n=n.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);n=n.replace("display: none","display:flex");jQuery("#tb-endscreens-queue-list2").prepend(n);e++;if(e==3)return false});if(e==0){jQuery("#tb-endscreens-queue-complete-list2").show();jQuery("#tb-endscreens-queue-list2").hide()}else{jQuery("#tb-endscreens-queue-list2").show()}};var g=function(e){var t=jQuery(".tb-endscreens-processed-success:last")[0].outerHTML;if(jQuery("#tb-endscreens-skip-existing").is(":checked")&&e.skipped&&e.skipped===true){t=jQuery(".tb-endscreens-skipped-success:last")[0].outerHTML}t=t.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);t=TBUtilities.ReplaceAll(t,"#VIDEOID#",e.id);t=t.replace("#VIDEOTITLE#",e.snippet.title);t=t.replace("#HREF#","https://www.youtube.com/endscreen_editor?feature=vm&v="+e.id);t=t.replace("display:none","display:flex");jQuery("#tb-endscreens-completed-list2").prepend(t);jQuery("#tb-endscreens-completed-none-list2").hide();jQuery("#tb-endscreens-completed-list2").show();i.successCount++;jQuery("#tb-endscreens-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(i.successCount))};var T=function(e){try{jQuery("#tb-endscreens-error-copy-container").show();var t=jQuery("#tb-endscreens-error-copy").attr("data-clipboard-text");var n=[];if(t!=""){n=t.split(",");if(n.indexOf(e.id)==-1){n.push(e.id)}}else{n.push(e.id)}jQuery("#tb-endscreens-error-copy").attr("data-clipboard-text",n.join(","))}catch(e){}var o=jQuery(".tb-endscreens-processed-error:last")[0].outerHTML;o=o.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);o=TBUtilities.ReplaceAll(o,"#VIDEOID#",e.id);o=o.replace("#VIDEOTITLE#",e.snippet.title);o=o.replace("#ERROR#",e.error);o=o.replace("#HREF#","https://www.youtube.com/endscreen_editor?feature=vm&v="+e.id);o=o.replace("display:none","display:block");jQuery("#tb-endscreens-error-list2").prepend(o);jQuery("#tb-endscreens-error-list2").show();jQuery("#tb-endscreens-error-none-list2").hide();i.errorCount++;jQuery("#tb-endscreens-error-list2-count").text(TBUtilities.FormatNumberWithCommas(i.errorCount))};var j=function(){try{TBUtilities.Log("TubeBuddyEndScreens - next video");jQuery("#tb-endscreens-progress-container").html("Start &#707;");if(i.isStopped)return;if(i.destinationVideos.length==0&&!i.hasFinished){i.hasFinished=true;jQuery("#tb-endscreens-status-count").html("<b>"+i.totalDestinationVideos+"</b> of <b>"+i.totalDestinationVideos+"</b> videos complete");jQuery("#tb-endscreens-progress-container").hide();if(i.currentVideo){if(!i.currentVideo.error){g(i.currentVideo)}else{T(i.currentVideo)}}v();jQuery("#tb-endscreens-working").hide();jQuery("#tb-endscreens-done").show();jQuery("#tb-endscreens-stop").hide();jQuery("#tb-endscreens-done-close").show();return}var e=i.destinationVideos[0].id;if(i.currentVideo){if(!i.currentVideo.error)g(i.currentVideo);else T(i.currentVideo)}var t=TBUtilities.RemoveFromArray(i.destinationVideos,"id",e)[0];i.currentVideo=t;jQuery("#tb-endscreens-status-count").html("<b>"+parseInt(i.totalDestinationVideos-i.destinationVideos.length)+"</b> of <b>"+i.totalDestinationVideos+"</b> videos complete");jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+e+'">'+e+"</a> &#707;");v();TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Getting Video Details for: "+t.id);if(window.location.href.indexOf("studio.youtube.com")!==-1){TubeBuddyYouTubeActions.GetVideoDetailStudio(t.id).then(function(e){k(e)}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [processNextVideo]"});jQuery("#tb-endscreens-progress-container").html(DOMPurify.sanitize(jQuery("#tb-endscreens-progress-container").html()+"Error: "+e,DOMPurifyConfig));B(t.id,e)})}else{TubeBuddyYouTubeActions.GetVideoDuration(t.id).then(function(e){k(e)}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [processNextVideo]"});jQuery("#tb-endscreens-progress-container").html(DOMPurify.sanitize(jQuery("#tb-endscreens-progress-container").html()+"Error: "+e,DOMPurifyConfig));B(t.id,e)})}}catch(e){TBUtilities.LogError({Exception:error,Location:"[TubeBuddyEndScreens] [processNextVideo]"});jQuery("#tb-endscreens-progress-container").html(DOMPurify.sanitize(jQuery("#tb-endscreens-progress-container").html()+"Error: "+error,DOMPurifyConfig));B(t.id,error)}};var Q=function(e,o,a){jQuery("#tb-endscreens-progress-container").show();jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete  &#707;");if(t==null){t=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}i.videosWithDeletedEndscreens.push(e.videoId);TBUtilities.Log("Session token ="+t);var s={destVideoMilliseconds:o,endscreenStartMs:a};if(!i.isDeleteOnly||n.deleteAll==true)TubeBuddyYouTubeActions.DeleteAllEndCardElements(e,s,t,TubeBuddyEndScreens.DeleteAllElementsCallBack);else if(n.deleteUrl)TubeBuddyYouTubeActions.DeleteAllEndCardElementsWithUrl(e,s,t,n.deleteUrl,n.includePartialMatches,TubeBuddyEndScreens.DeleteAllElementsCallBack)};var B=function(e,t){i.currentVideo.error=t;j()};var k=function(e){var t="Video: "+i.currentVideo.id;if(!e)t="Failed to get video details!";try{jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Got Details &#707;");var n="https://www.youtube.com/endscreen_ajax?v="+e.videoId+"&encrypted_video_id="+e.videoId+"&action_load=1";TBExtension.Get(n,function(t,n,o){if(t==true){try{var o=jQuery.parseJSON(o);var a=o.for_editor.minStartMs;var s=e.videoDurationMs;if(!i.isDeleteOnly){if(jQuery("#tb-endscreens-skip-existing").is(":checked")){if(o.for_editor.elements&&o.for_editor.elements.length>0){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Skipped");i.currentVideo.skipped=true;j();return}}if(jQuery("#tb-endscreens-delete-existing").is(":checked")){if(i.videosWithDeletedEndscreens.indexOf(e.videoId)==-1){Q(e,s,a);return}}w(e,s,a)}else{Q(e,s,a)}}catch(e){var r="";r+=" [Error: "+e.message+"]";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Details &#707;");B(i.currentVideo.id,r)}}else{var r="endscreen not found";r+=" [Error: "+r+"]";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Details &#707;");B(i.currentVideo.id,r)}})}catch(e){var t="";t+=" [Error: "+e.message+"]";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Details &#707;");B(i.currentVideo.id,t)}};var w=function(e,n,o){try{if(n<25e3){B(i.currentVideo.id,"End screens can only be created on videos that are at least 25 seconds long.")}else{if(t==null){t=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}var a=i.totalVideoMiliseconds-i.allData.startMs;if(a>=19999){a=19950}var s=o;if(s<=2e4){s=2e4}var r=n-2e4;if(r<0){r=s}var l=[];jQuery.each(i.selectedElements,function(t,o){var a=jQuery("div[data-video-id='"+e.videoId+"'][data-element-default-id='"+o.id+"']");var c=jQuery.extend({},o);d(c,a);x(c,i.totalVideoMiliseconds,n,r,s);l.push(c)});jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Copy ("+i.selectedElements.length+") &#707;");if(jQuery("#tb-endscreens-confirm-unpublish").is(":checked")){TubeBuddyYouTubeActions.UnpublishAnnotations(e.videoId,t,function(i,o,a){if(i==false){TBUtilities.Log("UnpublishAnnotations failed")}TubeBuddyYouTubeActions.CopyEndCardElements(e.videoId,n,s,r,l,t,TubeBuddyEndScreens.ProcessNextVideo)})}else{TubeBuddyYouTubeActions.CopyEndCardElements(e.videoId,n,s,r,l,t,TubeBuddyEndScreens.ProcessNextVideo)}}}catch(e){var c="";c+=" [Error: "+e.message+"]";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Copy &#707;");B(i.currentVideo.id,c)}};var x=function(e,t,i,n,o){TBUtilities.Log("TubeBuddyEndScreens - start ms ="+e.startMs);TBUtilities.Log("TubeBuddyEndScreens - sourceVideoMiliseconds ="+t);TBUtilities.Log("TubeBuddyEndScreens - destinationVideoMiliseconds ="+i);try{var a=e.endMs-e.startMs;TBUtilities.Log("TubeBuddyEndScreens - duration ="+a);var s=t-e.startMs;if(s>2e4){s=19999}var r=i-s;var l=r+a;if(r<=2e4){r=2e4;l=r+a}TBUtilities.Log("TubeBuddyEndScreens - calculated start time ="+r);if(r<=i){e.startMs=r;e.endMs=l}else{e.startMs=i}if(a<=5e3){e.startMs=r-100}if(e.startMs<n){e.startMs=n}if(e.startMs<o){e.startMs=o}if(e.endMs>=i-50){e.endMs=i-50}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] checkElementStartMs"})}};var U=function(e,t,n,o,a){TBUtilities.Log("TubeBuddyEndscreens - deleteAllElementsCallBack cards from video + "+t.videoId+" success = "+e);if(e){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Success &#707;");if(i.isDeleteOnly==false){w(t,n.destVideoMilliseconds,n.endscreenStartMs)}else{j()}}else{if(!a)a+="?";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Fail &#707;");B(t.videoId,"VideoId: "+t.videoId+" - Error deleting elements ("+a+")")}};var L=function(){jQuery(document).on("click change","#tb-endscreens-delete-link-option, #tb-endscreens-delete-all-option",function(){if(jQuery("#tb-endscreens-delete-link-option").is(":checked"))jQuery("#tb-endscreens-delete-partial-matches-container").fadeIn();else jQuery("#tb-endscreens-delete-partial-matches-container").fadeOut();if(jQuery("#tb-endscreens-delete-text-option").is(":checked"))jQuery("#tb-endscreens-delete-partial-matches-container-text").fadeIn();else jQuery("#tb-endscreens-delete-partial-matches-container-text").fadeOut()});jQuery(document).on("click","#tb-endscreens-back-bulk",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-endscreens-container").hide();i.step=1;TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyBulkCopySelect.Show("TubeBuddyEndScreens")});jQuery(document).on("click","#tb-endscreens-error-copy",function(){jQuery(this).find("span").text("Copied");window.setTimeout(function(){jQuery("#tb-endscreens-error-copy-container").find("span").text("Copy video ids")},1500)});jQuery(document).on("click",".tb-cards-default-setting",function(e){e.stopPropagation()});jQuery(document).on("click","#tb-endscreens-stop",function(e){i.isStopped=true;jQuery("#tb-endscreens-stop").hide();jQuery("#tb-endscreens-done-close").show();jQuery("#tb-endscreens-working").hide();jQuery("#tb-endscreens-stopped").show()});jQuery(document).on("click","#playlist-select-type-manual",function(){var e=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").children("input");e.each(function(e,t){i.validPlaylistIds.push(jQuery(t).val())})});jQuery(document).on("keyup",".playlistSelectManualIds",function(){var e=jQuery(this).val();if(i.validPlaylistIds.indexOf(e)==-1){jQuery(".tb-playlist-select-manual-id-invalid").show()}else{jQuery(".tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery(".tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("click","#tb-endscreens-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-endscreens-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-endscreens-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-input-search",function(e){i.search=jQuery(this).val().trim()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-input-ids",function(e){var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-endscreens-input-ids-status").hide();return}jQuery("#tb-endscreens-input-ids-status").show();i.specificVideoIds=[];if(t.indexOf(",")>-1){i.specificVideoIds=t.split(",")}else{i.specificVideoIds=t.split(" ")}for(var n=0;n<i.specificVideoIds.length;n++){i.specificVideoIds[n]=i.specificVideoIds[n].trim();i.specificVideoIds[n]=i.specificVideoIds[n].replace("https://www.youtube.com/watch?v=","");i.specificVideoIds[n]=i.specificVideoIds[n].replace("https://youtu.be/","");if(i.specificVideoIds[n].length!=11){i.specificVideoIds.splice(n,1);n--}}if(i.specificVideoIds.length==0){jQuery("#tb-endscreens-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-input-ids-status").css("color","red")}else if(i.specificVideoIds.length==1){jQuery("#tb-endscreens-input-ids-status").text("1 video detected");jQuery("#tb-endscreens-input-ids-status").css("color","green");jQuery("#tb-endscreens-method-ids").prop("checked",true);jQuery("#tb-endscreens-method-ids").trigger("click")}else{jQuery("#tb-endscreens-input-ids-status").text(i.specificVideoIds.length+" videos detected");jQuery("#tb-endscreens-input-ids-status").css("color","green");jQuery("#tb-endscreens-method-ids").prop("checked",true);jQuery("#tb-endscreens-method-ids").trigger("click")}});jQuery(document).on("click","#tb-endscreens-method-ids, #tb-endscreens-method-playlist, #tb-endscreens-method-search, #tb-endscreens-method-full",function(e){i.method=parseInt(jQuery(this).attr("data-method"));TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-method-ids, #tb-endscreens-method-playlist, #tb-endscreens-method-search, #tb-endscreens-method-full clicked");TBUtilities.Log("TubeBuddyEndScreens - data-method "+i.method);jQuery(".tb-playlist-select-manual-id-invalid").hide();var t=jQuery("#tb-endscreens-input-playlist").playlistSelect().data("plugin_playlistSelect");switch(i.method){case 0:jQuery("#tb-endscreens-input-ids").removeAttr("disabled","disabled");t.disable();i.playlistId="";jQuery("#tb-endscreens-input-search").attr("disabled","disabled");break;case 1:jQuery("#tb-endscreens-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-input-search").attr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide();t.enable();t.showDropDown();break;case 2:jQuery("#tb-endscreens-input-ids").attr("disabled","disabled");t.disable();jQuery("#tb-endscreens-input-search").removeAttr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;i.playlistId="";jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide();break;case 3:jQuery("#tb-endscreens-input-ids").attr("disabled","disabled");t.disable();jQuery("#tb-endscreens-input-search").attr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;i.playlistId="";jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide();break}});jQuery(document).on("change",".tb-endscreens-filter",function(){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-filter clicked");jQuery(".tb-endscreens-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-endscreens-destination-row[data-privacy="private"]').hide();jQuery('.tb-endscreens-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-endscreens-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-endscreens-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-endscreens-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-endscreens-destination-row[data-privacy="public"]').hide();break}jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-total-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row").filter(":visible").length)});jQuery(document).on("click",".tb-endscreens-destination-row",function(){try{if(!jQuery(this).hasClass("tb-endscreens-destination-row--selected")){if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length>0){jQuery(this).prop("checked",false);if(i.isDeleteOnly)TBGlobal.ShowUpgradePage("delete End Screen Elements in bulk (more than 1 video at a time)","bulkdeleteendscreen");else TBGlobal.ShowUpgradePage("copy End Screen Elements in bulk in bulk (more than 1 video at a time)","bulkcopyendscreen");return}jQuery(this).closest(".tb-endscreens-destination-row").addClass("tb-endscreens-destination-row--selected")}else{jQuery(this).closest(".tb-endscreens-destination-row").removeClass("tb-endscreens-destination-row--selected")}jQuery("#tb-endscreens-copy-destination-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-checkbox-include"})}});jQuery(document).on("click","#tb-endscreens-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()&&i.videos.length>1){if(i.isDeleteOnly)TBGlobal.ShowUpgradePage("delete End Screen Elements in bulk (more than 1 video at a time)","bulkdeleteendscreen");else TBGlobal.ShowUpgradePage("copy End Screen Elements in bulk (more than 1 video at a time)","bulkcopyendscreen");return}jQuery(".tb-endscreens-destination-row").addClass("tb-endscreens-destination-row--selected");jQuery("#tb-endscreens-copy-destination-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show()});jQuery(document).on("click","#tb-endscreens-select-no-checkboxes",function(){jQuery(".tb-endscreens-destination-row").removeClass("tb-endscreens-destination-row--selected");jQuery("#tb-endscreens-copy-destination-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show()});jQuery(document).on("click","#tb-endscreens-back",function(){TBUtilities.Log(i);if(i.step==2){if(i.isDeleteOnly)jQuery("#tb-endscreens-delete-options").show();else jQuery("#tb-endscreens-source").show();if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2");jQuery("#tb-endscreens-back-bulk").show()}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 1")}if(i.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 1");jQuery("#tb-endscreens-method").hide();jQuery("#tb-endscreens-back").hide();i.step=1}else if(i.step==3){i.step=2;jQuery("#tb-endscreens-destination").hide();jQuery("#tb-endscreens-method").show();if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2")}if(i.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 2");i.specificVideoIds.length=0;i.specificVideos.length=0;i.playlistId="";jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide()}else if(i.step==4){i.step=3;if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 4")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}if(i.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 3");jQuery("#tb-endscreens-destination").show();jQuery("#tb-endscreens-confirm").hide();jQuery("#tb-endscreens-kickoff").hide();jQuery("#tb-endscreens-continue").show()}});jQuery(document).on("click","#tb-endscreens-expand-all",function(){jQuery(".tb-endscreens-item-customize").html("Customize &#9650;");jQuery(".tb-endscreens-item-options").slideDown()});jQuery(document).on("click","#tb-endscreens-collapse-all",function(){jQuery(".tb-endscreens-item-customize").html("Customize &#9660;");jQuery(".tb-endscreens-item-options").slideUp()});jQuery(document).on("click",".tb-endscreens-item-customize",function(){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-item-customize clicked");try{var e=jQuery(this).attr("data-video-id");if(jQuery(this).parent().parent().find(".tb-endscreens-item-options").css("display")=="none"){jQuery(this).html("Customize &#9650;");jQuery(this).parent().parent().find(".tb-endscreens-item-options").slideDown()}else{jQuery(this).html("Customize &#9660;");jQuery(this).parent().parent().find(".tb-endscreens-item-options").slideUp()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-item-customize"})}});jQuery(document).on("click","#tb-endscreens-select-all-elements",function(e){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-select-all-cards clicked");jQuery(".tb-endscreens-element-item:visible").each(function(){var e=jQuery(this).attr("data-element-default-id");var t=TBUtilities.GetInArray(i.selectedElements,"id",e);if(!t){c(e,this)}})});jQuery(document).on("click","#tb-endscreens-select-none-elements",function(e){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-select-none-elements clicked");jQuery(".tb-endscreens-element-item:visible").each(function(){var e=jQuery(this).attr("data-element-default-id");var t=TBUtilities.GetInArray(i.selectedElements,"id",e);if(t){u(e,this)}})});jQuery(document).on("click",".tb-endscreens-destination-row input",function(e){e.stopPropagation()});jQuery(document).on("click","#tb-endscreens-continue, #tb-endscreens-kickoff",function(){try{TBUtilities.Log("TubeBuddyEndscreens - tb-endscreens-continue, #tb-endscreens-kickoff clicked ");if(i.step==1){jQuery("#tb-endscreens-back-bulk").hide();if(i.selectedElements.length===0&&!i.isDeleteOnly){TBUtilities.Alert("You must select at least 1 end screen element to copy.");return}if(i.isDeleteOnly){n.deleteAll=true;n.deleteText="";n.deleteUrl="";if(jQuery("#tb-endscreens-delete-link-option").is(":checked")){n.deleteAll=false;n.deleteUrl=jQuery("#tb-endscreens-delete-url").val().trim();n.includePartialMatches=jQuery("#tb-endscreens-delete-partial-matches").is(":checked");if(!n.deleteUrl){TBUtilities.Alert("You must enter a URL");return}else if(n.deleteUrl.length<=3){TBUtilities.Alert("It does not look like you entered a valid URL");return}}}if(i.isDeleteOnly==false){var e=false;jQuery.each(i.selectedElements,function(t,i){switch(i.type){case"VIDEO":{e=true;break}case"PLAYLIST":{e=true;break}}if(e){return false}});var t=TBUtilities.GetCookie("tbnonprofit");if(e===false&&t===null){TBUtilities.Alert("You must select at least 1 <strong>Video</strong> or <strong>Playlist</strong> end screen element to copy. <br><br> Note: If your channel is part of the YouTube Nonprofit program email support@tubebuddy.com to enable copying only link end screen elements.");return}}jQuery("#tb-endscreens-loading-videos").show();jQuery("#tb-endscreens-destination-list").hide();jQuery("#tb-endscreens-delete-options").hide();jQuery("#tb-endscreens-source").hide();if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2")}if(i.isDeleteOnly){jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 2")}jQuery("#tb-endscreens-method").show();jQuery("#tb-endscreens-back").show();TBUtilities.Log("TubeEndScreens - Number of elements selected = "+i.selectedElements.length);jQuery.each(i.selectedElements,function(e,t){var i=jQuery("div[data-element-default-id='"+t.id+"']").first();d(t,i)});i.step=2}else if(i.step==2){switch(parseInt(i.method)){case 0:if(i.specificVideoIds.length==0){jQuery("#tb-endscreens-input-ids-status").css("color","red");jQuery("#tb-endscreens-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&i.specificVideoIds.length>1){if(i.isDeleteOnly)TBGlobal.ShowUpgradePage("delete end screen elements in bulk (more than 1 video at a time)","bulkdeleteendscreen");else TBGlobal.ShowUpgradePage("copy end screen elements in bulk (more than 1 video at a time)","bulkcopyendscreen");return}TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: Video IDs "+JSON.stringify(i.specificVideoIds));m();break;case 1:var o=jQuery("#tb-endscreens-input-playlist").playlistSelect().data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();var a=o.getSelectedPlaylistIds();if(a.length>0){i.playlistId=a.join(",")}if(a.length>=2){TBUtilities.Alert("Please select only one playlist");return}if(i.playlistId==""){o.showValidationWarning();TBUtilities.Alert("Please select a playlist");return}TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: Playlist ["+i.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(i.playlistId,null,y,b);break;case 2:if(i.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: Search ["+i.search+"]");jQuery("#tb-endscreens-destination").show();TBYouTubeApi.GetChannelVideosSearch(i.search,null,y,b);break;case 3:TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: All");var s=null;if(jQuery("#tb-endscreens-onlyLoadFirstPage").is(":checked")){var r=/^\+?\d+$/.test(jQuery("#tb-endscreens-onlyLoadFirstPage-number").val());if(r==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}s=parseInt(jQuery("#tb-endscreens-onlyLoadFirstPage-number").val());if(s<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,y,b,s,null,i.selectedVideo.id);break}jQuery("#tb-endscreens-method").hide();if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 4")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}if(i.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 3");jQuery("#tb-endscreens-destination").show();jQuery("#tb-endscreens-destination-list").hide();jQuery("#tb-endscreens-loading-videos").show();i.step=3}else if(i.step==3){if(jQuery("#tb-endscreens-delete-existing").is(":checked")){TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Yes, Deleting Existing End Screen Elements");jQuery("#tb-endscreens-delete-existing-warning").show()}else{TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - No, Not Deleting Existing End Screen Elements");jQuery("#tb-endscreens-delete-existing-warning").hide()}if(jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length==0&&i.destinationVideos.length==0){if(i.isDeleteOnly)TBUtilities.Alert("Please select at least 1 video to Delete All End Screen Elements from.");else TBUtilities.Alert("Please select at least 1 video to copy End Screen Elements to.");return}i.destinationVideos=[];jQuery(".tb-endscreens-destination-row--selected").filter(":visible").each(function(){var e=jQuery(this).find(".tb-endscreens-item-options").attr("data-video-id");jQuery.each(i.videos,function(t,n){if(n.id==e){i.destinationVideos.push(n);TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Selected Destination Video: https://www.youtube.com/watch?v="+e)}})});jQuery("#tb-endscreens-queue-list").empty();jQuery("#tb-endscreens-completed-list").empty();jQuery("#tb-endscreens-queue-list2").empty();jQuery("#tb-endscreens-completed-list2").empty();jQuery("#tb-endscreens-error-list2").empty();if(i.isDeleteOnly){if(n.deleteAll)jQuery("#tb-endscreens-delete-existing-warning").html("<b>WARNING:</b> You have chosen to automatically delete all existing end screen elements from <b>"+i.destinationVideos.length+"</b> Video(s)");else{if(n.includePartialMatches)jQuery("#tb-endscreens-delete-existing-warning").html('<b>WARNING:</b> You have chosen to automatically delete all existing end screen elements that contain the URL: "'+n.deleteUrl+'" [INCLUDING PARTIAL MATCHES] from <b>'+i.destinationVideos.length+"</b> Video(s)");else jQuery("#tb-endscreens-delete-existing-warning").html('<b>WARNING:</b> You have chosen to automatically delete all existing end screen elements that contain the URL: "'+n.deleteUrl+'" from <b>'+i.destinationVideos.length+"</b> Video(s)")}}jQuery("#tb-endscreens-copy-destination-count").text(i.destinationVideos.length);jQuery("#tb-endscreens-destination-selected-count").text(i.destinationVideos.length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show();jQuery("#tb-endscreens-method").hide();jQuery("#tb-endscreens-confirm-checkbox").prop("checked",false);i.step=4;jQuery("#tb-endscreens-destination").hide();if(i.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 5")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 4")}if(i.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 4");jQuery("#tb-endscreens-confirm").show();jQuery("#tb-endscreens-kickoff").show();jQuery("#tb-endscreens-continue").hide();if(i.destinationVideos.length>=2e3){jQuery("#tb-endscreens-2k-warning").show()}else{jQuery("#tb-endscreens-2k-warning").hide()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] #tb-endscreens-continue, #tb-endscreens-kickoff"})}});jQuery(document).on("click",".tb-endscreens-element-item",function(){try{var e=jQuery(this).attr("data-element-default-id");TBUtilities.Log("TubeBuddyEndScreens - element clicked, id = "+e);var t=TBUtilities.GetInArray(i.selectedElements,"id",e);TBUtilities.Log(t);if(t==null){c(e,this)}else{u(e,this)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-element-item"})}});jQuery(document).on("click","#tb-endscreens-close, .tb-endscreens-closex",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-endscreens-container").hide();i.step=1}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-close"})}});jQuery(document).on("click","#tb-endscreens-kickoff",function(){if(!jQuery("#tb-endscreens-confirm-checkbox").is(":checked")){if(i.isDeleteOnly)TBUtilities.Alert("Please check the box confirming that you want to Delete all End Screen Elements");else TBUtilities.Alert("Please check the box confirming that you want to copy the End Screen Elements");return}i.step=4;jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Processing");if(i.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Processing");jQuery("#tb-endscreens-status").show();jQuery("#tb-endscreens-confirm").hide();jQuery("#tb-endscreens-stop").show();jQuery("#tb-endscreens-back").hide();jQuery("#tb-endscreens-kickoff").hide();jQuery("#tb-endscreens-continue").hide();f()})};var C=function(){jQuery(document.body).on("CRTBEndScreenGetImageBytes",function(e,t){try{if(t.success){var n=JSON.parse(t.response);i.imageConversionDic[t.data.Url]=n}else{i.imageConversionDic[t.data.Url]=""}var o=0;for(var a in i.imageConversionDic){var s=i.imageConversionDic[a];if(s!=null){o++}}if(Object.keys(i.imageConversionDic).length==o){j();v()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] CRTBLoadEndScreensTemplate"})}});jQuery(document.body).on("CRTBLoadEndScreensTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);if(i.isDeleteOnly==true){S()}else{E()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] CRTBLoadEndScreensTemplate"})}})};var E=function(){i.isDeleteOnly=false;i.endscreens=[];i.selectedElements=[];i.videos=[];i.destinationVideos=[];i.currentVideo=null;i.duration=null;i.totalVideoMiliseconds=null;i.isStopped=false;i.videosWithDeletedEndscreens=[];i.step=1;i.specificVideoIds.length=0;i.specificVideos.length=0;i.method=3;a();o()};var S=function(){TBGlobal.ClearUserDebugInfo();TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Opening Endscreens - Delete Mode");i.isDeleteOnly=true;i.endscreens=[];i.selectedElements=[];i.videos=[];i.destinationVideos=[];i.currentVideo=null;i.duration=null;i.totalVideoMiliseconds=null;i.isStopped=false;i.videosWithDeletedEndscreens=[];i.selectedVideo.id="";i.selectedVideo.title="";i.selectedVideo.thumbnail="";i.step=1;i.specificVideoIds.length=0;i.specificVideos.length=0;i.method=3;a();o();jQuery("#tb-endscreens-back").hide()};return{Show:function(t,n,o,a){if(TBGlobal.IsAuthenticated()){i.selectedVideo.id=t;i.selectedVideo.title=n;i.selectedVideo.thumbnail=o;i.fromBulkSelectMenu=a;if(!e){C();l();L();e=true}else{E()}}},ShowDelete:function(){if(TBGlobal.IsAuthenticated()){i.selectedVideo.id="";i.selectedVideo.title="";i.selectedVideo.thumbnail="";if(!e){i.isDeleteOnly=true;C();l();L();e=true}else{S()}}},Initialize:function(){},GetEndScreenListCallback:function(e){r(e)},ProcessNextVideo:function(e,t,n,o){if(o)i.currentVideo.error=o;j()},CheckForErrors:function(e,t,n,o){if(o)i.currentVideo.error=o},DeleteAllElementsCallBack:function(e,t,i,n,o){U(e,t,i,n,o)},UpdateElementMs:function(e,t,i,n,o){x(e,t,i,n,o)}}}();var TubeBuddyEndScreensVideo=function(){var e=false;var t=null;var i=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideo+"?videoid="+TBUtilities.GetUrlParameter("v");TBExtension.Get(e,"CRTBEndScreensLoadVideo",null)};var n=function(e,t){if(jQuery(".creator-editor-content").find(".tb-edit-video-endscreens-container").length==0){jQuery(".creator-editor-content").after(jQuery(".tb-edit-video-endscreens-container:last")[0].outerHTML);if(t)jQuery(".tb-video-endscreens-title-input").val(t);else jQuery(".tb-video-endscreens-title-input").val(jQuery("#creator-editor-title-link").attr("title"));if(e){jQuery(".tb-edit-video-endscreens-template").prop("checked",true);jQuery(".tb-video-endscreens-title-input").prop("disabled",false)}else{jQuery(".tb-edit-video-endscreens-template").prop("checked",false);jQuery(".tb-video-endscreens-title-input").prop("disabled",true)}}jQuery(".annotator-learn-more-container").after(jQuery(".tb-edit-video-endscreens-options-container:first")[0].outerHTML)};var o=function(){var e=TBGlobal.host+"/ModuleManager/EndScreensVideo/EndScreensVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/endscreensvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/endscreensvideo.html"}TBExtension.Get(e,"CRTBLoadEndScreensVideoTemplate")};var a=function(){jQuery(document).on("click",".tb-edit-video-endscreens-apply-endscreen-template",function(){TubeBuddyMenu.ShowBackgroundSticky();var e=TBUtilities.GetUrlParameter("v");var t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyEndScreenTemplates.Show(e,t,i)});jQuery(document).on("click",".tb-edit-video-endscreens-clear-endscreens",function(e){e.stopImmediatePropagation();if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all End Screen Elements from this video?"))r()}else{TBUtilities.Confirm("Are you sure you want to remove all Endscreen Elements from this video?",r,null)}});jQuery(document).on("change",".tb-edit-video-endscreens-template",function(){s()});jQuery(document).on("change",".tb-video-endscreens-title-input",function(){s()});jQuery(document).on("keyup",".tb-video-endscreens-title-input",function(e){if(e.keyCode==13){s()}})};var s=function(){try{TBUtilities.Log("TubeBuddyEndScreensVideo - saveTemplateChanges");var e=jQuery(".tb-edit-video-endscreens-template").prop("checked");var t=TBUtilities.GetUrlParameter("v");if(e&&!jQuery(".tb-video-endscreens-title-input").val())jQuery(".tb-video-endscreens-title-input").val(jQuery("#creator-editor-title-link").attr("title"));title=jQuery(".tb-video-endscreens-title-input").val();var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleEndScreenTemplate;var n={Id:t,Enabled:e,Title:title};TBUtilities.Log(n);TBExtension.Post(i,JSON.stringify(n),"CRTBLoadEditVideoEndScreenTemplateToggle",null,{contentType:"application/json"});jQuery(".tb-video-endscreens-title-input").prop("disabled",!e);jQuery(".tb-video-endscreens-changes-saved").hide();jQuery(".tb-video-endscreens-changes-saved").show().delay(2e3).fadeOut();if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.EndScreenTemplates_Apply,"endscreentemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreensVideo] saveTemplateChanges"})}};var r=function(){jQuery(".tb-edit-video-endscreens-working").show();TBYouTubeApi.GetVideoDetails(t,"contentDetails, snippet, id",function(e){var t=new timelord(e.contentDetails.duration);var i="https://www.youtube.com/account";TBExtension.Get(i,function(i,n,o){try{if(i){var a=TBUtilities.GetSessionToken(o);var s={destVideoMilliseconds:t.ticks(),endscreenStartMs:0};var r={videoId:e.id};TubeBuddyYouTubeActions.DeleteAllEndCardElements(r,s,a,function(e){jQuery(".tb-edit-video-endscreens-working").hide();if(e){TBUtilities.Alert("End Screen elements successfully cleared!\n\nWe need to re-load the page for the changes to take effect. Any unsaved changes on this page will be lost. ",function(){location.reload()})}})}else{TBUtilities.LogFailedWebRequest({Location:"EndScreensVideo.js|removeAllEndScreenElements",Data:n,Response:o})}}catch(e){TBUtilities.LogError({Exception:e,Location:"EndScreensVideo.js|removeAllEndScreenElements"})}})})};var l=function(){jQuery(document.body).on("CRTBLoadEditVideoEndScreenTemplateToggle",function(e,t){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreensVideo] CRTBLoadEditVideoEndScreenTemplateToggle"})}});jQuery(document.body).on("CRTBLoadEndScreensVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);i()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreensVideo] CRTBLoadEndScreensVideoTemplate"})}});jQuery(document.body).on("CRTBEndScreensLoadVideo",function(e,t){try{if(t.success){_video=jQuery.parseJSON(t.response);n(_video.IsEndScreenTemplate,_video.EndScreenTemplateName)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBEditVideoCardsLoadVideo"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){t=TBUtilities.GetUrlParameter("v");l();o();a();e=true}}}}}();var TubeBuddySchedule=function(){var e=false;var t=null;var i=true;var n=null;var o=function(){jQuery("#vm-view-filter").append(jQuery(".tb-schedule-button:last")[0].outerHTML)};var a=function(){var e=TBGlobal.host+"/ModuleManager/schedule/schedule?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/schedule.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/schedule.html"}TBExtension.Get(e,"CRTBLoadScheduleSchedule")};var s=function(){TubeBuddyMenu.ShowBackgroundSticky();jQuery("#tb-schedule-container").css("width","1100px");jQuery("#tb-schedule-view-toggle").text("View All");jQuery("#tb-schedule-view-toggle").hide();jQuery("#tb-schedule-day-none-scheduled").hide();jQuery("#tb-schedule-view-all").hide();jQuery("#tb-schedule-container").show();jQuery("#tb-schedule-loaded-none-found").hide();jQuery("#tb-schedule-loaded").hide();if(n)n.destroy();jQuery("#tb-schedule-loading").show();jQuery("#tb-schedule-legend").hide();var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetYouTubeVideoScheduledActionsInFuture;TBExtension.Get(e,"CRTBScheduleLoadSchedule")};var r=function(){jQuery(document).on("click",".tb-schedule-buttons, .tb-schedule-button",function(e){s()});jQuery(document).on("click",".tb-schedule-close, .tb-schedule-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-schedule-container").hide();if(n)n.destroy()});jQuery(document).on("click",".tb-schedule-edit-golive",function(e){var t=jQuery(this).attr("data-video-id");var i=jQuery(this).attr("data-title");var n="https://img.youtube.com/vi/"+t+"/mqdefault.jpg";jQuery("#tb-schedule-container").hide();TubeBuddyGoLiveVideo.Show(t,i)});jQuery(document).on("click",".tb-schedule-edit-sunset",function(e){var t=jQuery(this).attr("data-video-id");var i=jQuery(this).attr("data-title");var n="https://img.youtube.com/vi/"+t+"/mqdefault.jpg";jQuery("#tb-schedule-container").hide();TubeBuddySunsetVideo.Show(t,i)});jQuery(document).on("click","#tb-schedule-view-toggle",function(){i=i==false?true:false;if(i==false){jQuery("#tb-schedule-monthly-view").hide();jQuery("#tb-schedule-view-toggle").text("View by Month");jQuery("#tb-schedule-container").css("width","680px");jQuery("#tb-schedule-view-all").show()}else{jQuery("#tb-schedule-view-all").hide();jQuery("#tb-schedule-view-toggle").text("View All");jQuery("#tb-schedule-container").css("width","1100px");jQuery("#tb-schedule-monthly-view").show()}});jQuery(document).on("click",".tb-schedule-month",function(){jQuery("#tb-schedule-day-none-scheduled").hide();jQuery(".day").removeClass("selected-day");jQuery("#tb-schedule-events-title-text").text("This Month");jQuery(".tb-schedule-event-item").show();c()})};var l=function(e){var t=Math.floor(e/60);var e=e%60;var i=t>=12?"PM":"AM";t=t%12;t=t?t:12;e=e<10?"0"+e:e;var n=t+":"+e+" "+i;return n};var d=function(e){var t=jQuery(e.element).attr("class").search("calendar-day");var i=jQuery(e.element).attr("class").slice(t,t+23);if(jQuery(e.element).hasClass("past"))return;if(jQuery(e.element).hasClass("last-month")){n.back()}else if(jQuery(e.element).hasClass("next-month")){n.forward()}if(e.events.length==0){jQuery("#tb-schedule-day-none-scheduled").show()}else{jQuery("#tb-schedule-day-none-scheduled").hide()}jQuery(".day").removeClass("selected-day");jQuery("."+i).addClass("selected-day");jQuery(".tb-schedule-event-item").show();jQuery("#tb-schedule-events-title-text").text("for "+e.date.format("ll"));jQuery('.tb-schedule-event-item[data-event-date!="'+e.date.format("MM/DD/YYYY")+'"]').hide()};var c=function(e){if(jQuery(".tb-schedule-event-item").length==0){jQuery("#tb-schedule-day-none-scheduled").show()}else{jQuery("#tb-schedule-day-none-scheduled").hide()}jQuery(".tb-schedule-template span.timeline-icon.golive img").attr("src",TBGlobal.host+"/images/modules/schedule/golive.png").attr("alt","go live icon");jQuery(".tb-schedule-template span.timeline-icon.sunset img").attr("src",TBGlobal.host+"/images/modules/schedule/sunset.png").attr("alt","sunset icon")};var u=function(){jQuery(document.body).on("CRTBLoadScheduleSchedule",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);o()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBLoadScheduleSchedule"})}});jQuery(document.body).on("CRTBScheduleLoadSchedule",function(e,i){try{if(i.success){t=JSON.parse(i.response);t.forEach(function(e){e.TimeFromMinutes=l(e.LocalTime)});jQuery(".day").removeClass("selected-day");jQuery("#tb-schedule-day-none-scheduled").hide();if(jQuery("#tb-schedule-monthly-view").children(".clndr").length>0)n.destroy();var o='<div class="tb-schedule-clndr-controls"><div class="clndr-previous-button"><i class="material-icons">keyboard_arrow_left</i></div><div class="tb-schedule-month"><%= month %> <%= year %></div><div class="clndr-next-button"><i class="material-icons">keyboard_arrow_right</i></div></div><div style="display:flex; justify-content: space-between;"><div class="tb-schedule-clndr-grid"><div class="tb-schedule-days-of-the-week"><% _.each(daysOfTheWeek, function (day) { %><div class="tb-schedule-header-day"><%= day %></div><% }); %><div class="tb-schedule-days tb-margin-top5"><% _.each(days, function (day) { %><div class="<%= day.classes %>"><div style="width: 100%;display: flex; flex-wrap: wrap; justify-content: center;"><div class="tb-font-size22 tb-width100-percent" style="display:flex;justify-content:center;"><%= day.day %></div><div style="position:relative; top: 5px; height: 8px; width: 100%; display:flex; justify-content:center;"><div style="height:8px; width:8px; border-radius:50%; background-color:#95b85e; margin:0 1px; display: <%= day.events.map(function(event){ return event.Type; }).indexOf(1) > -1 ? \'flex\': \'none\'%>"></div><div style="height:8px; width:8px; border-radius:50%; background-color:#fa8564; margin:0 1px; display: <%= day.events.map(function(event){ return event.Type; }).indexOf(0) > -1 ? \'flex\': \'none\'%>"></div></div></div></div><% }); %></div></div></div><div class="tb-schedule-event-listing" id="tb-schedule-events-this-month"><div class="tb-schedule-event-listing-title">Events&nbsp;<span id="tb-schedule-events-title-text">This Month</span></div><div id="tb-schedule-event-listing-container"><div style="max-height:386px; overflow-y:auto;"><% _.each(eventsThisMonth, function(event) { %><div class="tb-schedule-event-item" data-event-date="<%= event.LocalDate %>"><div class="tb-schedule-template" style="position: relative;left: 55px;margin-bottom:20px;width: 480px;"><div style="border:4px solid #f1f1f1; margin-bottom:5px;border-radius:5px;"><span style="border-right: 8px solid #f1f1f1; border-bottom: 8px solid transparent;border-top: 8px solid transparent;display: block;height: 0;left: -12px;position: absolute;top: 13px;width: 0;"></span><span class="timeline-icon <%= event.Type == 0 ? \'sunset\' : \'golive\'%>" style="position:absolute; left:-50px; top:5px;"><img src="{PLUGIN_FILE_ROOT}/images/modules/schedule/<%= event.Type == 0 ? \'sunset\' : \'golive\'%>.png" alt="Alternate Text" /></span><div style="width:52px; position: absolute;right: -60px; text-align:left; line-height:16px; font-size:11px;"><span style="font-size:11px; text-transform:uppercase; opacity:.7; color: <%= event.Type == 0 ? \'red\' : \'green\'%>"> <%= event.CurrentPrivacy %> </span><div><i class="material-icons">arrow_drop_down</i></div><span style="font-size:11px; font-weight:500; text-transform:uppercase; color: <%= event.Type == 0 ? \'red\' : \'green\'%>"><%= event.ActionLabel %></span><br /><a class="<%= event.Type == 0 ? \'tb-schedule-edit-sunset\' : \'tb-schedule-edit-golive\' %>" data-video-id="<%= event.Video.Id %>" data-title="<%= event.Video.Title %>" style="font-size:11px; cursor:pointer; position:relative; left:1px;">edit</a></div><table style="border:0; width:470px;"><tr><td style="width:150px; text-align:center; color:#111; background-color:#f1f1f1;vertical-align:top;" rowspan="2"><div style="position:relative; font-size:20px;"><%= event.Day %><br /> <%= event.LocalDateDisplay %> </div><span style="background-color:#f1f1f1; color:#333; border-radius:5px; padding:4px 6px; font-size:16px;"> <%= event.TimeFromMinutes %> </span><div style="background-color:#f1f1f1; color:#999; border-radius:5px; padding:4px 6px; font-size:11px; max-width:145px; overflow:hidden;"><%= event.TimeZoneId %></div></td><td style="width:80px; padding:6px 0px 6px 8px; vertical-align:top;"><img class="tb-calendar-type0" src="https://img.youtube.com/vi/<%= event.VideoId %>/mqdefault.jpg" style="height:50px; margin-right:5px;"></td><td style="width:260px; padding:6px 0px; vertical-align:top; text-align:left; vertical-align:top;"><a href="https://www.youtube.com/edit?o=U&video_id=<%= event.VideoId %>" target="_blank"><%= event.Video.Title %></a></td></tr><tr><td colspan="2" style="border-top:dashed 1px #ccc; margin:-10px 5px 0 5px;"><table style="border:0; width:100%; margin:5px 8px 8px 8px;"><tr><td style="width:40%; margin-right:15px; vertical-align:top;"><div style="font-weight:500; font-size:.9em;">Current Playlists</div><%= event.PlaylistHtml %></td><td style="width:142px; margin-right:15px; vertical-align:top; display:<%= event.Type == 0 ? \'none\' : \'block\' %>"><div style="font-weight:500; font-size:.9em;">Add to Playlists</div><%= event.PlaylistHtmlToAddTo %></td><td style="width:142px; margin-right:15px; vertical-align:top; display:<%= event.Type == 0 ? \'block\' : \'none\' %>"><div style="font-weight:500; font-size:.9em;">Remove from Playlists</div><%= event.PlaylistHtmlToRemoveFrom %></td></tr></table></td></tr></table></div></div></div><% }); %></div></div><div id="tb-schedule-day-none-scheduled" class="tb-font-size14 tb-margin10" style="display:none;">You don\'t have any videos scheduled to be published or sunsetted for the timeframe selected.</div></div></div>';try{n=jQuery("#tb-schedule-monthly-view").clndr({events:t,dateParameter:"LocalDate",template:o,forceSixRows:true,startWithMonth:moment(),clickEvents:{click:function(e){d(e)},onMonthChange:function(e){c(e)}},constraints:{startDate:moment()}});jQuery(".tb-schedule-template span.timeline-icon.golive img").attr("src",TBGlobal.host+"/images/modules/schedule/golive.png").attr("alt","go live icon");jQuery(".tb-schedule-template span.timeline-icon.sunset img").attr("src",TBGlobal.host+"/images/modules/schedule/sunset.png").attr("alt","sunset icon")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBScheduleLoadSchedule"})}if(t.length==0){jQuery("#tb-schedule-loaded").hide();jQuery("#tb-schedule-loading").hide();jQuery("#tb-schedule-legend").hide();jQuery("#tb-schedule-monthly-view").hide();jQuery("#tb-schedule-view-toggle").hide();jQuery("#tb-schedule-day-none-scheduled").show();jQuery("#tb-schedule-loaded-none-found").show()}else{jQuery("#tb-schedule-loaded-none-found").hide();jQuery("#tb-schedule-loading").hide();jQuery("#tb-schedule-view-toggle").show();jQuery("#tb-schedule-monthly-view").show();c();jQuery("#tb-schedule-legend").show();jQuery("#tb-schedule-loaded").show();jQuery("#tb-schedule-list-container").empty();jQuery.each(t,function(e,t){var i=jQuery(".tb-schedule-template:first")[0].outerHTML;if(t.Type==0){i=TBUtilities.ReplaceAll(i,"#TYPE#","sunset");i=TBUtilities.ReplaceAll(i,"#COLOR#","red");i=TBUtilities.ReplaceAll(i,"#CLASS#","tb-schedule-edit-sunset");i=TBUtilities.ReplaceAll(i,"#ADDDISPLAY#","none");i=TBUtilities.ReplaceAll(i,"#REMOVEDISPLAY#","block")}else{i=TBUtilities.ReplaceAll(i,"#TYPE#","GoLive");i=TBUtilities.ReplaceAll(i,"#COLOR#","green");i=TBUtilities.ReplaceAll(i,"#CLASS#","tb-schedule-edit-golive");i=TBUtilities.ReplaceAll(i,"#ADDDISPLAY#","block");i=TBUtilities.ReplaceAll(i,"#REMOVEDISPLAY#","none")}i=TBUtilities.ReplaceAll(i,"#DATE#",t.LocalDateDisplay);i=TBUtilities.ReplaceAll(i,"#DAY#",t.Day);i=TBUtilities.ReplaceAll(i,"#TIME#",l(t.LocalTime));i=TBUtilities.ReplaceAll(i,"#TIMETYPE#",t.TimeZoneId);i=TBUtilities.ReplaceAll(i,"#VIDEOID#",t.Video.Id);i=TBUtilities.ReplaceAll(i,"#VIDEOTITLE#",t.Video.Title);i=TBUtilities.ReplaceAll(i,"#PRIVACY#",t.ActionLabel);i=TBUtilities.ReplaceAll(i,"#CURPRIVACY#",t.CurrentPrivacy);i=TBUtilities.ReplaceAll(i,"#PLAYLISTS#",t.PlaylistHtml);i=TBUtilities.ReplaceAll(i,"#ADDPLAYLISTS#",t.PlaylistHtmlToAddTo);i=TBUtilities.ReplaceAll(i,"#REMOVEPLAYLISTS#",t.PlaylistHtmlToRemoveFrom);jQuery("#tb-schedule-list-container").append(i)})}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBScheduleLoadSchedule"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();a();r();e=true}else{o()}}},Show:function(){s()}}}();var TubeBuddyBulkCopySelect=function(){var e=false;var t;var i;var n;var o;var a;var s=function(){var e=TBGlobal.host+"/ModuleManager/BulkCopySelect/BulkCopySelect?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/bulkcopyselect.html")}else if(loadLocalHTML&&TBExtension.GetType()==="safari"){e="modules/bulkcopyselect.html"}TBExtension.Get(e,"CRTBLoadBulkCopySelectTemplate")};var r=function(){jQuery(document).on("keypress",".tb-bulk-copy-select-search-input",function(e){try{if(e.which==13){jQuery(this).blur();jQuery(".tb-bulk-copy-select-search").focus().click()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-search-input"})}});jQuery(document).on("click",".tb-bulk-copy-select-search",function(){try{var e=jQuery(".tb-bulk-copy-select-search-input").val();if(e==""){TBUtilities.Alert("Please enter a search phrase.");return}jQuery(".tb-bulk-copy-select-videos-contianer").hide();jQuery(".tb-bulk-copy-select-videos-search-contianer").show();jQuery(".tb-bulk-copy-select-fetching").show();jQuery(".tb-bulk-copy-select-videos-search").empty();TBYouTubeApi.GetChannelVideosSearch(jQuery(".tb-bulk-copy-select-search-input").val(),null,l,function(){})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-search"})}});jQuery(document).on("click",".tb-bulk-copy-select-row",function(){try{if(jQuery(this).hasClass("tb-card-item-inner-selected")){t=null;n=null;i=null;jQuery(this).removeClass("tb-card-item-inner-selected");jQuery(".tb-module-embed-video").hide()}else{jQuery(".tb-bulk-copy-select-row").removeClass("tb-card-item-inner-selected");jQuery(this).addClass("tb-card-item-inner-selected");t=jQuery(this).attr("data-video-id");i=jQuery(this).attr("data-video-title");n="https://i.ytimg.com/vi/"+t+"/mqdefault.jpg"}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-row"})}});jQuery(document).on("click",".tb-bulk-copy-select-continue",function(){if(t==null){var e=a.toLowerCase()=="tubebuddycards"?"cards":"end screens";TBUtilities.Alert("You must select a video to copy "+e+" from");return}try{switch(a.toLowerCase()){case"tubebuddycards":{TubeBuddyCards.Show(t,i,n,true);break}case"tubebuddyannotations":{TBUtilities.Alert("Sorry but YouTube has removed the ability to add or update Annotations. They are requesting that you use Cards or End Screens instead.");return;TubeBuddyAnnotations.Show(t,i,n,true);break}case"tubebuddyendscreens":{TubeBuddyEndScreens.Show(t,i,n,true);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-continue"})}finally{jQuery("#tb-bulk-copy-select-container").hide()}});jQuery(document).on("click",".tb-bulk-copy-select-close",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-bulk-copy-select-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-close"})}});jQuery(document).on("change",".tb-bulk-copy-select-filter",function(){TBUtilities.Log("TubeBuddyBulkCopySelect - tb-bulk-copy-select-filter clicked");d(jQuery(this).val())})};var l=function(e){try{if(e.length>0){var t=jQuery("#tb-bulk-copy-select-video-template").html();jQuery.each(e,function(e,i){var n=t.formatTemplate(i.id,i.snippet.thumbnails.thumbnailMedium,i.url,i.snippet.title,i.status.privacy);jQuery(".tb-bulk-copy-select-videos-search").append(n)});d(jQuery(".tb-bulk-copy-select-filter").val())}else{jQuery(".tb-bulk-copy-select-videos-search").append('<span class="tb-margin-left15 tb-margin-top20">No videos found</span>')}jQuery(".tb-bulk-copy-select-fetching").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [gotVideoList]"})}};var d=function(e){TBUtilities.Log("TubeBuddyBulkCopySelect - filterVideos "+e);jQuery(".tb-bulk-copy-select-row").show();switch(e){case"all":break;case"public":jQuery('.tb-bulk-copy-select-row[data-privacy="private"]').hide();jQuery('.tb-bulk-copy-select-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-bulk-copy-select-row[data-privacy="public"]').hide();jQuery('.tb-bulk-copy-select-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-bulk-copy-select-row[data-privacy="public"]').hide();jQuery('.tb-bulk-copy-select-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-bulk-copy-select-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-bulk-copy-select-row[data-privacy="public"]').hide();break}};var c=function(){try{t=null;n=null;i=null;jQuery(".tb-bulk-copy-select-search-input").val("");jQuery(".tb-bulk-copy-select-videos-contianer").show();jQuery(".tb-bulk-copy-select-videos-search-contianer").hide();jQuery(".tb-bulk-copy-select-fetching").show();jQuery(".tb-bulk-copy-select-videotemplates").empty();jQuery(".tb-bulk-copy-select-videotemplates-contianer").hide();jQuery(".tb-bulk-copy-select-videos").empty();switch(a.toLowerCase()){case"tubebuddycards":{jQuery(".tb-bulk-copy-select-label").text("Cards");jQuery("#tb-bulk-copy-select-title-block").text("Bulk Copy Cards - Step 1");jQuery("#tb-bulk-copy-select-instructions").text("Click on the video you want to copy cards from:");jQuery("#tb-bulk-copy-select-help").attr("href","https://www.tubebuddy.com/tools#bulkcopycards");jQuery(".tb-bulk-copy-select-videotemplates-contianer-name").text("Card Templates");var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoCardTemplates;TBExtension.Get(e,"CRTBLoadBulkCopySelectCardTemplates",{Type:"tubebuddycards"});break}case"tubebuddyannotations":{var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoAnnotationTemplates;TBExtension.Get(e,"CRTBLoadBulkCopySelectCardTemplates",{Type:"tubebuddyannotations"});jQuery(".tb-bulk-copy-select-label").text("Annotations");jQuery("#tb-bulk-copy-select-title-block").text("Bulk Copy Annotations");jQuery("#tb-bulk-copy-select-help").attr("href","https://www.tubebuddy.com/tools#bulkcopyannotations");jQuery(".tb-bulk-copy-select-videotemplates-contianer-name").text("Annotation Templates");break}case"tubebuddyendscreens":{jQuery(".tb-bulk-copy-select-label").text("End Screen Elements");jQuery("#tb-bulk-copy-select-title-block").text("Bulk Copy End Screen - Step 1");jQuery("#tb-bulk-copy-select-instructions").text("Click on the video you want to copy end screens from:");jQuery("#tb-bulk-copy-select-help").attr("href","https://www.tubebuddy.com/tools#bulkcopyendscreen");jQuery(".tb-bulk-copy-select-videotemplates-contianer-name").text("End Screen Templates");var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(e,"CRTBLoadBulkCopySelectCardTemplates",{Type:"tubebuddyendscreens"});break}}jQuery(".tb-bulk-copy-select-fetching").show();jQuery("#tb-bulk-copy-select-container").show();var o=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetRecentVideos;TBExtension.Get(o,"CRTBLoadBulkCopySelectRecent")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] prepareDialog"})}};var u=function(){jQuery(document.body).on("CRTBLoadBulkCopySelectTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);p()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] CRTBLoadBulkCopySelectTemplate"})}});jQuery(document.body).on("CRTBLoadBulkCopySelectRecent",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);var n=jQuery("#tb-bulk-copy-select-video-template").html();jQuery.each(i,function(e,t){var i=n.formatTemplate(t.id,t.snippet.thumbnails.thumbnailMedium,t.url,t.snippet.title,t.status.privacy);jQuery(".tb-bulk-copy-select-videos").append(i)});jQuery(".tb-bulk-copy-select-videos-contianer").show();jQuery(".tb-bulk-copy-select-fetching").hide();d(jQuery(".tb-bulk-copy-select-filter").val())}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] CRTBLoadBulkCopySelectRecent"})}});jQuery(document.body).on("CRTBLoadBulkCopySelectCardTemplates",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i.length>0){jQuery(".tb-bulk-copy-select-videos").css("max-height","195px");jQuery(".tb-bulk-copy-select-videotemplates-contianer").show();var n=jQuery("#tb-bulk-copy-select-video-template").html();jQuery.each(i,function(e,i){var o="temp";switch(t.data.Type.toLowerCase()){case"tubebuddycards":{o=i.CardTemplateName;break}case"tubebuddyannotations":{o=i.AnnotationTemplateName;break}case"tubebuddyendscreens":{o=i.EndScreenTemplateName;break}}var a=n.formatTemplate(i.Id,"https://i.ytimg.com/vi/"+i.Id+"/mqdefault.jpg","https://www.youtube.com/watch?v="+i.Id,o);jQuery(".tb-bulk-copy-select-videotemplates").append(a)})}else{jQuery(".tb-bulk-copy-select-videos").css("max-height","244px");jQuery(".tb-bulk-copy-select-videotemplates-contianer").hide()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] CRTBLoadBulkCopySelectCardTemplates"})}})};var p=function(){c()};return{Show:function(t){if(TBGlobal.IsAuthenticated()){TBUtilities.Log("TubeBuddyBulkCopySelect - Opening");a=t;if(!e){u();s();r();e=true}else{p()}}}}}();var TubeBuddySentiment=function(){var e=false;var t=function(){TBUtilities.Log("TubeBuddySentiment2");jQuery(".commenthub-discussion").prepend(jQuery(".tb-sentiment-area")[0].outerHTML);if(jQuery(".comments-order-menu:visible").length>0)jQuery(".comments-order-menu").before('<button aria-haspopup="true" aria-expanded="false" type="button" class="yt-uix-button yt-uix-button-default yt-uix-button-size-default tb-sentiment-word-cloud" style="float:right; margin-right:15px;"><img src="'+TBGlobal.host+'/images/branding/tb-icon-transparent.svg" class="tb-height11" style="position:relative; top:-1px; left:-1px;"> Word Cloud</button>');else{jQuery(".commenthub-discussion").prepend('<button aria-haspopup="true" aria-expanded="false" type="button" class="yt-uix-button yt-uix-button-default yt-uix-button-size-default tb-sentiment-word-cloud" style="float:right; margin-right:15px;"><img src="'+TBGlobal.host+'/images/branding/tb-icon-transparent.svg" class="tb-height11" style="position:relative; top:-1px; left:-1px;"> Word Cloud</button><div style="clear:both"></div>')}};var i=function(e,t){if(!t||!e){return false}else{var i=e.split(t),n={};for(var o=0,a=i.length;o<a;o++){i[o]=i[o].trim();if(n.hasOwnProperty(i[o])){n[i[o]]=parseInt(n[i[o]],10)+1}else{n[i[o]]=1}}return n}};var n=function(){TBUtilities.AddAction(null,TBUtilities.ActionTypes.CommentCloud_Show,"commentcloud");jQuery(".tb-sentiment-area:first").jQCloud("destroy");var e="";var t="";jQuery(".comment-entry").each(function(t,i){jQuery(this).find(".comment-text-content").each(function(t,i){if(jQuery(this).closest(".comment-item").hasClass("channel-owner")==false){e+=" "+jQuery(this).text()}})});e=TBUtilities.ReplaceAll(e,".","");e=TBUtilities.ReplaceAll(e,",","");e=TBUtilities.ReplaceAll(e,"?","");e=TBUtilities.ReplaceAll(e,"!","");e=e.toLowerCase();var n=i(e," ");var o=[];var a=[];var s=[{name:"you"},{name:"the"},{name:"to"},{name:"i"},{name:"i'm"},{name:"for"},{name:"and"},{name:"then"},{name:"it"},{name:"my"},{name:"what"},{name:"but"},{name:"can"},{name:"so"},{name:"how"},{name:"a"},{name:"is"},{name:"me"},{name:"of"},{name:"of"},{name:"from"},{name:"not"},{name:"your"},{name:"in"},{name:"on"},{name:"this"},{name:"that"},{name:"because"},{name:"it's"},{name:"do"},{name:"it"},{name:"here"},{name:"them"},{name:"it"},{name:"channel"},{name:"am"},{name:"he"},{name:"she"},{name:"get"},{name:"got"},{name:"or"},{name:"but"},{name:"as"},{name:"have"},{name:"we"},{name:"why"},{name:"u"},{name:"did"},{name:"why"},{name:"just"},{name:"they"},{name:"at"},{name:"was"},{name:"are"},{name:"an"},{name:"be"},{name:"was"},{name:"-"},{name:'"'},{name:"more"},{name:"about"}];var r=Object.keys(n).length>250;TBUtilities.Log("Length: "+Object.keys(n).length);jQuery.each(e.split(" "),function(e,t){if(TBUtilities.GetInArray(a,"name",t.trim()))return;if(TBUtilities.GetInArray(s,"name",t.trim()))return;if(r&&n[t.trim()]==1)return;o.push({text:t.trim(),weight:n[t.trim()]});a.push({name:t.trim()})});jQuery(".tb-sentiment-area:first").slideDown(500,null,function(){jQuery(".tb-sentiment-area:first").jQCloud(o,{width:775,height:400,fontSize:{from:.075,to:.015},colors:["#e50000","#ff0000","#ff1919","#ff3232","#ff4c4c","#ff6666","#ff7f7f","#ff9999","#ff9999","#ff9999"]})})};var o=function(){var e=TBGlobal.host+"/ModuleManager/sentiment/sentiment?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/sentiment.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/sentiment.html"}TBExtension.Get(e,"CRTBLoadSentimentTemplate")};var a=function(){jQuery(document).on("click",".tb-sentiment-word-cloud",function(){if(jQuery(".tb-sentiment-area:first").is(":visible")){jQuery(".tb-sentiment-area:first").slideUp()}else{n()}})};var s=function(){jQuery(document.body).on("CRTBLoadSentimentTemplate",function(e,i){try{if(i.success){i.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i.response,DOMPurifyConfig));jQuery("body").append(i.response);t()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySentiment] CRTBLoadSentimentTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){s();o();a();e=true}else{t()}}}}}();var TubeBuddySocialBluebook=function(){var e=false;var t=true;var i=function(){jQuery(".dashboard-widget-column:nth-of-type(2)").prepend(jQuery(".tb-social-bluebook-container")[0].outerHTML);o()};var n=function(){var e=TBGlobal.host+"/ModuleManager/socialbluebook/socialbluebook?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/socialbluebook.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/socialbluebook.html"}TBExtension.Get(e,"CRTBLoadSocialBluebookTemplate")};var o=function(){TBUtilities.Log("loading settings");TBExtension.GetDbValue("tb-upload-hide-tools","CRTBLoadSocialBluebookSettings");TBExtension.GetDbValue("tb-upload-hide-tools-forever","CRTBLoadSocialBluebookSettings2")};var a=function(){jQuery(document).on("click",".tb-sbb-showhide",function(){TBUtilities.Log("tb-sbb-showhide");TBUtilities.Log(t);if(t){t=false;jQuery(".tb-sbb-showhide").attr("src",TBGlobal.host+"/images/icons/caret-up.png");jQuery(".tb-sbb-data-container").slideUp();TBExtension.SetDbValue("tb-upload-hide-tools",true);jQuery(".tb-sbb-remove").show()}else{t=true;jQuery(".tb-sbb-showhide").attr("src",TBGlobal.host+"/images/icons/caret-down.png");jQuery(".tb-sbb-remove").hide();jQuery(".tb-sbb-data-container").slideDown();TBExtension.SetDbValue("tb-upload-hide-tools",false)}});jQuery(document).on("click",".tb-sbb-remove",function(){if(confirm("Are you sure you want to remove the Brand Deal Valuation panel forever?")){TBExtension.SetDbValue("tb-upload-hide-tools-forever",true);jQuery(".tb-social-bluebook-container").hide()}})};var s=function(){jQuery(document.body).on("CRTBLoadSocialBluebookSettings2",function(e,t){if(t&&t.value==true){}else{jQuery(".tb-social-bluebook-container").show()}});jQuery(document.body).on("CRTBLoadSocialBluebookSettings",function(e,i){try{TBUtilities.Log("Got CRTBLoadSocialBluebookSettings");if(i&&i.value){t=i.value==false;TBUtilities.Log("_isShowing: "+t);if(t){jQuery(".tb-sbb-showhide").attr("src",TBGlobal.host+"/images/icons/caret-down.png");jQuery(".tb-sbb-data-container").show();jQuery(".tb-sbb-remove").hide()}}else{jQuery(".tb-sbb-showhide").attr("src",TBGlobal.host+"/images/icons/caret-down.png");jQuery(".tb-sbb-data-container").show();jQuery(".tb-sbb-remove").hide()}}catch(e){jQuery(".tb-sbb-showhide").attr("src",TBGlobal.host+"/images/icons/caret-down.png");jQuery(".tb-sbb-data-container").show();jQuery(".tb-sbb-remove").hide()}});jQuery(document.body).on("CRTBLoadSocialBluebookTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);i();var n=TBGlobal.host+"/api/socialbluebook/getvaluation";TBExtension.Get(n,"CRTBLoadSocialBluebookValuation")}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialBluebook] CRTBLoadSocialBluebookTemplate"})}});jQuery(document.body).on("CRTBLoadSocialBluebookValuation",function(e,t){try{if(t.success){TBUtilities.Log("CRTBLoadSocialBluebookValuation");TBUtilities.Log(t);var i=JSON.parse(t.response);if(i.hasAccount){jQuery(".tb-sbb-dedicated-upload").text(i.dedicatedUpload.midDisplay);jQuery(".tb-sbb-dedicated-upload-min").text(i.dedicatedUpload.lowDisplay);jQuery(".tb-sbb-dedicated-upload-max").text(i.dedicatedUpload.highDisplay);jQuery(".tb-sbb-shoutout").text(i.shoutOut.midDisplay);jQuery(".tb-sbb-shoutout-min").text(i.shoutOut.lowDisplay);jQuery(".tb-sbb-shoutout-max").text(i.shoutOut.highDisplay);jQuery(".tb-sbb-updated").text(i.dedicatedUpload.updatedDisplay);jQuery(".tb-sbb-value").show();jQuery(".tb-sbb-powered-by").show();jQuery(".tb-sbb-showhide").css("top","-9px");jQuery(".tb-sbb-showhide").css("left","0px");jQuery(".tb-sbb-remove").css("top","21px");jQuery(".tb-sbb-remove").css("left","1px");jQuery(".tb-sbb-remove").css("position","absolute")}else{jQuery(".tb-sbb-novalue").show()}jQuery(".tb-sbb-loading").hide()}else{jQuery(".tb-sbb-failed").show();jQuery(".tb-sbb-loading").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialBluebook] CRTBLoadSocialBluebookTemplate"})}})};return{Initialize:function(){return;if(TBGlobal.IsAuthenticated()){if(!e){s();n();a();e=true}else{i()}}}}}();var TubeBuddyEndScreenTemplates=function(){var t=false;var i=null;var n=null;var o=null;var a=null;var s={};var r=null;var l;var d;var c;var u=null;var p={videoId:"",endscreenElements:[],selectedEndscreenElements:[]};var b=function(){var e=TBGlobal.host+"/ModuleManager/EndScreens/EndScreenTemplates?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/endscreentemplates.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/endscreentemplates.html"}TBExtension.Get(e,"CRTBLoadEndscreenTemplatesTemplate")};var y=function(){jQuery(document).on("click","#tb-endscreen-templates-apply",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("apply End Screen Templates","endscreentemplates");return}jQuery("#tb-endscreen-templates-working").show();jQuery(this).hide();var e="https://www.youtube.com/endscreen_ajax?v="+a+"&encrypted_video_id="+a+"&action_load=1";TBExtension.Get(e,function(e,t,n){if(e==true){try{var n=jQuery.parseJSON(n);var a=n.for_editor.minStartMs;jQuery.each(p.selectedEndscreenElements,function(e,t){switch(t.type){case"WEBSITE":{if(t.displayImages.thumbnails[0].url){if(!s[t.displayImages.thumbnails[0].url]){s[t.displayImages.thumbnails[0].url]=null}}break}}});if(jQuery("#tb-endscreen-templates-delete-all").prop("checked")){TBUtilities.Log("Delete all selected");if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}TBUtilities.Log("Session token ="+i);var r=o.videoDurationMs;var l={destVideoMilliseconds:r,endscreenStartMs:a};TubeBuddyYouTubeActions.DeleteAllEndCardElements(o,l,i,function(e,t,i){TBUtilities.Log("TubeBuddyEndScreenTemplates - DeleteAllEndCardElements from video + "+t.videoId+" success = "+e);if(e){T(l.endscreenStartMs)}else{TBUtilities.Alert("There was an error deleting End Screen Elements from the video.");h(videoId)}})}else{T(a)}}catch(e){TBUtilities.Alert("There was an error applying endscreen template.");h(videoId)}}else{TBUtilities.Alert("There was an error applying endscreen template.");h(videoId)}})});jQuery(document).on("click","#tb-endscreen-templates-close, .tb-endscreen-templates-closex, .tb-module-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-endscreen-templates-container").hide()});jQuery(document).on("change","#tb-endscreen-templates-select",function(){f()});jQuery(document).on("click","#tb-endscreen-templates-delete-template",function(){TBUtilities.Confirm("Are you sure you want to delete this End Screen Template?",g,null)});jQuery(document).on("click","#tb-endscreen-templates-reload-templates",function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(e,"CREndScreenTemplatesGetVideoCardTemplates",null)});jQuery(document).on("click","#tb-endscreen-templates-select-all",function(){p.selectedEndscreenElements=[];p.endscreenElements.forEach(function(e){p.selectedEndscreenElements.push(e)});jQuery(".tb-endscreen-template-element-item-inner").addClass("tb-endscreen-template-element-item-inner-selected");jQuery("#tb-endscreen-templates-how-many").text("Selected ("+p.selectedEndscreenElements.length+"/"+p.endscreenElements.length+")")});jQuery(document).on("click","#tb-endscreen-templates-select-none",function(){p.selectedEndscreenElements=[];jQuery(".tb-endscreen-template-element-item-inner").removeClass("tb-endscreen-template-element-item-inner-selected");jQuery("#tb-endscreen-templates-how-many").text("Selected ("+p.selectedEndscreenElements.length+"/"+p.endscreenElements.length+")")});jQuery(document).on("click",".tb-endscreen-template-input",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-endscreen-template-element-item",function(){try{var e=jQuery(this).attr("data-element-default-id");TBUtilities.Log("EndScreen element selected with key id =");TBUtilities.Log(e);var t=TBUtilities.GetInArray(p.selectedEndscreenElements,"id",e);TBUtilities.Log(t);TBUtilities.Log("Selected elements before modifying");TBUtilities.Log(p.selectedCards);if(t==null){var i=TBUtilities.GetInArray(p.endscreenElements,"id",e);p.selectedEndscreenElements.push(i);jQuery(this).find(".tb-endscreen-template-element-item-inner").addClass("tb-endscreen-template-element-item-inner-selected");TBUtilities.Log("Selected elements after adding");TBUtilities.Log(p.selectedEndscreenElements)}else{TBUtilities.RemoveFromArray(p.selectedEndscreenElements,"id",e);jQuery(this).find(".tb-endscreen-template-element-item-inner").removeClass("tb-endscreen-template-element-item-inner-selected");TBUtilities.Log("Selected elements after removing");TBUtilities.Log(p.selectedEndscreenElements)}jQuery("#tb-endscreen-templates-how-many").text("Selected ("+p.selectedEndscreenElements.length+"/"+p.endscreenElements.length+")");if(p.selectedEndscreenElements.length==0)jQuery("#tb-endscreen-templates-apply").hide();else jQuery("#tb-endscreen-templates-apply").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [click] tb-endscreen-templates-cards-item"})}})};var m=function(){jQuery(document.body).on("CRTBEndScreenTemplateGetImageBytes",function(e,t){try{if(t.success){var i=JSON.parse(t.response);s[t.data.Url]=i}else{s[t.data.Url]=""}var n=0;for(var o in s){var a=s[o];if(a!=null){n++}}if(Object.keys(s).length==n){T(t.data.EndscreenStartMs)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeEndScreenTemplates] CRTBEndScreenTemplateGetImageBytes"})}});jQuery(document.body).on("CREndScreenTemplatesSession",function(e,t){try{TBUtilities.Log("CREndScreenTemplatesSession");var n=DOMPurify.sanitize(t.response,DOMPurifyConfig);var o=jQuery.parseHTML(n);i=TBUtilities.GetSessionToken(n);TBUtilities.Log(i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeEndScreenTemplates] CREndScreenTemplatesSession"})}});jQuery(document.body).on("CRTBCardTemplateCardsTemplateToggle",function(e,t){var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(i,"CREndScreenTemplatesGetVideoCardTemplates",null)});jQuery(document.body).on("CRTBLoadEndscreenTemplatesTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(u){u.append(t.response)}else{jQuery("body").append(t.response)}h(l,d,c)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeEndScreenTemplates] CRTBLoadEndscreenTemplatesTemplate"})}});jQuery(document.body).on("CREndScreenTemplatesGetVideoCardTemplates",function(e,t){try{jQuery("#tb-endscreen-templates-select").show();jQuery("#tb-endscreen-templates-select").find("option").remove();if(t.success){r=jQuery.parseJSON(t.response);if(r.length>0){jQuery("#tb-endscreen-templates-select").empty();jQuery.each(r,function(){jQuery("#tb-endscreen-templates-select").append(jQuery("<option></option>").text(this.EndScreenTemplateName).val(this.Id))});jQuery("#tb-endscreen-templates-loading-container").hide();jQuery("#tb-endscreen-templates-none").hide();jQuery("#tb-endscreen-templates-apply-container").show();f()}else{jQuery("#tb-endscreen-templates-loading-container").hide();jQuery("#tb-endscreen-templates-none").show();jQuery("#tb-endscreen-templates-apply-container").hide();jQuery("#tb-endscreen-templates-apply").hide()}}}catch(e){jQuery("#tb-endscreen-templates-loading-container").hide();jQuery("#tb-endscreen-templates-none").show();jQuery("#tb-endscreen-templates-apply-container").hide();jQuery("#tb-endscreen-templates-apply").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] CRAnnotationTemplatesGetVideoAnnotationTemplates"})}})};var h=function(t,n,o){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML);if(!i){try{TBExtension.Get("https://www.youtube.com/account",function(e,t,n){if(e){i=TBUtilities.GetSessionToken(n)}},null,{contentType:"text"})}catch(t){TBUtilities.LogError({Exception:e,Location:"[EndscreenTemplates] [get session token from account page]"})}}jQuery("#tb-endscreen-templates-loading-container").show();jQuery("#tb-endscreen-templates-none").hide();jQuery("#tb-endscreen-templates-apply-container").hide();jQuery("#tb-endscreen-templates-apply").hide();a=t;jQuery("#tb-endscreen-templates-container").fadeIn();jQuery("#tb-endscreen-templates-how-many").text("");jQuery("#tb-endscreen-templates-thumbnail").attr("src",o);jQuery("#tb-endscreen-templates-title").text(n);jQuery("#tb-endscreen-templates-title").attr("href","https://www.youtube.com/watch?v="+t);jQuery("#tb-endscreen-templates-working").hide();var s=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(s,"CREndScreenTemplatesGetVideoCardTemplates",null)};var f=function(){jQuery("#tb-endscreen-templates-list-container").html('<div style="padding:20px;"><span class="tb-spinner"></span> Loading End Screen Elements...</div>');if(window.location.href.indexOf("studio.youtube.com")!==-1){TubeBuddyYouTubeActions.GetVideoDetailStudio(a).then(function(e){try{o=e;var t=TBUtilities.GetInArray(r,"Id",jQuery("#tb-endscreen-templates-select").val());p.videoId=t.Id;jQuery("#tb-endscreen-templates-edit-template").attr("href","https://www.youtube.com/endscreen?v="+p.videoId);TubeBuddyYouTubeActions.GetVideoDetailStudio(p.videoId).then(function(e){n=e;TubeBuddyYouTubeActions.GetEndScreenList(p.videoId,TubeBuddyEndScreenTemplates.GetEndScreenListCallback)}).catch(function(e){Q(e)})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [api callback] destinationVideoDetailsCallback"})}}).catch(function(e){Q(e)})}else{TubeBuddyYouTubeActions.GetVideoDuration(a).then(function(e){o=e;var t=TBUtilities.GetInArray(r,"Id",jQuery("#tb-endscreen-templates-select").val());p.videoId=t.Id;jQuery("#tb-endscreen-templates-edit-template").attr("href","https://www.youtube.com/endscreen?v="+p.videoId);TubeBuddyYouTubeActions.GetVideoDuration(p.videoId).then(function(e){n=e;TubeBuddyYouTubeActions.GetEndScreenList(p.videoId,TubeBuddyEndScreenTemplates.GetEndScreenListCallback)}).catch(function(e){Q(e)})}).catch(function(e){Q(e)})}};var v=function(e){jQuery("#tb-endscreen-templates-list-container").html("");try{if(e.for_editor.elements.length==0){jQuery("#tb-endscreen-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any End Screen Elements</div>');jQuery("#tb-endscreen-templates-apply").hide();return}else{p.endscreenElements=e.for_editor.elements.slice();p.selectedEndscreenElements=e.for_editor.elements.slice();p.endscreen=e.for_editor}jQuery("#tb-endscreen-templates-list-container").html("");TBUtilities.Log("TubeBuddyEndScreenTemplates - Elements Returned");TBUtilities.Log(JSON.stringify(e));var t=p.endscreenElements.length;var i="";for(var n=0;n<t;n++){var o=p.endscreenElements[n];var a=null;switch(o.type){case"CHANNEL":{var s="";var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");if(o.isSubscribe){var l=jQuery("#tb-endscreen-template-elementType-subscribe-template").html();s=l.formatTemplate(o.id,r,o.title)}else{var l=jQuery("#tb-endscreen-template-elementType-channel-template").html();s=l.formatTemplate(o.id,o.targetUrl,o.metadata,r)}jQuery("#tb-endscreen-templates-list-container").append(s);break}case"WEBSITE":{var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var l=jQuery("#tb-endscreen-template-elementType-website-template").html();var s=l.formatTemplate(o.id,o.title,o.cta,r,o.targetUrl);jQuery("#tb-endscreen-templates-list-container").append(s);break}case"VIDEO":{switch(o.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var l=jQuery("#tb-endscreen-template-elementType-recent_upload-template").html();var s=l.formatTemplate(o.id,r);jQuery("#tb-endscreen-templates-list-container").append(s);break}case"VIDEO_TYPE_FIXED":{var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var l=jQuery("#tb-endscreen-template-elementType-fixed-template").html();var s=l.formatTemplate(o.id,o.targetUrl,r);jQuery("#tb-endscreen-templates-list-container").append(s);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var l=jQuery("#tb-endscreen-template-elementType-best_for_viewer-template").html();var s=l.formatTemplate(o.id,r);jQuery("#tb-endscreen-templates-list-container").append(s);break}}break}case"PLAYLIST":{var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.startMs),":"," ");var l=jQuery("#tb-endscreen-template-elementType-playlist-template").html();var s=l.formatTemplate(o.id,o.targetUrl,r);jQuery("#tb-endscreen-templates-list-container").append(s);break}}}jQuery("#tb-endscreen-templates-apply").show();jQuery("#tb-endscreen-templates-how-many").text("Selected ("+p.selectedEndscreenElements.length+"/"+p.endscreenElements.length+")")}catch(t){jQuery("#tb-endscreen-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this template does not contain any end screen elements</div>');jQuery("#tb-endscreen-templates-apply").hide();t.resultData=e;TBUtilities.LogError({Exception:t,Location:"[TubeBuddyEndScreenTemplates] getCardsListCallback"})}};var g=function(e){var e=jQuery("#tb-endscreen-templates-select").val();var t=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleEndScreenTemplate;var i={Id:e,Enabled:false,Title:""};TBExtension.Post(t,JSON.stringify(i),"CRTBCardTemplateCardsTemplateToggle",null,{contentType:"application/json"})};var T=function(e){var t=0;for(var r in s){var l=s[r];if(l!=null){t++}}if(Object.keys(s).length!=0&&t!=Object.keys(s).length){for(r in s){var d=TBGlobal.host+TBGlobal.apiUrls.imageGetBytes+"?url="+encodeURIComponent(r);TBExtension.Get(d,"CRTBEndScreenTemplateGetImageBytes",{Url:r,EndscreenStartMs:e})}return}if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}var c=o.videoDurationMs;var u=n.videoDurationMs;if(c<25e3){Q("End screens can only be created on videos that are at least 25 seconds long.");return}var b=u-p.endscreen.startMs;if(b>=19999){b=19950}var y=e;if(y<=2e4){y=2e4}var m=c-2e4;if(m<0){m=y}var h=0;try{TBUtilities.AddAction({EndScreenElementCount:p.selectedEndscreenElements.length},TBUtilities.ActionTypes.EndScreenTemplates_Apply,"endscreentemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [applyEndScreenElements]"})}var f=[];jQuery.each(p.selectedEndscreenElements,function(e,t){h++;var i=jQuery("div[data-element-default-id='"+t.id+"']");var n=jQuery.extend({},t);B(n,i);TubeBuddyEndScreens.UpdateElementMs(n,u,c,m,y);f.push(n)});if(jQuery("#tb-endscreen-templates-confirm-unpublish").is(":checked")){TubeBuddyYouTubeActions.UnpublishAnnotations(a,i,function(e,t,n,o){if(e==true){TubeBuddyYouTubeActions.CopyEndCardElements(a,c,y,m,f,i,function(e,t,i,n){if(e){j()}else{Q(n)}})}else{Q(o)}})}else{TubeBuddyYouTubeActions.CopyEndCardElements(a,c,y,m,f,i,function(e,t,i,n){if(e){j()}else{Q(n)}})}};var j=function(){if(document.URL.indexOf("endscreen")>0||document.URL.indexOf("editor")>0||document.URL.indexOf("video")>0&&document.URL.indexOf("edit")>0){TBUtilities.Confirm("Success! \n\n In order for your End Screen Elements to show up, we need to re-load the page. Any unsaved changes on this page will be lost \n\nShould we reload now?",w,null);jQuery("#tb-endscreen-templates-close, .tb-module-close").trigger("close")}else{TBUtilities.Alert("End Screen Elements successfully applied!",function(){jQuery("#tb-endscreen-templates-close, .tb-module-close").trigger("click")})}};var Q=function(e){jQuery("#tb-endscreen-templates-working").hide();jQuery("#tb-endscreen-templates-apply").show();var t="Failed to apply End Screen Elements! ";if(e&&e.length>0){t+=e}TBUtilities.Alert(t,function(){})};var B=function(e,t){TBUtilities.Log("copyFromTemplateToElement before");TBUtilities.Log(e);switch(e.type){case"CHANNEL":{if(e.isSubscribe){}else{e.targetUrl=jQuery(t).find(".tb-endscreen-template-elementType-channel-channelurl").val();e.metadata=jQuery(t).find(".tb-endscreen-template-elementType-channel-custom-message").val()}break}case"WEBSITE":{e.title=jQuery(t).find(".tb-endscreen-template-elementType-website-title").val();e.targetUrl=jQuery(t).find(".tb-endscreen-template-elementType-website-url").val();if(e.displayImages.thumbnails[0].url&&s[e.displayImages.thumbnails[0].url]){e.imagefile=s[e.displayImages.thumbnails[0].url]}break}case"VIDEO":{switch(e.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{break}case"VIDEO_TYPE_FIXED":{var i=jQuery(t).find(".tb-endscreen-template-elementType-fixed-url").val();var n=TBUtilities.ParseVideoIdFromUrl(i);if(n!=null){e.targetUrl=i;e.videoId=n}break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{break}}break}case"PLAYLIST":{var o=jQuery(t).find(".tb-endscreen-template-elementType-playlist-url").val();var a=TBUtilities.ParsePlaylistIdFromUrl(o);if(a!=null){e.targetUrl=o;e.playlistId=a}break}}TBUtilities.Log("copyFromTemplateToElement after");TBUtilities.Log(e)};var k=function(e,t,i,n){if(document.URL.indexOf("cards")>0){TBUtilities.Confirm("Success! \n\n In order for your Cards to show up, we need to re-load the page. Any changes you've made will not be saved. \n\nShould we reload now?",w,null);jQuery(".tb-endscreen-templates-closex, .tb-module-close").trigger("close")}else{TBUtilities.Alert("Cards successfully applied!",function(){jQuery(".tb-endscreen-templates-closex, .tb-module-close").trigger("click")})}};var w=function(){location.reload()};return{Show:function(e,i,n,o){if(TBGlobal.IsAuthenticated()){l=e;d=i;c=n;if(o){u=o}else{u=null}if(!t){m();b();y();t=true}else if(t&&(o&&jQuery(".tb-endscreen-templates-modal").length===0)){b()}else{h(l,d,c)}}},GetEndScreenListCallback:function(e){v(e)},CopyCardsCallBack:function(e,t,i,n){k(e,t,i,n)}}}();var TubeBuddyEndScreenTemplatesStudio=function(){var e=false;var t=null;var i=null;var n=null;var o;var a;var s;var r={videoId:"",endscreenElements:[],selectedEndscreenElements:[]};var l=function(){var e=TBGlobal.host+"/ModuleManager/EndScreens/EndScreenTemplatesStudio?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/endscreentemplatesstudio.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/endscreentemplatesstudio.html"}TBExtension.Get(e,"CRTBLoadEndscreenTemplatesTemplate")};var d=function(){jQuery(document).on("click","#tb-endscreen-studio-templates-apply",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("apply End Screen Templates","endscreentemplates");return}jQuery("#tb-endscreen-studio-templates-working").show();jQuery(this).hide();TubeBuddyYouTubeActions.GetVideoEndScreenStartMs(t.videoId).then(function(e){if(jQuery("#tb-endscreen-studio-templates-delete-all").prop("checked")){TubeBuddyYouTubeActions.DeleteAllEndScreenElementsStudio(i,e).then(function(){m(e)}).catch(function(e){f(e)})}else{m(e)}}).catch(function(e){f(e)})});jQuery(document).on("click","#tb-endscreen-studio-templates-close, .tb-endscreen-studio-templates-closex, .tb-module-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-endscreen-studio-templates-container").hide()});jQuery(document).on("change","#tb-endscreen-studio-templates-select",function(){p()});jQuery(document).on("click","#tb-endscreen-studio-templates-delete-template",function(){TBUtilities.Confirm("Are you sure you want to delete this End Screen Template?",y,null)});jQuery(document).on("click","#tb-endscreen-studio-templates-reload-templates",function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(e,"CREndScreenTemplatesGetVideoCardTemplates",null)});jQuery(document).on("click","#tb-endscreen-studio-templates-select-all",function(){r.selectedEndscreenElements=[];r.endscreenElements.forEach(function(e){r.selectedEndscreenElements.push(e)});jQuery(".tb-endscreen-studio-template-element-item-inner").addClass("tb-endscreen-studio-template-element-item-inner-selected");jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+r.selectedEndscreenElements.length+"/"+r.endscreenElements.length+")")});jQuery(document).on("click","#tb-endscreen-studio-templates-select-none",function(){r.selectedEndscreenElements=[];jQuery(".tb-endscreen-studio-template-element-item-inner").removeClass("tb-endscreen-studio-template-element-item-inner-selected");jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+r.selectedEndscreenElements.length+"/"+r.endscreenElements.length+")")});jQuery(document).on("click",".tb-endscreen-studio-template-input",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-endscreen-studio-template-element-item",function(){try{var e=jQuery(this).attr("data-element-default-id");TBUtilities.Log("EndScreen element selected with key id =");TBUtilities.Log(e);var t=TBUtilities.GetInArray(r.selectedEndscreenElements,"id",e);TBUtilities.Log(t);TBUtilities.Log("Selected elements before modifying");TBUtilities.Log(r.selectedCards);if(t==null){var i=TBUtilities.GetInArray(r.endscreenElements,"id",e);r.selectedEndscreenElements.push(i);jQuery(this).find(".tb-endscreen-studio-template-element-item-inner").addClass("tb-endscreen-studio-template-element-item-inner-selected");TBUtilities.Log("Selected elements after adding");TBUtilities.Log(r.selectedEndscreenElements)}else{TBUtilities.RemoveFromArray(r.selectedEndscreenElements,"id",e);jQuery(this).find(".tb-endscreen-studio-template-element-item-inner").removeClass("tb-endscreen-studio-template-element-item-inner-selected");TBUtilities.Log("Selected elements after removing");TBUtilities.Log(r.selectedEndscreenElements)}jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+r.selectedEndscreenElements.length+"/"+r.endscreenElements.length+")");if(r.selectedEndscreenElements.length==0)jQuery("#tb-endscreen-studio-templates-apply").hide();else jQuery("#tb-endscreen-studio-templates-apply").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [click] tb-endscreen-studio-templates-cards-item"})}})};var c=function(){jQuery(document.body).on("CRTBCardTemplateCardsTemplateToggle",function(e,t){var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(i,"CREndScreenTemplatesGetVideoCardTemplates",null)});jQuery(document.body).on("CRTBLoadEndscreenTemplatesTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);u(o,a,s)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeEndScreenTemplates] CRTBLoadEndscreenTemplatesTemplate"})}});jQuery(document.body).on("CREndScreenTemplatesGetVideoCardTemplates",function(e,t){try{jQuery("#tb-endscreen-studio-templates-select").show();jQuery("#tb-endscreen-studio-templates-select").find("option").remove();if(t.success){n=jQuery.parseJSON(t.response);if(n.length>0){jQuery("#tb-endscreen-studio-templates-select").empty();jQuery.each(n,function(){jQuery("#tb-endscreen-studio-templates-select").append(jQuery("<option></option>").text(this.EndScreenTemplateName).val(this.Id))});jQuery("#tb-endscreen-studio-templates-loading-container").hide();jQuery("#tb-endscreen-studio-templates-none").hide();jQuery("#tb-endscreen-studio-templates-apply-container").show();p()}else{jQuery("#tb-endscreen-studio-templates-loading-container").hide();jQuery("#tb-endscreen-studio-templates-none").show();jQuery("#tb-endscreen-studio-templates-apply-container").hide();jQuery("#tb-endscreen-studio-templates-apply").hide()}}}catch(e){jQuery("#tb-endscreen-studio-templates-loading-container").hide();jQuery("#tb-endscreen-studio-templates-none").show();jQuery("#tb-endscreen-studio-templates-apply-container").hide();jQuery("#tb-endscreen-studio-templates-apply").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] CRAnnotationTemplatesGetVideoAnnotationTemplates"})}})};var u=function(e,t,n){jQuery("#tb-endscreen-studio-templates-loading-container").show();jQuery("#tb-endscreen-studio-templates-none").hide();jQuery("#tb-endscreen-studio-templates-apply-container").hide();jQuery("#tb-endscreen-studio-templates-apply").hide();i=e;jQuery("#tb-endscreen-studio-templates-container").fadeIn();jQuery("#tb-endscreen-studio-templates-how-many").text("");jQuery("#tb-endscreen-studio-templates-thumbnail").attr("src",n);jQuery("#tb-endscreen-studio-templates-title").text(t);jQuery("#tb-endscreen-studio-templates-title").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-endscreen-studio-templates-working").hide();var o=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(o,"CREndScreenTemplatesGetVideoCardTemplates",null)};var p=function(){jQuery("#tb-endscreen-studio-templates-list-container").html('<div style="padding:20px;"><span class="tb-spinner"></span> Loading End Screen Elements...</div>');TubeBuddyYouTubeActions.GetVideoDetailStudio(i).then(function(e){try{t=e;var i=TBUtilities.GetInArray(n,"Id",jQuery("#tb-endscreen-studio-templates-select").val());r.videoId=i.Id;jQuery("#tb-endscreen-studio-templates-edit-template").attr("href","https://www.youtube.com/endscreen?v="+r.videoId);TubeBuddyYouTubeActions.GetEndScreenListStudio(r.videoId).then(function(e){b(e)}).catch(function(e){TBUtilities.Log(e);TBUtilities.Alert("There was an error retrieving endscreens. Please try again.")})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [api callback] destinationVideoDetailsCallback"})}})};var b=function(e){jQuery("#tb-endscreen-studio-templates-list-container").html("");try{if(!e.elements||e.elements&&e.elements.length==0){jQuery("#tb-endscreen-studio-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any End Screen Elements</div>');jQuery("#tb-endscreen-studio-templates-apply").hide();return}else{r.endscreenElements=e.elements.slice();r.selectedEndscreenElements=e.elements.slice();r.endscreen=e}jQuery("#tb-endscreen-studio-templates-list-container").html("");TBUtilities.Log("TubeBuddyEndScreenTemplates - Elements Returned");TBUtilities.Log(JSON.stringify(e));var t=r.endscreenElements.length;for(var i=0;i<t;i++){var n=r.endscreenElements[i];var o=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(r.endscreen.startMs+n.offsetMs),":"," ");switch(n.type){case"CHANNEL":{var a="";if(n.channelEndscreenElement.isSubscribe){let e=jQuery("#tb-endscreen-studio-template-elementType-subscribe-template").html();a=e.formatTemplate(n.id,o,n.channelEndscreenElement.title)}else{let e=jQuery("#tb-endscreen-studio-template-elementType-channel-template").html();a=e.formatTemplate(n.id,"https://www.youtube.com/channel/"+n.channelEndscreenElement.channelId,n.channelEndscreenElement.metadata,o)}jQuery("#tb-endscreen-studio-templates-list-container").append(a);break}case"WEBSITE":{let e=jQuery("#tb-endscreen-studio-template-elementType-website-template").html();let t=e.formatTemplate(n.id,n.websiteEndscreenElement.title,n.websiteEndscreenElement.cta,o,n.websiteEndscreenElement.targetUrl);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"VIDEO":{switch(n.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{let e=jQuery("#tb-endscreen-studio-template-elementType-recent_upload-template").html();let t=e.formatTemplate(n.id,o);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"VIDEO_TYPE_FIXED":{let e=jQuery("#tb-endscreen-studio-template-elementType-fixed-template").html();let t=e.formatTemplate(n.id,"https://www.youtube.com/watch?v="+n.videoEndscreenElement.encryptedVideoId,o);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{let e=jQuery("#tb-endscreen-studio-template-elementType-best_for_viewer-template").html();let t=e.formatTemplate(n.id,o);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}}break}case"PLAYLIST":{let e=jQuery("#tb-endscreen-studio-template-elementType-playlist-template").html();let t=e.formatTemplate(n.id,"https://www.youtube.com/playlist?list="+n.playlistEndscreenElement.playlistId,o);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}}}jQuery("#tb-endscreen-studio-templates-apply").show();jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+r.selectedEndscreenElements.length+"/"+r.endscreenElements.length+")")}catch(t){jQuery("#tb-endscreen-studio-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this template does not contain any end screen elements</div>');jQuery("#tb-endscreen-studio-templates-apply").hide();t.resultData=e;TBUtilities.LogError({Exception:t,Location:"[TubeBuddyEndScreenTemplates] getCardsListCallback"})}};var y=function(e){var e=jQuery("#tb-endscreen-studio-templates-select").val();var t=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleEndScreenTemplate;var i={Id:e,Enabled:false,Title:""};TBExtension.Post(t,JSON.stringify(i),"CRTBCardTemplateCardsTemplateToggle",null,{contentType:"application/json"})};var m=function(e){var n=t.videoDurationMs;if(n<25e3){f("End screens can only be created on videos that are at least 25 seconds long.");return}try{TBUtilities.AddAction({EndScreenElementCount:r.selectedEndscreenElements.length},TBUtilities.ActionTypes.EndScreenTemplates_Apply,"endscreentemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [applyEndScreenElements]"})}let o=[];jQuery.each(r.selectedEndscreenElements,function(e,t){switch(t.type){case"WEBSITE":{if(t.websiteEndscreenElement.customUploadedImage&&t.websiteEndscreenElement.customUploadedImage.url){o.push(t.websiteEndscreenElement.customUploadedImage.url)}break}}});TBUtilities.ConvertImagesToDataUrls(o).then(function(t){var o=[];jQuery.each(r.selectedEndscreenElements,function(i,a){var s=jQuery("div[data-element-default-id='"+a.id+"']");var r=jQuery.extend({},a);v(r,s);TBUtilities.AdjustEndScreenElementTiming(r,n,e);if(a.type==="WEBSITE"&&a.websiteEndscreenElement.customUploadedImage&&a.websiteEndscreenElement.customUploadedImage.url){let e=t.find(e=>e.url===a.websiteEndscreenElement.customUploadedImage.url);r.websiteEndscreenElement.imageDataUrl=e.dataUrl}o.push(r)});TubeBuddyYouTubeActions.CopyEndScreenElementsStudio(i,e,o).then(function(){h()}).catch(function(e){f(e)})}).catch(function(e){f(e)})};var h=function(){if(document.URL.indexOf("endscreen")>0||document.URL.indexOf("editor")>0){TBUtilities.Confirm("Success! \n\n In order for your End Screen Elements to show up, we need to re-load the page. Any unsaved changes on this page will be lost. \n\nShould we reload now?",T,null);jQuery("#tb-endscreen-studio-templates-close, .tb-module-close").trigger("close")}else{TBUtilities.Alert("End Screen Elements successfully applied!",function(){jQuery("#tb-endscreen-studio-templates-close, .tb-module-close").trigger("click")})}};var f=function(e){jQuery("#tb-endscreen-studio-templates-working").hide();jQuery("#tb-endscreen-studio-templates-apply").show();var t="Failed to apply End Screen Elements! ";if(e&&e.length>0){t+=e}TBUtilities.Alert(t,function(){})};var v=function(e,t){TBUtilities.Log("copyFromTemplateToElement before");TBUtilities.Log(e);switch(e.type){case"CHANNEL":{if(e.channelEndscreenElement.isSubscribe){}else{e.channelEndscreenElement.channelId=jQuery(t).find(".tb-endscreen-studio-template-elementType-channel-channelurl").val();e.channelEndscreenElement.metadata=jQuery(t).find(".tb-endscreen-studio-template-elementType-channel-custom-message").val()}break}case"WEBSITE":{e.websiteEndscreenElement.title=jQuery(t).find(".tb-endscreen-studio-template-elementType-website-title").val();e.websiteEndscreenElement.targetUrl=jQuery(t).find(".tb-endscreen-studio-template-elementType-website-url").val();break}case"VIDEO":{switch(e.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{break}case"VIDEO_TYPE_FIXED":{var i=jQuery(t).find(".tb-endscreen-studio-template-elementType-fixed-url").val();var n=TBUtilities.ParseVideoIdFromUrl(i);if(n!=null){e.videoEndscreenElement.encryptedVideoId=n}break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{break}}break}case"PLAYLIST":{var o=jQuery(t).find(".tb-endscreen-studio-template-elementType-playlist-url").val();var a=TBUtilities.ParsePlaylistIdFromUrl(o);if(a!=null){e.playlistEndscreenElement.playlistId=a}break}}TBUtilities.Log("copyFromTemplateToElement after");TBUtilities.Log(e)};var g=function(e,t,i,n){if(document.URL.indexOf("cards")>0){TBUtilities.Confirm("Success! \n\n In order for your Cards to show up, we need to re-load the page. Any unsaved changes on this page will be lost. \n\nShould we reload now?",T,null);jQuery(".tb-endscreen-studio-templates-closex, .tb-module-close").trigger("close")}else{TBUtilities.Alert("Cards successfully applied!",function(){jQuery(".tb-endscreen-studio-templates-closex, .tb-module-close").trigger("click")})}};var T=function(){location.reload()};return{Show:function(t,i,n){if(TBGlobal.IsAuthenticated()){o=t;a=i;s=n;if(!e){c();l();d();e=true}else{u(o,a,s)}}},GetEndScreenListCallback:function(e){b(e)},CopyCardsCallBack:function(e,t,i,n){g(e,t,i,n)}}}();var TubeBuddyEndScreenUpdate=function(){var e={method:3,specificVideoIds:[],specificVideos:[],playlistId:"",validPlaylistIds:[],search:"",selectedVideo:{},currentVideo:null,isStopped:false,failedVideos:[],step:1,videosWithFoundElements:[],destinationVideos:[],hasFinished:false,errorCount:0,successCount:0,totalDestinationVideos:0,actionElementCount:0,imageConversionDic:{},searchQueue:[]};var t=false;var i=null;var n=function(){var e=TBGlobal.host+"/ModuleManager/endscreensupdate/endscreensupdate?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/endscreensupdate.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/endscreensupdate.html"}TBExtension.Get(e,"CRTBLoadEndScreensUpdateTemplate")};var o=function(){jQuery(document).on("click","#tb-endscreens-update-error-copy-container",function(){jQuery(this).attr("src","https://www.tubebuddy.com/images/icons/check.png");window.setTimeout(function(){jQuery("#tb-endscreens-update-error-copy").attr("src","https://www.tubebuddy.com/images/icons/copy.png")},1500)});jQuery(document).on("click","#tb-endscreens-update-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change",".tb-endscreens-update-elementtype-select",function(){try{var e=jQuery(".tb-endscreens-update-elementtype-select").val();switch(e){case"video":{jQuery(".tb-endscreens-update-cardtype-video").show();jQuery(".tb-endscreens-update-cardtype-link").hide();jQuery(".tb-endscreens-update-cardtype-playlist").hide();jQuery(".tb-endscreens-update-target-select").val("videoUrl");jQuery(".tb-endscreens-update-cardtype-video-container").show();jQuery(".tb-endscreens-update-cardtype-link-container").hide();jQuery(".tb-endscreens-update-action-option-playlistorvideourl").text("Set Video URL to");break}case"playlist":{jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-playlist").show();jQuery(".tb-endscreens-update-cardtype-link").hide();jQuery(".tb-endscreens-update-target-select").val("playlistUrl");jQuery(".tb-endscreens-update-cardtype-video-container").show();jQuery(".tb-endscreens-update-cardtype-link-container").hide();jQuery(".tb-endscreens-update-action-option-playlistorvideourl").text("Set Playlist URL to");break}case"link":{jQuery(".tb-endscreens-update-cardtype-playlist").hide();jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-link").show();jQuery(".tb-endscreens-update-target-select").val("url");jQuery(".tb-endscreens-update-cardtype-video-container").hide();jQuery(".tb-endscreens-update-cardtype-link-container").show();break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-endscreens-update-imagefile"})}});jQuery(document).on("change","#tb-endscreens-update-imagefile-input",function(){try{var e=jQuery(".tb-endscreens-update-imagefile").val().split(".").pop().toLowerCase();if(jQuery.inArray(e,["gif","png","jpg","jpeg"])===-1){TBUtilities.Alert("Invalid image file type.  Only .gif, .png, and .jpg are allowed");jQuery(".tb-endscreens-update-imagefile").val("");return}jQuery("#tb-endscreens-update-uploaded-file").text(jQuery(".tb-endscreens-update-imagefile").val().split("\\")[2]).show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-endscreens-update-imagefile"})}});jQuery(document).on("change",".tb-endscreens-update-filter",function(){jQuery(".tb-endscreens-update-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-endscreens-update-destination-row[data-privacy="private"]').hide();jQuery('.tb-endscreens-update-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-endscreens-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-update-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-endscreens-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-update-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-endscreens-update-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-endscreens-update-destination-row[data-privacy="public"]').hide();break}jQuery(".tb-endscreens-update-destination-selected-count").text(jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length)});jQuery(document).on("click",".tb-endscreens-update-destination-row",function(){try{if(!jQuery(this).hasClass("tb-endscreens-destination-row--selected")){jQuery(this).addClass("tb-endscreens-destination-row--selected");if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length>1){jQuery(this).removeClass("tb-endscreens-destination-row--selected");TBGlobal.ShowUpgradePage("update End Screen Elements in bulk (more than 1 video at a time)","bulkupdateendscreens");return}}else{jQuery(this).removeClass("tb-endscreens-destination-row--selected")}var t=y();e.actionElementCount=t;jQuery(".tb-endscreens-update-destination-selected-count").text(t);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length);jQuery(".tb-endscreens-update-count").text(t);if(jQuery(".tb-endscreens-update-count").text()=="1")jQuery(".tb-endscreens-update-count-s").hide();else jQuery(".tb-endscreens-update-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [click] tb-endscreens-update-checkbox-include"})}});jQuery(document).on("click",".tb-endscreens-update-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("update end screen elements in bulk (more than 1 video at a time)","bulkupdateendscreens");return}jQuery(".tb-endscreens-update-destination-row").addClass("tb-endscreens-destination-row--selected");var e=y();jQuery(".tb-endscreens-update-destination-selected-count").text(e);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length);jQuery(".tb-endscreens-update-count").text(e);if(jQuery(".tb-endscreens-update-count").text()=="1")jQuery(".tb-endscreens-update-count-s").hide();else jQuery(".tb-endscreens-update-count-s").show()});jQuery(document).on("click",".tb-endscreens-update-select-no-checkboxes",function(){jQuery(".tb-endscreens-update-destination-row").removeClass("tb-endscreens-destination-row--selected");var e=y();jQuery(".tb-endscreens-update-destination-selected-count").text(e);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length);jQuery(".tb-endscreens-update-count").text(e);if(jQuery(".tb-endscreens-update-count").text()=="1")jQuery(".tb-endscreens-update-count-s").hide();else jQuery(".tb-endscreens-update-count-s").show()});jQuery(document).on("click","input[name=tb-endscreens-update-target-option]",function(){jQuery(".tb-endscreens-update-target-input").prop("disabled",true);jQuery(".tb-endscreens-update-target-input").val("");jQuery(this).siblings(".tb-endscreens-update-target-input:first").prop("disabled",false)});jQuery(document).on("click",".tb-endscreens-update-action-option",function(){var e=jQuery(this).is(":checked");if(e){if(jQuery(this).hasClass("tb-endscreens-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-endscreens-update-imagefile:first").prop("disabled",false)}else{jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").prop("disabled",false);jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").val("")}}else{if(jQuery(this).hasClass("tb-endscreens-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-endscreens-update-imagefile:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-endscreens-update-imagefile:first").val("")}else{jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").val("")}}});jQuery(document).on("click","#tb-endscreens-update-close, #tb-endscreens-update-cancel, .tb-endscreens-update-closex",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-endscreens-update-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [click] tb-endscreens-close"})}});jQuery(document).on("click",".tb-endscreens-update-continue",function(){try{switch(e.step){case 1:{if(jQuery(".tb-endscreens-update-target-input-field").val()===""){TBUtilities.Alert("Enter your search criteria");return}var t=jQuery(".tb-endscreens-update-elementtype-select").val();var i=a();switch(t){case"playlist":case"video":{try{if(i.find(".tb-endscreens-update-action-video").is(":checked")===false){TBUtilities.Alert("Please choose at least one update to make");return}var n;var o;if(i.find(".tb-endscreens-update-action-video").is(":checked")){var r=i.find(".tb-endscreens-update-action-video-input").val();o=w(r);if(!o){n=k(r)}if(!n&&o==false){TBUtilities.Alert("Invalid video id or playlist id to set to.  Make sure you have a valid YouTube URL");return}}var l=jQuery(".tb-endscreens-update-target-input-field").val();var d=w(l);var c;if(!d){c=k(l)}if(!c&&d==false){TBUtilities.Alert("Invalid video id or playlist id to search for.  Make sure you have a valid YouTube URL");return}if(i.find(".tb-endscreens-update-action-image").is(":checked")&&i.find(".tb-endscreens-update-imagefile").val()===""){TBUtilities.Alert("Select an IMAGE FILE");return}var u=jQuery(".tb-endscreens-update-target-select").val();switch(u){case"playlistUrl":{var p=w(l);if(!p){TBUtilities.Alert("Invalid playlist.  Make sure the playlist you're trying to search for is a valid playlist URL.");return}break}case"videoUrl":{var b=k(l);if(!b){TBUtilities.Alert("Invalid video.  Make sure the video you're trying to search for is a valid video URL.");return}break}}var y=jQuery(".tb-endscreens-update-action-video-input").val();switch(u){case"playlistUrl":{var p=w(y);if(!p){TBUtilities.Alert("Invalid playlist.  Make sure the playlist you're trying to set is a valid playlist URL.");return}break}case"videoUrl":{var b=k(y);if(!b){TBUtilities.Alert("Invalid video.  Make sure the video you're trying to set is a valid video URL.");return}break}}s(2)}catch(e){TBUtilities.Alert("Invalid video id or playlist id.  Make sure you have a valid YouTube URL")}break}case"link":{if(i.find(".tb-endscreens-update-action-title").is(":checked")==false&&i.find(".tb-endscreens-update-action-url").is(":checked")==false&&i.find(".tb-endscreens-update-action-image").is(":checked")==false){TBUtilities.Alert("Please choose at least one update to make");return}if(i.find(".tb-endscreens-update-action-title").is(":checked")&&i.find(".tb-endscreens-update-action-title-input").val()==""){TBUtilities.Alert("Enter a TITLE");return}if(i.find(".tb-endscreens-update-action-url").is(":checked")&&i.find(".tb-endscreens-update-action-url-input").val()==""){TBUtilities.Alert("Enter a URL");return}if(i.find(".tb-endscreens-update-action-image").is(":checked")&&i.find(".tb-endscreens-update-imagefile").val()==""){TBUtilities.Alert("Select an image to upload");return}s(2);break}}break}case 2:{switch(parseInt(e.method)){case 0:if(e.specificVideoIds.length==0){jQuery("#tb-endscreens-input-ids-status").css("color","red");jQuery("#tb-endscreens-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&e.specificVideoIds.length>1){TBGlobal.ShowUpgradePage("update End Screen Elements in bulk (more than 1 video at a time)","bulkupdateendscreens");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Video IDs "+JSON.stringify(e.specificVideoIds));g();break;case 1:var h=jQuery("#tb-endscreens-update-input-playlist").playlistSelect().data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();var f=h.getSelectedPlaylistIds();if(f.length>0){e.playlistId=f.join(",")}if(f.length>=2){TBUtilities.Alert("Please select only one playlist");return}if(e.playlistId===""){h.showValidationWarning();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Playlist ["+e.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(e.playlistId,null,m,Q);break;case 2:if(e.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Search ["+e.search+"]");jQuery("#tb-endscreens-destination").show();TBYouTubeApi.GetChannelVideosSearch(e.search,null,m,Q);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var v=null;if(jQuery("#tb-endscreens-update-onlyLoadFirstPage").is(":checked")){var T=/^\+?\d+$/.test(jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").val());if(T==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}v=parseInt(jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").val());if(v<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,m,Q,v,null,e.selectedVideo.id);break}jQuery(".tb-endscreens-update-loading-count").text("0");jQuery(".tb-endscreens-update-loading-count-total").text("?");jQuery(".tb-endscreens-update-loading-text").text("Loading your videos...");jQuery(".tb-endscreens-update-loading-text-search").text("");jQuery(".tb-endscreens-update-loading-videos").show();jQuery(".tb-endscreens-loading-count-container").show();jQuery(".tb-endscreens-update-no-videos").hide();s(3);break}case 3:{if(jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length===0){TBUtilities.Alert("Please select at least 1 video to update end screen elements.");return}e.destinationVideos=[];jQuery(".tb-endscreens-destination-row--selected").filter(":visible").each(function(){var t=jQuery(this).attr("data-video-id");jQuery.each(e.videosWithFoundElements,function(i,n){if(n.id===t){var o=TBUtilities.GetInArray(e.destinationVideos,"id",t);if(!o){e.destinationVideos.push(n)}}})});jQuery("#tb-endscreens-update-queue-list").empty();jQuery("#tb-endscreens-update-completed-list").empty();if(e.destinationVideos.length>=2e3){jQuery("#tb-endscreens-update-2k-warning").show()}else{jQuery("#tb-endscreens-update-2k-warning").hide()}s(4);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [click] #tb-endscreens-continue, #tb-endscreens-kickoff"})}});jQuery(document).on("click",".tb-endscreens-update-kickoff",function(){if(!jQuery(".tb-endscreens-update-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to update the end screen elements");return}try{TBUtilities.AddAction({VideoCount:e.videosWithFoundElements.length,CardCount:e.actionElementCount,Data:"method = "+e.method},TBUtilities.ActionTypes.BulkUpdateEndScreens_Update,"bulkupdateendscreens")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateEndScreens] [addAction]"})}jQuery(".tb-endscreens-update-status").show();jQuery(".tb-endscreens-update-confirm").hide();jQuery("#tb-endscreens-update-stop").show();jQuery(".tb-endscreens-update-cancel").hide();jQuery(".tb-endscreens-update-back").hide();jQuery(".tb-endscreens-update-kickoff").hide();jQuery(".tb-endscreens-update-continue").hide();jQuery("#tb-endscreens-update-close").hide();jQuery(".tb-endscreens-update-step-number").text("- Processing");r(function(){l();d()})});jQuery(document).on("click",".tb-endscreens-update-back",function(){if(e.step>1){var t=e.step;e.step=e.step-1;s(e.step,t)}});jQuery(document).on("click","#tb-endscreens-update-method-ids, #tb-endscreens-update-method-playlist, #tb-endscreens-update-method-search, #tb-endscreens-update-method-full",function(t){e.method=parseInt(jQuery(this).attr("data-method"));var i=jQuery("#tb-endscreens-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(t){e.playlistId=t}}).data("plugin_playlistSelect");switch(e.method){case 0:jQuery("#tb-endscreens-update-input-ids").removeAttr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").attr("disabled","disabled");i.disable();break;case 1:jQuery("#tb-endscreens-update-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").attr("disabled","disabled");i.enable();i.showDropDown();break;case 2:jQuery("#tb-endscreens-update-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").removeAttr("disabled","disabled");i.disable();break;case 3:jQuery("#tb-endscreens-update-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").attr("disabled","disabled");i.disable();break}});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-update-input-playlist",function(t){e.playlistId="";var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-endscreens-update-input-playlist-status").hide();return}if(i.indexOf("list=")>0){i=i.substring(i.indexOf("list=")+5)}if(i.length!=18&&i.length!=34||i.substring(0,2)!="PL"){jQuery("#tb-endscreens-update-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-endscreens-update-input-playlist-status").css("color","red")}else{jQuery("#tb-endscreens-update-input-playlist-status").text("Valid Playlist Id");jQuery("#tb-endscreens-update-input-playlist-status").css("color","green");e.playlistId=i}jQuery("#tb-endscreens-update-input-playlist-status").show()});jQuery(document).on("click",".playlistSelectTypeManual",function(){var t=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").find("input");t.each(function(t,i){e.validPlaylistIds.push(jQuery(i).val())})});jQuery(document).on("keyup",".playlistSelectManualIds",function(){var t=jQuery(this).val();if(e.validPlaylistIds.indexOf(t)==-1){jQuery("#tb-playlist-select-manual-id-invalid").show()}else{jQuery("#tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery("#tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-update-input-search",function(t){e.search=jQuery(this).val().trim()});jQuery(document).on("click","#tb-endscreens-update-stop",function(){e.isStopped=true;jQuery("#tb-endscreens-update-stop").hide();jQuery("#tb-endscreens-update-close").show();jQuery("#tb-endscreens-update-working").hide();jQuery("#tb-endscreens-update-stopped").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-update-input-ids",function(t){var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-endscreens-update-input-ids-status").hide();return}jQuery("#tb-endscreens-update-input-ids-status").show();e.specificVideoIds=[];if(i.indexOf(",")>-1){e.specificVideoIds=i.split(",")}else{e.specificVideoIds=i.split(" ")}for(var n=0;n<e.specificVideoIds.length;n++){e.specificVideoIds[n]=e.specificVideoIds[n].trim();e.specificVideoIds[n]=e.specificVideoIds[n].replace("https://www.youtube.com/watch?v=","");e.specificVideoIds[n]=e.specificVideoIds[n].replace("https://youtu.be/","");if(e.specificVideoIds[n].length!=11){e.specificVideoIds.splice(n,1);n--}}if(e.specificVideoIds.length==0){jQuery("#tb-endscreens-update-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-update-input-ids-status").css("color","red")}else if(e.specificVideoIds.length==1){jQuery("#tb-endscreens-update-input-ids-status").text("1 video detected");jQuery("#tb-endscreens-update-input-ids-status").css("color","green");jQuery("#tb-endscreens-update-method-ids").prop("checked",true);jQuery("#tb-endscreens-update-method-ids").trigger("click")}else{jQuery("#tb-endscreens-update-input-ids-status").text(e.specificVideoIds.length+" videos detected");jQuery("#tb-endscreens-update-input-ids-status").css("color","green");jQuery("#tb-endscreens-update-method-ids").prop("checked",true);jQuery("#tb-endscreens-update-method-ids").trigger("click")}})};var a=function(){var e=jQuery(".tb-endscreens-update-elementtype-select").val();var t=null;switch(e){case"playlist":case"video":{t=jQuery(".tb-endscreens-update-cardtype-video-container");break}case"link":{t=jQuery(".tb-endscreens-update-cardtype-link-container");break}}return t};var s=function(t,i){try{jQuery(".tb-endscreens-update-step1").hide();jQuery(".tb-endscreens-update-step2").hide();jQuery(".tb-endscreens-update-step3").hide();jQuery(".tb-endscreens-update-step4").hide();jQuery(".tb-endscreens-update-kickoff").hide();jQuery(".tb-endscreens-update-continue").hide();jQuery(".tb-endscreens-update-back").hide();jQuery("#tb-endscreens-update-stop").hide();jQuery("#tb-endscreens-done-close").hide();jQuery(".tb-endscreens-update-step-number").text("- Step "+t);switch(t){case 1:{jQuery(".tb-endscreens-update-step1").show();jQuery(".tb-endscreens-update-continue").show();e.step=1;break}case 2:{e.specificVideoIds=[];e.specificVideos=[];e.playlistId="";e.search="";jQuery(".tb-endscreens-update-step2").show();jQuery(".tb-endscreens-update-continue").show();jQuery(".tb-endscreens-update-back").show();jQuery("#tb-endscreens-update-input-ids").val("");jQuery("#tb-endscreens-update-input-playlist").val("");jQuery("#tb-endscreens-update-input-search").val("");jQuery("#tb-endscreens-update-input-ids-status").empty();jQuery("#tb-endscreens-update-input-playlist-status").empty();var n=jQuery("#tb-endscreens-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(t){e.playlistId=t}}).data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();jQuery("#tb-endscreens-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-endscreens-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");e.method&&e.method==1?n.enable():n.disable();e.step=2;break}case 3:{jQuery(".tb-endscreens-update-step3").show();jQuery(".tb-endscreens-update-continue").show();jQuery(".tb-endscreens-update-back").show();if(i&&i==4){TBUtilities.Log("back step 3")}else{jQuery(".tb-endscreens-update-destination-list").empty();jQuery(".tb-endscreens-update-destination-list").hide();jQuery(".tb-endscreens-update-destination-selected-count").text("0");jQuery(".tb-endscreens-update-destination-total-count").text("0");jQuery(".tb-endscreens-update-count").text("0")}e.step=3;break}case 4:{jQuery(".tb-endscreens-update-step4").show();jQuery(".tb-endscreens-update-continue").hide();jQuery(".tb-endscreens-update-kickoff").show();jQuery(".tb-endscreens-update-back").show();jQuery(".tb-endscreens-update-confirm").show();jQuery(".tb-endscreens-update-status").hide();jQuery(".tb-endscreens-update-continue").hide();e.step=4;break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] showstep "})}};var r=function(t){var i=jQuery(".tb-endscreens-update-elementtype-select").val();var n=a();jQuery.each(e.destinationVideos,function(e,t){var o=v(t.endscreen.elements);jQuery.each(t.endscreen.elements,function(e,t){var a=o.find(e=>e.id===t.id);if(a){switch(i){case"video":{if(t.type=="VIDEO"&&t.videoType=="VIDEO_TYPE_FIXED"){var s=k(n.find(".tb-endscreens-update-action-video-input").val());if(s){t.videoId=s}}break}case"playlist":{if(t.type==="PLAYLIST"){var r=w(n.find(".tb-endscreens-update-action-video-input").val());if(r){t.playlistId=r}var l=k(n.find(".tb-endscreens-update-action-video-input").val());if(l){t.videoId=l}}break}case"link":{if(t.type=="WEBSITE"){if(n.find(".tb-endscreens-update-action-url").is(":checked")&&n.find(".tb-endscreens-update-action-url-input").val()!==""){t.targetUrl=n.find(".tb-endscreens-update-action-url-input").val()}if(n.find(".tb-endscreens-update-action-title").is(":checked")&&n.find(".tb-endscreens-update-action-title-input").val()!==""){t.title=n.find(".tb-endscreens-update-action-title-input").val()}}break}}}})});if(n.find(".tb-endscreens-update-action-image").is(":checked")){var o=jQuery(".tb-endscreens-update-imagefile")[0].files[0];var s=new FileReader;s.readAsDataURL(o);s.onload=function(){var i=s.result;jQuery.each(e.destinationVideos,function(e,t){jQuery.each(t.endscreen.elements,function(e,t){if(t.type==="WEBSITE"){t.imagefile=i}})});t()};s.onerror=function(e){t()}}else{t()}};var l=function(){TBUtilities.Log("startProcessing");try{e.totalDestinationVideos=e.destinationVideos.length;e.hasFinished=false;e.errorCount=0;e.successCount=0;jQuery("#tb-endscreens-update-update-queue-list").empty();jQuery("#tb-endscreens-update-completed-list").empty();jQuery("#tb-endscreens-update-queue-list2").empty();jQuery("#tb-endscreens-update-completed-list2").empty();jQuery("#tb-endscreens-update-error-list2").empty();jQuery("#tb-endscreens-update-error-list2").hide();jQuery("#tb-endscreens-update-error-none-list2").show();jQuery("#tb-endscreens-update-working").show();jQuery("#tb-endscreens-update-done").hide();jQuery("#tb-endscreens-done-close").hide();jQuery("#tb-endscreens-update-stopped").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [startProcessing]"})}};var d=function(){TBUtilities.Log("processNextVideo");try{jQuery("#tb-endscreens-update-progress-container").html("Start &rarr;");if(e.isStopped)return;if(e.destinationVideos.length==0&&e.hasFinished==false){e.hasFinished=true;jQuery("#tb-endscreens-update-status-count").html("<b>"+e.totalDestinationVideos+"</b> of <b>"+e.totalDestinationVideos+"</b> videos complete");jQuery("#tb-endscreens-update-progress-container").hide();if(e.currentVideo){if(!e.currentVideo.error)u(e.currentVideo.video);else p(e.currentVideo.video)}c();jQuery("#tb-endscreens-update-working").hide();jQuery("#tb-endscreens-update-done").show();jQuery("#tb-endscreens-done-close").show();jQuery("#tb-endscreens-update-stop").hide();jQuery("#tb-endscreens-update-close").show();return}var t=e.destinationVideos[0].id;if(e.currentVideo){if(!e.currentVideo.error)u(e.currentVideo.video);else p(e.currentVideo.video)}var i=TBUtilities.RemoveFromArray(e.destinationVideos,"id",t);e.currentVideo=i[0];e.imageConversionDic={};jQuery("#tb-endscreens-update-status-count").html("<b>"+parseInt(e.totalDestinationVideos-e.destinationVideos.length)+"</b> of <b>"+e.totalDestinationVideos+"</b> videos complete");jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+t+'">'+t+"</a>");c();TBGlobal.AddUserDebugInfo("Updating elements for video: "+e.currentVideo.id);jQuery.each(e.currentVideo.endscreen.elements,function(t,i){switch(i.type){case"WEBSITE":{if(!i.uploadedImage&&i.imageUrl&&i.imageUrl.length>0){if(!e.imageConversionDic[i.imageUrl]){e.imageConversionDic[i.imageUrl]=null}}break}}});if(Object.keys(e.imageConversionDic).length>0){for(key in e.imageConversionDic){var n=TBGlobal.host+TBGlobal.apiUrls.imageGetBytes+"?url="+encodeURIComponent(key);TBExtension.Get(n,"CRTBEndScreenUpdateGetImageBytes",{Url:key})}}else{b(e.currentVideo)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [processNextVideo]"});jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+"Error: "+e.message);TBUtilities.Alert('Sorry, there was an error: "'+e.message+'"');jQuery("#tb-endscreens-update-stop").trigger("click");jQuery("#tb-endscreens-update-stop").trigger("click")}};var c=function(){TBUtilities.Log("showNextToBeProcessed");jQuery("#tb-endscreens-update-queue-list2").empty();jQuery("#tb-endscreens-update-queue-complete-list2").hide();var t=0;jQuery.each(e.destinationVideos,function(e,i){var n=i.video.snippet.thumbnails.thumbnailMedium?i.video.snippet.thumbnails.thumbnailMedium:i.video.snippet.thumbnails.default.url;var o=jQuery(".tb-endscreens-update-processing-template2:last")[0].outerHTML;o=o.replace("#THUMBNAILURL#",n);o=TBUtilities.ReplaceAll(o,"#VIDEOID#",i.id);o=o.replace("#VIDEOTITLE#",i.video.snippet.title);o=o.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);o=o.replace("display: none","display:flex");jQuery("#tb-endscreens-update-queue-list2").prepend(o);t++;if(t==3)return false});if(t==0){jQuery("#tb-endscreens-update-queue-complete-list2").show();jQuery("#tb-endscreens-update-queue-list2").hide()}else{jQuery("#tb-endscreens-update-queue-list2").show()}};var u=function(t){TBUtilities.Log("addCompletedSuccess");var i=t.snippet.thumbnails.thumbnailMedium?t.snippet.thumbnails.thumbnailMedium:t.snippet.thumbnails.default.url;var n=jQuery(".tb-endscreens-update-processed-success:last")[0].outerHTML;n=n.replace("#THUMBNAILURL#",i);n=TBUtilities.ReplaceAll(n,"#VIDEOID#",t.id);n=n.replace("#VIDEOTITLE#",t.snippet.title);n=n.replace("#HREF#","https://www.youtube.com/endscreen?video_referrer=watch&v="+t.id);n=n.replace("display:none","display:flex");jQuery("#tb-endscreens-update-completed-list2").prepend(n);jQuery("#tb-endscreens-update-completed-none-list2").hide();jQuery("#tb-endscreens-update-completed-list2").show();e.successCount++;jQuery("#tb-endscreens-update-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(e.successCount))};var p=function(t){try{jQuery("#tb-endscreens-update-error-copy-container").show();var i=jQuery("#tb-endscreens-update-error-copy").attr("data-clipboard-text");var n=[];if(i!==""){n=i.split(",");if(n.indexOf(t.id)===-1){n.push(t.id)}}else{n.push(t.id)}jQuery("#tb-endscreens-update-error-copy").attr("data-clipboard-text",n.join(","))}catch(e){TBUtilities.Log("addCompletedError",e)}TBUtilities.Log("addCompletedError");var o=t.snippet.thumbnails.thumbnailMedium?t.snippet.thumbnails.thumbnailMedium:t.snippet.thumbnails.default.url;var a=jQuery(".tb-endscreens-update-processed-error:last")[0].outerHTML;a=a.replace("#THUMBNAILURL#",o);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",t.id);a=a.replace("#VIDEOTITLE#",t.snippet.title);a=a.replace("#ERROR#",t.error);a=a.replace("#HREF#","https://www.youtube.com/endscreen?video_referrer=watch&v="+t.id);a=a.replace("display:none","display:flex; flex-wrap:wrap;");jQuery("#tb-endscreens-update-error-list2").prepend(a);jQuery("#tb-endscreens-update-error-list2").show();jQuery("#tb-endscreens-update-error-none-list2").hide();e.errorCount++;jQuery("#tb-endscreens-update-error-list2-count").text(TBUtilities.FormatNumberWithCommas(e.errorCount))};var b=function(t){if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}TubeBuddyYouTubeActions.UpdateEndCardElements(t.id,t.endscreen.startMs,t.endscreen.minStartMs,t.endscreen.elements,i,function(t,i,n,o){TBUtilities.Log("endscreen Update Callback");if(o){jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+" Error");e.currentVideo.error=o}else{jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+" Update Complete")}d()})};var y=function(){var t=0;jQuery(".tb-endscreens-destination-row--selected").filter(":visible").each(function(){var i=jQuery(this).attr("data-video-id");jQuery.each(e.videosWithFoundElements,function(e,n){if(n.id==i){t=t+n.searchResults.length}})});return t};var m=function(t){try{if(t==null){if(e.method==0)TBUtilities.Alert("No valid Video IDs found");else if(e.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(e.method==2)TBUtilities.Alert("No videos matching your search");else if(e.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery(".tb-endscreens-update-back").trigger("click");return}else if(t.length==0){if(e.method==0)TBUtilities.Alert("No valid Video IDs found");else if(e.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(e.method==2)TBUtilities.Alert("No videos matching your search");else if(e.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery(".tb-endscreens-update-back").trigger("click");return}jQuery(".tb-endscreens-update-destination-list").empty();jQuery(".tb-endscreens-update-destination-list").hide();jQuery(".tb-endscreens-update-no-videos").hide();jQuery(".tb-endscreens-update-loading-videos").show();jQuery(".tb-endscreens-update-loading-text").html("Hang Tight!<br /><br />We are currently looking through the videos you selected to find End Screen Elements that match your search criteria. This generally takes a couple seconds per video meaning it may take up to 30 minutes per 1,000 videos you have.");jQuery(".tb-endscreens-loading-count-container").hide();jQuery("tb-endscreens-update-loading-text-search").text("");e.videosWithFoundElements=[];e.searchQueue=[];jQuery.each(t,function(t,i){if(i.id.videoId!=null){i.id=i.id.videoId}if(i.snippet.resourceId!=null)i.id=i.snippet.resourceId.videoId;if(i.snippet!=null&&i.snippet.title=="Deleted video"&&i.snippet.thumbnails==null)return;e.searchQueue.push(i)});h()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [gotVideoList]"})}};var h=function(){if(e.searchQueue.length>0){var t=e.searchQueue.shift();var i="https://www.youtube.com/endscreen_ajax?v="+t.id+"&encrypted_video_id="+t.id+"&action_load=1";TBExtension.Get(i,function(i,n,o){if(i===true){jQuery(".tb-endscreens-update-loading-text-search").html("Searching End Screen Elements for video https://youtube.com/watch?v="+t.id);var a=v(o.for_editor.elements);if(a.length>0){var s=TBUtilities.GetInArray(e.videosWithFoundElements,"id",t.id);if(!s){e.videosWithFoundElements.push({video:t,endscreen:o.for_editor,searchResults:a,id:t.id,error:""});var r=jQuery("#tb-endscreens-update-destination-template").html();var l="matches";if(a.length==1){l="match"}var d=r.formatTemplate(t.id,t.snippet.thumbnails.default.url,"https://www.youtube.com/endscreen?v="+t.id,t.snippet.title,a.length,l,t.status.privacy);jQuery(".tb-endscreens-update-destination-list").prepend(d)}}}else{jQuery(".tb-endscreens-update-loading-text-search").html("Searching End Screen Elements for video "+t.id)}if(e.searchQueue.length===0){f()}else{h()}},null,{dataType:"json"})}else{f()}};var f=function(){jQuery(".tb-endscreens-update-loading-videos").hide();if(e.videosWithFoundElements.length==0){jQuery(".tb-endscreens-update-no-videos").show();jQuery(".tb-endscreens-update-destination-list").hide();jQuery(".tb-endscreens-update-continue").hide()}else{jQuery(".tb-endscreens-update-destination-total-count").text(e.videosWithFoundElements.length);jQuery(".tb-endscreens-update-destination-list").show();jQuery(".tb-endscreens-update-continue").show();if(e.method===0||e.method===1)jQuery(".tb-endscreens-update-select-all-checkboxes").trigger("click")}};var v=function(e){var t=jQuery(".tb-endscreens-update-target-select").val();var i=jQuery(".tb-endscreens-update-target-input-field").val().toUpperCase();var n=jQuery(".tb-endscreens-update-elementtype-select").val();TBUtilities.Log("searchField="+t);TBUtilities.Log("searchValue="+i);TBUtilities.Log("selectedElementType="+n);var o;var a;var s;if(n==="video"||n==="playlist"){s=jQuery(".tb-endscreens-update-target-select").val();o=w(jQuery(".tb-endscreens-update-target-input-field").val());a=k(jQuery(".tb-endscreens-update-target-input-field").val())}TBUtilities.Log("listIdToSearch="+o);TBUtilities.Log("videoIdToSearch="+a);TBUtilities.Log("searchType="+s);TBUtilities.Log("selectedElementType="+n);var r=new Array;try{jQuery.each(e,function(e,t){TBUtilities.Log(t);switch(n){case"video":{if(t.type=="VIDEO"&&t.videoType=="VIDEO_TYPE_FIXED"){switch(s){case"videoUrl":{if(t.videoId==a){r.push(t);return true}break}}}break}case"playlist":{if(t.type=="PLAYLIST"){switch(s){case"playlistUrl":{if(t.playlistId==o){r.push(t);return true}break}}}break}case"link":{if(t.type=="WEBSITE"){if(t.targetUrl&&t.targetUrl.toUpperCase()===i){r.push(t);return true}else if(t.title&&t.title.toUpperCase()===i){r.push(t);return true}}break}}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] searchElements"})}return r};var g=function(){var t=e.specificVideoIds[0];e.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(t,"contentDetails, snippet, id, status",T)};var T=function(t){if(t!=null)e.specificVideos.push(t);if(e.specificVideoIds.length>0){g()}else{m(e.specificVideos)}};var j=function(){jQuery(document.body).on("CRTBEndScreenUpdateGetImageBytes",function(t,i){try{if(i.success){var n=JSON.parse(i.response);e.imageConversionDic[i.data.Url]=n}else{e.imageConversionDic[i.data.Url]=""}var o=0;for(var a in e.imageConversionDic){var s=e.imageConversionDic[a];if(s!=null){o++}}if(Object.keys(e.imageConversionDic).length==o){for(var a in e.imageConversionDic){var s=e.imageConversionDic[a];if(s!=null){jQuery.each(e.currentVideo.endscreen.elements,function(e,t){switch(t.type){case"WEBSITE":{if(!t.uploadedImage&&t.imageUrl&&t.imageUrl.length>0){if(t.imageUrl==a){t.imagefile=s}}break}}})}}b(e.currentVideo)}}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyCards] CRTBGetImageBytes"})}});jQuery(document.body).on("CRTBLoadEndScreensUpdateTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);B()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] CRTBLoadCardsTemplate"})}})};var Q=function(e){if(e.totalCount-e.loaded>50){jQuery(".tb-endscreens-update-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-endscreens-update-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").val())}jQuery(".tb-endscreens-update-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery(".tb-endscreens-update-loading-count"))}else{jQuery(".tb-endscreens-update-rendering").show();jQuery(".tb-endscreens-update-loading-count-container").hide()}};var B=function(){try{jQuery("#tb-endscreens-update-error-copy-container").hide();jQuery("#tb-endscreens-update-error-copy").prop("data-clipboard-text","");jQuery("#tb-endscreens-update-uploaded-file").text("").hide();var t=new ClipboardJS("#tb-endscreens-update-error-copy");e.destinationVideos=[];e.videosWithFoundElements=[];e.specificVideos=[];e.currentVideo=null;e.is=false;jQuery('input[type="radio"][value="url"]').prop("checked",true);jQuery(".tb-endscreens-update-target-input").prop("disabled",true);jQuery(".tb-endscreens-update-target-url").prop("disabled",false);jQuery(".tb-endscreens-update-target-input").val("");jQuery(".tb-endscreens-update-action-input").val("");jQuery(".tb-endscreens-update-filter").val("all");jQuery(".tb-endscreens-update-action-input").prop("disabled",true);jQuery(".tb-endscreens-update-imagefile").val("");jQuery(".tb-endscreens-update-imagefile").prop("disabled",true);jQuery(".tb-endscreens-update-action-option").prop("checked","");jQuery(".tb-endscreens-kickoff").hide();jQuery(".tb-endscreens-update-confirm-checkbox").prop("checked","");jQuery(".tb-endscreens-update-no-videos").hide();jQuery(".tb-endscreens-update-loading-videos").show();jQuery(".tb-endscreens-update-loading-count").text("0");jQuery(".tb-endscreens-update-loading-count-total").text("?");jQuery(".tb-endscreens-update-loading-text-search").text("");jQuery(".tb-endscreens-update-loading-text").text("Loading your videos...");jQuery(".tb-endscreens-update-target-input-field").val("");jQuery(".tb-endscreens-update-action-video-input").val("");jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-endscreens-update-onlyLoadFirstPage").prop("checked",false);jQuery(".tb-endscreens-update-elementtype-select").val("link");jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-playlist").hide();jQuery(".tb-endscreens-update-cardtype-link").show();jQuery(".tb-endscreens-update-target-select").val("url");jQuery(".tb-endscreens-update-cardtype-video-container").hide();jQuery(".tb-endscreens-update-cardtype-link-container").show();e.step=1;s(e.step);jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-link").show();jQuery("#tb-endscreens-update-container").show();jQuery(".tb-endscreens-update-action-option-playlistorvideourl").text("Set Video URL to")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] prepareDialog"})}};var k=function(e){var t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var i=e.match(t);return i&&i[7].length===11?i[7]:false};var w=function(e){var t=/list=([a-zA-Z0-9\-\_]+)&?/;var i=e.match(t);var n=i?i[1]:false;return n};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!t){j();n();o();t=true}else{B()}}}}}();var TubeBuddyTagLists=function(){var e=false;var t=false;var i;var n=true;var o=null;var a=null;var s=false;var r=function(){var e=TBGlobal.host+"/ModuleManager/TagLists/TagLists?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/taglists.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/taglists.html"}TBExtension.Get(e,"CRTBLoadTagListsTemplate")};var l=function(){var e=jQuery(".tb-tag-list-tag-input").val();if(!e){TBUtilities.Alert("Please enter a Tag to add to your list.");return}var t={ListId:jQuery(".tb-tag-lists-select").val(),Tag:e};var i=TBGlobal.host+TBGlobal.apiUrls.taglistsAddTag;TBExtension.Post(i,JSON.stringify(t),"CRTBTagListAddTag",null,{contentType:"application/json"})};var d=function(){var e=jQuery(".tb-tag-lists-select").val();var t=jQuery(".tb-tag-lists-tag-sort").val();var i=TBGlobal.host+TBGlobal.apiUrls.taglistsGetListTags+"?id="+e+"&sort="+t;TBExtension.Get(i,"CRTBTagListGetListTags")};var c=function(){var e=0;var t=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){if(jQuery(this).is(":checked")){e++;var i=jQuery(this).attr("data-tag-value");if(i){t.push(i)}}});jQuery(".tb-tag-lists-selected-count").text(e);if(e>0){jQuery(".tb-tag-lists-remove").attr("disabled",false);jQuery(".tb-tag-lists-insert").attr("disabled",false);jQuery(".tb-tag-lists-tag-selected-container").slideDown()}else{jQuery(".tb-tag-lists-remove").attr("disabled",true);jQuery(".tb-tag-lists-insert").attr("disabled",true);jQuery(".tb-tag-lists-tag-selected-container").hide()}if(jQuery(".tb-tag-list-tag-row-checkbox:visible").length<=1){jQuery(".tb-tag-list-filtering").hide()}else{jQuery(".tb-tag-list-filtering").show()}var i="";var n=t.length;if(t.length>0){jQuery.each(t,function(e,t){if(e==n-1){i+=t}else{i+=t+", "}})}jQuery(".tb-tag-lists-insert").attr("data-clipboard-text",i);return e};var u=function(){var e=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(t,i){if(jQuery(this).is(":checked")){var n=jQuery(this).attr("data-tag-value");if(n){e.push(n)}}});var t="";var n=e.length;if(e.length>0){jQuery.each(e,function(e,i){if(e==n-1){t+=i}else{t+=i+", "}})}if(i){i.destroy()}jQuery(".tb-tag-lists-insert").attr("data-clipboard-text",t);if(!s){i=new ClipboardJS(".tb-tag-lists-insert")}else{i=new ClipboardJS(".tb-tag-lists-insert",{container:jQuery(s)[0]})}};var p=function(){jQuery(document).on("click",".tb-tag-lists-delete-list",function(e){var t="Are you sure you want to delete list "+jQuery(".tb-tag-lists-select option:selected").text()+" ?";TBUtilities.Confirm(t,function(){var e={ListId:jQuery(".tb-tag-lists-select").val()};var t=TBGlobal.host+TBGlobal.apiUrls.taglistsDeleteList;TBExtension.Post(t,JSON.stringify(e),"CRTBTagListDeleteList",null,{contentType:"application/json"})},null)});jQuery(document).on("change",".tb-tag-lists-action-select",function(e){var t=jQuery(".tb-tag-lists-action-select").val();switch(t){case"video":{if(i){i.destroy();jQuery(".tb-tag-lists-insert").removeAttr("data-clipboard-text")}jQuery(".tb-tag-lists-insert").text("Insert");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");break}case"clipboard":{jQuery(".tb-tag-lists-insert").text("Copy");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");u();break}case"remove":{jQuery(".tb-tag-lists-insert").text("Remove");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").addClass("tb-btn-danger");u();break}}});jQuery(document).on("click",".tb-tag-lists-insert",function(e){if(jQuery(this).attr("disabled")=="disabled"){return true}var t=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(e,i){if(jQuery(this).is(":checked")){var n=jQuery(this).attr("data-tag-value");if(n){t.push(n)}}});var i=jQuery(".tb-tag-lists-action-select:visible").val();switch(i){case"video":{if(o){o(t)}else{if(document.URL.indexOf("youtube.com/edit")>0){TubeBuddyEditVideo.AddTags(t)}else if(document.URL.indexOf("youtube.com/upload")>0){TubeBuddyUpload.AddTags(jQuery(".tb-upload-tag-sorter-button"),t)}else if(document.URL.indexOf("youtube.com/my_live_events")>0){TubeBuddyLiveEventsVideo.AddTags(t)}else if(document.URL.indexOf("https://studio.youtube.com")==0){var n=location.pathname;var a=[];if(n){var a=n.substring(1).split("/");if(a[0]=="video"&&a[2]=="edit"){TubeBuddyEditVideoStudio.AddTags(t)}}}jQuery(".tb-tag-lists-insert").html('<img class="tb-move-down3" src="https://www.tubebuddy.com/images/icons/check.png"/>');window.setTimeout(function(){jQuery(".tb-tag-lists-insert").html("Add")},1500)}try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.TagLists_Export,"taglists")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] [addAction]"})}TubeBuddyMenu.HideBackground();jQuery("#tb-tag-lists-container:visible").hide();break}case"clipboard":{jQuery(".tb-tag-lists-insert").html('<img class="tb-move-down3" src="https://www.tubebuddy.com/images/icons/check.png"/>');window.setTimeout(function(){jQuery(".tb-tag-lists-insert").html("Add")},1500);try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.TagLists_Export,"taglists")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] [addAction]"})}break}case"remove":{if(jQuery(this).attr("disabled")=="disabled"){return true}var s=c();var r="Are you sure you want to remove "+s+" tag(s)?";TBUtilities.Confirm(r,function(){var e=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){if(jQuery(this).is(":checked"))e.push(jQuery(this).attr("data-tag-id"))});if(e.length>0){var t={ListId:jQuery(".tb-tag-lists-select").val(),TagIds:e};var i=TBGlobal.host+TBGlobal.apiUrls.taglistsRemoveTags;TBExtension.Post(i,JSON.stringify(t),"CRTBTagListRemoveTags",null,{contentType:"application/json"})}},null);return}}jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){jQuery(this).prop("checked",false)});c()});jQuery(document).on("click",".tb-tag-lists-all-tags",function(e){jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){jQuery(this).prop("checked",true)});c()});jQuery(document).on("click",".tb-tag-lists-none-tags",function(e){jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){jQuery(this).prop("checked",false)});c()});jQuery(document).on("change",".tb-tag-list-tag-row-checkbox",function(e){var t=jQuery(".tb-tag-lists-action-select:visible").val();switch(t){case"video":{jQuery(".tb-tag-lists-insert").text("Insert");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");break}case"clipboard":{jQuery(".tb-tag-lists-insert").text("Copy");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");break}case"remove":{jQuery(".tb-tag-lists-insert").text("Remove");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").addClass("tb-btn-danger");break}}c()});jQuery(document).on("change",".tb-tag-lists-tag-sort",function(e){d()});jQuery(document).on("change",".tb-tag-lists-select",function(e){d()});jQuery(document).on("click",".tb-tag-list-tag-insert",function(e){l()});jQuery(document).on("keypress",".tb-tag-list-tag-input",function(e){if(e.which===13){l()}});jQuery(document).on("keypress",".tb-tag-list-name-input",function(e){if(e.which===13){jQuery(".tb-tag-list-empty-insert").click()}});jQuery(document).on("keypress","#tb-tag-list-emptystart-name-input",function(e){if(e.which===13){jQuery(".tb-tag-list-emptystart-insert").click()}});jQuery(document).on("click",".tb-tag-lists-show-add",function(e){if(TBGlobal.CanAccessLevel1Tools()==false&&a.length>=3){TBGlobal.ShowUpgradePage("have more than 3 Tag Lists",TBGlobal.limitation.tagLists);return}var t=TBGlobal.host+TBGlobal.apiUrls.taglistsAddList;if(!s){TBUtilities.Prompt("What would you like to call the new tag list?","List #"+(jQuery(".tb-tag-lists-select:first option").length+1),function(e,i){if(i!=null){var n={Name:i};TBExtension.Post(t,JSON.stringify(n),"CRTBTagListAdd",null,{contentType:"application/json"})}})}else{var i=prompt("What would you like to call the new tag list?","");if(!i||i.length==0){TBUtilities.Alert("Please enter a list name.");return}else{var n={Name:i};TBExtension.Post(t,JSON.stringify(n),"CRTBTagListAdd",null,{contentType:"application/json"})}}});jQuery(document).on("click",".tb-tag-list-emptystart-insert",function(e){jQuery(".tb-tag-lists-show-add-cancel").hide();var t=jQuery(this).siblings("#tb-tag-list-emptystart-name-input").val();if(t.length==0){TBUtilities.Alert("Please enter a name for your Tag List");return}var i={Name:t};var n=TBGlobal.host+TBGlobal.apiUrls.taglistsAddList;TBExtension.Post(n,JSON.stringify(i),"CRTBTagListAdd",null,{contentType:"application/json"});jQuery("#tb-tag-list-emptystart-name-input").text("")});jQuery(document).on("click",".tb-tag-lists-close, .tb-tag-lists-closex",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-tag-lists-container:visible").hide()})};var b=function(){jQuery(document.body).on("CRTBTagListDeleteList",function(e,t){try{if(t.success){m()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListDeleteList"})}});jQuery(document.body).on("CRTBTagListRemoveTags",function(e,t){try{if(t.success){d()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListGetListTags"})}});jQuery(document.body).on("CRTBTagListGetListTags",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);jQuery(".tb-tag-lists-tag-list-tag-container").empty();if(i.length>0){var n=jQuery("#tb-tag-list-tag-row").html();var o="";jQuery.each(i,function(e,t){o+=n.formatTemplate(t.TagValue,t.Id)});jQuery(".tb-tag-lists-tag-list-tag-container").append(o);u()}else{var n=jQuery("#tb-tag-list-empty-row").html();jQuery(".tb-tag-lists-tag-list-tag-container").append(n)}c()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListGetListTags"})}});jQuery(document.body).on("CRTBLoadTagListsTemplate",function(e,t){try{if(t.success){if(jQuery("#tb-tag-lists-container").length>0){jQuery("#tb-tag-lists-container").remove()}t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!s){jQuery("body").append(t.response)}else{s.append(t.response)}h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBLoadTagListsTemplate"})}});jQuery(document.body).on("CRTBTagListsGetLists",function(e,t){try{if(t.success){a=jQuery.parseJSON(t.response);if(a.length==0){jQuery(".tb-tag-lists-has-container").hide();jQuery(".tb-tag-lists-has-none-container").show()}else{jQuery(".tb-tag-lists-select").empty();jQuery.each(a,function(e,t){jQuery(".tb-tag-lists-select").append(jQuery("<option></option>").attr("value",t.Id).text(t.Name))});if(t.data&&t.data.ListId){jQuery(".tb-tag-lists-select").val(t.data.ListId);d()}else{jQuery(".tb-tag-lists-select").val(jQuery(".tb-tag-lists-select option:first").val());d()}jQuery(".tb-tag-lists-has-container").show();jQuery(".tb-tag-lists-has-none-container").hide();jQuery(".tb-tag-lists-select-container").show()}jQuery(".tb-tag-lists-loading-container").hide();jQuery(".tb-tag-lists-loading-done-container").show()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListsGetLists"})}});jQuery(document.body).on("CRTBTagListAdd",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);var n=TBGlobal.host+TBGlobal.apiUrls.taglistsGetLists;TBExtension.Get(n,"CRTBTagListsGetLists",{ListId:i.Id})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListAdd"})}});jQuery(document.body).on("CRTBTagListAddTag",function(e,t){try{if(t.success){jQuery(".tb-tag-list-tag-input").val("");d()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListAddTag"})}})};var y=function(){try{jQuery(".tb-tag-lists-loading-done-container").hide();jQuery(".tb-tag-lists-has-container").hide();jQuery("#tb-tag-lists-container").show();jQuery(".tb-tag-lists-remove").prop("disabled",true);var e=TBGlobal.GetYouTubeUI();var o=false;switch(e){case"studio":{var a=location.pathname;var s=[];if(a){var s=a.substring(1).split("/");TBUtilities.Log(s);for(var r=0;r<5-s.length;r++)s.push("");if(s[0]=="video"&&s[2]=="edit"){o=true}else if(s[2]=="videos"&&s[3]=="upload"&&jQuery("paper-dialog.ytcp-uploads-dialog#dialog").length>0){o=true}}break}case"material":case"default":{o=document.URL.indexOf("youtube.com/upload")>0||document.URL.indexOf("youtube.com/edit")>0||document.URL.indexOf("youtube.com/my_live_events")>0;break}}if(o===true){jQuery(".tb-tag-lists-insert").attr("disabled",false);jQuery(".tb-tag-lists-insert").attr("title","Insert Tag to Video.");jQuery(".tb-tag-lists-insert").attr("data-tooltip-text","Insert Tag to Video.");t=true;if(n){jQuery(".tb-tag-lists-action-select").val("video");if(i){i.destroy();jQuery(".tb-tag-lists-insert").removeAttr("data-clipboard-text")}jQuery(".tb-tag-lists-insert").text("Insert");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger")}}else{jQuery(".tb-tag-lists-action-select-video").attr("disabled","disabled");jQuery(".tb-tag-lists-action-select").val("clipboard");jQuery(".tb-tag-lists-insert").attr("disabled",true);t=false}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] prepareDialog"})}};var m=function(){jQuery(".tb-tag-lists-loading-container").show();jQuery(".tb-tag-lists-container").hide();jQuery(".tb-tag-lists-loading-done-container").hide();var e=TBGlobal.host+TBGlobal.apiUrls.taglistsGetLists;TBExtension.Get(e,"CRTBTagListsGetLists")};var h=function(){y();m()};return{Show:function(t,i,a){if(TBGlobal.IsAuthenticated()){if(t){n=true}if(i){o=i}if(a){s=a}else{s=false}if(!e){b();r();p();e=true}else{r()}}}}}();var TubeBuddyCopyTo=function(){var e=false;var t=null;var i=null;var n;var o;var a;var s;var r;var l=null;var d=function(){var e=TBGlobal.host+"/ModuleManager/CopyTo/CopyTo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/copyto.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/copyto.html"}TBExtension.Get(e,"CRTBLoadCopyToTemplate")};var c=function(){var e=u();if(t){t.destroy()}var i=" ";if(e.length>0){i=e.join(",")}jQuery('.tb-copyto-action-dropdown-action-option[data-option="clipboard"]').attr("data-clipboard-text",i);if(!l){t=new ClipboardJS('.tb-copyto-action-dropdown-action-option[data-option="clipboard"]')}else{t=new ClipboardJS('.tb-copyto-action-dropdown-action-option[data-option="clipboard"]',{container:jQuery(l)[0]})}jQuery(".tb-copyto-action-dropdown-selected-count").text(e.length)};var u=function(){var e=[];jQuery(".tb-copyto-dropdown-tag:visible").each(function(){if(jQuery(this).is(":checked")){var t=decodeURIComponent(jQuery(this).attr("data-tag-value"));if(t){e.push(t)}}});return e};var p=function(){if(i){i.siblings(".tb-copyto-action-dropdown").remove()}};var b=function(){var e=i.html();var t='&nbsp;&nbsp;<span style="color:green">Copied!<span>&nbsp;&nbsp;';i.html(t);window.setTimeout(function(){i.html(e)},3e3)};var y=function(){jQuery(document).click(function(){p()});jQuery(document).on("click",".tb-copyto-action-dropdown",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-copyto-action-dropdown-all",function(e){jQuery(".tb-copyto-dropdown-tag:visible").each(function(){jQuery(this).prop("checked",true)});c()});jQuery(document).on("click",".tb-copyto-action-dropdown-none",function(e){jQuery(".tb-copyto-dropdown-tag:visible").each(function(){jQuery(this).prop("checked",false)});c()});jQuery(document).on("change",".tb-copyto-dropdown-tag",function(e){c()});jQuery(document).on("click",".tb-copyto-action-dropdown .tb-copyto-action-dropdown-action-option",function(e){e.stopPropagation();var t=jQuery(this).attr("data-option");var i=jQuery(this).attr("data-list-id");var o=jQuery(this).attr("data-list-name");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ViewAndCopyVideoTags_Copy,"watchpagestats")}catch(e){TBUtilities.LogError({Exception:e,Location:"[CopyTo] [tb-copyto-action-dropdown]"})}switch(t){case"clipboard":{b();p();break}case"newlist":{if(TBGlobal.CanAccessLevel1Tools()==false&&n.length>=3){TBGlobal.ShowUpgradePage("have more than 3 Tag Lists",TBGlobal.limitation.tagLists);return}if(!l){TBUtilities.Prompt("What would you like the list name to be?",null,function(e,t){if(t.length==0){TBUtilities.Alert("Please enter a list name.");return}var i=u();var n={Name:t,Tags:i};var o=TBGlobal.host+TBGlobal.apiUrls.taglistsAddListWithTags;TBExtension.Post(o,JSON.stringify(n),"CRTBCopyToAddListWithTags",null,{contentType:"application/json"});p()},function(e,t){})}else{var a=prompt("What would you like the list name to be?","");if(!a||a.length==0){TBUtilities.Alert("Please enter a list name.");return}else{var s=u();var r={Name:a,Tags:s};var d=TBGlobal.host+TBGlobal.apiUrls.taglistsAddListWithTags;TBExtension.Post(d,JSON.stringify(r),"CRTBCopyToAddListWithTags",null,{contentType:"application/json"})}p()}break}case"list":{var i=jQuery(this).attr("data-list-id");if(i){var s=u();var r={Id:i,Tags:s};var d=TBGlobal.host+TBGlobal.apiUrls.taglistsAddTags;TBExtension.Post(d,JSON.stringify(r),"CRTBCopyToAddTags",null,{contentType:"application/json"})}p();break}}})};var m=function(e,i,n){i=i.filter(function(e){return e===0||e});if(t){t.destroy()}e.siblings(".tb-copyto-action-dropdown").remove();var o=jQuery("#tb-copyto-dropdown-template").html();var a=o.formatTemplate();e.after(a);var l=e.position().top;var d=e.position().left;if(r){d=d-r}if(s){l=l+s.scrollTop()}if(n&&n===true){l=l+35;d=d-280;jQuery(".tb-copyto-action-dropdown").css({position:"absolute",top:l,left:d})}else{if(document.URL.indexOf("youtube.com/edit")>0){l=l-275;d=70}else if(document.URL.indexOf("youtube.com/watch?v")>0){l=l-275;d=d-400}else if(document.URL.indexOf("youtube.com/my_live_events")>0){l=l-270;d=d-10}jQuery(".tb-copyto-action-dropdown").css({position:"absolute",top:l,left:d})}jQuery(".tb-copyto-action-dropdown").show();var u=jQuery("#tb-copyto-dropdown-tag-template").html();if(i.length>0){jQuery.each(i,function(e,t){if(t!=""){var i=u.formatTemplate(encodeURIComponent(t.trim()),t.trim());jQuery(".tb-copyto-tags-container:visible").append(i)}})}else{jQuery(".tb-copyto-tags-container:visible").append('<span class="tb-margin-left10 tb-font-size11">No Tags</span>')}c();var p=TBGlobal.host+TBGlobal.apiUrls.taglistsGetLists;TBExtension.Get(p,"CRTBCopyToGetLists")};var h=function(){jQuery(document.body).on("CRTBCopyToAddTags",function(e,t){try{if(t.success){b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBCopyToAddTags"})}finally{p()}});jQuery(document.body).on("CRTBCopyToAddListWithTags",function(e,t){try{if(t.success){b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBCopyToAddListWithTags"})}finally{p()}});jQuery(document.body).on("CRTBCopyToGetLists",function(e,t){try{if(t.success){jQuery(".tb-copyto-lists-container").empty();n=jQuery.parseJSON(t.response);if(n.length==0){jQuery(".tb-copyto-lists-container").append('<span class="tb-margin-left10 tb-font-size11">You don\'t have any tag lists</span>')}else{var i="";jQuery.each(n,function(e,t){i+='<div class="tb-copyto-action-dropdown-action-option tb-copyto-list-item" data-option="list" data-list-id="'+t.Id+'" data-list-name="'+t.Name+'" ><span title="'+t.Name+'">'+TBUtilities.Truncate(t.Name,25,true)+"</span></div>"});jQuery(".tb-copyto-lists-container").append(i)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBCopyToGetLists"})}});jQuery(document.body).on("CRTBLoadCopyToTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);m(i,o,a)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBLoadCopyToTemplate"})}})};return{ShowMenu:function(t,n,c,u,p,b){if(TBGlobal.IsAuthenticated()){i=t;o=n;a=c;s=u;r=p;if(b){l=b}else{l=null}if(!e){h();d();y();e=true}else{m(i,o,a)}}}}}();var TubeBuddyVideolytics=function(){var e=false;var t=null;var n=null;var o=null;var a={};var s=0;var r={};var l={};var d;var c=0;var u=0;var p=4;var b=false;var y="&#10003;";var m='<span style="color:red">&#10007;</span>';var h="-";var f=function(e,i){TBUtilities.Log("Videolytics populateContent");if(TBGlobal.CanAccessLevel1Tools()==false){jQuery(".tb-videolytics-savevideo").attr("disabled","disabled")}var o=R();var a=setInterval(function(){if(jQuery("#"+o).length){u=0;l={};clearInterval(a);var i=G();if(TBGlobal.IsAuthenticated()&&TBGlobal.Profile().SettingsShowVideolytics==true){var s=TBGlobal.GetYouTubeUI();var r=i.find(".tb-videolytics-container");if(r.length>0){r.remove()}var d=i.find(".tb-videolytics-container-disabled");if(d.length>0){d.remove()}switch(s){case"studio":case"material":{jQuery("#player-ads").after(jQuery(".tb-videolytics-container")[0].outerHTML);i.find(".tb-videolytics-header-carret").attr("style","flex:1; order:3; justify-content:flex-end;");break}case"default":{i.prepend(jQuery(".tb-videolytics-container")[0].outerHTML);break}}if(TBGlobal.IsDarkMode()){jQuery("#tb-videolytics-thumbsdown").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsdownwhite.png"));jQuery("#tb-videolytics-thumbsup").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsupwhite.png"))}else{jQuery("#tb-videolytics-thumbsdown").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsdown.png"));jQuery("#tb-videolytics-thumbsup").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsup.png"))}ce();de();i.find(".tb-videolytics-container").show();var c=TBUtilities.GetUrlParameter("list");if(c&&s==="default"){i.find(".tb-videolytics-container").css("margin-top","490px")}else{i.find(".tb-videolytics-container").css("margin-top","0px")}T(t,n,"primary",e)}else{switch(TBGlobal.GetYouTubeUI()){case"studio":case"material":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0){jQuery("#player-ads").after(jQuery(".tb-videolytics-container-disabled")[0].outerHTML)}break}case"default":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0){i.prepend(jQuery(".tb-videolytics-container-disabled")[0].outerHTML)}break}}}setTimeout(function(){v()},2e3)}},100)};var v=function(){u++;if(u>=p){return}var e=".tb-videolytics-container";if(TBGlobal.IsAuthenticated()&&TBGlobal.Profile().SettingsShowVideolytics==false){e=".tb-videolytics-container-disabled"}var t=G();var i=t.find(e);if(i){var n=i.index();if(n!=-1&&n!=0){t.prepend(i)}}setTimeout(function(){v()},2e3)};var g=function(e){if(TBExtension.GetType()=="crossrider"){var t=TBGlobal.host+"/assets/js/moment/moment-with-locales.js";TBExtension.Get(t,function(t,i,n){try{if(t){var o="https://cdnjs.cloudflare.com/ajax/libs/highcharts/4.1.9/highcharts.js";TBExtension.Get(o,function(t,i,n){try{if(t){e()}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|addScripts",Data:i,Response:n})}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|addScripts"})}},null,{dataType:"script",cache:true})}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|addScripts",Data:i,Response:n})}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|addScripts"})}},null,{dataType:"script",cache:true})}else{e()}};var T=function(e,t,i,n,o){TBUtilities.Log("Videolytics.js|getPageData");var a=new VideolyticsData;a.videoId=t;a.sessionToken=TBUtilities.GetSessionToken(document.documentElement.innerHTML);a.idToken=k();a.uiVersionNumber=w();a.ui=TBGlobal.GetYouTubeUI();a.serverStats=null;if(TBUtilities.GetUrlParameter("v").toLowerCase()==t.toLowerCase()&&n==false){a.html=document.documentElement.innerHTML;a.language=j(a.html);if(a.serverStats==null){a.commentToken=B(document.documentElement.innerHTML);Q(a,i)}Ce(a,i);Le(a,i)}else{var s="https://www.youtube.com/watch?v="+t;TBExtension.Get(s,function(e,t,n){try{if(e){a.html=n;if(a.serverStats==null){a.commentToken=B(n);Q(a,i)}}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getPageData",Data:t,Response:n});a.html="error"}a.language=j(a.html);x(a,i);Ce(a,i);Le(a,i)}catch(e){a.html="error";TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getPageData"})}},null,{dataType:null})}TubeBuddyYouTubeActions.GetVideoTags(t,function(e){a.tags=e;x(a,i)});if(a.serverStats==null){r[t]=a;D(a,e,i);var s="https://www.youtube.com/channel/"+e+"/about";TBExtension.Get(s,function(e,t,n){try{if(e){a.channelAboutHtml=n}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getPageData",Data:t,Response:n});a.channelAboutHtml="error"}M(a,i)}catch(e){a.channelAboutHtml="error";TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getPageData"})}},null,{dataType:null})}};var j=function(e){TBUtilities.Log("Videolytics getLanguage");var t=null;var i=TBGlobal.GetYouTubeUI();switch(i){case"studio":case"material":{try{var n=e.indexOf("ytplayer.config = ");n=n+17;var o=e.substring(n,e.length);var a=o.indexOf("};")+1;var o=o.substring(0,a);var s=jQuery.parseJSON(o);t=s.args.hl}catch(i){try{var r=e.indexOf('"hl"');var l=e.indexOf('"',r+4);var d=e.indexOf('"',l+1);t=e.substring(l+1,d)}catch(e){}}break}case"default":{break}}TBUtilities.Log(t);return t};var Q=function(e,t){TBUtilities.Log("Videolytics getCommentCount");if(e.commentToken==null){e.commentCount=0;e.commentCountFormatted=0;x(e,t);return}var i=TBGlobal.GetYouTubeUI();switch(i){case"studio":case"material":{var n="https://www.youtube.com/comment_service_ajax?action_get_comments=1&pbj=1&ctoken="+encodeURIComponent(e.commentToken);var o={session_token:e.sessionToken};var a=jQuery.param(o);TBExtension.Post(n,a,function(i,n,o){try{if(i){var a=0;var s="";try{if(o.response.continuationContents.itemSectionContinuation.header.commentsHeaderRenderer.countText.simpleText){s=o.response.continuationContents.itemSectionContinuation.header.commentsHeaderRenderer.countText.simpleText}else if(o.response.continuationContents.itemSectionContinuation.header.commentsHeaderRenderer.countText.runs){s=o.response.continuationContents.itemSectionContinuation.header.commentsHeaderRenderer.countText.runs["0"].text}a=s.match(/\d/g);a=a.join("")}catch(e){a=0;TBUtilities.Log(e)}e.commentCount=parseInt(a);e.commentCountFormatted=TBUtilities.FormatNumberAbbreviated(e.commentCount,null,"tb-videolytics-abbrev")}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getCommentCount",Data:n,Response:o});e.commentCount="error"}x(e,t)}catch(t){e.commentCount="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getCommentCount"})}},null,{dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{"X-YouTube-Identity-Token":e.idToken,"X-YouTube-Client-Name":1,"X-YouTube-Client-Version":e.uiVersionNumber}});break}case"default":{var n="https://www.youtube.com/watch_fragments_ajax?v="+e.videoId+"&tr=scroll&distiller=1&ctoken="+e.commentToken+"&frags=comments&spf=load";var o={session_token:e.sessionToken,client_url:"https://www.youtube.com/watch?v="+e.videoId};var a=jQuery.param(o);TBExtension.Post(n,a,function(i,n,o){try{if(i){var a=0;try{var s=jQuery.parseHTML(DOMPurify.sanitize(o.body["watch-discussion"],DOMPurifyConfig));var r=jQuery(s).find(".comment-section-header-renderer").text();var a=r.match(/\d/g);a=a.join("")}catch(e){a=0;TBUtilities.Log(e)}e.commentCount=parseInt(a);e.commentCountFormatted=TBUtilities.FormatNumberAbbreviated(e.commentCount,null,"tb-videolytics-abbrev")}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getCommentCount",Data:n,Response:o});e.commentCount="error"}x(e,t)}catch(t){e.commentCount="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getCommentCount"})}},null,{dataType:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{"X-YouTube-Identity-Token":e.sessionToken}});break}}};var B=function(e){var t=TBGlobal.GetYouTubeUIFromHtml(e);var i=null;try{switch(t){case"studio":case"material":{var n=TBUtilities.ParseResponseContextFromHtml(e);var o=0;if(n.contents.twoColumnWatchNextResults.results.results.contents[1]&&n.contents.twoColumnWatchNextResults.results.results.contents[1].itemSectionRenderer){o=1}else if(n.contents.twoColumnWatchNextResults.results.results.contents[2]&&n.contents.twoColumnWatchNextResults.results.results.contents[2].itemSectionRenderer){o=2}else if(n.contents.twoColumnWatchNextResults.results.results.contents[3]&&n.contents.twoColumnWatchNextResults.results.results.contents[3].itemSectionRenderer){o=3}i=n.contents.twoColumnWatchNextResults.results.results.contents[o].itemSectionRenderer.continuations["0"].nextContinuationData.continuation;break}case"default":{var a=e.indexOf("COMMENTS_TOKEN");var s=e.indexOf('"',a);var r=e.indexOf('"',s+1);i=e.substring(s+1,r);break}}}catch(e){TBUtilities.Log(e)}return i};var k=function(){var e=TBGlobal.GetYouTubeUI();var t=null;switch(e){case"studio":case"material":{var i='"ID_TOKEN":"';var n=document.documentElement.innerHTML.indexOf(i);var o=document.documentElement.innerHTML.substring(n+i.length,document.documentElement.innerHTML.length);var a=o.indexOf('","');t=o.substring(0,a);break}case"default":{break}}return t};var w=function(){var e=TBGlobal.GetYouTubeUI();var t=null;switch(e){case"studio":case"material":{var n=TBUtilities.ParseResponseContextFromHtml(document.documentElement.innerHTML);jQuery.each(n.responseContext.serviceTrackingParams,function(e,n){if(n.service&&n.service=="CSI"){for(i=0;i<n.params.length;i++){if(n.params[i].key=="cver"){t=n.params[i].value}}}});break}case"default":{break}}return t};var x=function(e,t){TBUtilities.Log("Videolytics getPageDataComplete");if(U(e,t)){TBUtilities.Log("Videolytics getPageDataComplete finished page data scrape");ye(e);he(e);O(e,t);Z(e,t);if(t=="primary"){var i=TBUtilities.GetCookie("tb-videolytics-saved-videoid-"+TBGlobal.CurrentChannelId());if(i){var n=G();n.find(".tb-videolytics-savevideo").attr("checked","checked");n.find(".tb-videolytics-savevideo").attr("checked","checked");n.find('input:radio[name="tb-videolytics-compareVid"]').filter('[value="3"]').attr("checked",true);n.find("#videolyticsVideoId").val(i);xe(i)}else{ue()}}else{ue()}}};var U=function(e,t){TBUtilities.Log("Videolytics isPageDataComplete");var i=false;switch(e.ui){case"studio":case"material":{if(e.html!=null&&e.commentCount!=null&&e.channelViews!=null&&e.tags!=null&&e.channelVideos!=null){i=true}else{var n="not populated";if(e.html!=null&&e.html.length>0){n="populated"}TBUtilities.Log("Videolytics html ="+n);TBUtilities.Log("Videolytics commentCount ="+e.commentCount);TBUtilities.Log("Videolytics channelViews ="+e.channelViews);TBUtilities.Log("Videolytics tags ="+e.tags)}break}case"default":{if(e.html!=null&&e.commentCount!=null&&e.tags!=null&&e.channelVideos!=null&&e.channelViews!=null&&e.subscribers!=null){i=true}break}}TBUtilities.Log(i);return i};var L=function(e,t){var i="https://www.youtube.com/insight_ajax?action_get_statistics_and_data=1&v="+e.videoId;var n={session_token:e.sessionToken};var o=jQuery.param(n);TBExtension.Post(i,o,function(i,n,o){try{if(i){e.statsData=o}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getVideoGraphData",Data:n,Response:o});e.statsData="error"}C(e,t)}catch(t){e.statsData="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getVideoGraphData"})}},null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:null,headers:{"X-Youtube-Identity-Token":e.sessionToken}})};var C=function(e,t){try{if(e.statsData!="error"&&jQuery(e.statsData).find("html_content").text().indexOf("No statistics available yet.")==-1&&jQuery(e.statsData).find("html_content").text().indexOf("Public statistics have been disabled.")==-1){var i=jQuery(e.statsData).find("graph_data").text();i=i.replace("<![CDATA[","").replace("]]>","");e.chartsObj=jQuery.parseJSON(i)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery.parseHTML(DOMPurify.sanitize(jQuery(e.statsData).find("html_content").text(),DOMPurifyConfig));e.watchTimeAvgViewDuration=jQuery(n).find(".menu-metric-value").first().text()}catch(t){e.watchTimeAvgViewDuration="error";TBUtilities.Log(t)}ge(e);Te(e);ke(e);E(e,t)};var E=function(e,t){var i=G();if(t=="primary"){if(e.viewHistoricalData!=null&&e.viewHistoricalData!="error"&&e.viewHistoricalData.length>2&&(e.watchTimeAvgViewDuration!=null&&e.watchTimeAvgViewDuration!="error")&&(e.watchTimeAvgPercentWatched!=null&&e.watchTimeAvgPercentWatched!="error")){i.find("#tb-videolytics-watchtimecontainer").show();if(e.viewHistoricalData!=null&&e.viewHistoricalData.length>2&&e.viewHistoricalData!="error"){try{var n="#759DED";if(t=="secondary"){n="#F3C66F"}var a=i.find("[data-name='views-historical']");if(e.viewHistoricalData!=null){var s=a.highcharts();if(s){s.addSeries({name:"secondary",data:e.viewHistoricalData,color:n,type:"spline"},true);s.series[0].update({type:"spline"})}else{var s=a.highcharts({chart:{renderTo:"historicalChart",margin:[0,0,0,0],backgroundColor:"transparent"},title:{text:""},credits:{enabled:false},xAxis:{labels:{enabled:false}},yAxis:{maxPadding:0,minPadding:0,gridLineWidth:0,endOnTick:false,labels:{enabled:false}},legend:{enabled:false},tooltip:{enabled:false},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,n],[1,n]]},lineWidth:1,marker:{enabled:false},shadow:false,states:{hover:{lineWidth:1}},threshold:null},series:{enableMouseTracking:false,lineWidth:1,shadow:false,states:{hover:{lineWidth:1}},color:n,marker:{radius:0,states:{hover:{radius:2}}}}},series:[{type:"area",data:e.viewHistoricalData,name:"primary"}]})}}else{a.html(o)}}catch(e){TBUtilities.Log(e)}if(t!="secondary"){N(i,"views-historical",e.durationSincePublish,function(t){t.text(e.durationSincePublish)})}}else{i.find(".tb-videolytics-historical-block").hide()}try{var r="view-duration";if(_(i,r,t,e.watchTimeAvgViewDurationInMilliSeconds,e.watchTimeAvgViewDuration)){if(t=="primary"){N(i,r,e.videoDuration,function(t){t.text(e.videoDuration)})}else{te(r)}}}catch(e){TBUtilities.Log(e)}try{var r="percent-watched";if(_(i,r,t,e.watchTimeAvgPercentWatched,e.watchTimeAvgPercentWatchedFormatted)){if(t=="primary"){N(i,r,e.watchTimeAvgPercentWatched,function(t){var i=jQuery("#tb-videolytics-percentwatched-bar-template").html();var n=i.formatTemplate(e.watchTimeAvgPercentWatched,"na","tb-percentwatched-fill");t.append(n);t.parent().show();t.find(".tb-horizontal .tb-progress-fill-percentwatched span").each(function(){var e=jQuery(this).attr("data-percent");jQuery(this).parent().css("width",e+"%")})})}else{te(r)}}}catch(e){TBUtilities.Log(e)}}}};var S=function(e,t){TBUtilities.Log("Videolytics isBestPracticesComplete");var i=false;if(e.commentHearted!=null&&e.commentPinned!=null&&e.infoCardsExist!=null&&e.endScreenExist!=null&&e.highResThumbnailExist!=null&&e.sharedOnTwitter!=null&&e.likedOnFacebook!=null){i=true}else{TBUtilities.Log("Videolytics isBestPracticesComplete commentPinned ="+e.commentPinned);TBUtilities.Log("Videolytics isBestPracticesComplete commentHearted ="+e.commentHearted);TBUtilities.Log("Videolytics isBestPracticesComplete infoCardsExist ="+e.infoCardsExist);TBUtilities.Log("Videolytics isBestPracticesComplete endScreenExist ="+e.endScreenExist);TBUtilities.Log("Videolytics isBestPracticesComplete highResThumbnailExist ="+e.highResThumbnailExist);TBUtilities.Log("Videolytics isBestPracticesComplete sharedOnTwitter ="+e.sharedOnTwitter);TBUtilities.Log("Videolytics isBestPracticesComplete likedOnFacebook ="+e.likedOnFacebook)}return i};var I=function(e,t){TBUtilities.Log("Videolytics isSocialComplete");var i=false;if(e.facebookLikeCount!=null&&e.redditResults!=null&&e.sharedOnTwitterCount!=null){i=true}else{TBUtilities.Log("Videolytics isSocialComplete facebookLikeCount ="+e.facebookLikeCount);TBUtilities.Log("Videolytics isSocialComplete redditResults ="+e.redditResults);TBUtilities.Log("Videolytics isSocialComplete sharedOnTwitterCount ="+e.sharedOnTwitterCount)}return i};var A=function(){var e=G();if(e.find(".tb-videolytics-container-non-english").length==0){jQuery("#player-ads").after(jQuery(".tb-videolytics-container-non-english")[0].outerHTML);jQuery(".tb-videolytics-container").hide()}};var G=function(){var e=jQuery("#"+R());return e};var R=function(){var e=TBGlobal.GetYouTubeUI();var t="";switch(e){case"studio":case"material":{t="related";break}case"default":{t="watch7-sidebar";break}}return t};var V=function(e,t,i){var n="https://www.youtube.com/channel/"+t+"/about";TBExtension.Get(n,function(t,n,o){try{if(t){e.channelAboutHtml=o}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getChannelAboutPageData",Data:n,Response:o});e.channelAboutHtml="error"}M(e,i)}catch(t){e.channelAboutHtml="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getChannelAboutPageData"})}},null,{dataType:null})};var D=function(e,t,i){var n="UU"+t.substr(2);var o="https://www.youtube.com/playlist?list="+n+"&playnext=1&index=1";TBExtension.Get(o,function(t,n,o){try{if(t){try{var a=TBUtilities.ParseResponseContextFromHtml(o);var s=a.contents.twoColumnWatchNextResults.playlist.playlist.totalVideos;var r=parseInt(s);e.channelVideos=r;e.channelVideosFormatted=TBUtilities.FormatNumberAbbreviated(e.channelVideos)}catch(t){e.channelVideos="error";x(e,i);e.channelVideos="error"}x(e,i)}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getChannelVideoCount",Data:n,Response:o})}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getChannelVideoCount"})}},null,{dataType:null})};var M=function(e,t){var i=TBGlobal.GetYouTubeUIFromHtml(e.channelAboutHtml);switch(i){case"studio":case"material":{try{var n=TBUtilities.ParseResponseContextFromHtml(e.channelAboutHtml);var o=null;jQuery.each(n.contents.twoColumnBrowseResultsRenderer.tabs,function(e,t){if(t.tabRenderer&&t.tabRenderer.endpoint.commandMetadata.webCommandMetadata.url.indexOf("about")!=-1){o=t;return true}});var a="";if(o.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.runs){a=o.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.runs["0"].text}else if(o.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.simpleText){a=o.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.simpleText}var s=a.match(/\d/g);s=s.join("");e.channelViews=s;e.channelViewsFormatted=TBUtilities.FormatNumberAbbreviated(e.channelViews,null,"tb-videolytics-abbrev");var r="";try{r=n.header.c4TabbedHeaderRenderer.subscribeButton.subscribeButtonRenderer.subscriberCountText.simpleText}catch{try{r=n.header.c4TabbedHeaderRenderer.subscriberCountText.runs[0].text;if(r.indexOf(" ")>0){r=r.substring(0,r.indexOf(" "))}}catch{}}if(r===""){e.subscribers="error";e.subscribersFormatted="error"}else{e.subscribersFormatted=r;e.subscribers=0}}catch(t){TBUtilities.Log(t);e.channelViews="error";e.subscribers="error";e.subscribersFormatted="error"}x(e,t);break}case"default":{var l=jQuery.parseHTML(DOMPurify.sanitize(e.channelAboutHtml,DOMPurifyConfig));var d=jQuery(l).find(".about-stat").length;if(d==2){e.subscribers="error";e.subscribersFormatted="error"}jQuery(l).find(".about-stat").each(function(t){try{var i=jQuery(this).html();var n=i.match(/\d/g);n=n.join("");if(d==3){if(t==0){e.subscribers=n;e.subscribersFormatted=TBUtilities.FormatNumberAbbreviated(e.subscribers,null,"tb-videolytics-abbrev")}else if(t==1){e.channelViews=n;e.channelViewsFormatted=TBUtilities.FormatNumberAbbreviated(e.channelViews,null,"tb-videolytics-abbrev")}else if(t==2){var o=i.indexOf(" ");var a=i.substring(o,i.length)}}else if(d==2){if(t==0){e.channelViews=n;e.channelViewsFormatted=TBUtilities.FormatNumberAbbreviated(e.channelViews,null,"tb-videolytics-abbrev")}else if(t==1){var o=i.indexOf(" ");var a=i.substring(o,i.length)}}}catch(e){TBUtilities.Log(e)}});x(e,t);break}}};var P=function(e,t,i){return e.split(t,i).join(t).length};var F=function(){var e=TBGlobal.host+"/ModuleManager/videolytics/videolytics?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/videolytics.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/videolytics.html"}TBExtension.Get(e,"CRTBLoadVideolyticsTemplate")};var O=function(e,t){var i=G();i.find(".tb-videolytics-vid-compare[data-videoid='"+e.videoId+"']").attr("title",e.title);try{var n="views";if(_(i,n,t,e.views,e.viewsFormatted)){if(t!="primary"){te(n)}}}catch(e){TBUtilities.Log(e)}try{var n="likeratio";var o=i.find("[data-name='likeratio'][data-type='"+t+"']");var a=e.likes+e.dislikes;var s=TBUtilities.FormatNumberAbbreviated(a,null,null);o.prop("data-value",a);o.prop("data-formatted",s);o.find(".up").text(e.likesFormatted);o.find(".down").text(e.dislikesFormatted);if(t!="primary"){te(n)}}catch(e){TBUtilities.Log(e)}try{var n="comments";if(_(i,n,t,e.commentCount,e.commentCountFormatted)){if(t!="primary"){te(n)}}}catch(e){TBUtilities.Log(e)}try{var n="creatorsuggested";if(_(i,n,t,e.creatorSuggestedCount,e.creatorSuggestedFormatted)){if(t!="primary"){}}if(e.creatorSuggestedCount=="na"){i.find(".tb-creatorsuggested-container").hide()}}catch(e){TBUtilities.Log(e)}try{var n="tagsin";var r=i.find("[data-name='tagsin'][data-type='"+t+"']");if(_(i,n,t,e.tagsIn,e.tagsIn,null,e.tagsInScore)){if(e.tagsIn==1){jQuery(".tb-videolytics-s").hide()}if(t!="primary"){te(n)}}if(e.tagsIn=="na"){i.find(".tb-tagsin-container").hide()}}catch(e){TBUtilities.Log(e)}try{if(e.tags.length==1&&e.tags[0]==""){e.tags=[]}if(e.tags.length>0){var d=i.find(".tb-videolytics-tags-body[data-type='"+t+"']");d.attr("data-videoid",e.videoId);d.attr("data-type",t);var c=i.find(".tb-videolytics-compare-tags-label[data-type='"+t+"']");c.text("for "+H(e.title,40));i.find(".tb-videolytics-tags-body[data-type='"+t+"']").empty();var u=jQuery("#tb-videolytics-tags-template").html();jQuery.each(e.tags,function(e,n){if(n!=""){var o=u.formatTemplate(n,escape(n.toLowerCase()));i.find(".tb-videolytics-tags-body[data-type='"+t+"']").append(o);i.find(".tb-videolytics-compare-tags[data-type='"+t+"']").show();if(t=="secondary"){var a=i.find(".tb-videolytics-tag[data-tag='"+escape(n.toLowerCase())+"']");if(a&&a.length>1){a.addClass("tb-videolytics-tag-duplicate")}jQuery(".tb-videolytics-compare-tags-label").show()}}});i.find(".tb-videolytics-copy-tags[data-type='"+t+"']").show();J(e.tags,t);if(b==true){i.find(".tb-videolytics-search-ranking[data-type='"+t+"']").hide();Y(e.videoId,e.tags,t);i.find(".tb-videolytics-loading-tag-rankings").show();i.find(".tb-videolytics-loading-tag-rankings-legend").hide()}else{i.find(".tb-videolytics-search-ranking[data-type='"+t+"']").show();$rankedTags=i.find("[data-name='rankedTags'][data-type='"+t+"']");$rankedTags.html('<span class="tb-videolytics-search-ranking-text" style="font-size:11px;opacity:0.5; cursor:pointer;">(click to load)</span>');i.find(".tb-videolytics-loading-tag-rankings").hide();var d=i.find(".tb-videolytics-tags-body[data-type='"+t+"']");d.attr("data-videoid",e.videoId);d.attr("data-type",t)}}else{var d=i.find(".tb-videolytics-tags-body[data-type='"+t+"']");d.attr("data-videoid",e.videoId);d.attr("data-type",t);l[e.videoId]=0;z(e.videoId);i.find(".tb-videolytics-copy-tags").hide();i.find(".tb-videolytics-tags-body").append('<span style="opacity:.7;font-size:11px">No Tags</span>');i.find(".tb-videolytics-loading-tag-rankings-legend").hide()}}catch(e){TBUtilities.Log(e)}try{var c=i.find(".tb-videolytics-image-compare-title[data-type='"+t+"']");c.text(H(e.title,29))}catch(e){TBUtilities.Log(e)}var p="";try{var y=moment(new Date);var m=moment.duration(y.diff(e.videoPublishDate));var h=parseInt(m.asDays().toFixed(0));if(h<=2){p='<div style="border-top:dashed 1px #ccc; padding:2px 0; margin:2px 0;"><span style="font-weight:500">NOTE:</span> Because this video is so new, these stats may change drastically over the few days.</div>'}}catch(e){}me("tt-total-views","Total Views","Total lifetime number of views that this video has received","How this video's view count comparies to the average video on this channel. Please note that new uploads generally have a small or negative value because they haven't been live as long as other videos on the channel"+p);me("tt-estimated-earnings","Estimated Earnings","An estimation for how much money this video has earned through AdSense based on a $1.50 USD per 1,000 ad views","The amount of money earned through AdSense varies widely based on a number of factors. This range gives you a better idea of the min/max the video is likely to earn through AdSense. (min $0.25 / max $4.00 USD per 1,000 views)");me("tt-engagement-rate","Engagement Rate","How often viewers are commenting, liking or disliking this video: (Comments + Likes + Dislikes) / Views ","TubeBuddy's rating of this value");me("tt-views-per-hour","Views Per Hour","How many views this video gets every hour on average","How many views this video gets every day on average");me("tt-percent-channel-views","Percent of Channel Views","What percent of the channel's total views this video accounts for","How many total uploads this channel has");me("tt-views-to-sub-ratio","Views to Subscribers Ratio","How many views this video has received compared to how many subscribers the channel has","The calculation used to get the main value in this area above"+p);me("tt-views-first-48-hours","Views in First 48 Hours","How many views this video got during the first 48 hours after being published","What percentage of the video's total views came during the first 48 hours"+p);me("tt-historical","Historical Views","Area chart showing views gained over time","How long ago the video was published");me("tt-average-view-duration","Average View Duration","How long the average viewer watches this video (Minutes:Seconds)","Total duration of video (Minutes:Seconds)");me("tt-average-percent-watched","Average Percentage Watched","What percentage of the video the average viewer watches","Line to help visually show how much of the video is watched");me("tt-days-watched","Cumulative Time Watched","If you add up all the watch time of everyone who has watched this video, this is how much time it is","Cumulative time per day on average");me("tt-like-ratio","Like Ratio","What percentage of viewers Liked the video versus Disliked it","Actual number of Likes and Dislikes");me("tt-comments","Comments","How many Comments this video has received","How many views per single comment on average");me("tt-engagements-per-day","Engagements Per Day","How many comments, likes and dislikes this video gets per day","How many lifetime engagements this video has received (comments + likes + dislikes)");me("tt-subscribers-gained","Subscribers Gained","How many subscribers the channel has gained from this video","How many views per new subscriber gained from this video");me("tt-creator-suggested","Creator Suggested","How many of the 'Suggested' videos shown at the end of the video are from the same channel as the video you are watching","TubeBuddy's rating of this value");me("tt-tags-in-title","Tags in Title/Description","How many of this video's tags also appear in the video's title or description","TubeBuddy's rating of this value");me("tt-ranked-tags","Rankged Tags","If you do a search for each of this video's tags, this number shows how many time this video shows up on the first page of search results for the tags","TubeBuddy's rating of this value");me("tt-channel-views","Lifetime Channel Views","Total number of views for this channel all time","Average number of views per video for this channel");me("tt-channel-subscribers","Lifetime Channel Subscribers","Total number of subscribers for this channel all time","How many subscribers are gained by this channel each day on average");me("tt-channel-videocount","Videos","Total number of videos this channel has published","The average number of videos per week this channel has published")};var _=function(e,t,i,n,o,a,s){var r=false;var l=e.find("[data-name='"+t+"'][data-type='"+i+"']");if(q(n,l)){if(s){var d=ie(s);l.html('<span class="'+d+'">'+o+"</span>")}else{l.html(o)}l.prop("data-value",n);if(a){l.prop("data-formatted",a)}else{l.prop("data-formatted",o)}r=true}return r};var N=function(e,t,i,n){var o=e.find("[data-name='"+t+"'][data-type='subitem']");if($(i,o)){try{n(o)}catch(e){TBUtilities.Log(e)}}};var H=function(e,t){return e.length>t?e.substring(0,t-3)+"...":e};var Y=function(e,t,i){TBUtilities.Log("loadSearchRankings");TBUtilities.Log("videoId = "+e);TBUtilities.Log("tag count = "+t.length);var n=r[e];var o=false;try{var s=moment.utc().diff(n.videoPublishDate,"hours");if(s<=72){o=true}}catch(e){console.log(e)}c=0;if(t.length>0){$watchSideBar=G();$watchSideBar.find(".tb-videolytics-loading-tag-rankings").show();if(a[e]==null){a[e]=[]}a[e]=t;var l=0;jQuery.each(t,function(t,i){setTimeout(function(){TubeBuddyYouTubeActions.GetVideoSearchRank(e,i,W,1,null,o)},l);l+=50})}};var W=function(e,t,i){try{c++;TBUtilities.Log("gotSearchRank searchTerm = "+t+" rank= "+i);if(l[e]==null){l[e]=0}if(i>0){var n=l[e];l[e]=n+1;TBUtilities.Log("Rank count = "+l[e]);X(e,t,i)}if(c>=a[e].length){TBUtilities.Log("done with search rank check");z(e)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] gotSearchRank"})}};var z=function(e){jQuery("#tb-videolytics-loading-tag-rankings-legend").show();jQuery("#tb-videolytics-loading-tag-rankings").hide();if(TBGlobal.Profile().IncognitoSearch==true)jQuery("#tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://www.tubebuddy.com/channel/preferences/'+TBGlobal.CurrentChannelId()+'?change=rank" target="_blank">Incognito Mode</a>)');else jQuery("#tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://www.tubebuddy.com/channel/preferences/'+TBGlobal.CurrentChannelId()+'?change=rank" target="_blank">For You</a>)');var t=G();var i=jQuery(".tb-videolytics-tags-body[data-videoid='"+e+"']");var n=i.attr("data-type");t.find(".tb-videolytics-loading-tag-rankings").hide();t.find(".tb-videolytics-loading-tag-rankings-legend").show();if(TBGlobal.Profile().IncognitoSearch==true)t.find(".tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://www.tubebuddy.com/channel/preferences/'+TBGlobal.CurrentChannelId()+'?change=rank" target="_blank">* Incognito Mode</a>)');else t.find(".tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://www.tubebuddy.com/channel/preferences/'+TBGlobal.CurrentChannelId()+'?change=rank" target="_blank">* For You</a>)');var o=t.find("[data-name='rankedTags'][data-type='"+n+"']");o.prop("data-value",l[e]);o.prop("data-formatted",l[e]);if(n=="secondary"){}else{try{var a=1;var s=l[e];if(s>8){a=5}else if(s>6){a=4}else if(s<=6&&s>4){a=3}else if(s<=4&&s>=2){a=2}else if(s<2){a=1}var r=ie(a);o.html('<span class="'+r+'">'+l[e]+"</span>");var d=t.find("[data-name='rankedTags'][data-type='subitem']");if($(a,d)){try{var c=ne(a);d.find("span").text(c)}catch(e){TBUtilities.Log(e)}}}catch(e){TBUtilities.Log(e)}}};var X=function(e,t,i){var n=t.toLowerCase();if(t.indexOf("(")>0){n=t.substring(0,t.indexOf("("))}var o=jQuery(".tb-videolytics-tags-body[data-videoid='"+e+"']");var a=o.find(".tb-videolytics-tag[data-tag='"+escape(n)+"']");if(a&&a.find(".tb-videolytics-tag-rank").length==0){a.append('&nbsp;&nbsp;<span class="tb-videolytics-tag-rank" style="opacity: .75;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">'+i+"</span>&nbsp;")}else{TBUtilities.Log("addSearchRankToTag tag not found found")}};var J=function(e,t){var i=G();i.find(".tb-videolytics-copy-tags[data-type='"+t+"']").attr("data-tags-list",e.join(", "))};var q=function(e,t){var i=false;if(o==null){o=jQuery("#tb-videolytics-na-template").html()}if(e!=null&&e!="error"&&isNaN(e)==false&&isFinite(e)==true){i=true}else{t.html(o);i=false}return i};var $=function(e,t){var i=false;if(e!=null&&e!="error"&&(isNaN(e)==false||e.length>0)){t.parent().show();i=true}else{t.parent().hide();i=false}return i};var Z=function(e,i){var n=G();var o='<span class="tb-font-size9" style="opacity:0.5">same channel</span>';try{var a="channel-views";if(_(n,a,i,e.channelViews,e.channelViewsFormatted)){if(i!="primary"){if(e.channelId==t){}else{te(a)}}}}catch(e){TBUtilities.Log(e)}try{var a="subscribers";if(e.subscribersFormatted!="error"&&e.subscribers=="error"){e.subscribers=0}if(_(n,a,i,e.subscribers,e.subscribersFormatted)){if(i!="primary"){if(e.channelId==t){}else{te(a)}}}}catch(e){TBUtilities.Log(e)}try{var a="videocount";if(_(n,a,i,e.channelVideos,e.channelVideosFormatted)){if(i!="primary"){if(e.channelId==t){}else{te(a)}}}}catch(e){TBUtilities.Log(e)}};var K=function(e,t){var i=G();i.find(".tb-videolytics-best-practices-loading").hide();i.find(".tb-videolytics-video-bestpractices").show();try{var n=jQuery(".tb-videolytics-best-practice-pinned-comment");if(e.commentPinned===true){n.html(y)}else if(e.commentPinned===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-hearted-comment");if(e.commentHearted===true){n.html(y)}else if(e.commentHearted===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-info-cards");if(e.infoCardsExist===true){n.html(y)}else if(e.infoCardsExist===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-endscreens");if(e.endScreenExist===true){n.html(y)}else if(e.endScreenExist===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-thumbnail");if(e.highResThumbnailExist===true){n.html(y)}else if(e.highResThumbnailExist===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-twitter");if(e.sharedOnTwitter===true){n.html(y)}else if(e.sharedOnTwitter===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-facebook");if(e.likedOnFacebook===true){n.html(y)}else if(e.likedOnFacebook===false){n.html(m)}else{n.html(h)}}catch(e){TBUtilities.Log(e)}try{var n=jQuery(".tb-videolytics-best-practice-captions");n.parent().attr("title","");if(e.captionsExist===true){n.html(y)}else if(e.captionsExist===false){n.html(m)}else{n.html(h);n.parent().attr("title","Captions check failed.  This could be due to an adblocker.")}}catch(e){TBUtilities.Log(e)}};var ee=function(e,t){var i=G();i.find(".tb-videolytics-social-loading").hide();i.find(".tb-videolytics-video-social").show();try{var n="facebooklikes";if(_(i,n,t,e.facebookLikeCount,e.facebookLikeCountFormatted)){if(t!="primary"){te(n)}}}catch(e){TBUtilities.Log(e)}try{var n="redditup";if(_(i,n,t,e.redditUps,e.redditUpsFormatted)){if(t!="primary"){te(n)}else{i.find(".tb-reddit-search").attr("href",e.redditSearchUrl)}}}catch(e){TBUtilities.Log(e)}try{var n="twitter";if(_(i,n,t,e.sharedOnTwitterCount,e.sharedOnTwitterFormatted)){if(t!="primary"){te(n)}else{i.find(".tb-twitter-search").attr("href",e.twitterUrl)}}}catch(e){TBUtilities.Log(e)}};var te=function(e){var t=G();t.find(".tb-videolytics-category-container-seo").hide();var i=parseFloat(t.find("[data-name='"+e+"'][data-type='primary']").prop("data-value"));var n=t.find("[data-name='"+e+"'][data-type='primary']").prop("data-formatted").toString();var o=parseFloat(t.find("[data-name='"+e+"'][data-type='secondary']").prop("data-value"));var a=t.find("[data-name='"+e+"'][data-type='secondary']").prop("data-formatted").toString();n=TBUtilities.ReplaceAll(n,"tb-videolytics-abbrev","");a=TBUtilities.ReplaceAll(a,"tb-videolytics-abbrev","");var s=false;var r=0;if(o>i){r=i/o*100}else if(o<i){s=true;r=o/i*100}else{s=true;r=100}if(r<=1){r=2}t.find(".tb-"+e+"-container").hide();var l="."+e+"-compare-chart-progress";var d=t.find(l);d.parent().show();if(d.find(".tb-progress-fill-primary").length==0){var c=jQuery("#tb-videolytics-bar-template").html();if(s){var u=c.formatTemplate(100,n,"tb-progress-fill-primary",i);d.append(u)}else{var u=c.formatTemplate(r,n,"tb-progress-fill-primary",i);d.append(u)}}if(d.find(".tb-progress-fill-secondary").length==0){if(s){var u=c.formatTemplate(r,a,"tb-progress-fill-secondary",o);d.append(u)}else{var u=c.formatTemplate(100,a,"tb-progress-fill-secondary",o);d.append(u)}}d.find(".tb-horizontal .tb-progress-fill span").each(function(){var e=jQuery(this).attr("data-percent");jQuery(this).parent().css("width",e+"%")})};var ie=function(e){var t="na";switch(e){case 1:{t="tb-videolytics-score1";break}case 2:{t="tb-videolytics-score2";break}case 3:{t="tb-videolytics-score3";break}case 4:{t="tb-videolytics-score4";break}case 5:{t="tb-videolytics-score5";break}}return t};var ne=function(e){var t="na";switch(e){case 1:{t="Very Poor";break}case 2:{t="Poor";break}case 3:{t="Fair";break}case 4:{t="Good";break}case 5:{t="Awesome!";break}}return t};var oe=function(e){var t={Enabled:e};TBUtilities.Log(t);var i=TBGlobal.host+TBGlobal.apiUrls.videoLyticsToggle;TBExtension.Post(i,JSON.stringify(t),"",null,{contentType:"application/json"})};var ae=function(){var e=G();e.find(".tb-compare-chart").hide();e.find(".tb-primary-container").show();e.find(".tb-videolytics-compare-text-edit").hide();e.find(".tb-videolytics-video-bestpractices-container").show();e.find("#videolyticsVideoId").val("");e.find(".tb-videolyticsClear").hide();TBUtilities.RemoveCookie("tb-videolytics-saved-videoid-"+TBGlobal.CurrentChannelId());e.find(".tb-videolytics-category-container-seo").show();try{var t=e.find("[data-name='views-historical']");var i=t.highcharts();var n=i.series.length;for(var o=n-1;o>-1;o--){if(i.series[o].name=="secondary")i.series[o].remove()}i.series[0].update({type:"area"});i.redraw()}catch(e){TBUtilities.Log(e)}e.find(".tb-videolytics-image-compare-container").hide();var a=e.find(".tb-videolytics-compare-tags[data-type='secondary']");a.hide();a.find(".tb-videolytics-tags-body").empty();e.find(".tb-videolytics-copy-tags[data-type='secondary']").hide();e.find(".tb-videolytics-compare-tags-label").show();e.find(".tb-videolytics-tag-duplicate").removeClass("tb-videolytics-tag-duplicate");e.find(".tb-videolytics-bar").remove();e.find(".tb-videolytics-compare-text").show()};var se=function(){jQuery(document).on("click",".tb-videolytics-tag",function(){var e=unescape(jQuery(this).attr("data-tag"));TubeBuddyTagExplorer.ShowTagExplorer(e)});jQuery(document).on("click",".tb-videolytics-chart",function(){var e=null;var i=null;switch(TBGlobal.GetYouTubeUI()){case"studio":case"material":{var e="";jQuery(".ytd-video-owner-renderer").each(function(){e=jQuery(this).find("a:first").text();if(e!=""){return false}});i=jQuery("#avatar").find("img:first").attr("src");break}case"default":{e=jQuery("#watch7-user-header").find("a:first").text;i=jQuery("#watch7-user-header").find("img:first").attr("src");break}}if(t&&e&&i){TubeBuddyChannelytics.ShowForChannel(t,e,i)}});jQuery(document).on("click",".tb-videolytics-compare-text-edit",function(){be()});jQuery(document).on("click",".tb-videolytics-enabled-img",function(){TBGlobal.Profile().SettingsShowVideolytics=true;oe(true);f(false)});jQuery(document).on("click",".tb-videolytics-non-english-load",function(){var e=G();var t=e.find(".tb-videolytics-container-non-english");if(t.length>0){t.remove()}f(false,true)});jQuery(document).on("click",".tb-videolytics-disable-img",function(){var e=jQuery(this);newSrc=e.attr("data-toggle-img");e.attr("data-toggle-img",e.attr("src"));e.attr("src",newSrc);var t=G();var i=t.find(".tb-videolytics-container");if(i.is(":visible")){i.slideUp();oe(false);TBGlobal.Profile().SettingsShowVideolytics=false;t.find(".tb-videolytics-compare-show").hide();i.hide();if(t.find(".tb-videolytics-container-disabled").length==0){switch(TBGlobal.GetYouTubeUI()){case"studio":case"material":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0)jQuery("#player-ads").after(jQuery(".tb-videolytics-container-disabled")[0].outerHTML);break}case"default":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0)t.prepend(jQuery(".tb-videolytics-container-disabled")[0].outerHTML);break}}}else{if(jQuery(".tb-videolytics-container-disabled:visible").length==0)t.find(".tb-videolytics-container-disabled").show()}}else{t.find(".tb-videolytics-container-disabled").hide();i.slideDown();oe(true);TBGlobal.Profile().SettingsShowVideolytics=true;t.find(".tb-videolytics-compare-show").show()}});jQuery(document).on("click",".tb-videolytics-search",function(){var e="https://www.youtube.com/";var t=window.open(e,"_blank")});jQuery(document).on("click",".tb-videolytics-toggle-row",function(){var e=jQuery(this);newSrc=e.attr("data-toggle-img");e.attr("data-toggle-img",e.attr("src"));e.attr("src",newSrc);var t=G();var i=e.attr("data-category-id");var n=t.find(".tb-videolytics-category-body[data-category-id='"+i+"']");if(n.is(":visible")){n.slideUp();re(i)}else{n.slideDown();le(i)}});jQuery(document).on("click",".tb-videolytics-search-ranking",function(){jQuery(this).hide();var e=G();var t=jQuery(this).parent().siblings(".tb-videolytics-tags-body");var i=t.attr("data-videoid");var n=t.attr("data-type");var o=[];t.find(".tb-videolytics-tag").each(function(e){var t=jQuery(this).attr("data-tag");o.push(unescape(t))});Y(i,o,n)});jQuery(document).on("click",".tb-videolytics-search-ranking-text",function(){jQuery(this).text("Loading...");var e=G();b=true;e.find(".tb-videolytics-search-ranking:first").click()});jQuery(document).on("click",".tb-videolytics-copy-tags",function(e){e.stopPropagation();if(TBExtension.GetType()=="crossrider"){window.prompt("Top copy Tags to your clipboard, Press Ctrl+C then Enter",jQuery(this).attr("data-clipboard-text"));e.stopPropagation()}else{var t=jQuery(this).attr("data-tags-list");if(t){var i=t.split(",");TubeBuddyCopyTo.ShowMenu(jQuery(this),i)}}});jQuery(document).on("click",".tb-videolytics-compare-show",function(){be()});jQuery(document).on("click",".tb-videolyticsCancel",function(){be()});jQuery(document).on("click",".tb-videolyticsClear",function(){ae();if(jQuery(".tb-videolytics-compare-container").is(":visible")){be()}});jQuery(document).on("click",".tb-videolyticsCompare",function(){TBUtilities.Log("Videolytics .videolyticsCompare click");var e=jQuery("input[name=tb-videolytics-compareVid]:checked").val();if((e==1||e==2)&&TBGlobal.CanAccessLevel1Tools()==false){TBGlobal.ShowUpgradePage("use this option","Pro");return}switch(e){case"0":case"1":case"2":{ce();var i=TBGlobal.host+TBGlobal.apiUrls.videolyticsGetVideoToCompare+"?type="+e+"&channelId="+t;TBExtension.Get(i,"CRTBVideolyticsGetVideoToCompare");break}case"3":{var n=jQuery("#watch7-sidebar");n.find(".tb-videolytics-compareVid-error-container").hide();var o=jQuery("#videolyticsVideoId").val().trim();var a=null;if(o.length==11){a=o}else{var s=/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var r=o.match(s);if(r&&r[2].length==11){a=r[2]}else{n.find(".tb-videolytics-compareVid-error-container").show();n.find(".tb-videolytics-compareVid-error").text("Invalid video URL")}}if(a!=null){ce();xe(a)}break}}be()});jQuery(document).on("click",".tb-videolytics-tools-menu-button",function(e){e.stopPropagation();var t=jQuery(this).offset();var i=jQuery(".tb-videolyitcs-tools-menu");i.css({position:"absolute",top:t.top+25+"px",left:t.left-5+"px",zIndex:4e3});i.show()});jQuery(document).bind("click",function(e){var t=jQuery(e.target);if(!t.parents().hasClass("tb-videolyitcs-tools-menu")){jQuery(".tb-videolyitcs-tools-menu").hide()}});jQuery(document).on("click",".tb-videolytics-tools-button",function(){var e=jQuery(this).attr("data-tool");var i=t!=TBGlobal.CurrentChannelId();var o=document.getElementsByTagName("title")[0].innerHTML.replace("- YouTube","");var a="https://img.youtube.com/vi/"+n+"/0.jpg";TubeBuddyMenu.ShowBackgroundSticky();switch(e){case"social-monitor":TubeBuddySocialMonitor.Show(n,o,a,i);break;case"advanced-embed":TubeBuddyEmbed.ShowForVideo(n,o,a);break;case"search-rank":TubeBuddySearchRanking.Show(n,a,o);break;case"share-tracker":TubeBuddyShareTracker.ShowForVideo(n,o,a);break;case"vid2vid-promotion":TubeBuddyV2VPromote.Show(n,o,a,i);break;case"gif-generator":TubeBuddyGifGenerator.Show(n,o,a,i);break}jQuery(".tb-videolyitcs-tools-menu").hide()});jQuery(document).on("click","#tb-videolytics-word-cloud-btn",function(e){var t="";var i="";var n=TBGlobal.CurrentChannelId();var o=0;jQuery("div#contents").find("ytd-comment-thread-renderer.ytd-item-section-renderer").each(function(){i=jQuery(this).find("div#header-author a#author-text").attr("href");if(i=="/channel/"+n){return}else{t+=jQuery(this).find("yt-formatted-string#content-text").text()}o=o+1;TBUtilities.Log("Comment #"+o+" - This comment channel's Id is: "+i)});TBGlobal.ShowWordCloud(t)})};var re=function(e){e=e.trim();var t=[];var i=TBUtilities.GetCookie("tb-videolytics-category-hide");if(i){t=JSON.parse(i);if(jQuery.inArray(e,t)==-1){t.push(e)}}else{t.push(e)}if(t.length>0){var n=JSON.stringify(t);TBUtilities.CreateCookie("tb-videolytics-category-hide",n,5e3)}};var le=function(e){e=e.trim();var t=[];var i=TBUtilities.GetCookie("tb-videolytics-category-hide");if(i){t=JSON.parse(i);var n=t.indexOf(e);if(n>-1){t.splice(n,1)}}if(t.length>0){var o=JSON.stringify(t);TBUtilities.CreateCookie("tb-videolytics-category-hide",o,5e3)}else{TBUtilities.RemoveCookie("tb-videolytics-category-hide")}};var de=function(){var e=TBUtilities.GetCookie("tb-videolytics-category-hide");if(e){var t=[];t=JSON.parse(e);var i=G();jQuery.each(t,function(e,t){var n=i.find(".tb-videolytics-category-body[data-category-id='"+t+"']");n.slideUp();var o=i.find(".tb-videolytics-toggle-row[data-category-id='"+t+"']");var a=o.attr("data-toggle-img");o.attr("data-toggle-img",o.attr("src"));o.attr("src",a)})}};var ce=function(e){var t=G();var i='<div class="tb-spinner"></div>'+'<span class="tb-move-up2" style="margin-left:10px; color: '+(TBGlobal.IsDarkMode()?"white":"black")+' !important; font-size: 130%">Loading...</span>';t.find(".tb-videolytics-container").block({message:i,css:{padding:"30px 20px;",backgroundColor:"transparent",border:"none"},overlayCSS:{backgroundColor:TBGlobal.IsDarkMode()?"rgb(2,2,2)":"rgb(255,255,255)",opacity:.8,cursor:"unavailable"}});t.find(".tb-videolytics-container-loading").show()};var ue=function(e){var t=G();t.find(".tb-videolytics-container").unblock();t.find(".tb-videolytics-container-body").show();t.find(".tb-videolytics-container-loading").hide()};var pe=function(e){var t=G();t.find(".tb-videolyticsClear").show();t.find(".tb-videolytics-image-compare-primary").prop("src","https://img.youtube.com/vi/"+n+"/mqdefault.jpg");t.find(".tb-videolytics-image-compare-primary").parent().attr("data-videoid",n);t.find(".tb-videolytics-image-compare-secondary").prop("src","https://img.youtube.com/vi/"+e+"/mqdefault.jpg");t.find(".tb-videolytics-image-compare-secondary").parent().attr("data-videoid",e);t.find(".tb-videolytics-image-compare-secondary").prop("data-videoid",e);t.find(".tb-videolytics-image-compare-secondary-link").prop("href","https://www.youtube.com/watch?v="+e);t.find(".tb-videolytics-compare-text").hide();t.find(".tb-videolytics-compare-text-edit").show();t.find(".tb-videolytics-image-compare-container").show()};var be=function(){var e=G();var t=jQuery(".tb-videolytics-compare-show-img"),i=t.attr("data-toggle-img");t.attr("data-toggle-img",t.attr("src"));t.attr("src",i);if(jQuery(".tb-videolytics-compare-container").is(":visible")){jQuery(".tb-videolytics-compare-container").slideUp("fast");if(jQuery(".tb-videolytics-compare-text-edit").is(":visible")==false){e.find(".tb-videolytics-compare-text").show()}}else{jQuery(".tb-videolytics-compare-container").slideDown("fast");e.find(".tb-videolytics-compare-text").hide()}};var ye=function(e){TBUtilities.Log("parseDataFromPage");var i=TBGlobal.GetYouTubeUIFromHtml(e.html);switch(i){case"studio":case"material":{e.responseContext=TBUtilities.ParseResponseContextFromHtml(e.html);e.creatorSuggestedCount=0;try{e.suggestedCount=e.responseContext.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results.length;jQuery(e.responseContext.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results).each(function(i,n){try{if(n.compactVideoRenderer){if(t==n.compactVideoRenderer.longBylineText.runs["0"].navigationEndpoint.browseEndpoint.browseId){e.creatorSuggestedCount++}}}catch(e){}})}catch(e){}var n=0;var o=1;if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0].videoPrimaryInfoRenderer){n=0}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1].videoPrimaryInfoRenderer){n=1}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2].videoPrimaryInfoRenderer){n=2}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3].videoPrimaryInfoRenderer){n=3}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0].videoSecondaryInfoRenderer){o=0}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1].videoSecondaryInfoRenderer){o=1}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2].videoSecondaryInfoRenderer){o=2}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3].videoSecondaryInfoRenderer){o=3}e.channelId=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.navigationEndpoint.browseEndpoint.browseId;e.title="";if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.title.simpleText){e.title=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.title.simpleText}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.title.runs){e.title=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.title.runs[0].text}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description.simpleText){e.description=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description.simpleText}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description.runs&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description.runs.length>0){var a="";try{jQuery.each(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.description.runs,function(e,t){a+=t.text})}catch(e){TBUtilities.Log(e)}e.description=a}else{e.description=""}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.viewCount){var s=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.viewCount.videoViewCountRenderer.viewCount.simpleText;var r=null;if(s)r=s.match(/\d/g);if(r==null){r=0}else{r=r.join("")}e.views=parseInt(r);e.viewsFormatted=TBUtilities.FormatNumberAbbreviated(e.views,null,"tb-videolytics-abbrev")}else{e.views="na";e.viewsFormatted="na"}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.dateText&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.dateText.simpleText){var l=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.dateText.simpleText;var d=new Date(l);e.videoPublishDate=moment(d)}else{var c=new Date;c.setDate(c.getDate()-3);e.videoPublishDate=moment(c)}var u=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons[0].toggleButtonRenderer.accessibility.label;var r=u.match(/\d/g);if(r==null){r=0}else{r=r.join("")}e.likes=parseInt(r);e.likesFormatted=TBUtilities.FormatNumberAbbreviated(e.likes);var p=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[n].videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons[1].toggleButtonRenderer.accessibility.label;var r=p.match(/\d/g);if(r==null){r=0}else{r=r.join("")}e.dislikes=parseInt(r);e.dislikesFormatted=TBUtilities.FormatNumberAbbreviated(e.dislikes);var b=jQuery("span.ytp-time-duration").text();var y=b.split(":");var m=0;var h=0;var f=0;if(y.length==3){m=jQuery.trim(y[0]);h=jQuery.trim(y[1]);f=jQuery.trim(y[2])}else if(y.length==2){h=jQuery.trim(y[0]);f=jQuery.trim(y[1])}else if(y.length==1){f=jQuery.trim(y[0])}var v=moment.duration({seconds:f,minutes:h,hours:m});e.durationInMilliseconds=v.valueOf();if(e.subscribers=="error"){try{var g=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[o].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.subscriberCountText.runs[0].text;var T=g.lastIndexOf(" ");g=g.substring(0,T);e.subscribersFormatted=g}catch(t){e.subscribers="error";e.subscribersFormatted="error"}}break}case"default":{e.$html=jQuery.parseHTML(DOMPurify.sanitize(e.html,DOMPurifyConfig));e.channelId=jQuery(e.$html).find("meta[itemprop=channelId]").attr("content");e.title=jQuery(e.$html).find("#eow-title").text();e.description=jQuery(e.$html).find("#eow-description").text();var s=jQuery(e.$html).find(".watch-view-count").html();var r=s.match(/\d/g);if(r==null){r=0}else{r=r.join("")}e.views=parseInt(r);e.viewsFormatted=TBUtilities.FormatNumberAbbreviated(e.views,null,"tb-videolytics-abbrev");var u=jQuery(e.$html).find("span.like-button-renderer:first").find(".like-button-renderer-like-button:first").find(".yt-uix-button-content:first").text();var r=u.match(/\d/g);if(r==null){r=0}else{r=r.join("")}e.likes=parseInt(r);e.likesFormatted=TBUtilities.FormatNumberAbbreviated(e.likes);var j=jQuery(e.$html).find("span.like-button-renderer:first").find(".like-button-renderer-dislike-button:first").find(".yt-uix-button-content:first").text();var r=j.match(/\d/g);if(r==null){r=0}else{r=r.join("")}e.dislikes=parseInt(r);e.dislikesFormatted=TBUtilities.FormatNumberAbbreviated(e.dislikes);var Q=jQuery(e.$html).find("meta[itemprop=datePublished]").attr("content");e.videoPublishDate=moment(Q);var B=jQuery(e.$html).find("meta[itemprop=duration]").attr("content");var k=moment.duration(B);e.durationInMilliseconds=k.valueOf();var w=jQuery(e.$html).find("#watch-related");e.creatorSuggestedCount="na";e.suggestedCount="na";break}}};var me=function(e,t,i,n){jQuery("#"+e).tipso({titleContent:t,size:"14px;",background:"#ddd",useTitle:false,color:"#222",tooltipHover:true,speed:200,titleColor:"#fff",titleBackground:"#454545",delay:750,hideDelay:0,content:"<div>"+i+'</div><div style="padding-top:6px; font-size:.9em; border-top:dashed 1px #bbb; margin-top:6px;">Sub Item: '+n+"</div>",position:"bottom",offsetY:10})};var he=function(e){fe(e);ve(e)};var fe=function(e){try{if(e.creatorSuggestedCount!="error"&&e.suggestedCount!="error"&&e.suggestedCount!=0){var t=1;var i=e.creatorSuggestedCount/e.suggestedCount*100;if(i>=65){t=5}else if(i>50){t=4}else if(i<=50&&i>20){t=3}else if(i<=20&&i>10){t=2}else if(i<=10){t=1}e.creatorSuggestedScore=t}}catch(t){TBUtilities.Log(t);e.creatorSuggestedScore="error"}try{var n=ie(e.creatorSuggestedScore);e.creatorSuggestedFormatted='<span class="tb-bold '+n+'"> '+e.creatorSuggestedCount+'</span > <span class="tb-videolytics-suggested-count" style="font-weight:normal !important"> of '+e.suggestedCount+"</span>"}catch(t){TBUtilities.Log(t);e.creatorSuggestedCount="error";e.suggestedCount="error"}};var ve=function(e){try{var t=e.title.toLowerCase();var i=e.description.toLowerCase();var n=0;var o=0;jQuery.each(e.tags,function(e,a){if(a!=""){if(t.indexOf(a.toLowerCase())!=-1){n++}if(i.indexOf(a.toLowerCase())!=-1){o++}}});e.tagsIn=n+o}catch(t){TBUtilities.Log(t);e.tagsIn="error"}try{if(e.tagsIn!="error"){var a=1;if(e.tagsIn>12){a=5}else if(e.tagsIn>9){a=4}else if(e.tagsIn<=9&&e.tagsIn>4){a=3}else if(e.tagsIn<=4&&e.tagsIn>=2){a=2}else if(e.tagsIn<2){a=1}e.tagsInScore=a}}catch(t){TBUtilities.Log(t);e.tagsInScore="error"}};var ge=function(e){try{e.viewHistoricalData=e.chartsObj.views.daily.data}catch(t){TBUtilities.Log(t);e.viewHistoricalData="error"}try{var t=moment(new Date);var i=moment.duration(t.diff(e.videoPublishDate));var n=i.asDays();n=Math.floor(n).toFixed(0);if(n<1){e.durationSincePublish="Published < a day ago"}else{e.durationSincePublish="Published "+TBUtilities.FormatNumberAbbreviated(n)+" days ago"}}catch(t){TBUtilities.Log(t);e.durationSincePublish="error"}};var Te=function(e){try{var t=e.watchTimeAvgViewDuration.split(":");if(t==""){e.watchTimeAvgViewDurationInMilliSeconds="error";e.watchTimeAvgPercentWatched="error";e.watchTimeAvgViewDuration="error"}else{var i=0;var n=0;var o=0;if(t.length==3){i=jQuery.trim(t[0]);n=jQuery.trim(t[1]);o=jQuery.trim(t[2])}else if(t.length==2){n=jQuery.trim(t[0]);o=jQuery.trim(t[1])}else if(t.length==1){o=jQuery.trim(t[0])}var a=moment.duration({seconds:o,minutes:n,hours:i});e.watchTimeAvgViewDurationInMilliSeconds=a.valueOf();if(e.durationInMilliseconds){var s=e.watchTimeAvgViewDurationInMilliSeconds/e.durationInMilliseconds*100;e.watchTimeAvgPercentWatched=Math.round(s);if(e.watchTimeAvgPercentWatched>100){e.watchTimeAvgPercentWatched=100}e.watchTimeAvgPercentWatchedFormatted=Qe(e.watchTimeAvgPercentWatched)+'<span class="tb-videolytics-abbrev">%<span>'}}}catch(t){TBUtilities.Log(t);e.watchTimeAvgViewDurationInMilliSeconds="error";e.watchTimeAvgPercentWatched="error";e.watchTimeAvgViewDuration="error"}try{var r=moment.duration(e.durationInMilliseconds);var l="ss";if(parseInt(r.asHours().toFixed(2))>0)l="HH:mm:ss";else if(parseInt(r.asMinutes().toFixed(2))>0)l="mm:ss";else if(parseInt(r.asSeconds().toFixed(2))>0)l="ss";e.videoDuration=moment(r._data).format(l)}catch(t){TBUtilities.Log(t);e.videoDuration="error"}};var je=function(e,t){return e+t};var Qe=function(e){if(e>=100){e=e.toFixed(0)}else if(e>=10&&e<100){e=e.toFixed(1)}else if(e<10){e=e.toFixed(2)}return e};var Be=function(e){if(e>=100){e=e.toFixed(0)}else if(e>=10&&e<100){e=e.toFixed(1)}else if(e<10){e=e.toFixed(2)}return e};var ke=function(e){try{var t=e.chartsObj["watch-time"].daily.data.reduce(je,0);e.watchDurationTotal=moment.duration({seconds:0,minutes:t,hours:0,days:0,years:0});var i="";var n="";var o="";if(parseInt(e.watchDurationTotal.asYears().toFixed(2))>0){i=e.watchDurationTotal.asYears().toFixed(1);n="Years";o="y"}else if(parseInt(e.watchDurationTotal.asDays().toFixed(2))>0){i=e.watchDurationTotal.asDays().toFixed(1);n="Days";o="d"}else if(parseInt(e.watchDurationTotal.asHours().toFixed(2))>0){i=e.watchDurationTotal.asHours().toFixed(1);n="Hours";o="h"}else if(parseInt(e.watchDurationTotal.asMinutes().toFixed(2))>0){i=e.watchDurationTotal.asMinutes().toFixed(1);n="Minutes";o="m"}else if(parseInt(e.watchDurationTotal.asSeconds().toFixed(2))>0){i=e.watchDurationTotal.asSeconds().toFixed(1);n="Seconds";o="s"}e.timeWatched=e.watchDurationTotal.asMinutes();e.timeWatchedFormatted=i+'<div class="tb-videolytics-category-label">'+n+" Watched</div>";e.timeWatchedFormattedSecondary=i+" "+o}catch(t){TBUtilities.Log(t);e.timeWatched="error";e.timeWatchedFormatted="error"}try{if(e.timeWatched!=null){var a=moment(new Date);var s=moment.duration(a.diff(e.videoPublishDate));var r=s.asDays();var l=e.timeWatched;var d=l/r;var c=moment.duration({seconds:0,minutes:d,hours:0,days:0,years:0});var i="";if(parseInt(c.asYears().toFixed(2))>0)i=c.asYears().toFixed(1)+" Years";else if(parseInt(c.asDays().toFixed(2))>0)i=c.asDays().toFixed(1)+" Days";else if(parseInt(c.asHours().toFixed(2))>0)i=c.asHours().toFixed(1)+" Hours";else if(parseInt(c.asMinutes().toFixed(2))>0)i=c.asMinutes().toFixed(1)+" Minutes";else if(parseInt(c.asSeconds().toFixed(2))>0)i=c.asSeconds().toFixed(1)+" Seconds";e.timeWatchedPerDay=i}}catch(t){TBUtilities.Log(t);e.timeWatchedPerDay="error"}};var we=function(e){var t="";var i=jQuery("span[data-ytid='"+e.channelId+"']");if(i.length>0){var n=i.find("img").clone();var o=n.clone();o.attr("height","25px");o.attr("width","25px");o.attr("src",o.attr("data-thumb"));o.removeAttr("onload");t=o.prop("outerHTML")}return t};var xe=function(e){$watchSideBar=G();if($watchSideBar.find(".tb-videolytics-savevideo").is(":checked")){TBUtilities.CreateCookie("tb-videolytics-saved-videoid-"+TBGlobal.CurrentChannelId(),e,365)}if($watchSideBar.find(".tb-videolytics-image-compare-container").is(":visible")==true){ae()}$watchSideBar.find(".tb-videolytics-video-bestpractices-container").hide();var t=TBGlobal.GetYouTubeUI();var i=j(document.documentElement.innerHTML);TubeBuddyYouTubeActions.GetVideoChannelId(e,null,function(t){if(t){pe(e);T(t,e,"secondary",true)}else{ue()}})};var Ue=function(){jQuery(document.body).on("CRTBVideolyticsGetVideoStats",function(e,t){try{var i=jQuery.parseJSON(t.response);T(t.data.ChannelId,t.data.VideoId,t.data.Type,t.data.ReloadHtml,i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBVideolyticsGetVideoStats"})}});jQuery(document.body).on("CRTBVideolyticsGetChannelHovercard",function(e,t){var i=t.data.VideoId;var n=r[i];try{if(t.success){var o="//youtube.com/channel/"+t.data.ChannelId+"/videos";var a=t.response.indexOf(o)-2;var s=t.response.substring(0,a);var l=s.lastIndexOf(",");var d=s.substring(l,s.length);var c=d.match(/\d/g);if(c!=null){c=parseInt(c.join(""))}else{c=0}n.channelVideos=c;n.channelVideosFormatted=TBUtilities.FormatNumberAbbreviated(n.channelVideos)}else{n.channelVideos="error"}}catch(e){n.channelVideos="error";TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBVideolyticsGetChannelHovercard"})}finally{x(n,t.data.Type)}});jQuery(document.body).on("CRTBVideolyticsGetVideoToCompare",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);xe(i)}else{ue();be()}}catch(e){ue();be();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBLoadVideolyticsTemplate"})}});jQuery(document.body).on("CRTBLoadVideolyticsTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);var i=false;if(d&&d==true){i=true}f(i)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBLoadVideolyticsTemplate"})}})};var Le=function(e,t){Ve(e,t,Se);Fe(e,t,Se);Me(e,t,Se)};var Ce=function(e,t){ze(e,t,Ee);We(e,t,Ee);Ne(e,t,Ee);He(e,t,Ee);Ye(e,t,Ee);Ge(e,t,Ee);Re(e,t,Ee);Ie(e,t,Ee)};var Ee=function(e,t){if(S(e,t)===true){K(e,t)}};var Se=function(e,t){if(I(e,t)===true){ee(e,t)}};var Ie=function(e,t,i){try{var n="https://www.youtube.com/get_video_info?&video_id="+e.videoId;TBExtension.Get(n,function(o,a,s){try{if(o){try{var r=decodeURIComponent(s);var l=r.indexOf('"captionTracks":[{"baseUrl":"');if(l>-1){l=l+29;var d=r.substring(l,r.length);var c=d.indexOf('","');var u=d.substring(0,c);u=Ae(u);TBExtension.Get(n,function(n,o,a){try{if(n){e.captionsExist=true;i(e,t)}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|performCaptionsCheck",Data:o,Response:a});e.captionsExist=false;i(e,t)}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|performCaptionsCheck"})}},null,{timeout:18e4,dataType:null})}else{e.captionsExist=false;i(e,t)}}catch(n){e.captionsExist="error";i(e,t);TBUtilities.Log(n)}}else{e.captionsExist="error";i(e,t)}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|performCaptionsCheck"})}},null,{timeout:18e4,dataType:null})}catch(t){e.captionsExist="error";TBUtilities.Log(t)}};var Ae=function(e){return e.replace(/\\u[\dA-F]{4}/gi,function(e){return String.fromCharCode(parseInt(e.replace(/\\u/g,""),16))})};var Ge=function(e,t,i){try{Me(e,t,i)}catch(e){TBUtilities.Log(e)}};var Re=function(e,t,i){try{Ve(e,t,i)}catch(e){TBUtilities.Log(e)}};var Ve=function(e,t,i){if(e.facebookLoading=="true"){clearTimeout(e.socialFacebookTimer);e.socialFacebookTimer=setTimeout(function(){Ve(e,t,i)},1e3)}else if(e.facebookLoading=="done"){clearTimeout(e.socialFacebookTimer);i(e,t)}else{De(e,t,i)}};var De=function(e,t,i){e.facebookLoading="true";jQuery(document).one("CRTBVideolyticsFacebookApi",function(n,o){e.likedOnFacebook=false;e.facebookLikeCount=0;try{if(o.success==true){var a=DOMPurify.sanitize(o.response,DOMPurifyConfig);var s=jQuery(a).find("#u_0_3").text();if(s&&s.indexOf("One")>-1){s="1"}var r=s.match(/\d/g);if(r!=null){r=r.join("");var l=parseInt(r);if(l>0){e.likedOnFacebook=true}e.facebookLikeCount=0;try{var d=Oe(s);var c=_e(d);var u=TBUtilities.FormatNumberAbbreviated(c,null,"tb-videolytics-abbrev");e.facebookLikeCountFormatted=u;e.facebookLikeCount=c}catch(t){e.facebookLikeCountFormatted="error";e.facebookLikeCount="error"}}else{e.facebookLikeCountFormatted=0;e.facebookLikeCount=0}}else{e.facebookLoading="done";e.facebookLikeCountFormatted="error";e.facebookLikeCount="error";e.likedOnFacebook="error";i(e,t)}}catch(t){e.facebookLikeCountFormatted="error";e.facebookLikeCount="error";e.likedOnFacebook="error"}e.facebookLoading="done";i(e,t)});var n="https://www.facebook.com/v2.9/plugins/like.php?action=like&domain=www.youtube.com&href=https://www.youtube.com/watch?v="+e.videoId;TBExtension.Get(n,"CRTBVideolyticsFacebookApi",null)};var Me=function(e,t,i){if(e.twitterLoading=="true"){clearTimeout(e.socialTwitterTimer);e.socialTwitterTimer=setTimeout(function(){Me(e,t,i)},1e3)}else if(e.twitterLoading=="done"){clearTimeout(e.socialTwitterTimer);i(e,t)}else{Pe(e,t,i)}};var Pe=function(e,t,i){e.twitterLoading="true";var n='"https://www.youtube.com/watch?v='+e.videoId+'" OR "https://youtu.be/'+e.videoId+'"';e.twitterUrl="https://twitter.com/search?f=tweets&vertical=default&q="+TBUtilities.GetUrlEncoded(n);TBUtilities.GetVideoTweetCount(e.videoId,function(n,o){if(n===true){e.sharedOnTwitterCount=o;if(e.sharedOnTwitterCount>0){e.sharedOnTwitter=true}else{e.sharedOnTwitter=false}if(e.sharedOnTwitterCount>=20){e.sharedOnTwitterFormatted=e.sharedOnTwitterCount+"+"}else{e.sharedOnTwitterFormatted=e.sharedOnTwitterCount}}else{e.sharedOnTwitter=null;e.sharedOnTwitterCount=0;e.sharedOnTwitterFormatted=0}i(e,t)})};var Fe=function(e,t,n){jQuery(document).one("CRTBVideolyticsRedditApi",function(o,a){if(a.success==true){try{var s=jQuery.parseJSON(a.response);if(s.data.children.length>0){var r=0;for(i=0;i<s.data.children.length;i++){r+=s.data.children[i].data.ups}e.redditResults=a;var l=TBUtilities.FormatNumberAbbreviated(r,null,"tb-videolytics-abbrev");e.redditUps=r;e.redditUpsFormatted=l}else{e.redditResults=0;e.redditUps=0;e.redditUpsFormatted=0}}catch(t){e.redditResults="error";e.redditUps="error"}}else{e.redditResults="error";e.redditUps="error"}n(e,t)});e.redditSearchUrl="https://www.reddit.com/search?q="+encodeURI("url:"+e.videoId);var o='url:"'+e.videoId+'"';var a="https://www.reddit.com/search.json?q="+encodeURI(o)+"&restrict_sr=off&sort=relevance&t=all";TBExtension.Get(a,"CRTBVideolyticsRedditApi",null)};var Oe=function(e){try{var t=e.indexOf(" ");if(t===-1)return e;else return e.substr(0,t)}catch(e){return""}};var _e=function(e){multiplier=e.substr(-1).toLowerCase();if(multiplier=="k"){return parseFloat(e)*1e3}else if(multiplier=="m"){return parseFloat(e)*1e6}else{return e}};var Ne=function(e,t,i){try{if(e.html){if(e.html.indexOf("cardCollectionRenderer")!==-1){e.infoCardsExist=true}else{e.infoCardsExist=false}}else{e.infoCardsExist="error";i(e,t)}}catch(n){e.infoCardsExist="error";TBUtilities.Log(n);i(e,t)}};var He=function(e,t,i){try{if(e.html){if(e.html.indexOf("endscreenElementRenderer")!==-1){e.endScreenExist=true}else{e.endScreenExist=false}}else{e.endScreenExist="error";i(e,t)}}catch(n){e.endScreenExist="error";TBUtilities.Log(n);i(e,t)}};var Ye=function(e,t,i){try{var n="https://i.ytimg.com/vi/"+e.videoId+"/maxresdefault.jpg";var o=new Image;o.onload=function(){if(o.naturalHeight<720&&o.naturalWidth<1280){e.highResThumbnailExist=false}else{e.highResThumbnailExist=true}i(e,t)};o.onerror=function(){e.highResThumbnailExist="error";i(e,t)};o.src=n}catch(n){e.highResThumbnailExist="error";TBUtilities.Log(n);i(e,t)}};var We=function(e,t,i){try{if(e.commentsResponse==null){qe(e,function(e){Je(e);i(e,t)})}else{Je(e);i(e,t)}}catch(n){TBUtilities.Log(n);i(e,t)}};var ze=function(e,t,i){try{if(e.commentsResponse==null){qe(e,function(e){Xe(e);i(e,t)})}else{Xe(e);i(e,t)}}catch(n){TBUtilities.Log(n);i(e,t)}};var Xe=function(e){try{if(e.commentsResponse!=null){e.commentPinned=false;if(e.commentsResponse.response.continuationContents.itemSectionContinuation.contents){jQuery.each(e.commentsResponse.response.continuationContents.itemSectionContinuation.contents,function(t,i){if(i.commentThreadRenderer.renderingPriority=="RENDERING_PRIORITY_PINNED_COMMENT"){e.commentPinned=true;return false}})}}else{e.commentPinned="error"}}catch(t){e.commentPinned="error"}};var Je=function(e){try{if(e.commentsResponse!=null){e.commentHearted=false;if(e.commentsResponse.response.continuationContents.itemSectionContinuation.contents){jQuery.each(e.commentsResponse.response.continuationContents.itemSectionContinuation.contents,function(t,i){try{var n=i.commentThreadRenderer.comment.commentRenderer.actionButtons.commentActionButtonsRenderer.creatorHeart;if(typeof n!="undefined"&&n.creatorHeartRenderer.isHearted===true){e.commentHearted=true;return false}}catch(e){}})}}else{e.commentHearted="error"}}catch(t){e.commentHearted="error"}};var qe=function(e,t){try{var i=TBUtilities.GetSessionToken(document.documentElement.innerHTML);var n=TBUtilities.GetCommentTokenFromWatchPageHtml(e.html);var o=TBUtilities.GetIdokenFromWatchPageHtml(e.html);var a=TBUtilities.GetYouTubeUIVersion(e.html);var s="https://www.youtube.com/comment_service_ajax?action_get_comments=1&pbj=1&ctoken="+encodeURIComponent(n);var r={session_token:i};var l=jQuery.param(r);TBExtension.Post(s,l,function(i,n,o){try{if(i){try{e.commentsResponse=o}catch(t){e.commentsResponse="error"}t(e)}else{e.commentsResponse="error";t(e)}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getCommentsResponse"})}},null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",headers:{"X-YouTube-Identity-Token":o,"X-YouTube-Client-Name":1,"X-YouTube-Client-Version":a}})}catch(i){e.commentsResponse="error";t(e)}};var $e=function(){n=TBUtilities.GetUrlParameter("v");if(!n){return}var i=jQuery("meta[itemprop=isLiveBroadcast]").attr("content");var o=jQuery("meta[itemprop=endDate]").attr("content");if(typeof i!==typeof undefined&&i!==false&&i=="True"&&typeof o===typeof undefined){return}b=false;if(!e){TBUtilities.Log("TubeBuddyVideolytics initi scripts");t=jQuery("meta[itemprop=channelId]").attr("content");if(t){g(function(){e=true;Ue();F();se()})}else{TubeBuddyYouTubeActions.GetVideoChannelId(n,null,function(i){t=i;if(i){g(function(){e=true;Ue();if(TBExtension.GetType()=="safari"){setTimeout(function(){se();F()},1e3)}else{se();F()}})}else{TBUtilities.Log("TubeBuddyVideolytics no channel id found")}})}}else{TBUtilities.Log("TubeBuddyVideolytics partial load");n=TBUtilities.GetUrlParameter("v");t=null;TubeBuddyYouTubeActions.GetVideoChannelId(n,null,function(e){if(e){t=e;f(true)}})}};var Ze=function(){var e=setInterval(function(){var t=jQuery("ytd-comments-header-renderer.ytd-item-section-renderer");if(t.length>0){clearInterval(e);jQuery("ytd-comments-header-renderer.ytd-item-section-renderer").find("div#title").append(jQuery(".tb-videolytics-word-cloud-button-container"));jQuery(".tb-videolytics-word-cloud-button-container").show()}},1e3)};return{Initialize:function(e){d=e;Ze();TBUtilities.Log("TubeBuddyVideolytics Initialize");if(TBGlobal.IsAuthenticated()){$e()}else{TBUtilities.Log("TubeBuddyVideolytics disabled")}},CleanPage:function(){var e=G();var t=e.find(".tb-videolytics-container");if(t.length>0){t.remove()}var i=e.find(".tb-videolytics-container-disabled");if(i.length>0){i.remove()}}}}();function VideolyticsData(){this.channelId=null;this.videoId=null;this.html=null;this.statsData=null;this.views=null;this.viewsFormatted=null;this.percentChangeOverAverage=null;this.percentChangeOverAverageFormatted=null;this.likes=null;this.likesFormatted=null;this.dislikes=null;this.dislikesFormatted=null;this.engagementLikeRatio=null;this.engagementLikeRatioFormatted=null;this.engagementLikeRatioScore=null;this.viewsPerHour=null;this.viewsPerHourFormatted=null;this.durationSincePublish=null;this.viewHistoricalData=null;this.watchTimeAvgViewDuration=null;this.videoDuration=null;this.watchTimeAvgViewDurationInMilliSeconds=null;this.watchTimeAvgPercentWatched=null;this.watchTimeAvgPercentWatchedFormatted=null;this.tags=null;this.commentToken=null;this.sessionToken=null;this.commentCount=null;this.commentCountFormatted=null;this.engagementRatio=null;this.engagementRatioFormatted=null;this.engagementRatioScore=null;this.earnings=null;this.earningsFormatted=null;this.earningsRange=null;this.views48hrs=null;this.views48hrsFormatted=null;this.views48hrsPercentOfTotal=null;this.views48hrsPercentOfTotalFormatted=null;this.timeWatched=null;this.timeWatchedFormatted=null;this.timeWatchedFormattedSecondary=null;this.timeWatchedPerDay=null;this.watchDurationTotal=null;this.subscribersGained=null;this.subscribersGainedFormatted=null;this.creatorSuggestedCount=null;this.creatorSuggestedScore=null;this.creatorSuggestedFormatted=null;this.suggestedCount=null;this.title=null;this.description=null;this.tagsIn=null;this.tagsInScore=null;this.ownerUrl=null;this.channelAboutHtml=null;this.subscribers=null;this.subscribersFormatted=null;this.channelViews=null;this.channelViewsFormatted=null;this.channelVideos=null;this.channelVideosFormatted=null;this.commentsPerView=null;this.subsPerView=null;this.averageViewsPerVideo=null;this.averageViewsPerVideoFormatted=null;this.subscribersPerDay=null;this.subscribersPerDayFormatted=null;this.percentOfChannelViews=null;this.percentOfChannelViewsFormatted=null;this.viewsToSubscriberRatio=null;this.viewsToSubscriberRatioFormatted=null;this.viewsToSubscriberRatioFormula=null;this.engagementsPerDay=null;this.engagementsPerDayFormatted=null;this.totalEngagements=null;this.videosPerWeek=null;this.videosPerWeekFormatted=null;this.$pageHtml=null;this.ui=null;this.chartsObj;this.videoPublishDate=null;this.durationInMilliseconds=null;this.viewsPerDay=null;this.viewsPerDayFormatted=null;this.idToken=null;this.uiVersionNumber=null;this.serverStats=null;this.language=null;this.ytplayerconfig=null;this.commentsResponse=null;this.commentHearted=null;this.infoCardsExist=null;this.endScreenExist=null;this.highResThumbnailExist=null;this.sharedOnTwitter=null;this.sharedOnTwitterCount=null;this.sharedOnTwitterFormatted=null;this.twitterLoading=null;this.likedOnFacebook=null;this.facebookLoading=null;this.facebookLikeCount=null;this.facebookLikeCountFormatted=null;this.redditResults=null;this.redditUps=null;this.redditUpsFormatted=null;this.redditSearchUrl=null;this.sessionLink=null;this.socialTwitterTimer=null;this.socialFacebookTimer=null}var TubeBuddyAnnotationAudit=function(){var e=false;var t=[];var i=0;var n=[];var o={Annotations:[]};var a=function(){var e=TBGlobal.host+"/ModuleManager/annotationaudit/annotationaudit?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/annotationaudit.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/annotationaudit.html"}TBExtension.Get(e,"CRTBLoadAnnotationAuditTemplate")};var s=function(e){TBUtilities.Log("gotVideoStatusUpdate");TBUtilities.Log(e);jQuery("#tb-annotations-audit-loading-count-total").text(e.totalCount);jQuery("#tb-annotations-audit-loading-count-total2").text(e.totalCount);TBUtilities.AutoIncrementCount(jQuery("#tb-annotations-audit-loading-count"));if(e.totalCount-e.loaded>50){TBUtilities.Log("IN");TBUtilities.Log(e.loaded);jQuery("#tb-annotations-audit-loading-count").attr("data-auto-count",e.loaded);TBUtilities.AutoIncrementCount(jQuery("#tb-annotations-audit-loading-count"))}else{TBUtilities.Log("OUT");jQuery("#tb-annotations-audit-loading-count").attr("data-auto-count",e.loaded);TBUtilities.AutoIncrementCount(jQuery("#tb-annotations-audit-loading-count"));jQuery("#tb-annotations-audit-rendering").show()}};var o;var r=function(e){var t,i,n,o,a,s;s=e.data||null;if(s==null||!s.length){return null}o=e.columnDelimiter||",";a=e.lineDelimiter||"\n";n=Object.keys(s[0]);t="";t+=n.join(o);t+=a;s.forEach(function(e){i=0;n.forEach(function(n){if(i>0)t+=o;t+=e[n];i++});t+=a});return t};var l=function(){o={Annotations:[]};TBUtilities.Log("buildCSV");jQuery.each(t,function(e,t){if(t.Annotations){if(t.Annotations.length>0){jQuery.each(t.Annotations,function(e,t){t.endTimeTimeSpan=null;t.startTimeTimeSpan=null;t.fullXML=null;t.fullXMLOriginal=null;TBUtilities.Log(t);if(!t.url)t.url="";if(!t.text)t.text="";t.text=TBUtilities.ReplaceAll(t.text,",","-");t.url=TBUtilities.ReplaceAll(t.url,",","-");t.text=TBUtilities.ReplaceAll(t.text,"\r"," ");t.url=TBUtilities.ReplaceAll(t.url,"\r"," ");t.text=TBUtilities.ReplaceAll(t.text,"\n"," ");t.url=TBUtilities.ReplaceAll(t.url,"\n"," ");t.text=t.text.trim();t.url=t.url.trim();if(!t.startTime||t.startTime=="never"||t.startTime=="0:00.000"&&t.endTime=="0:00.000"){t.startTime="-";t.endTime="-";t.startTimeTimeMiliseconds="-";t.endTimeTimeMiliseconds="-"}if(!t.startTimeTimeMiliseconds)t.startTimeTimeMiliseconds="-";if(!t.endTimeTimeMiliseconds)t.endTimeTimeMiliseconds="-";if(t.display=="Spotlight Text")return;o.Annotations.push({Video_ID:t.videoId,Edit_Link:"https://www.youtube.com/my_videos_annotate?v="+t.videoId,Annotation_ID:t.id,Type:t.display,Text:t.text,Start_Time:t.startTime,End_Time:t.endTime,Start_Time_Milliseconds:t.startTimeTimeMiliseconds,End_Time_Milliseconds:t.endTimeTimeMiliseconds,Link:t.url})})}}});jQuery("#tb-annotations-audit-status-label").text("COMPLETE!");jQuery("#tb-annotations-audit-loading-count-check3").show();jQuery("#tb-annotations-audit-loading-count-working3").hide();if(o.Annotations.length>0){jQuery("#tb-annotations-audit-status-details").hide();jQuery("#tb-annotations-audit-status-step4").show();jQuery("#tb-annotations-audit-status-step5").show();var e=1e3;var i=Math.floor(o.Annotations.length/e)+1;TBUtilities.Log("Total Buttons: "+i);if(i>1){for(var n=0;n<i;n++){TBUtilities.Log("Total Buttons Loop: "+n);jQuery("#tb-annotations-audit-download-buttons-container").append('<div style="padding-bottom:10px;"><img src="'+TBGlobal.host+'/images/icons/arrow-right.png" style="height:16px; padding-left:10px; padding-right:0px; position:relative; top:2px;" /><a style="height: 24px; margin-right: 10px; margin-left: 10px;padding-top:4px" data-start="'+(n*e+1)+'" data-end="'+(n+1)*e+'" class="tb-button tb-button-payment tb-annotation-audit-download">Download CSV File (Ann. '+(n*e+1)+" to "+(n+1)*e+")</a></div>")}}else{jQuery("#tb-annotations-audit-download-buttons-container").append('<div style="padding-bottom:10px"><img src="'+TBGlobal.host+'/images/icons/arrow-right.png" style="height:16px; padding-left:10px; padding-right:0px; position:relative; top:2px;" /><a style="height: 24px; margin-right: 10px; margin-left: 10px;padding-top:4px" data-start="1" data-end="'+o.Annotations.length+'" class="tb-button tb-button-payment tb-annotation-audit-download">Download CSV File</a></div>')}}else{TBUtilities.Alert("None of your videos have Annotations. You're all good!")}};var d=function(){var e=t[i];i++;jQuery("#tb-annotations-audit-loading-count2").text(i);TBUtilities.Log(i);TBUtilities.Log(e.id);if(i>=t.length){jQuery("#tb-annotations-audit-status-step3").show();jQuery("#tb-annotations-audit-loading-count-check2").show();jQuery("#tb-annotations-audit-loading-count-working2").hide();l()}else{TubeBuddyYouTubeActions.GetAnnotations(e,c)}};var c=function(e){t[i].Annotations=e;d()};var u=function(e){try{TBUtilities.Log("gotVideos");jQuery("#tb-annotations-audit-loading-count-check").show();jQuery("#tb-annotations-audit-loading-count-working").hide();jQuery("#tb-annotations-audit-status-step2").show();t=[];jQuery.each(e,function(e,i){i.id=i.snippet.resourceId.videoId;t.push(i)});i=0;jQuery("#tb-annotations-audit-status-label").text("Processing...");d()}catch(e){TBUtilities.LogError({Exception:e,Location:"[V2VPromote] gotVideos"})}};var p=function(){jQuery(document).on("click","#tb-annotation-audit-start",function(){jQuery("#tb-annotations-audit-status-label").text("Processing...");jQuery("#tb-annotations-audit-status-label").css("color","green");jQuery("#tb-annotations-audit-status-step1").show();jQuery("#tb-annotations-audit-status-step0").hide();TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,u,s)});jQuery(document).on("click",".tb-annotation-audit-download",function(){var e=jQuery(this).attr("data-start");var t=jQuery(this).attr("data-end");TBUtilities.Log("Range: "+e+" to "+t);var i=[];for(var n=e-1;n<t;n++){if(n<o.Annotations.length)i.push(o.Annotations[n])}var a,s,l;var d=r({data:i});i=[];if(d==null)return;s=TBGlobal.CurrentChannelId()+"_"+e+"-"+t+"_export.csv";if(!d.match(/^data:text\/csv/i)){d="data:text/csv;charset=utf-8,"+d}a=encodeURI(d);l=document.createElement("a");l.setAttribute("href",a);l.setAttribute("download",s);l.click()});jQuery(document).on("click","#tb-annotation-audit-close, .tb-annotation-audit-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-annotation-audit-container").hide()})};var b=function(e,t,i){jQuery("#tb-annotation-audit-loading-container").show();jQuery("#tb-annotation-audit-none").hide();jQuery("#tb-annotation-audit-apply-container").hide();jQuery("#tb-annotation-audit-apply").hide();jQuery("#tb-annotations-audit-working").hide();jQuery("#tb-annotation-audit-container").fadeIn()};var y=function(){jQuery(document.body).on("CRTBLoadAnnotationAuditTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[AnnotationAudit] CRTBLoadAnnotationAuditTemplate"})}})};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){y();a();p();e=true}else{b()}}}}}();var TubeBuddyLiveEventsVideo=function(){var e=false;var t=[];var i=[];var n=0;var o=null;var a=false;var s=[];var r=function(){var e=jQuery(".save-cancel-buttons:first").find("button:first");jQuery(".save-cancel-buttons:first").append(jQuery(".tb-live-events-upload-container:last")[0].outerHTML);jQuery(".save-cancel-buttons:first").find(".tb-live-events-upload-container").css("right",250);jQuery(".save-cancel-buttons:first").find(".tb-live-events-upload-container").css("top",e.offset().top-70);jQuery(".video-settings-tag-chips-container").after(jQuery(".tb-live-events-video-tags-container:last")[0].outerHTML);jQuery(".video-settings-title").closest("label").append("<br/>");jQuery(".video-settings-title").closest("label").append(jQuery(".tb-live-events-title-length-container:first")[0].outerHTML);jQuery(".video-settings-description").closest("label").append("<br/>");jQuery(".video-settings-description").closest("label").append(jQuery(".tb-live-events-description-length-container:first")[0].outerHTML);jQuery(".video-settings-tag-chips-container").after(jQuery(".tb-live-events-tags-length-container:first")[0].outerHTML);var t=false;var i=TBUtilities.GetUrlParameter("action_create_live_event");if(i&&i=="1"){jQuery(".tb-live-events-description-length-container:first").css("margin-right","130px");jQuery(".tb-live-events-title-length-container:first").css("margin-right","130px");jQuery(".tb-live-events-tags-length-container:first").css("margin-right","130px")}b();y();c();u();p();jQuery(".yt-chip").prepend(jQuery(".tb-live-events-search-icon:last")[0].outerHTML);d()};var l=function(){var e=TBGlobal.host+"/ModuleManager/LiveEventsVideo/liveeventsvideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/liveeventsvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/liveeventsvideo.html"}TBExtension.Get(e,"CRTBLoadLiveEventsVideoTemplate")};var d=function(){var e=TBGlobal.host+TBGlobal.apiUrls.uploadDefaultsList;TBExtension.Get(e,"CRTBLoadLiveEventsUploadDefaultsGetList")};var c=function(){var e=jQuery(".video-settings-title").val().length;jQuery(".tb-live-events-title-length").text(e);if(e>100){jQuery(".tb-live-events-title-length").css("color","red");jQuery(".tb-live-events-title-length").css("font-weight","bold")}else{jQuery(".tb-live-events-title-length").css("color","#666");jQuery(".tb-live-events-title-length").css("font-weight","normal")}};var u=function(){var e=jQuery(".video-settings-description").val();var t=h(e);jQuery(".tb-live-events-description-length").text(t);if(t>5e3){jQuery(".tb-live-events-description-length").css("color","red");jQuery(".tb-live-events-description-length").css("font-weight","bold")}else{jQuery(".tb-live-events-description-length").css("color","#666");jQuery(".tb-live-events-description-length").css("font-weight","normal")}};var p=function(){var e=0;var t=b();jQuery.each(t,function(t,i){var n=i.trim();n=n.replace(/\s/,"---");e+=n.length;e+=1});if(e>0)e--;var i=jQuery(".video-settings-add-tag").val();i=i.replace(/\s+/g,"---");e+=i.length;jQuery(".tb-live-events-tags-length").text(e);if(e>500){jQuery(".tb-live-events-tags-length").css("color","red");jQuery(".tb-live-events-tags-length").css("font-weight","bold")}else{jQuery(".tb-live-events-tags-length").css("color","#666");jQuery(".tb-live-events-tags-length").css("font-weight","normal")}};var b=function(){t=[];jQuery(".video-settings-tag-chips-container").find(".yt-chip").each(function(e){t.push(jQuery(this).find("span:first").text())});TBUtilities.Log("Tag length = "+t.length);return t};var y=function(){if(a)return;jQuery(".tb-live-events-video-copy-tags").prop("disabled",true);jQuery(".tb-live-events-video-clear-tags").prop("disabled",true);jQuery(".tb-live-events-video-tag-sorter-button").prop("disabled",true);jQuery(".tb-live-events-video-tag-translator-button").prop("disabled",true);if(t.length!==0){jQuery(".tb-live-events-video-copy-tags").prop("disabled",false);jQuery(".tb-live-events-video-clear-tags").prop("disabled",false);jQuery(".tb-live-events-video-tag-sorter-button").prop("disabled",false);jQuery(".tb-live-events-video-tag-translator-button").prop("disabled",false)}};var m=function(){try{if(n>=i.length){clearTimeout(o);o=null;a=false;b();y();p()}else{jQuery(".video-settings-add-tag").val(i[n++]);jQuery(".video-settings-add-tag:first").focus();jQuery(".video-settings-title:first").focus();o=setTimeout(m,100)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveEvents] addTagsOneAtATime"})}};var h=function(e){var t=e.length;for(var i=e.length-1;i>=0;i--){var n=e.charCodeAt(i);if(n>127&&n<=2047)t++;else if(n>2047&&n<=65535)t+=2;if(n>=56320&&n<=57343)i--}return t};var f=function(){jQuery(document).on("change keyup keypress paste",".video-settings-description",function(e){u()});jQuery(document).on("change keyup keypress paste",".video-settings-title",function(e){c()});jQuery(document).on("change keyup keypress paste",".video-settings-add-tag",function(e){p()});jQuery(document).on("blur",".video-settings-add-tag, .video-settings-tag-chips-container",function(){jQuery(".yt-chip").each(function(){if(jQuery(this).find(".tb-live-events-search-icon").length===0){jQuery(this).prepend(jQuery(".tb-live-events-search-icon:last")[0].outerHTML)}});b();y();p()});jQuery(document).on("click",".tb-live-events-video-tag-translator-button",function(e){var t=b();TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagTranslator.Show(t)});jQuery(document).on("click",".tb-live-events-video-tag-list-button",function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagLists.Show(true)});jQuery(document).on("blur",".video-settings-tag-chips-container",function(){b();y()});jQuery(document).on("click",".tb-live-events-video-copy-tags",function(e){e.stopPropagation();var t=b();TubeBuddyCopyTo.ShowMenu(jQuery(this),t,false)});jQuery(document).on("click",".tb-live-events-video-clear-tags",function(e){TBUtilities.Confirm("Are you sure you want to CLEAR all tags that you have entered?",function(){jQuery(".video-settings-tag-chips-container").find(".yt-delete-chip").each(function(){jQuery(this)[0].click()});b();y();p()},function(){})});jQuery(document).on("click",".tb-live-events-video-tag-explorer-button",function(e){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagExplorer.ShowTagExplorer(null,jQuery(this),t)});jQuery(document).on("click",".tb-live-events-video-tag-translator-button",function(e){var t=[];jQuery(".video-settings-tag-chips-container").find(".yt-chip").each(function(e){t.push(jQuery(this).find("span:first").text())});TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagTranslator.Show(t)});jQuery(document).on("click",".tb-live-events-video-tag-sorter-button",function(e){var t=[];var i=[];jQuery(".video-settings-tag-chips-container").find(".yt-chip").each(function(e){t.push(jQuery(this).find("span:first").text());i.push({tag:jQuery(this).find("span:first").text(),rank:jQuery(this).find(".tb-tag-rank-value").text()})});TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagSorter.Show(t,i)});jQuery(document).on("click",".yt-delete-chip",function(e){e.stopPropagation();if(!a){y(false)}});jQuery(document).on("click",".yt-chip",function(){var e=jQuery(this).find("span:first").text();if(!a){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagExplorer.ShowTagExplorer(e,jQuery(this),t)}});jQuery(document).on("change",".tb-live-events-default-select",function(){jQuery(this).attr("data-tooltip-text",jQuery(this).find("option:selected").text())});jQuery(document).on("click",".tb-live-events-default-apply-button",function(){var e="0";try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.DefaultUploadProfiles_Apply,"defaultuploadprofiles");var t=jQuery(this).closest("#creator-page").find(".tb-live-events-default-select").val();e+="["+t+"]";e+="["+s.length+"]";var i=TBUtilities.GetInArray(s,"Id",t);e+="["+i+"]";jQuery(this).closest("#creator-page").find("[data-tab-id=basic-info]")[0].click();jQuery(this).closest("#creator-page").find(".video-settings-title").val(i.Title);jQuery(this).closest("#creator-page").find(".video-settings-description").val(i.Description);jQuery(this).closest("#creator-page").find(".category-input").val(i.Category);jQuery(this).closest("#creator-page").find(".video-settings-tag-chips-container").find(".yt-delete-chip").each(function(){jQuery(this)[0].click()});var n=i.Tags.split(",");TubeBuddyLiveEventsVideo.AddTags(n);b();y();jQuery(this).closest("#creator-page").find(".video-settings-description").trigger("keyup");var o=document.createEvent("HTMLEvents");o.initEvent("input",true,true);jQuery(this).closest("#creator-page").find(".video-settings-description")[0].dispatchEvent(o)}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyLiveEvents] tb-upload-default-apply-button [click] "+e})}});jQuery(document).on("focus",".video-settings-title, .video-settings-description, .video-settings-add-tag",function(){jQuery(".tb-emoji-toggle").hide();jQuery(this).siblings(".tb-emoji-toggle").remove();jQuery(this).before('<span style="position:absolute; left:430px; opacity:.7" class="tb-emoji-toggle"><img src="'+TBGlobal.host+'/images/modules/emoji/face.png" style=" cursor:pointer; position:relative; top:5px;" /></span>')});jQuery(document).on("click",".tb-emoji-toggle",function(){if(jQuery(this).next().attr("tb-emoji-added")!="1"){jQuery(this).next().emojiPicker({height:"300px",width:"450px",button:false});jQuery(this).next().attr("tb-emoji-added","1")}jQuery(this).next().emojiPicker("toggle")})};var v=function(){jQuery(document.body).on("CRTBLoadLiveEventsUploadDefaultsGetList",function(e,t){try{if(t.success){jQuery.each(JSON.parse(t.response),function(e,t){s.push(t)});var i=jQuery(this).find(".tb-live-events-default-select:first");jQuery.each(s,function(e,t){i.append(jQuery("<option></option>").attr("value",t.Id).text(t.Name))});if(s.length>0){jQuery(".tb-live-events-no-upload-default-profiles").hide();jQuery(".tb-live-events-has-upload-default-profiles").show()}else{jQuery(".tb-live-events-no-upload-default-profiles").show();jQuery(".tb-live-events-has-upload-default-profiles").hide()}}}catch(e){jQuery(".tb-live-events-no-upload-default-profiles").show();jQuery(".tb-live-events-has-upload-default-profiles").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveEvents] CRUploadDefaultsGetList"})}});jQuery(document.body).on("CRTBLoadLiveEventsVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);r()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveEventsVideo] CRTBLoadLiveEventsVideoTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){v();l();f();e=true}else{r()}}},AddTags:function(e){i=e;a=true;n=0;o=setTimeout(m,10)}}}();var TubeBuddyLiveCardsVideo=function(){var e=false;var t=null;var i=null;var n=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideo+"?videoid="+TBUtilities.GetUrlParameter("v");TBExtension.Get(e,"CRTBEditVideoCardsLoadVideo",null)};var o=function(){jQuery(".annotator-learn-more-container").after(jQuery(".tb-live-cards-video-cards-container:first")[0].outerHTML)};var a=function(){var e=TBGlobal.host+"/ModuleManager/livecardsvideo/livecardsvideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/livecardsvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/livecardsvideo.html"}TBExtension.Get(e,"CRTBLoadCardsVideoTemplate")};var s=function(){jQuery(document).on("click",".tb-live-cards-video-cards-apply-cards-template",function(){TubeBuddyMenu.ShowBackgroundSticky();var e=TBUtilities.GetUrlParameter("v");var t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyCardTemplates.Show(e,t,i)});jQuery(document).on("click",".tb-live-cards-video-cards-clear-cards",function(){if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all Cards from this video?"))r()}else{TBUtilities.Confirm("Are you sure you want to remove all Cards from this video?",r,null)}});jQuery(document).on("change",".tb-live-cards-video-cards-template",function(){l()});jQuery(document).on("change",".tb-video-cards-title-input",function(){l()});jQuery(document).on("keyup",".tb-video-cards-title-input",function(e){if(e.keyCode==13){l()}})};var r=function(){jQuery(".tb-live-cards-video-cards-working").show();if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}TBUtilities.Log("Session token ="+i);TubeBuddyYouTubeActions.DeleteAllCards(TBUtilities.GetUrlParameter("v"),i,TubeBuddyLiveCardsVideo.DeleteAllCardsCallBack)};var l=function(){try{TBUtilities.Log("TubeBuddyLiveCardsVideo - saveTemplateChanges");var e=jQuery(".tb-live-cards-video-cards-template").prop("checked");var t=TBUtilities.GetUrlParameter("v");if(e&&!jQuery(".tb-video-cards-title-input").val())jQuery(".tb-video-cards-title-input").val(jQuery("#creator-editor-title-link").attr("title"));title=jQuery(".tb-video-cards-title-input").val();var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleCardTemplate;var n={Id:t,Enabled:e,Title:title};TBUtilities.Log(n);TBExtension.Post(i,JSON.stringify(n),"CRTBLoadEditVideoCardTemplateToggle",null,{contentType:"application/json"});jQuery(".tb-video-cards-title-input").prop("disabled",!e);jQuery(".tb-video-cards-changes-saved").hide();jQuery(".tb-video-cards-changes-saved").show().delay(2e3).fadeOut();if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.CardTemplates_Apply,"cardtemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveCardsVideo] saveTemplateChanges"})}};var d=function(){jQuery(document.body).on("CRTBLoadCardsVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);o()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveCardsVideo] CRTBLoadCardsVideoTemplate"})}});jQuery(document.body).on("CRTBEditVideoCardsLoadVideo",function(e,i){try{if(i.success){t=jQuery.parseJSON(i.response);o(t.IsCardTemplate,t.CardTemplateName)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveCardsVideo] CRTBEditVideoCardsLoadVideo"})}});jQuery(document.body).on("CRTBLoadEditVideoCardTemplateToggle",function(e,t){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveCardsVideo] CRTBLoadEditVideoCardsTemplateToggle"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){d();a();s();e=true}}},DeleteAllCardsCallBack:function(){jQuery(".tb-live-cards-video-cards-working").hide();TBUtilities.Alert("Cards successfully cleared!\n\nWe need to re-load the page for the changes to take effect. Any unsaved changes on this page will be lost. ",function(){location.reload()})}}}();var TubeBuddyLiveDashboardVideo=function(){var e=false;var t=[];var i=[];var n=0;var o=null;var a=false;var s=[];var r=function(){var e=setInterval(function(){if(jQuery(".video-settings-description:first").is(":visible")==true){clearInterval(e);jQuery(".yt-uix-custom-thumbnail").after(jQuery(".tb-live-dashboard-thumbnail-gen-create:last")[0].outerHTML);var t=jQuery(".metadata-editor-container:first");t.prepend(jQuery(".tb-live-dashboard-upload-container:last")[0].outerHTML);jQuery(".video-settings-title").closest(".video-title-widget").after(jQuery(".tb-live-dashboard-title-length-container:first")[0].outerHTML);jQuery(".video-settings-description").closest(".description-widget").after(jQuery(".tb-live-dashboard-description-length-container:first")[0].outerHTML);u();c();jQuery(".annotator-learn-more-container").after(jQuery(".tb-live-dashboard-cards-container:first")[0].outerHTML)}},100);d()};var l=function(){var e=TBGlobal.host+"/ModuleManager/LiveDashboardVideo/LiveDashboardVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/livedashboardvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/livedashboardvideo.html"}TBExtension.Get(e,"CRTBLoadLiveDashboardVideoTemplate")};var d=function(){var e=TBGlobal.host+TBGlobal.apiUrls.uploadDefaultsList;TBExtension.Get(e,"CRTBLoadLiveEventsUploadDefaultsGetList")};var c=function(){var e=jQuery(".video-settings-title").val().length;jQuery(".tb-live-dashboard-title-length").text(e);if(e>100){jQuery(".tb-live-dashboard-title-length").css("color","red");jQuery(".tb-live-dashboard-title-length").css("font-weight","bold")}else{jQuery(".tb-live-dashboard-title-length").css("color","#666");jQuery(".tb-live-dashboard-title-length").css("font-weight","normal")}};var u=function(){var e=jQuery(".video-settings-description").val();var t=p(e);jQuery(".tb-live-dashboard-description-length").text(t);if(t>5e3){jQuery(".tb-live-dashboard-description-length").css("color","red");jQuery(".tb-live-dashboard-description-length").css("font-weight","bold")}else{jQuery(".tb-live-dashboard-description-length").css("color","#666");jQuery(".tb-live-dashboard-description-length").css("font-weight","normal")}};var p=function(e){var t=e.length;for(var i=e.length-1;i>=0;i--){var n=e.charCodeAt(i);if(n>127&&n<=2047)t++;else if(n>2047&&n<=65535)t+=2;if(n>=56320&&n<=57343)i--}return t};var b=function(){jQuery(document).on("click",".tb-live-dashboard-cards-apply-cards-template",function(){TubeBuddyMenu.ShowBackgroundSticky();var e=jQuery(".metadata-app[data-video-id]:first").attr("data-video-id");var t=jQuery(".video-settings-title").val();var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyCardTemplates.Show(e,t,i)});jQuery(document).on("click",".tb-live-dashboard-cards-clear-cards",function(){var e=jQuery(".metadata-app[data-video-id]:first").attr("data-video-id");if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all Cards from this video?")){y(e)}}else{TBUtilities.Confirm("Are you sure you want to remove all Cards from this video?",function(){y(e)},null)}});jQuery(document).on("change keyup keypress paste",".video-settings-description",function(e){u()});jQuery(document).on("change keyup keypress paste",".video-settings-title",function(e){c()});jQuery(document).on("click",".tb-live-dashboard-thumbnail-gen-create",function(){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyThumbnailCreator.ShowForLiveStream()});jQuery(document).on("change",".tb-live-dashboard-default-select",function(){jQuery(this).attr("data-tooltip-text",jQuery(this).find("option:selected").text())});jQuery(document).on("click",".tb-live-dashboard-default-apply-button",function(){try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.DefaultUploadProfiles_Apply,"defaultuploadprofiles");var e=jQuery(this).closest("#creator-page").find(".tb-live-dashboard-default-select").val();var t=TBUtilities.GetInArray(s,"Id",e);jQuery(".video-settings-title").val(t.Title);jQuery(".video-settings-description").val(t.Description);jQuery(".video-settings-description").trigger("keyup");var i=document.createEvent("HTMLEvents");i.initEvent("input",true,true);jQuery(".video-settings-description")[0].dispatchEvent(i);if(t.Category){var n=jQuery('.yt-uix-form-input-select-element[data-ng-model="category"');var o="string:"+t.Category;var a=n.find("option[value='"+o+"']");n.val("string:"+t.Category);var r=n.siblings(".yt-uix-form-input-select-content").find(".yt-uix-form-input-select-value");r.text(a.text())}u();c()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveDashboardVideo] tb-upload-default-apply-button [click] "})}});jQuery(document).on("focus",".video-settings-title, .video-settings-description",function(e){if(jQuery(this).siblings(".tb-emoji-toggle").length==0){jQuery(this).before('<span style="position:absolute; right:2px; top:-1px; opacity:.7; z-index:99999999" class="tb-emoji-toggle"><img src="'+TBGlobal.host+'/images/modules/emoji/face.png" style=" cursor:pointer; position:relative; top:5px;" /></span>')}});jQuery(document).on("click",".tb-emoji-toggle",function(e){e.stopImmediatePropagation();if(jQuery(this).siblings("yt-uix-form-input-text").attr("tb-emoji-added")!=="1"){jQuery(this).siblings("yt-uix-form-input-text").emojiPicker({height:"300px",width:"450px",button:false});jQuery(this).siblings("yt-uix-form-input-text").attr("tb-emoji-added","1")}jQuery(this).siblings("yt-uix-form-input-text").emojiPicker("toggle")})};var y=function(e){jQuery(".tb-live-dashboard-cards-working").show();TBExtension.Get("/my_videos?o=U",function(t,i,n){try{if(t){var o=jQuery.parseHTML(DOMPurify.sanitize(n,DOMPurifyConfig));_sessionToken=TBUtilities.GetSessionToken(document.documentElement.innerHTML);TBUtilities.Log("Session token ="+_sessionToken);TubeBuddyYouTubeActions.DeleteAllCards(e,_sessionToken,TubeBuddyLiveDashboardVideo.DeleteAllCardsCallBack)}else{TBUtilities.LogFailedWebRequest({Location:"LiveDashboardVideo.js|removeAllCards",Data:i,Response:n})}}catch(e){TBUtilities.LogError({Exception:e,Location:"LiveDashboardVideo.js|removeAllCards"})}})};var m=function(){jQuery(document.body).on("CRTBLoadLiveEventsUploadDefaultsGetList",function(e,t){try{if(t.success){jQuery.each(JSON.parse(t.response),function(e,t){s.push(t)});var i=jQuery(this).find(".tb-live-dashboard-default-select:first");jQuery.each(s,function(e,t){i.append(jQuery("<option></option>").attr("value",t.Id).text(t.Name))});if(s.length>0){jQuery(".tb-live-dashboard-no-upload-default-profiles").hide();jQuery(".tb-live-dashboard-has-upload-default-profiles").show()}else{jQuery(".tb-live-dashboard-no-upload-default-profiles").show();jQuery(".tb-live-dashboard-has-upload-default-profiles").hide()}}}catch(e){jQuery(".tb-live-dashboard-no-upload-default-profiles").show();jQuery(".tb-live-dashboard-has-upload-default-profiles").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveDashboardVideo] CRUploadDefaultsGetList"})}});jQuery(document.body).on("CRTBLoadLiveDashboardVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);r()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyLiveDashboardVideo] CRTBLoadLiveDashboardVideoTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){m();l();b();e=true}else{r()}}},DeleteAllCardsCallBack:function(){jQuery(".tb-live-dashboard-cards-working").hide();TBUtilities.Alert("Cards successfully cleared!\n\nWe need to re-load the page for the changes to take effect. Any unsaved changes on this page will be lost. ",function(){location.reload()})}}}();var TubeBuddyScheduledMetaUpdates=function(){var e=false;var t=null;var i=null;var n=null;var o=null;var a=null;var s=null;var r=null;var l=null;var d=true;var c=function(){var e=TBGlobal.host+"/ModuleManager/ScheduledMetaUpdates/ScheduledMetaUpdates?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/scheduledmetaupdates.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/scheduledmetaupdates.html"}TBExtension.Get(e,"CRTBLoadScheduledMetaUpdatesTemplate")};var u=function(){jQuery(document).on("click",".tb-scheduled-meta-updates-video-upgrade-link",function(e){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.scheduledvideoupdate)});jQuery(document).on("click",".tb-scheduled-meta-updates-video-close, .tb-scheduled-meta-updates-video-closex",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-scheduled-meta-updates-video").hide()});jQuery(document).on("click",".tb-tabs-menu-item-container",function(){jQuery(this).parent().find(".tb-tabs-selected-menu-item").removeClass("tb-tabs-selected-menu-item");jQuery(this).parents().find(".tb-tabs-content").addClass("tb-hid");jQuery(this).addClass("tb-tabs-selected-menu-item");jQuery(this).find(".tb-tabs-menu-item-icon").addClass("tb-tabs-selected-menu-icon");jQuery(this).parents().find("#"+jQuery(this).attr("data-tab")).removeClass("tb-hid")});jQuery(document).on("click",".tb-scheduled-meta-updates-video-option-checkbox",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-option-checkbox click");var t=jQuery(this).is(":checked");if(t===true){jQuery(this).parent().parent().parent().parent().siblings().children().children("input,select,textarea").prop("disabled",false)}else{jQuery(this).parent().parent().parent().parent().siblings().children().children("input,textarea").val("");jQuery(this).parent().parent().parent().parent().siblings().children().children("input,select,textarea").prop("disabled",true)}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-removeFromPlaylistOptions",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-removeFromPlaylistOptions click");var t=jQuery(this).is(":checked");if(t===true){jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("checked",true)}else{var i=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.disable()}});jQuery(document).on("click","#tb-scheduled-meta-updates-timepicker",function(e){if(jQuery("#tb-scheduled-meta-updates-time").find(".tp-timepicker_wrap").length>0)if(jQuery("#tb-scheduled-meta-updates-time").find(".tp-timepicker_wrap")[0].outerHTML.indexOf("tb-pickr-midnight")==-1)jQuery("#tb-scheduled-meta-updates-time").find(".tp-timepicker_wrap").append('<div style="clear:both;"></div><div class="tb-pickr-midnight" style="border-top:solid 1px #ccc; padding-top:3px; padding-left:1px; margin:15px 5px 0px 5px;">Set to <a class="tb-pickr-set-to-midnight">Midnight</a></div>')});jQuery(document).on("click",".tb-pickr-set-to-midnight",function(e){jQuery("#tb-scheduled-meta-updates-time").find(".tp-meridian").find("input").val("AM");jQuery("#tb-scheduled-meta-updates-time").find(".tp-time").find("input").val("12");jQuery("#tb-scheduled-meta-updates-time").find(".tp-mins").find("input").val("00")});jQuery(document).on("click","#tb-scheduled-meta-updates-video-removeFromAllPlaylists",function(e){var t=jQuery(this).is(":checked");if(t===true){var i=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.disable()}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-thumbnail-option",function(e){var t=jQuery(this).is(":checked");if(t===false){s=null;o=null;a=null}});jQuery(document).on("change","#tb-scheduled-meta-updates-video-thumbnail-upload",function(e){var t=document.getElementById("tb-scheduled-meta-updates-video-thumbnail-upload").value;var i=t.match(/\.([^\.]+)$/)[1];i=i.toLowerCase();switch(i){case"png":case"bmp":case"gif":case"jpg":{$("#tb-scheduled-meta-updates-video-namefile").html(t)}break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");jQuery("#tb-scheduled-meta-updates-video-namefile").html(t);callback(false)}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-save",function(e){var t=jQuery("#tb-scheduled-meta-updates-video-thumbnail-option").is(":checked");if(t===true){f(function(e){if(e===true){if(y()){b()}}})}else{if(y()){b()}}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-addToPlaylists",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-addToPlaylists click");var t=jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){t.enable();t.showDropDown()}else{t.disable()}});jQuery(document).on("change","#tb-scheduled-meta-updates-video-removeFromPlaylistIds",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-removeFromPlaylistIds click");var t=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){t.enable()}else{t.disable()}});jQuery(document).on("change","#tb-scheduled-meta-updates-video-revert-option",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-revert-option click");if(jQuery(this).is(":checked")){jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-timepicker-revert").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick("enable")}else{jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-timepicker-revert").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick("disable")}});jQuery(document).on("click","input[name='descCampaignTarget']",function(e){TBUtilities.Log("input[name=descCampaignTarget] click");var t=jQuery(this).attr("value");jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-videoIds").hide();jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").hide();switch(t){case"0":{jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-videoIds").show();break}case"1":{jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").show();var i=jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.enable();i.showDropDown();break}}});jQuery(document).on("click",".tb-scheduled-meta-updates-video-cancel",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-cancel click");try{TBUtilities.Confirm("Are you sure you want to cancel this Video Update?",function(){var e=TBGlobal.host+TBGlobal.apiUrls.scheduledMetaUpdatesDelete;var t={Id:r};p(l);TBExtension.Post(e,JSON.stringify(t),"CRTBScheduledMetaUpdatesDelete",null,{contentType:"application/json"})},function(){})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] cancel click"})}})};var p=function(e){if(e.ScheduledMetaUpdateTitleUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-title-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-title-change").val(e.TitleUpdate);jQuery("#tb-scheduled-meta-updates-video-title-change").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-title-update-types").val(e.ScheduledMetaUpdateTitleUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-title-update-types").prop("disabled",false)}if(e.ScheduledMetaUpdateDescriptionUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-description-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-description-change").val(e.DescriptionUpdate);jQuery("#tb-scheduled-meta-updates-video-description-change").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-description-update-types").val(e.ScheduledMetaUpdateDescriptionUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-description-update-types").prop("disabled",false)}if(e.ScheduledMetaUpdateTagsUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-tags-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-tags-change").val(e.TagsUpdate);jQuery("#tb-scheduled-meta-updates-video-tags-change").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-tags-update-types").val(e.ScheduledMetaUpdateTagsUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-tags-update-types").prop("disabled",false)}if(e.ScheduledMetaUpdatePrivacyUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-privacy-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-privacy-type").val(e.ScheduledMetaUpdatePrivacyUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-privacy-type").prop("disabled",false)}jQuery("#tb-scheduled-meta-updates-video-datepicker").val(e.ScheduledLocalDate);var t=j(e.ScheduledLocalTime);jQuery("#tb-scheduled-meta-updates-timepicker").val(t);jQuery("#tb-scheduled-meta-updates-video-timezone-select").val(e.TimeZoneId);if(e.PlaylistIdsToAddTo&&e.PlaylistIdsToAddTo!=""){var i=jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.setIds(e.PlaylistIdsToAddTo);jQuery("#tb-scheduled-meta-updates-video-addToPlaylists").prop("checked",true)}if(e.PlaylistIdsToRemoveFrom&&e.PlaylistIdsToRemoveFrom!=""){var i=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.setIds(e.PlaylistIdsToAddTo);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistIds").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistIds").prop("disabled",false)}if(e.RemoveFromAllPlaylists===true){jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistIds").prop("disabled",false)}if(e.SendWarningEmail==true){jQuery("#tb-scheduled-meta-updates-video-emailreminder").prop("checked",true)}if(e.SendWarningEmailNow==true){jQuery("#tb-scheduled-meta-updates-video-emailreminder-now").prop("checked",true)}if(e.EndLocalDate!=null&&e.EndLocalTime!=null){jQuery("#tb-scheduled-meta-updates-video-revert-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").val(e.EndLocalDate);var t=j(e.EndLocalTime);jQuery("#tb-scheduled-meta-updates-timepicker-revert").val(t);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-timepicker-revert").prop("disabled",false)}};var b=function(){try{m();var e=g();var t=v(e,false);TBUtilities.Confirm(t,function(){var t='<img src="'+TBGlobal.host+'/images/general/loading1.gif" />'+'<span style="margin-left:10px; font-size: 130%">Scheduling...</span>';jQuery(".tb-scheduled-meta-updates-video-settings-container").block({message:t,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});var i=TBGlobal.host+TBGlobal.apiUrls.scheduledMetaUpdatesCreate;TBExtension.Post(i,JSON.stringify(e),"CRTBScheduledMetaUpdateCreate",null,{contentType:"application/json"})},function(){h()})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] save click"});jQuery("#tb-scheduled-meta-updates-video-save").text("Schedule Publish");jQuery("#tb-scheduled-meta-updates-video-save").attr("disabled",false)}};var y=function(){var e=g();if(jQuery(".tb-scheduled-meta-updates-video-main-content-options input[type=checkbox]:checked").length===0){TBUtilities.Alert("You must make a change above before scheduling an update");h();return false}var t=jQuery("#tb-scheduled-meta-updates-video-title-option").is(":checked");if(t===true){if(e.TitleUpdate==""){TBUtilities.Alert("Please enter a title change");h();return false}}var i=jQuery("#tb-scheduled-meta-updates-video-tags-option").is(":checked");if(i===true){if(e.TagsUpdate==""){h();TBUtilities.Alert("Please enter a tags change");return false}}var n=jQuery("#tb-scheduled-meta-updates-video-description-option").is(":checked");if(n===true){if(e.DescriptionUpdate==""){h();TBUtilities.Alert("Please enter a description change");return false}}var o=jQuery("#tb-scheduled-meta-updates-video-addToPlaylists").is(":checked");if(o===true){var a=[];if(e.PlaylistIdsToAddTo!=null&&e.PlaylistIdsToAddTo.length>0){var a=e.PlaylistIdsToAddTo.split(",")}if(a.length==0){h();TBUtilities.Alert("Please select a playlist to add to");return false}}var s=jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").is(":checked");if(s===true){if(e.RemoveFromAllPlaylists==false){var a=[];if(e.PlaylistIdsToRemoveFrom!=null&&e.PlaylistIdsToRemoveFrom.length>0){var a=e.PlaylistIdsToRemoveFrom.split(",")}if(a.length==0){h();TBUtilities.Alert("Please select a playlist to remove");return false}}}var r=jQuery("#tb-scheduled-meta-updates-video-revert-option").is(":checked");if(r===true){var l=jQuery("#tb-scheduled-meta-updates-video-datepicker").val();var d=jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").val();var c=new Date(l);var u=new Date(d);if(c.getTime()>u.getTime()){h();TBUtilities.Alert("Please select a rollback date that is after the start date");return false}}return true};var m=function(){jQuery("#tb-scheduled-meta-updates-video-save").text("Scheduling...");jQuery("#tb-scheduled-meta-updates-video-save").attr("disabled",true)};var h=function(){jQuery(".tb-scheduled-meta-updates-video-settings-container").unblock();jQuery("#tb-scheduled-meta-updates-video-save").text("Schedule Video Update");jQuery("#tb-scheduled-meta-updates-video-save").attr("disabled",false)};var f=function(e){var t=document.getElementById("tb-scheduled-meta-updates-video-thumbnail-upload");var i=t.value;$("#tb-scheduled-meta-updates-video-namefile").html(i);if(!i){TBUtilities.Alert("Please choose a thumbnail file to upload");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");e(false)}var n=i.match(/\.([^\.]+)$/)[1];n=n.toLowerCase();switch(n){case"png":case"bmp":case"gif":case"jpg":break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");$("#tb-scheduled-meta-updates-video-namefile").html(i);e(false)}var r=t.files[0].size;if(r>2e6){TBUtilities.Alert("The maximum image file size is 2MB. Please select a smaller image.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");e(false)}var l=new FileReader;l.readAsDataURL(t.files[0]);l.onloadend=function(t){var i=t.target.result;s=i;var r="";switch(n){case"png":r=i.replace("data:image/png;base64,","");break;case"bmp":r=i.replace("data:image/bmp;base64,","");break;case"gif":r=i.replace("data:image/gif;base64,","");break;case"jpg":r=i.replace("data:image/jpeg;base64,","");break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");e(false)}o=r;a=n;e(true)}};var v=function(e,t){var i=e.ScheduledLocalDate;var n=j(e.ScheduledLocalTime);var a=e.TimeZoneId;var r=jQuery("#tb-scheduled-meta-updates-video-summary-template").html();var l="";if(e.ScheduledMetaUpdateTitleUpdateTypes!=0||e.ScheduledMetaUpdateDescriptionUpdateTypes!=0||e.ScheduledMetaUpdateTagsUpdateTypes!=0||e.ScheduledMetaUpdatePrivacyUpdateTypes!=0||(o!=null||e.ScheduledMetaUpdateThumbnailUpdateTypes!=0&&e.ThumbnailId!="")){l="<table class='tb-scheduled-meta-updates-video-summary-table'>";l+='<tr><th style="width:100px"></th><th style="width:100px">Update Type</th> <th style="width:300px">Value</th> </tr>';if(e.ScheduledMetaUpdateTitleUpdateTypes!=0){l+="<tr><td><strong>Title</strong></td><td>"+e.ScheduledMetaUpdateTitleUpdateTypesDesc+"</td><td>"+e.TitleUpdate+"</td></tr>"}if(e.ScheduledMetaUpdateDescriptionUpdateTypes!=0){l+="<tr><td><strong>Description</strong></td><td>"+e.ScheduledMetaUpdateDescriptionUpdateTypesDesc+"</td><td>"+e.DescriptionUpdate+"</td></tr>"}if(e.ScheduledMetaUpdateTagsUpdateTypes!=0){l+="<tr><td><strong>Tags</strong></td><td>"+e.ScheduledMetaUpdateTagsUpdateTypesDesc+"</td><td>"+e.TagsUpdate+"</td></tr>"}if(e.ScheduledMetaUpdatePrivacyUpdateTypes!=0){l+="<tr><td><strong>Privacy</strong></td><td> Overwrite </td><td>"+e.ScheduledMetaUpdatePrivacyUpdateTypesDesc+"</td></tr>"}if(o!=null){var d=jQuery("<img>");d.attr("src",s);d.attr("height","25px");l+="<tr><td><strong>Thumbnail</strong></td><td> Overwrite </td><td>"+d[0].outerHTML+"</td></tr>"}if(e.ScheduledMetaUpdateThumbnailUpdateTypes!=0&&e.ThumbnailId!=""){var d=jQuery("<img>");d.attr("src","https://s3-us-west-1.amazonaws.com/tubebuddy/scheduledmetaupdates/"+e.ThumbnailId+".jpg");d.attr("height","25px");l+="<tr><td><strong>Thumbnail</strong></td><td> Overwrite </td><td>"+d[0].outerHTML+"</td></tr>"}l+="</table>"}var c="";if(e.RemoveFromAllPlaylists==true){c="&#149;Video will be removed from <span style='background-color:#ffffcc; padding:3px 4px'><strong>all</strong> playlists</span>"}else if(e.PlaylistIdsToRemoveFrom!=null&&e.PlaylistIdsToRemoveFrom!=""){var u=e.PlaylistIdsToRemoveFrom.split(",");c="&#149;Video will be removed from the following playlists:<br>";jQuery.each(e.PlaylistsToRemoveFrom,function(e,t){c+='&nbsp;&nbsp;<strong style="font-size:13px; padding:4px 3px;"><a target="_blank" href="https://www.youtube.com/playlist?list='+t.Id+'">'+t.Title+"</a></strong><br>"})}var p="";if(e.PlaylistIdsToAddTo!=null&&e.PlaylistIdsToAddTo!=""){var u=e.PlaylistIdsToAddTo.split(",");p="&#149;Video will be added to the following playlists:<br>";jQuery.each(e.PlaylistsToAddTo,function(e,t){p+='&nbsp;&nbsp;<strong style="font-size:13px; padding:4px 3px;"><a target="_blank" href="https://www.youtube.com/playlist?list='+t.Id+'">'+t.Title+"</a></strong><br>"})}var b="";if(e.EndLocalDate!=null&&e.EndLocalTime!=null){var y=e.EndLocalDate;var m=j(e.EndLocalTime);b="<p class='tb-margin-bottom-5'>Changes will be rolled back on:</p> <span style='font-size:16px; color: #4A90E2;' class='tb-font-medium'>"+y+"  at "+m+" "+a+"</span>"}var h="&#149;  We'll send you an email reminder the day before.";if(e.SendWarningEmail==false){h=""}if(t===false&&e.SendWarningEmailNow===true){if(h.length>0){h+="<br>"}h+="&#149;  We'll send you a copy of scheduled changes right now."}var f="Are you sure you want to schedule the following changes?";var v="";if(t==true){v='<img style="position: relative; top: 3px; margin-right:3px" src="https://tubebuddy.com/images/icons/check.png" />';f=""}var g=r.formatTemplate(i,n,a,l,c,p,b,h,f,v);return g};var g=function(){var e=jQuery("#tb-scheduled-meta-updates-video-datepicker").val();var i=T(jQuery("#tb-scheduled-meta-updates-timepicker").val());var n=jQuery("#tb-scheduled-meta-updates-timepicker").val();var s=jQuery("#tb-scheduled-meta-updates-video-timezone-select").val();var r=jQuery("#tb-scheduled-meta-updates-video-privacy-option").is(":checked");var l=0;var d=null;if(r===true){l=jQuery("#tb-scheduled-meta-updates-video-privacy-type").val();d=jQuery("#tb-scheduled-meta-updates-video-privacy-type option:selected").text()}var c=jQuery("#tb-scheduled-meta-updates-video-title-option").is(":checked");var u=0;var p=null;var b=null;if(c===true){b=jQuery("#tb-scheduled-meta-updates-video-title-update-types option:selected").text();u=jQuery("#tb-scheduled-meta-updates-video-title-update-types").val();p=jQuery("#tb-scheduled-meta-updates-video-title-change").val();jQuery("#tb-scheduled-meta-updates-video-title-change").prop("disabled",false)}var y=jQuery("#tb-scheduled-meta-updates-video-tags-option").is(":checked");var m=0;var h=null;var f=null;if(y===true){m=jQuery("#tb-scheduled-meta-updates-video-tags-update-types").val();h=jQuery("#tb-scheduled-meta-updates-video-tags-change").val();f=jQuery("#tb-scheduled-meta-updates-video-tags-update-types option:selected").text()}var v=jQuery("#tb-scheduled-meta-updates-video-description-option").is(":checked");var g=0;var j=null;var Q=null;if(v===true){g=jQuery("#tb-scheduled-meta-updates-video-description-update-types").val();j=jQuery("#tb-scheduled-meta-updates-video-description-change").val();Q=jQuery("#tb-scheduled-meta-updates-video-description-update-types option:selected").text()}var B=jQuery("#tb-scheduled-meta-updates-video-addToPlaylists").is(":checked");var k=null;var w=null;if(B===true){var x=jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");var U=x.getSelectedPlaylistIds();w=x.getSelectedPlaylists();if(U.length>0){k=U.join(",")}}var L=jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").is(":checked");var C=null;var E=false;var S=null;if(L===true){if(jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").is(":checked")){E=true}else{var x=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");S=x.getSelectedPlaylists();var U=x.getSelectedPlaylistIds();if(U.length>0){C=U.join(",")}}}var I=jQuery("#tb-scheduled-meta-updates-video-emailreminder").is(":checked");var A=jQuery("#tb-scheduled-meta-updates-video-emailreminder-now").is(":checked");var G=null;var R=null;var V=jQuery("#tb-scheduled-meta-updates-video-revert-option").is(":checked");if(V===true){G=jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").val();R=T(jQuery("#tb-scheduled-meta-updates-timepicker-revert").val())}var D={TargetIds:t,ScheduledLocalDate:e,ScheduledLocalTime:i,TimeZoneId:s,ScheduledMetaUpdatePrivacyUpdateTypes:l,ScheduledMetaUpdatePrivacyUpdateTypesDesc:d,ScheduledMetaUpdateTitleUpdateTypes:u,TitleUpdate:p,ScheduledMetaUpdateTitleUpdateTypesDesc:b,ScheduledMetaUpdateDescriptionUpdateTypes:g,DescriptionUpdate:j,ScheduledMetaUpdateDescriptionUpdateTypesDesc:Q,ScheduledMetaUpdateTagsUpdateTypes:m,TagsUpdate:h,ScheduledMetaUpdateTagsUpdateTypesDesc:f,ScheduledMetaUpdateThumbnailUpdateTypes:0,PlaylistIdsToAddTo:k,PlaylistsToAddTo:w,PlaylistIdsToRemoveFrom:C,PlaylistsToRemoveFrom:S,RemoveFromAllPlaylists:E,SendWarningEmail:I,SendWarningEmailNow:A,TimeRecent:n,ScheduledMetaUpdateTargetVideoType:0,EndLocalDate:G,EndLocalTime:R,ThumbnailData:o,ThumbnailExt:a};return D};var T=function(e){var t=e.split(":");if(t.length!=3){throw"invalid time format"}var i=t[0];var n=t[1];if(t[2].trim()=="PM"&&t[0]!=12){i=parseInt(i,10);i=i+12}if(t[2].trim()=="AM"&&t[0]==12)i=0;var o=parseInt(i,10)*60+parseInt(n,10);return o};var j=function(e){var t=Math.floor(e/60);var e=e%60;var i=t>=12?"PM":"AM";t=t%12;t=t?t:12;e=e<10?"0"+e:e;var n=t+":"+e+":"+i;return n};var Q=function(){jQuery(document.body).on("CRTBLoadScheduledMetaUpdatesTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);k()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBLoadScheduledMetaUpdatesTemplate"})}});jQuery(document.body).on("CRTBScheduledMetaUpdatesGetVideo",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i.ScheduledMetaUpdateViewModel==null){h();jQuery("#tb-scheduled-meta-updates-video-loading").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loaded").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-edit").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-current").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-cancel").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-status-bar").addClass("tb-hid");var n=jQuery("#tb-scheduled-meta-updates-video-datepicker").datepick({minDate:new Date,onSelect:function(e){try{var t=$(this).val();var i=24*60*60*1e3;var n=Math.abs((new Date(t).getTime()-(new Date).getTime())/i);if(n<=1){jQuery("#tb-scheduled-meta-updates-video-emailreminder").attr("checked",false);jQuery("#tb-scheduled-meta-updates-video-emailreminder").attr("disabled",true)}else{jQuery("#tb-scheduled-meta-updates-video-emailreminder").attr("disabled",false)}}catch(e){}}});var n=jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick({minDate:new Date,onSelect:function(e){}});if(!jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-tim")){jQuery("#tb-scheduled-meta-updates-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}if(!jQuery("#tb-scheduled-meta-updates-timepicke-revertr").attr("data-timepicki-tim")){jQuery("#tb-scheduled-meta-updates-timepicker-revert").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}if(d===true){var o=jQuery("#tb-scheduled-meta-updates-video-timezone-select");o.empty();jQuery(i.TimeZones).each(function(){o.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});var a=new Date;var s=new Date(a);s.setDate(a.getDate()+2);jQuery("#tb-scheduled-meta-updates-video-datepicker").datepick("setDate",s);var a=new Date;var c=new Date(a);c.setDate(a.getDate()+7);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick("setDate",c);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick({minDate:new Date});try{var u=jstz.determine_timezone();var p=u.timezone;if(p!="undefined"){p.ambiguity_check()}jQuery.each(i.TimeZones,function(e,t){if(t.DisplayName.indexOf(p.utc_offset)>0){o.val(t.Id)}})}catch(e){}jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").prop("checked",false);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("checked",false);jQuery("#tb-scheduled-meta-updates-video-input-ids").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-timepicker-revert").val("09 : 30 : AM");jQuery("#tb-scheduled-meta-updates-timepicker-revert").timepicki({start_time:["09","30","AM"]});jQuery("#tb-scheduled-meta-updates-timepicker-revert").attr("data-timepicki-tim","09");jQuery("#tb-scheduled-meta-updates-timepicker-revert").attr("data-timepicki-mini","30");jQuery("#tb-scheduled-meta-updates-timepicker-revert").attr("data-timepicki-meri","AM");jQuery("#tb-scheduled-meta-updates-timepicker").val("09 : 30 : AM");jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-tim","09");jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-mini","30");jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-meri","AM")}}else{jQuery("#tb-scheduled-meta-updates-video-loading").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-edit").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-current").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loaded").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-cancel").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-status-bar").removeClass("tb-hid");var o=jQuery("#tb-scheduled-meta-updates-video-timezone-select");o.empty();jQuery(i.TimeZones).each(function(){o.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});r=i.ScheduledMetaUpdateViewModel.Id;l=i.ScheduledMetaUpdateViewModel;var b=v(i.ScheduledMetaUpdateViewModel,true);jQuery("#tb-scheduled-meta-updates-video-current").html(b)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBScheduledMetaUpdatesGetVideo"})}});jQuery(document.body).on("CRTBScheduledMetaUpdateCreate",function(e,t){try{jQuery(".tb-scheduled-meta-updates-video-settings-container").unblock();o=null;s=null;a=null;if(t.success){B()}else{TBUtilities.Alert("There was a problem saving your request.  Please try again...");h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBLoadScheduledMetaUpdatesTemplate"})}});jQuery(document.body).on("CRTBScheduledMetaUpdatesDelete",function(e,t){try{r=null;l=null;d=false;if(t.success){B()}else{TBUtilities.Alert("There was a problem with your request.  Please try again...")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBLoadScheduledMetaUpdatesTemplate"})}})};var B=function(){if(TBGlobal.CanAccessLevel2Tools()==true){if(t){var e=TBGlobal.host+TBGlobal.apiUrls.scheduledMetaUpdatesGetByVideo+"?videoId="+t;TBExtension.Get(e,"CRTBScheduledMetaUpdatesGetVideo")}}else{jQuery("#tb-scheduled-meta-updates-video-upgrade").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loading").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-loaded").addClass("tb-hid")}};var k=function(){jQuery("#tb-scheduled-meta-updates-video-container").show();jQuery("#tb-scheduled-meta-updates-video-loading").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loaded").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-current").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-cancel").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-status-bar").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-upgrade").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-edit").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").addClass("tb-hid");h();B();jQuery(".tb-scheduled-meta-updates-video-option-checkbox").prop("checked","");jQuery(".tb-scheduled-meta-updates-video-option-checkbox").siblings("input, textarea").not("input:radio").val("");jQuery(".tb-scheduled-meta-updates-video-option-checkbox").siblings("input, textarea, select").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-video-revert-option").prop("checked","");jQuery("#tb-scheduled-meta-updates-video-emailreminder").prop("checked","");jQuery("#tb-scheduled-meta-updates-video-emailreminder-now").prop("checked","");jQuery(".tb-scheduled-meta-updates-video-tab").removeClass("tb-scheduled-meta-updates-video-tab-selected");jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true});jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true});jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").playlistSelect({tbMaterial:true});jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-videoIds").hide();jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").hide();jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-allVideos").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-thumbnail").attr("src",n);jQuery("#tb-scheduled-meta-updates-video-link").text(i);jQuery("#tb-scheduled-meta-updates-video-link").attr("href","https://www.youtube.com/watch?v="+t);o=null;a=null;s=null;r=null;d=true;jQuery('[data-tbtooltip!=""]').qtip({content:{attr:"data-tbtooltip"},style:{classes:"qtip-youtube-tubebuddy"}})};return{Show:function(o,a,s){if(TBGlobal.IsAuthenticated()){t=o;i=a;n=s?s:"https://img.youtube.com/vi/"+t+"/mqdefault.jpg";if(!e){Q();c();u();e=true}else{k()}}}}}();