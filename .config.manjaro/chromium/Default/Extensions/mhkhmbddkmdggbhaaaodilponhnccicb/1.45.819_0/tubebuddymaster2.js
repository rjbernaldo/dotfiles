var TubeBuddySocialBlade=function(){var e=function(){this.image="";this.url="";this.handle="";this.type=0;this.twitterHandle="";this.title=""};var t={YouTube:0,GooglePlus:1,Twitter:2,Facebook:3};var i=false;var a=false;var r=null;var o=null;var n=null;var s=null;var l=null;var u=null;var c=null;var d=null;var b=null;var h=null;var y=null;var p=null;var m=null;var f=null;var g=null;var v=null;var T=null;var j=null;var Q=null;var k=null;var B=null;var C=2500;var w=[];var A=function(){try{a=false;var e=TBGlobal.GetYouTubeUI();switch(e){case"studio":case"material":{var t=jQuery("ytd-expandable-tab-renderer:not(.tb-socialblade-tab-material):last");var i=t.find(".tb-socialblade-tab-material").length;if(i<1){var r=jQuery(".tb-socialblade-tab-material:last")[0].outerHTML;t.append(r)}break}case"default":{jQuery("#channel-search").parent().before(jQuery(".tb-socialblade-tab-item:last")[0].outerHTML);jQuery(".appbar-nav-menu").append(jQuery(".tb-socialblade-tab-item:last")[0].outerHTML);break}}}catch(e){TBUtilities.LogError({Exception:ex3,Location:"[TubeBuddySocialBlade] populateContent"})}};var x=function(){jQuery(".tb-socialblade-live-counter").empty();jQuery(".tb-socialblade-live-counter").append('<div style="position:relative; top:-6px; left:10px; font-size:24px;"><span style="position:relative; top:-1px; left:-16px;"><span class="beacon"></span></span><span style="font-weight:normal">Real-Time</span> Subscriber Count</div><div class="counter-wrapper"><ul class="flip-counter small" id="myCounter"></ul></div><div style="clear:both"></div><div class="live-update-value" style="text-align:center"></div>');k=new flipCounter("myCounter",{value:Q,inc:1,pace:1e3,auto:false});clearInterval(B);C=2500;B=setTimeout(I,C)};var I=function(){TBUtilities.Log("live count");TBExtension.Get(TBGlobal.host+TBGlobal.apiUrls.dataGetChannelSubscriberCount+"?id="+r,"CRTBLoadRealTimeStats")};var U=function(e){var t=e-Q;k.add(t);Q=e;if(t>0){jQuery(".live-update-value").html('<span style="color:green; font-weight:bold; position:relative; top:5px;">+'+TBUtilities.FormatNumberWithCommas(t)+"</span>");jQuery(".live-update-value").show().delay(1500).fadeOut(1e3)}else if(t<0){jQuery(".live-update-value").html('<span style="color:red; font-weight:bold; position:relative; top:5px;">'+TBUtilities.FormatNumberWithCommas(t)+"</span>");jQuery(".live-update-value").show().delay(1500).fadeOut(1e3)}else{jQuery(".live-update-value").html('<span style="color:#666; position:relative; top:5px;">+0</span>');jQuery(".live-update-value").show().fadeOut(1e3)}C=C*1.05;if(C>3e4)C=C*1.25;B=setTimeout(I,C);TBUtilities.Log(C)};var L=function(){var e=TBGlobal.host+"/ModuleManager/socialblade/socialblade?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/socialblade.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/socialblade.html"}TBExtension.Get(e,"CRTBLoadSocialBladeTemplate")};var S=function(e){TubeBuddyStatFire.GetCompetitorChannelStats(TBGlobal.CurrentChannelId(),r,e,30,TubeBuddySocialBlade.GotChannelStats)};var G=function(){TubeBuddyStatFire.GetChannelInfo(r,TubeBuddySocialBlade.GotChannelInfo)};var E=function(){TubeBuddyMenu.ShowBackgroundSticky();jQuery("#tb-socialblade-container").show();jQuery("#tb-statfire-chart-type").val("subscribers");jQuery("#tb-statfire-chart-data").val("1");jQuery(".tb-social-blade-channel-title").text("...");jQuery(".tb-social-blade-socialProfiles-container").html('<img src="'+TBGlobal.host+'/images/general/loading1.gif" /><span class="tb-move-up4">Loading...</span>');D()};var R=function(){jQuery(document).on("click",".tb-social-blade-close",function(e){if(jQuery(".tb-statfire-subscribers").highcharts()){jQuery(".tb-statfire-subscribers").highcharts().destroy()}if(jQuery(".tb-statfire-subscribers-cumulative").highcharts()){jQuery(".tb-statfire-subscribers-cumulative").highcharts().destroy()}if(jQuery(".tb-statfire-views").highcharts()){jQuery(".tb-statfire-views").highcharts().destroy()}if(jQuery(".tb-statfire-views-cumulative").highcharts()){jQuery(".tb-statfire-views-cumulative").highcharts().destroy()}if(jQuery(".tb-statfire-videos").highcharts()){jQuery(".tb-statfire-videos").highcharts().destroy()}if(jQuery(".tb-statfire-videos-cumulative").highcharts()){jQuery(".tb-statfire-videos-cumulative").highcharts().destroy()}a=false;jQuery("#tb-socialblade-container").hide()});jQuery(document).on("click",".tb-social-blade-close",function(){if(B){clearTimeout(B)}TubeBuddyMenu.HideBackground();jQuery("#tb-tag-explorer-container").hide()});jQuery(document).on("click",".tb-socialblade-tab-material",function(e){TBUtilities.Log("tb-socialblade-tab-material");e.stopPropagation();P()});jQuery(document).on("click",".tb-social-blade-channel-id",function(e){jQuery(".tb-social-blade-channel-id-copied").show().delay(2e3).fadeOut()});jQuery(document).on("click",".tb-socialblade-copy-tags",function(e){e.stopPropagation();TubeBuddyCopyTo.ShowMenu(jQuery(this),w)});jQuery(document).on("change","#tb-statfire-chart-type",function(){S(jQuery("#tb-statfire-chart-data").val());N()});jQuery(document).on("change","#tb-statfire-chart-data",function(){if(jQuery("#tb-statfire-chart-data").val()==2||jQuery("#tb-statfire-chart-data").val()==2){TBUtilities.Alert('Unfortunately YouTube has updated their <a href="https://developers.google.com/youtube/terms/developer-policies" target="_blank">Developer API Terms Of Service</a> and we are no longer allowed to provide data beyond 30 days. (Section E.4.d)<br><br>We are working with YouTube to see what other options we have but for now, we cannot provide data beyond 30 days, sorry.');jQuery("#tb-statfire-chart-data").val("1");return}S(jQuery("#tb-statfire-chart-data").val());N()});jQuery(document).on("click","#channel-navigation-menu h2, .appbar-nav-menu h2",function(){jQuery(".branded-page-v2-col-container").show();jQuery("#tb-socialblade-layout").hide();jQuery(".tb-socialblade-tab-link").show()});jQuery(document).on("click",".tb-socialblade-tab-item",function(){P()})};var V=function(e,t,i){var a="";if(e.indexOf("UC")==0&&e.length=="UCo33niDKpTpgwZ_dohqvylg".length){a="https://www.youtube.com/channel/"+e}else{a="https://www.youtube.com/user/"+e}T=t;E();TubeBuddyYouTubeActions.GetChannelInfoFromPage(a,M)};var M=function(t){TBUtilities.Log("showChannelData");TBUtilities.Log(t);if(t!=null){try{var i=TBGlobal.GetYouTubeUI();TBUtilities.Log("ytUI"+i);switch(i){case"studio":case"material":{T=jQuery("#channel-title").text();r=t.ChannelId;v=t.Tags;var o="https://www.youtube.com/channel/"+r+"/about";TBExtension.Get(o,function(t,i,a){try{if(t){var r=a.indexOf('window["ytInitialData"] = ');r=r+26;var o=a.substring(r,a.length);var n=o.indexOf("};")+1;var o=o.substring(0,n);var s=jQuery.parseJSON(o);try{if(s.contents.twoColumnBrowseResultsRenderer){try{var l=s.contents.twoColumnBrowseResultsRenderer.tabs[5].tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.primaryLinks;jQuery(".tb-social-blade-socialProfiles-container").html("");if(l&&l.length>0){jQuery.each(l,function(t,i){try{var a=new e;a.image=i.icon.thumbnails["0"].url;a.title=i.title.simpleText;a.url=i.navigationEndpoint.urlEndpoint.url;jQuery(".tb-social-blade-socialProfiles-container").append('<a class="tb-margin-left5" style="display:inline;" href="'+a.url+'" target="_blank"><img src="'+a.image+'" /><span class="tb-move-up3 tb-margin-left2">'+a.title+"<span></a>")}catch(e){}})}else{jQuery(".tb-social-blade-socialProfiles-container").html("(none)")}}catch(e){jQuery(".tb-social-blade-socialProfiles-container").html("(na)")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"socialBlade.js|showChannelData"})}}else{TBUtilities.LogFailedWebRequest({Location:"socialBlade.js|showChannelData",Data:i,Response:a})}}catch(e){TBUtilities.LogError({Exception:e,Location:"socialBlade.js|showChannelData"})}},null,{cache:false});break}case"default":{T=jQuery(".branded-page-header-title-link").attr("title");r=t.ChannelId;break}}if(!T)T=t.Title;TBUtilities.Log("_currentChannelTitle"+T);TBUtilities.Log("_currentChannelId"+r);TBUtilities.Log("_currentChannelTags"+v);TBUtilities.Log("_loaded"+a);if(!a){a=true;G()}else{F()}N();jQuery(".branded-page-header-title").after('<input type="text" style="color:white; border:0; width:100px;" value="'+r+'" />');jQuery(".tb-statfire-you-thumbnail").attr("src",TBGlobal.Profile().ThumbnailUrl);try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.Channelytics_Use,"channelytics")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialBlade] [tabClicked]"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialBlade] tabClicked"})}}};var P=function(){_extractedTitle=null;_extractedThumbnail=null;E();TubeBuddyYouTubeActions.GetChannelInfoFromPage(window.location.href,M)};var D=function(){jQuery(".tb-statfire-loading-container").show();jQuery(".tb-statfire-container").hide()};var F=function(){jQuery(".tb-statfire-loading-container").hide();jQuery(".tb-statfire-container").show()};var O=function(){var e=0;var t=0;var i=jQuery("#tb-statfire-chart-data").val();var a=jQuery("#tb-statfire-chart-type").val();if(i==1){switch(a){case"subscribers":jQuery.each(h,function(t,i){e+=i});jQuery.each(y,function(e,i){t+=i});break;case"views":jQuery.each(u,function(t,i){e+=i});jQuery.each(c,function(e,i){t+=i});break;case"videos":jQuery.each(f,function(t,i){e+=i});jQuery.each(g,function(e,i){t+=i});break}}else{switch(a){case"subscribers":e=d[d.length-1];t=b[b.length-1];break;case"views":e=s[s.length-1];t=l[l.length-1];break;case"videos":e=p[p.length-1];t=m[m.length-1];break}}jQuery(".tb-socialblade-you-value").text(TBUtilities.FormatNumberAbbreviated(e));jQuery(".tb-socialblade-them-value").text(TBUtilities.FormatNumberAbbreviated(t))};var N=function(){var e=jQuery("#tb-statfire-chart-data").val();var t=jQuery("#tb-statfire-chart-type").val();TBUtilities.Log("dataType = "+e);TBUtilities.Log("chartType = "+t);jQuery(".tb-socialblade-you-value").html('<img src="'+TBGlobal.host+'/images/general/loading1.gif" />');jQuery(".tb-socialblade-them-value").html('<img src="'+TBGlobal.host+'/images/general/loading1.gif" />');jQuery(".tb-statfire-chart").hide();var i=false;switch(t){case"subscribers":{if(e==1){if(!jQuery(".tb-statfire-subscribers").highcharts()){i=false;jQuery(".tb-statfire-subscribers-container").show();jQuery(".tb-statfire-subscribers-loading").show()}else{i=true;jQuery(".tb-statfire-subscribers-container").show()}}else{if(!jQuery(".tb-statfire-subscribers-cumulative").highcharts()){i=false;jQuery(".tb-statfire-subscribers-cumulative-loading").show();jQuery(".tb-statfire-subscribers-cumulative-container").show()}else{i=true;jQuery(".tb-statfire-subscribers-cumulative-container").show()}}break}case"views":{if(e==1){if(!jQuery(".tb-statfire-views").highcharts()){i=false;jQuery(".tb-statfire-views-container").show();jQuery(".tb-statfire-views-loading").show()}else{i=true;jQuery(".tb-statfire-views-container").show()}}else{if(!jQuery(".tb-statfire-views-cumulative").highcharts()){i=false;jQuery(".tb-statfire-views-cumulative-loading").show();jQuery(".tb-statfire-views-cumulative-container").show()}else{i=true;jQuery(".tb-statfire-views-cumulative-container").show()}}break}case"videos":{if(e==1){if(!jQuery(".tb-statfire-videos").highcharts()){i=false;jQuery(".tb-statfire-videos-container").show();jQuery(".tb-statfire-videos-loading").show()}else{i=true;jQuery(".tb-statfire-videos-container").show()}}else{if(!jQuery(".tb-statfire-videos-cumulative").highcharts()){i=false;jQuery(".tb-statfire-videos-cumulative-loading").show();jQuery(".tb-statfire-videos-cumulative-container").show()}else{i=true;jQuery(".tb-statfire-videos-cumulative-container").show()}}break}}};var _=function(e,t){o=H(t.ChannelStats);n=H(t.CompetitorStats);var i=parseInt(jQuery("#tb-statfire-chart-data").val());var a=jQuery("#tb-statfire-chart-type").val();switch(a){case"subscribers":{if(i==1){z(o,n,t.Labels);h=o;y=n}else{Y(o,n,t.Labels);d=o;b=n}break}case"views":{if(i==1){J(o,n,t.Labels);u=o;c=n}else{$(o,n,t.Labels);s=o;l=n}break}case"videos":{if(i==1){q(o,n,t.Labels);f=o;g=n}else{Z(o,n,t.Labels);p=o;m=n}break}}O()};var H=function(e){var t=parseInt(jQuery("#tb-statfire-chart-data").val());var i=jQuery("#tb-statfire-chart-type").val();TBUtilities.Log("dataType = "+t);TBUtilities.Log("chartType = "+i);var a=new Array;jQuery.each(e,function(e,r){switch(i){case"subscribers":{if(t==1){a.push(r.SubscribersGained)}else{a.push(r.SubscriberCount)}break}case"views":{if(t==1){a.push(r.ViewsGained)}else{a.push(r.ViewCount)}break}case"videos":{if(t==1){a.push(r.VideosUploaded)}else{a.push(r.VideoCount)}break}}});TBUtilities.Log("createDataPoints results");TBUtilities.Log(a);return a};var W=function(e,t){var i=TBGlobal.GetYouTubeUI();var a=t.channelImage;w=[];var o=jQuery("#tb-socialblade-basestats-template").html();var n=o.formatTemplate(TBUtilities.FormatNumberAbbreviated(t.view_count),TBUtilities.FormatNumberAbbreviated(t.subscriber_count),TBUtilities.FormatNumberAbbreviated(t.video_count),TBUtilities.FormatNumberAbbreviated(t.views_per_video),TBUtilities.FormatNumberAbbreviated(t.average_views_per_month),"n/a","n/a","n/a",a,(t.IsTubeBuddyUser==true?"YES! ðŸ˜Ž":'Nope <br><span style="font-weight:normal; font-size:.8em; line-height:13px;"> (or kept private)')+'<br><a href="'+TBGlobal.host+"/channel/preferences/"+TBGlobal.CurrentChannelId()+'" target="_blank">my settings</a></span>',"");jQuery(".tb-socialblade-basestats").empty();jQuery(".tb-socialblade-basestats").append(n);jQuery(".tb-social-blade-tag-list-container").empty();jQuery(".tb-social-blade-tag-list-container").append('<img src="'+TBGlobal.host+"/images/general/loading1.gif"+'" /> Loading...');jQuery(".tb-social-blade-channel-id").val(r);jQuery(".tb-social-blade-channel-id").attr("data-clipboard-text",r);var s=new ClipboardJS(".tb-social-blade-channel-id");jQuery(".tb-social-blade-channel-title").text(t.title);T=t.title;jQuery(".tb-statfire-them-thumbnail").attr("src",t.channelImage);switch(i){case"studio":case"material":{jQuery(".tb-social-blade-tag-list-container").empty();if(v!=null){var l=v.match(/\w+|"(?:\\"|[^"])+"/g);var u="";if(l){jQuery.each(l,function(e,t){t=t.replace(/['"]+/g,"");u+=t+", ";jQuery(".tb-social-blade-tag-list-container").append('<span title="'+t.toLowerCase().trim()+'" class="tb-socialblade-tag-item">'+TBUtilities.GetHtmlEncoded(t.trim())+"</span>")})}if(!u)jQuery(".tb-social-blade-tag-list-container").append("(none)");if(u.length>3){u=u.substring(0,u.length-2);jQuery(".tb-socialblade-copy-tags").show()}w=l}else{TBExtension.Get("https://www.youtube.com/channel/"+e,"CRTBSocialBladeLoadPageDetails")}break}case"default":{TBExtension.Get("https://www.youtube.com/channel/"+e,"CRTBSocialBladeLoadPageDetails");break}}Q=new Number(t.subscriber_count);x();S(1);jQuery(".tb-socialblade-mySettings").attr("href",TBGlobal.host+"/channel/preferences/"+TBGlobal.CurrentChannelId());if(!t.IsTubeBuddyUser){jQuery("#isNotTubeBuddyUser").show();jQuery("#isTubeBuddyUser").hide()}else{jQuery("#isNotTubeBuddyUser").hide();jQuery("#isTubeBuddyUser").show()}F()};var z=function(e,t,i){jQuery(".tb-statfire-subscribers").highcharts({title:{text:""},credits:{enabled:false},xAxis:{categories:i},yAxis:{title:{text:"Subscribers Gained"},plotLines:[{value:0,width:0,color:"#808080"}],min:0},plotOptions:{spline:{marker:{enabled:false}}},tooltip:{formatter:function(){var e="gained";var t="subscribers ";var i=Math.abs(this.y);if(this.y<0){e="lost"}if(i==1){t="subscriber "}return this.x+"<br> <b>"+TBUtilities.FormatNumberAbbreviated(i)+"</b>  "+t+e}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:TBGlobal.Profile().Title,data:e,color:"#33FF33"},{name:T,data:t,color:"#FF3333"}]});jQuery(".tb-statfire-subscribers-loading:first").hide()};var Y=function(e,t,i){jQuery(".tb-statfire-subscribers-cumulative").highcharts({title:{text:""},credits:{enabled:false},xAxis:{categories:i},yAxis:{title:{text:"Subscribers"},plotLines:[{value:0,width:0,color:"#808080"}],min:0},plotOptions:{spline:{marker:{enabled:false}}},tooltip:{formatter:function(){return this.x+"<br> <b>"+TBUtilities.FormatNumberAbbreviated(this.y)+"</b> subscribers "}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:TBGlobal.Profile().Title,data:e,color:"#33FF33"},{name:T,data:t,color:"#FF3333"}]});jQuery(".tb-statfire-subscribers-cumulative-loading:first").hide()};var J=function(e,t,i){jQuery(".tb-statfire-views").highcharts({title:{text:""},credits:{enabled:false},xAxis:{categories:i},yAxis:{title:{text:"Views Gained"},plotLines:[{value:0,width:0,color:"#808080"}],min:0},plotOptions:{spline:{marker:{enabled:false}}},tooltip:{formatter:function(){var e="gained";var t=Math.abs(this.y);if(this.y<0){e="lost"}return this.x+"<br> <b>"+TBUtilities.FormatNumberAbbreviated(t)+"</b> views "+e}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:TBGlobal.Profile().Title,data:e,color:"#33FF33"},{name:T,data:t,color:"#FF3333"}]});jQuery(".tb-statfire-views-loading:first").hide()};var $=function(e,t,i){jQuery(".tb-statfire-views-cumulative").highcharts({title:{text:""},credits:{enabled:false},xAxis:{categories:i},yAxis:{title:{text:"Views"},plotLines:[{value:0,width:0,color:"#808080"}],min:0},plotOptions:{spline:{marker:{enabled:false}}},tooltip:{formatter:function(){return this.x+"<br> <b>"+TBUtilities.FormatNumberAbbreviated(this.y)+"</b> views "}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:TBGlobal.Profile().Title,data:e,color:"#33FF33"},{name:T,data:t,color:"#FF3333"}]});jQuery(".tb-statfire-views-cumulative-loading:first").hide()};var q=function(e,t,i){jQuery(".tb-statfire-videos").highcharts({title:{text:""},credits:{enabled:false},xAxis:{categories:i},yAxis:{allowDecimals:false,title:{text:"Videos Uploaded"},plotLines:[{value:0,width:0,color:"#808080"}],min:0},plotOptions:{spline:{marker:{enabled:false}}},tooltip:{formatter:function(){var e="uploaded";var t="videos ";var i=Math.abs(this.y);if(this.y<0){e="lost"}if(i==1){t="video "}return this.x+" <br><b>"+TBUtilities.FormatNumberAbbreviated(this.y)+"</b>  "+t+e}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:TBGlobal.Profile().Title,data:e,color:"#33FF33"},{name:T,data:t,color:"#FF3333"}]});jQuery(".tb-statfire-videos-loading:first").hide()};var Z=function(e,t,i){jQuery(".tb-statfire-videos-cumulative").highcharts({title:{text:""},credits:{enabled:false},xAxis:{categories:i},yAxis:{title:{text:"Videos"},plotLines:[{value:0,width:0,color:"#808080"}],min:0},plotOptions:{spline:{marker:{enabled:false}}},tooltip:{formatter:function(){return this.x+"<br> <b>"+TBUtilities.FormatNumberAbbreviated(this.y)+"</b> videos "}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:TBGlobal.Profile().Title,data:e,color:"#33FF33"},{name:T,data:t,color:"#FF3333"}]});jQuery(".tb-statfire-videos-cumulative-loading:first").hide()};var X=function(){jQuery(document.body).on("CRTBLoadSocialBladeTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);i=true;A()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialBlade] CRTBLoadSocialBladeTemplate"})}});jQuery(document.body).on("CRTBLoadRealTimeStats",function(e,t){try{if(t.success){var i=Number(t.response);if(!isNaN(i)&&i!=-1)U(i)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialBlade] CRTBLoadSocialBladeTemplate"})}});jQuery(document.body).on("CRTBSocialBladeLoadPageDetails",function(t,i){try{if(i.success){w=[];var a=TBGlobal.GetYouTubeUI();switch(a){case"studio":case"material":{var r=i.response;var o=r.indexOf('window["ytInitialData"] = ');o=o+26;var n=r.substring(o,r.length);var s=n.indexOf("};")+1;var n=n.substring(0,s);var l=jQuery.parseJSON(n);if(l.metadata&&l.header){v=l.metadata.channelMetadataRenderer.keywords;var u=v.match(/\w+|"(?:\\"|[^"])+"/g);var c="";jQuery.each(u,function(e,t){t=t.replace(/['"]+/g,"");c+=t+", ";jQuery(".tb-social-blade-tag-list-container").append('<span title="'+t.toLowerCase().trim()+'" class="tb-socialblade-tag-item"><img src="'+TBGlobal.host+'/images/icons/search.png" style="opacity:.5; height:11px;" /> '+TBUtilities.GetHtmlEncoded(t.trim())+"</span>")});if(!c)jQuery(".tb-social-blade-tag-list-container").append("(none)");if(c.length>3){c=c.substring(0,c.length-2);jQuery(".tb-socialblade-copy-tags").show()}w=u}break}case"default":{var r=i.response;var d=r.indexOf("og:video:tag");jQuery(".tb-social-blade-tag-list-container").empty();var b="";do{d=r.indexOf('content="',d)+'content="'.length;var h=r.indexOf('"',d);var y=r.substring(d,h);y=y.replace("&quot;","");d=r.indexOf("og:video:tag",d);b+=y+", ";jQuery(".tb-social-blade-tag-list-container").append('<span title="'+y.toLowerCase().trim()+'" class="tb-socialblade-tag-item"><img src="'+TBGlobal.host+'/images/icons/search.png" style="opacity:.5; height:11px; position:relative; top:2px;" /> '+TBUtilities.GetHtmlEncoded(y.trim())+"</span>");w.push(y)}while(d>20);if(!b)jQuery(".tb-social-blade-tag-list-container").append("(none)");if(b.length>3){b=b.substring(0,b.length-2);jQuery(".tb-socialblade-copy-tags").show()}var p=[];var m=jQuery.parseHTML(DOMPurify.sanitize(r,DOMPurifyConfig));jQuery(".tb-social-blade-socialProfiles-container").html("");jQuery("#header-links",m).find(".about-channel-link").each(function(t,i){var a=new e;a.image=jQuery(this).find("img:first").attr("src");a.url=jQuery(this).attr("href");a.title=jQuery(this).attr("title");jQuery(".tb-social-blade-socialProfiles-container").append('<a style="display:inline;" class="tb-margin-left5" href="'+a.url+'" target="_blank"><img src="'+a.image+'" /><span class="tb-move-up3 tb-margin-left2">'+a.title+"<span></a>");p.push(a)});if(p.length==0){jQuery(".tb-social-blade-socialProfiles-container").html("(none)")}break}}}}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddySocialBlade] CRTBSocialBladeLoadPageDetails"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){r=null;if(!i){X();L();R()}else{A()}}},GotChannelStats:function(e,t){_(e,t)},GotChannelInfo:function(e,t){W(e,t)},ShowForChannel:function(e,t,i){V(e,t,i)}}}();var TubeBuddyShareTracker=function(){var e=false;var t;var i;var a;var r;var o={facebook:{name:"Facebook",dataTbServiceId:1,notSharedMsg:"You haven't shared to Facebook."},twitter:{name:"Twitter",dataTbServiceId:2,notSharedMsg:"You haven't shared to Twitter."},linkedin:{name:"LinkedIn",dataTbServiceId:9,notSharedMsg:"You haven't shared to LinkedIn."},pinterest:{name:"Pinterest",dataTbServiceId:7,notSharedMsg:"You haven't shared to Pinterest."},mix:{name:"Mix",dataTbServiceId:10,notSharedMsg:"You haven't shared to Mix."},reddit:{name:"Reddit",dataTbServiceId:5,notSharedMsg:"You haven't shared to Reddit."},blogger:{name:"Blogger",dataTbServiceId:4,notSharedMsg:"You haven't shared to Blogger."}};var n=function(){var e=TBGlobal.host+"/ModuleManager/sharetracker/sharetracker?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/sharetracker.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/sharetracker.html"}TBExtension.Get(e,"CRTBLoadShareTrackerTemplate")};var s=function(){jQuery(document).on("click",".tb-share-tracker-checkbox",function(){var e=jQuery(this);var t=e.closest(".tb-share-checkbox-container").attr("data-tb-service-name");if(e.prop("checked")){l(true,t,false)}else{l(false,t,false)}});jQuery(document).on("click",".tb-share-tracker-close, .tb-share-tracker-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-layout-share-container").hide()})};var l=function(e,i,a){var r={service:i,shared:e};var n=TBGlobal.host;var s=jQuery.param({VideoId:t.id,SocialSiteType:o[i.toLowerCase()].dataTbServiceId});if(e){var l=jQuery("#tb-share-"+i.toLowerCase()).find(".tb-share-tracker-checkbox").prop("checked");if(a&&l){TBExtension.Post(n+TBGlobal.apiUrls.sharedVideoRemove,s,null,null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}n+=TBGlobal.apiUrls.sharedVideoAdd}else{n+=TBGlobal.apiUrls.sharedVideoRemove}TBExtension.Post(n,s,"CRShareTrackerPost",r,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});TBUtilities.AddAction(null,TBUtilities.ActionTypes.ShareTracker_Track,"sharetracker")};var u=function(){jQuery(document.body).on("CRTBLoadShareTrackerTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyShareTracker] CRTBLoadShareTrackerTemplate"})}});jQuery(document.body).on("CRTBShareTrackerGetHistory",function(e,t){try{if(t.success){var i=JSON.parse(t.response);if(i.SharedWithFacebookDate!=null){o.facebook.shareStatus=true;o.facebook.sharedMsg="You shared to Facebook on "+i.SharedWithFacebookDate+"."}else{o.facebook.shareStatus=false}if(i.SharedWithTwitterDate!=null){o.twitter.shareStatus=true;o.twitter.sharedMsg="You shared to Twitter on "+i.SharedWithTwitterDate+"."}else{o.twitter.shareStatus=false}if(i.SharedWithBloggerDate!=null){o.blogger.shareStatus=true;o.blogger.sharedMsg="You shared to Blogger on "+i.SharedWithBloggerDate+"."}else{o.blogger.shareStatus=false}if(i.SharedWithRedditDate!=null){o.reddit.shareStatus=true;o.reddit.sharedMsg="You shared to Reddit on "+i.SharedWithRedditDate+"."}else{o.reddit.shareStatus=false}if(i.SharedWithPinterestDate!=null){o.pinterest.shareStatus=true;o.pinterest.sharedMsg="You shared to Pinterest on "+i.SharedWithPinterestDate+"."}else{o.pinterest.shareStatus=false}if(i.SharedWithLinkedInDate!=null){o.linkedin.shareStatus=true;o.linkedin.sharedMsg="You shared to LinkedIn on "+i.SharedWithLinkedInDate+"."}else{o.linkedin.shareStatus=false}if(i.SharedWithMixDate!=null){o.mix.shareStatus=true;o.mix.sharedMsg="You shared to Mix on "+i.SharedWithMixDate+"."}else{o.mix.shareStatus=false}}else{}c();jQuery("#tb-share-tracker-loading").hide();jQuery("#tb-share-tracker-video-container").show();jQuery("#tb-layout-share-button-container").show();jQuery("#tb-share-tracker-buttons-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyShareTracker] CRTBShareTrackerGetHistory"})}});jQuery(document.body).on("CRShareTrackerPost",function(e,t){d(t.data.service,t.data.shared)})};var c=function(){var e=jQuery(".jssocials-shares").children();jQuery.each(e,function(e,t){var i=jQuery(t);var a=t.className.slice(t.className.search("jssocials-share-")+16);var r=jQuery("#tb-share-service-template").clone().attr("id","tb-share-"+a);var n=r.find(".tb-share-tracker-checkbox");r.attr("data-tb-service-name",o[a].name).attr("data-tb-service-id",o[a].dataTbServiceId);n.attr("id","tb-share-tracker-checkbox-"+a);r.find(".tb-share-tracker-checkbox-label").attr("for","tb-share-tracker-checkbox-"+a);if(o[a].shareStatus){n.prop("checked",true);n.parent().attr("title",o[a].sharedMsg)}else{n.parent().attr("title",o[a].notSharedMsg)}r.removeClass("tb-hid").appendTo(i)})};var d=function(e,t){var i=jQuery(".jssocials-share-"+e.toLowerCase()).find("#tb-share-"+e.toLowerCase());var a=i.find(".tb-share-tracker-checkbox");if(t){a.prop("checked",true);a.parent().attr("title","You shared to "+o[e.toLowerCase()].name+" today.")}else{a.prop("checked",false);a.parent().attr("title","You haven't shared to "+o[e.toLowerCase()].name+".")}};var b=function(e){t=e;var i=TBGlobal.host+TBGlobal.apiUrls.sharedVideoGetHistory+"?videoId="+e.id;TBExtension.Get(i,"CRTBShareTrackerGetHistory")};var h=function(e,t,i){jQuery("#tb-share-tracker-thumbnail").attr("src",i);jQuery("#tb-share-tracker-title").text(t);jQuery("#tb-share-tracker-title").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-share-tracker-loading").show();jQuery("#tb-share-tracker-video-container").hide();jQuery("#tb-layout-share-button-container").hide();jQuery("#tb-share-tracker-buttons-container").hide();jQuery("#tb-share-tracker-video-thumbnail").attr("src",i);jQuery("#tb-share-tracker-video-link").text(t);jQuery("#tb-share-tracker-video-link").attr("href","https://www.youtube.com/watch?v="+e);TBYouTubeApi.GetVideoDetails(e,"snippet",b);jQuery("#tb-layout-share-container").fadeIn();var a="https://youtu.be/"+e;jQuery("#tb-share-tracker-buttons-container").jsSocials({url:a,text:t,showLabel:false,showCount:false,shareIn:"blank",shares:["facebook","twitter","linkedin","pinterest","mix","reddit","blogger"],on:{click:function(e){if(this.share){l(true,this.share,true)}}}})};var y=function(){h(i,a,r)};return{ShowForVideo:function(t,o,l){if(TBGlobal.IsAuthenticated()){i=t;a=o;r=l;if(!e){u();n();s();e=true}else{y()}}}}}();var TubeBuddyEmbed=function(){var e=false;var t=false;var i;var a;var r;var o={url:"",videoId:"",height:315,width:560,start:null,end:null,playlistId:""};var n=function(){var e=TBGlobal.host+"/ModuleManager/embed/embed?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/embed.html")}else if(loadLocalHTML&&TBExtension.GetType()==="safari"){e="modules/embed.html"}TBExtension.Get(e,"CRTBLoadEmbedTemplate")};var s=function(){o.url="https://www.youtube.com";o.start=null;if(jQuery("#tb-embed-start").val()!==""){var e=parseInt(jQuery("#tb-embed-start").val());if(e!==null)o.start=e}o.end=null;if(jQuery("#tb-embed-end").val()!==""){var i=parseInt(jQuery("#tb-embed-end").val());if(i!==null)o.end=i}if(jQuery("#tb-embed-size").val()==="1"){o.height=315;o.width=560}else if(jQuery("#tb-embed-size").val()==="2"){o.height=360;o.width=640}else if(jQuery("#tb-embed-size").val()==="3"){o.height=480;o.width=853}else if(jQuery("#tb-embed-size").val()==="4"){o.height=720;o.width=1280}else if(jQuery("#tb-embed-size").val()==="5"){o.height=315;o.width=560;var a=null;var r=null;if(jQuery("#tb-embed-height").val().replace("px","").replace("PX","").replace(" ","")!=="")a=parseInt(jQuery("#tb-embed-height").val().replace("px","").replace("PX","").replace(" ",""));if(jQuery("#tb-embed-width").val().replace("px","").replace("PX","").replace(" ","")!=="")r=parseInt(jQuery("#tb-embed-width").val().replace("px","").replace("PX","").replace(" ",""));if(a!==null&&r!==null){o.height=a;o.width=r}}if(jQuery("#tb-embed-privacy").is(":checked"))o.url="https://www.youtube-nocookie.com";var n=o.videoId+"?";if(t==true){n="videoseries?list="+o.playlistId+"&"}var s='<iframe type="text/html" width="'+o.width+'" height="'+o.height+'" src="'+o.url+"/embed/"+n;if(o.start)s+="start="+o.start+"&";if(o.end)s+="end="+o.end+"&";if(jQuery("#tb-embed-showVideoInfo").is(":checked"))s+="showinfo=0&";if(jQuery("#tb-embed-disablePlayControls").is(":checked"))s+="controls=0&";if(jQuery("#tb-embed-modestBranding").is(":checked"))s+="modestbranding=1&";if(jQuery("#tb-embed-disabledKeyboardControls").is(":checked"))s+="disablekb=1&";if(jQuery("#tb-embed-forceClosedCaptions").is(":checked"))s+="cc_load_policy=1&";if(jQuery("#tb-embed-lightTheme").is(":checked"))s+="theme=light&";if(jQuery("#tb-embed-autoPlayVideo").is(":checked"))s+="autoplay=1&";if(jQuery("#tb-embed-loopVideo").is(":checked"))s+="loop=1&playlist="+o.videoId+"&";if(jQuery("#tb-embed-autoHidePlayBar").is(":checked"))s+="autohide=1&";if(jQuery("#tb-embed-hideRelatedVideos").is(":checked"))s+="rel=0&";if(jQuery("#tb-embed-jsapi").is(":checked"))s+="enablejsapi=1&";if(jQuery("#tb-embed-disableFullscreen").is(":checked"))s+="fs=0&";s=s.substring(0,s.length-1);s+='" frameborder="0"';if(jQuery("#tb-embed-autoPlayVideo").is(":checked")){s+=' allow="autoplay" '}s+="></iframe>";jQuery("#tb-embed-code").val(s);jQuery("#tb-embed-preview").html(s);jQuery(".copy-tags-element").remove();jQuery("#tb-embed-copy").attr("data-clipboard-text",s);var l=new ClipboardJS("#tb-embed-copy")};var l=function(){jQuery(document).on("click","#tb-embed-copy",function(){jQuery("#tb-embed-copy").html("Copied");window.setTimeout(function(){jQuery("#tb-embed-copy").html("Copy")},1500)});jQuery(document).on("click change keypress keydown keyup",".tb-embed-option",function(){s()});jQuery(document).on("click","#tb-embed-close, .tb-embed-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-layout-embed-container").hide()});jQuery(document).on("click change","#tb-embed-size",function(){var e=jQuery(this).val();if(e==="5"){jQuery("#tb-embed-custom-size").show()}else{jQuery("#tb-embed-custom-size").hide()}});jQuery(document).on("click",".tb-embed-explorer-tab-header",function(){try{jQuery(".tb-embed-explorer-tab").hide();jQuery("#"+jQuery(this).attr("data-tab-id")).fadeIn();jQuery(".tb-embed-explorer-tab-header").removeClass("selected");jQuery(this).addClass("selected")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyembedExplorer] tb-embed-explorer-tab-header [click]"})}})};var u=function(){jQuery(document.body).on("CRTBLoadEmbedTemplate",function(e,o){try{if(o.success){o.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(o.response,DOMPurifyConfig));jQuery("body").append(o.response);if(t==true){d(i,a,r)}else{c(i,a,r)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEmbed] CRTBLoadEmbedTemplate"})}})};var c=function(e,i,a){t=false;o.videoId=e;s();jQuery("#tb-layout-embed-container").fadeIn();jQuery(".tb-embed-mode-title").text("Video");jQuery("#tb-embed-video-thumbnail").attr("src",a);jQuery("#tb-embed-video-link").text(i);jQuery("#tb-embed-video-link").attr("href","https://www.youtube.com/watch?v="+e)};var d=function(e,i,a){t=true;o.playlistId=e;s();jQuery("#tb-layout-embed-container").fadeIn();jQuery(".tb-embed-mode-title").text("Playlist");jQuery("#tb-embed-video-thumbnail").attr("src",a);jQuery("#tb-embed-video-link").text(i);jQuery("#tb-embed-video-link").attr("href","https://www.youtube.com/playlist?list="+e)};return{ShowForVideo:function(o,s,d){if(TBGlobal.IsAuthenticated()){TBUtilities.AddAction(null,TBUtilities.ActionTypes.AdvancedVideoEmbedding_Use,"advancedvideoembedding");if(!e){i=o;a=s;r=d;u();n();l();e=true;t=false}else{c(o,s,d)}}},ShowForPlaylist:function(o,s,c){if(TBGlobal.IsAuthenticated()){TBUtilities.AddAction(null,TBUtilities.ActionTypes.AdvancedVideoEmbedding_Use,"advancedvideoembedding");if(!e){i=o;a=s;r=c;u();n();l();e=true;t=true}else{d(o,s,c)}}}}}();var TubeBuddyCommentManager=function(){var t=false;var a=false;var r=false;var o=false;var n=null;var s=null;var l=null;var u=false;var c=[];var d=null;var b=null;var h=null;var y=false;var p=false;var m=null;var f=false;var g=null;var v=false;var T=0;var j=0;var Q=false;var k=null;var B=null;var C=null;var w=null;var A=null;var x=null;var I=function(){this.isLoaded=false;this.name="";this.thumbnail="";this.channelId="";this.channelId="";this.viewCount=0;this.videoCount=0;this.subscriberCount=0;this.hiddenSubscriberCount=false;this.dateContacted=null;this.socialProfiles=[];this.contacted=false;this.twitterHandle=""};var U=function(){this.image="";this.url="";this.handle="";this.type=0};var L={YouTube:0,GooglePlus:1,Twitter:2,Facebook:3};var S=function(){B=jQuery("#tb-commentsCannedResponse-channelInfoTemplate").html();C=jQuery("#tb-commentsCannedResponse-subscriberCountTemplate").html();w=jQuery("#tb-commentsCannedResponse-facebookTemplate").html();A=jQuery("#tb-commentsCannedResponse-twitterTemplate").html();x=jQuery("#tb-commentsCannedResponse-instagramTemplate").html();l=null;n=null;o=TBGlobal.Profile().SettingsShowCommentCannedResponses;r=false;G();TBUtilities.Log("Canned Responses Enabled: "+o);if(o==true||r){R()}};var G=function(){try{var e=TBUtilities.GetParameterByName("v",window.location.href);jQuery(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(".tb-commentsCannedResponse-cannedResponses-container").append('<div style="padding: 4px 12px 4px 29px;">Loading...</div>');if(k!=e){k=e;TubeBuddyYouTubeActions.GetVideoInfo(e,function(e){var t=TBGlobal.CurrentChannelId().toLowerCase();if(e.channelid.toLowerCase()==t){Q=true}else{Q=false}var i=TBGlobal.host+TBGlobal.apiUrls.campaignGetByYouTubeChannelId+"?id="+TBGlobal.CurrentChannelId();TBExtension.Get(i,"CRTBCannedResponseGetCannedResponses")})}}catch(e){Q=false;TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] checkOwnerChannel"})}};var E=function(){jQuery(".tb-commenter-campaign-dropdown-list").each(function(){var e=jQuery(this);e.empty();if(TBGlobal.Profile().Campaigns.length==0){e.append('<span style="font-size:11px; color:Red">You haven\'t created any Campaigns</span>')}else{jQuery.each(TBGlobal.Profile().Campaigns,function(t,i){e.append('<a class="tb-commenter-insert-campaign" data-campaign-id="'+i.Id+'">'+i.Name+"</a><br>")})}TBUtilities.Log("Populating Camapigns: "+TBGlobal.Profile().Campaigns.length)})};var R=function(){u=true;j=V();jQuery(".comment-renderer").css("overflow","visible");var e=M();var t=TBGlobal.GetYouTubeUI();jQuery(e.commentSelector).each(function(i,a){var r=this;if(t=="material"){var o=jQuery(r).find(e.commentTextSelector).text();var n=jQuery(r).find(e.commentAuthorSelector).attr("href");var s=n+o;jQuery(this).attr("data-cid",s.hashCode())}P(r)});E();oe()};var V=function(){var e=0;var t=M();e=jQuery(t.commentSelector).length;return e};var M=function(){var e={footerRowSelector:"",lastElementSelector:"",actionMenuContainer:"",commentSelector:""};var t=TBGlobal.GetYouTubeUI();switch(t){case"studio":case"material":{e.footerRowSelector="#toolbar";e.lastElementSelector="#dislike-button";e.actionMenuContainer="#toolbar";e.commentSelector="div#body.ytd-comment-renderer";e.commentTextSelector="yt-formatted-string#content-text";e.commentRendererSelector="#comment";e.replyButtonSelector=".ytd-button-renderer.style-text";e.commentAuthorSelector="#author-text";e.commentAuthorTitleSelector="#author-text > span";e.commentTextAreaSelector="#contenteditable-root";e.commentAuthorUrlSelector="#author-thumbnail a:first";e.commentPublishTimeSelector="#published-time-text";break}case"default":{e.footerRowSelector=".comment-renderer-footer";e.lastElementSelector=".sprite-dislike";e.actionMenuContainer=".comment-renderer-action-menu";e.commentSelector=".comment-renderer";e.commentRendererSelector=".comment-renderer";e.replyButtonSelector=".comment-renderer-reply";e.commentAuthorTitleSelector=".comment-author-text";e.commentTextAreaSelector=".comment-simplebox-text";e.commentAuthorUrlSelector="a:first";e.commentPublishTimeSelector=".comment-renderer-time";break}}return e};var P=function(e){try{if(o){D(e);jQuery(".tb-commentsCannedResponse-manage-cannedResponses").attr("href",TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId())}if(r){var t=M();if(jQuery(e).find(".tb-commentsCannedResponse-channelInfo").length==0&&jQuery(e).find(".creator").length==0){var a=jQuery(e).find(t.commentAuthorUrlSelector).attr("href");TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(a,function(a){if(a.success==true){var r="";if(a.subscribersFormatted!=null){r=C.formatTemplate(a.subscribersFormatted)}var o="";var n="";var s="";for(i=0;i<a.socialProfiles.length;i++){var l=a.socialProfiles[i];if(l.url!==undefined&&l.url.indexOf("twitter.com")!==-1){n=A.formatTemplate(l.url)}else if(l.url!==undefined&&l.url.indexOf("facebook.com")!==-1&&l.url.indexOf("youtube.com")===-1){o=w.formatTemplate(l.url)}else if(l.url!==undefined&&l.url.indexOf("instagram.com")!==-1){s=x.formatTemplate(l.url)}}var u=TBGlobal.GetYouTubeUI();var c="";if(u=="material"){c="tb-move-up4"}var d=B.formatTemplate(r,o,n,s,c);jQuery(e).find(t.commentPublishTimeSelector).after(d)}})}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] populateMenus"})}};var D=function(e){var t=M();var i=TBGlobal.GetYouTubeUI();jQuery(e).find(t.footerRowSelector).each(function(e,a){if(jQuery(this).find(".tb-commentsCannedResponse-cannedResponse-menu").length==0){if(jQuery(this).closest(t.commentSelector).hasClass("channel-owner")==false){jQuery(this).find(t.lastElementSelector).after(F());switch(i){case"studio":case"material":{jQuery(this).find(t.lastElementSelector).after(O());break}case"default":{jQuery(this).find(t.actionMenuContainer).append(O());break}}}}})};var F=function(){if(n){return n}else{var e=jQuery("#tb-commentsCannedResponse-menuMenuTemplate").html();n=e;return n}};var O=function(){if(l){return l}else{var e="";try{s=TBGlobal.Profile().Campaigns;var t=jQuery("#tb-commentsCannedResponse-menuContainerTemplate").html();var i=N();if(t)e=t.formatTemplate(i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] getCannedResponsesMenuHtml"})}l=e;return l}};var N=function(){var e="";if(Q==true){var t=jQuery("#tb-commentsCannedResponse-menuButtonTemplate").html();if(s.length>0){jQuery.each(s,function(i,a){e+=t.formatTemplate(a.Id,a.Name)})}else{e=jQuery("#tb-commentsCannedResponse-menuButtonTemplateEmpty").html()}}else{e=jQuery("#tb-commentsCannedResponse-menuButtonTemplateNotOwner").html()}return e};var _=function(){var e=TBGlobal.host+"/ModuleManager/commentmanager/commentmanager?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/commentmanager.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/commentmanager.html"}TBExtension.Get(e,"CRTBLoadCommentManagerTemplate")};var H=function(){if(r==true||o==true){R()}};var W=function(e){var t=jQuery(e);t.closest(".tb-video-commenter-info").hide();t.closest(".tb-commenter-action-icon").fadeIn("fast")};var z=function(t){try{TBUtilities.Log("actionDropDownClicked");jQuery(".tb-video-commenter-info").hide();jQuery(".tb-commenter-action-icon").fadeIn("slow");var i=jQuery(t).attr("data-channelid");TBUtilities.Log(i);if(i){TBUtilities.Log("channel id found");var a=TBUtilities.GetInArray(c,"channelId",i);var r=jQuery(t).siblings('.tb-video-commenter-info[data-channelid="'+i+'"]');r.find(".tb-video-commenter-thumbnail").attr("src",a.thumbnail);r.find(".tb-video-commenter-name").text(a.name);r.find(".tb-video-commenter-name").attr("href","https://www.youtube.com/channel/"+a.channelId);r.find(".tb-video-commenter-thumbnail-link").attr("href","https://www.youtube.com/channel/"+a.channelId);r.fadeIn("fast")}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] actionDropDownClicked"})}};var Y=function(t){TBUtilities.Log("cRTBCommentManagerRedirectUrl result = "+t.success);if(t.success){try{var a=t.response;var r=$.parseHTML(DOMPurify.sanitize(a,DOMPurifyConfig));var o=jQuery(r).find("meta[itemprop=channelId]").first().attr("content");var n=parseInt(jQuery(r).find(".yt-subscription-button-subscriber-count-branded-horizontal").first().text());TBUtilities.Log("cRTBCommentManagerRedirectUrl channelId = "+o);var s=TBUtilities.GetInArray(c,"channelId",t.data.channelId);s.channelId=o;s.subscriberCount=n;var l=TBGlobal.host+TBGlobal.apiUrls.contactHistoryGetContactHistoryByChannelId+"?channelId="+s.channelId;TBUtilities.Log(l);TBExtension.Get(l,"CRTBCommentManagerGetHistoryByProfileId",s.channelId);var u=jQuery('.tb-video-commenter-info[data-channelid="'+s.channelId+'"]');if(s.channelId){TBYouTubeApi.GetChannelStatisticsNoApiClient(s.channelId,"CRTBCommentManagerGetChannelStatisticsCallback")}u.find(".tb-commenter-social-accounts").empty();jQuery("#header-links",r).find(".channel-links-item").each(function(e,t){var i=new U;i.image=jQuery(this).find("img:first").attr("src");i.url=jQuery(this).find("a:first").attr("href");if(i.url.toLowerCase().indexOf("twitter.com/")>-1){i.type=L.Twitter;var a=i.url.toLowerCase().indexOf("twitter.com/")+"twitter.com/".length;if(a>0){var r=i.url.toLowerCase().substring(a,i.url.toLowerCase().length);if(r.indexOf("/")>0)r=r.substring(0,r.indexOf("/"));if(r.indexOf("&")>0)r=r.substring(0,r.indexOf("&"));if(r.indexOf("?")>0)r=r.substring(0,r.indexOf("?"));i.handle=r;if(s.twitterHandle=="")s.twitterHandle=r}}else if(i.url.toLowerCase().indexOf("facebook.com/")>-1){i.type=L.Facebook}else if(i.url.toLowerCase().indexOf("plus.google.com/")>-1){i.type=L.GooglePlus}u.find(".tb-commenter-social-accounts").append('<a href="'+i.url+'" target="_blank"><img src="'+i.image+'" /></a>&nbsp;');s.socialProfiles.push(i)});u.find(".tb-video-commenter-addToGooglePlusCircle").hide();for(i=0;i<s.socialProfiles.length;i++){var d=s.socialProfiles[i];if(d.type==L.GooglePlus){u.find(".tb-video-commenter-addToGooglePlusCircle").show()}}if(jQuery("#header-links",r).find(".channel-links-item").length==0){u.find(".tb-commenter-social-accounts").append('<span style="color:#999; font-size:11px;">(none)</span>')}u.find(".tb-commenter-social-accounts-loading").hide()}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] cRTBCommentManagerRedirectUrl"})}}else{var s=TBUtilities.GetInArray(c,"channelId",t.data.channelId);var u=jQuery('.tb-video-commenter-info[data-channelid="'+s.channelId+'"]');u.find(".tb-commenter-social-accounts-loading").hide();u.find(".tb-commenter-suspended").show()}};var J=function(){jQuery(".tb-video-commenter-info").hide()};var q=function(e){try{if(e.success){e.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(e.response,DOMPurifyConfig));jQuery("body").append(e.response);S()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] CRTBLoadCommentManagerTemplate"})}};var Z=function(e,t){if(!t)t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=i.exec(t);if(!a)return null;if(!a[2])return"";return decodeURIComponent(a[2].replace(/\+/g," "))};var X=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var K=function(e){var t=jQuery(e).attr("data-campaign-id");var i=jQuery(e).closest(".tb-video-commenter-contact").find(".tb-video-commenter-message:first");var a=TBUtilities.GetInArray(TBGlobal.Profile().Campaigns,"Id",t).Template;var r=jQuery(e).closest(".tb-video-commenter-info");r=r.find(".tb-video-commenter-name:first");r=r.text();a=TBUtilities.ReplaceAll(a,"{N}",r);a=TBUtilities.ReplaceAll(a,"{n}",r);i.val(a);TubeBuddyCommentManager.HideCannedResponses(e)};var ee=function(e){var t=jQuery(e).parent().find(".tb-commenter-campaign-dropdown:first");t.toggle()};var te=function(e,t){if(t)jQuery(e).find(".tb-commenter-social-accounts-tb:first").css("opacity",".75");else jQuery(e).find(".tb-commenter-social-accounts-tb:first").css("opacity",".4")};var ie=function(){E()};var ae=function(e){jQuery(e).closest(".tb-commenter-campaign-dropdown").hide()};var re=function(){TBUtilities.Log("checkNewRender");var e=false;if(jQuery("#comment-section-renderer-items").length==0)e=true;if(!e){if(!jQuery("#comment-section-renderer-items").hasClass("loading"))e=true}if(e){TBUtilities.Log("Done! Load new comments");H();clearInterval(h)}};var oe=function(){TBUtilities.Log("checkForNewComments");if(d){clearInterval(d)}var e=M();var t=jQuery(e.commentSelector).length;TBUtilities.Log("commentCount = "+t);if(t>j){TBUtilities.Log("new comments found");clearInterval(d);H();d=setInterval(oe,1e4)}else{d=setInterval(oe,5e3)}};var ne=function(){TBUtilities.Log("checkEmbeddedComments");try{var e=false;var t=TBGlobal.GetYouTubeUI();switch(t){case"studio":case"material":{if(jQuery("#comments").find(".ytd-comment-thread-renderer").length>0){e=true}else{e=false}break}case"default":{if(jQuery("#watch-discussion").find(".comment-author-text").length>0){e=true}else if(jQuery("#watch-discussion").find("iframe").length>0){TBUtilities.Log("iframe detected, do not init comment manager");e=false}else{e=false}break}}if(e==true){TBUtilities.Log("comments are visible");y=true;setTimeout(TubeBuddyCommentManager.Initialize,1e3)}else{TBUtilities.Log("comments are not visible");p=setTimeout(TubeBuddyCommentManager.CheckEmbeddedComments,2e3)}}catch(e){TBUtilities.Log("checkEmbeddedComments exception ="+e)}};var se=function(){jQuery(".tb-commentsCannedResponse-cannedResponse-menu-list").addClass("tb-hid").hide()};var le=function(){jQuery(document).on("click",".yt-sort-filter-sub-menu-renderer a.yt-dropdown-menu",function(e){if(jQuery(this).hasClass("yt-dropdown-menu")){TBUtilities.Log("comment sort clicked");jQuery(".ytd-comment-renderer .tb-commentsCannedResponse-channelInfo").remove();setTimeout(function(){H()},2e3)}});jQuery(document).on("click",".tb-commentManager-chart",function(){var e=TBGlobal.GetYouTubeUI();var t;var i;var a;var r;switch(e){case"studio":case"material":{i=jQuery(this).closest("#body");var o=jQuery(i).find("#author-thumbnail").find("a:first").attr("href");var t=o.substr(o.lastIndexOf("/")+1);a=jQuery(i).find("#author-text").find("span:first").text().trim();r=jQuery(i).find("#img").attr("src");break}case"default":{i=jQuery(this).closest(".comment-renderer");var n=jQuery(i).find(".comment-author-text:first").attr("href");var s=n.lastIndexOf("/");var t=n.substring(s+1);a=jQuery(i).find(".comment-author-text:first").text();r=jQuery(i).find('img[data-ytimg="1"]').attr("src");break}}if(t&&a&&r){TubeBuddyChannelytics.ShowForChannel(t,a,r)}});jQuery(document).on("click",".tb-commentsCannedResponse-topicgenerator-input",function(e){e.stopPropagation()});jQuery(document).on("click",".comment-section-sort-menu-item",function(e){TBUtilities.Log("Setting Interval");h=setInterval(re,500)});jQuery(document).on("change",".tb-commentsCannedResponse-topicgenerator-input",function(e){TBUtilities.Log("tb-commentsCannedResponse-topicgenerator-input change");try{var t=jQuery(this).is(":checked");if(v==false&&t==true){jQuery(this).prop("checked",false);TBGlobal.ShowUpgradePage("have more than 5 comment suggestions","videotopicplanner");return}if(t){TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_SaveComment,"videotopicplanner")}var i="";var a="";var r="";var o="";var n="";var s="";var l=TBGlobal.GetYouTubeUI();switch(l){case"studio":case"material":{var u=this;commentItem=jQuery(u).closest("#comment");var c=jQuery(commentItem).find("a:first").attr("href");o=c.substr(c.lastIndexOf("/")+1);r=jQuery(commentItem).find("#author-text").find("span:first").text().trim();s=jQuery(commentItem).find("#img").attr("src");n=jQuery(commentItem).find("#content-text").text().trim();a=TBUtilities.GetUrlParameter("v");var d=jQuery(u).closest("#body");i=jQuery(d).attr("data-cid");break}case"default":{commentItem=jQuery(this).closest(".comment-renderer");i=jQuery(commentItem).attr("data-cid");a=TBUtilities.GetUrlParameter("v");r=jQuery(commentItem).find(".comment-author-text").text();var b=jQuery(commentItem).find(".comment-author-text:first").attr("href");var h=b.lastIndexOf("/");var o=b.substring(h+1);n=jQuery(commentItem).find(".comment-renderer-text-content").text();s=jQuery(commentItem).find(".yt-thumb-clip").find("img").attr("src");break}}var y={VideoId:a,CommentId:i,CommentorChannelId:o,CommentorName:r,Comment:n,CommentorPhoto:s};TBUtilities.Log(y);var p=TBGlobal.host+TBGlobal.apiUrls.topicsToggleCommentAudienceSuggestedTopic;TBExtension.Post(p,JSON.stringify(y),null,null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-topicgenerator-input change"})}});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponseEmpty",function(){var t=window.open(TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId(),"_blank");t.focus();e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-refresh-cannedResponses",function(e){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeOut();var t=TBGlobal.host+TBGlobal.apiUrls.campaignGetByYouTubeChannelId+"?id="+TBGlobal.CurrentChannelId();TBExtension.Get(t,"CRTBCannedResponseGetCannedResponses");e.stopPropagation()});jQuery(document).on("focusin focus click","#contenteditable-textarea",function(){jQuery(".tb-emoji-toggle").remove();jQuery(this).find("#contenteditable-root").before('<span style="position:absolute; right:5px; opacity:.7; z-index:999;" class="tb-emoji-toggle"><img src="'+TBGlobal.host+'/images/modules/emoji/face.png" style=" cursor:pointer; position:relative; bottom:5px;" /></span>')});jQuery(document).on("keyup paste input","#contenteditable-textarea",function(){jQuery(".tb-emoji-toggle").remove();jQuery(this).find("#contenteditable-root").before('<span style="position:absolute; right:5px; opacity:.7; z-index:999;" class="tb-emoji-toggle"><img src="'+TBGlobal.host+'/images/modules/emoji/face.png" style=" cursor:pointer; position:relative; bottom:5px;" /></span>')});jQuery(document).click(function(){se()});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponse",function(e){TBUtilities.Log("CommentsCannedResponse tb-commentsCannedResponse-menu-cannedResponse click");if(jQuery("#yt-comments-paginator").length>0)if(jQuery("#yt-comments-paginator").closest("form").length>0)jQuery("#yt-comments-paginator").closest("form").css("padding-bottom","400px");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.CannedResponses_Use,"cannedresponses");se();var t=jQuery(this).attr("data-id");var i=M();var a=jQuery(this).closest(i.footerRowSelector);var r=jQuery(this).closest(i.commentRendererSelector);if(r.length==0){r=jQuery(this).closest("ytd-comment-replies-renderer")}TBUtilities.Log(a.attr("class"));var o=a.find(i.replyButtonSelector);TBUtilities.Log(o.attr("class"));o[0].click();var n=TBUtilities.GetInArray(s,"Id",t);TBUtilities.Log(n);var l=n.Template;var u=r.find(i.commentAuthorTitleSelector).text().trim();TBUtilities.Log(u);if(u){l=TBUtilities.ReplaceAll(l,"{N}",u);l=TBUtilities.ReplaceAll(l,"{n}",u)}TBUtilities.Log(l);var c=TBGlobal.GetYouTubeUI();switch(c){case"studio":case"material":{var d=jQuery(r).find(i.commentTextAreaSelector);setTimeout(function(){jQuery(d).parent().parent().siblings("label:first").hide()},10);jQuery(d).focus();jQuery(d).sendkeys(l);jQuery(d).blur();break}case"default":{var d=jQuery(a).find(i.commentTextAreaSelector);jQuery(d).append(l);break}}var o=jQuery(a).parent().find("#submit-button");if(o){o.removeAttr("disabled")}e.stopPropagation()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-menu-cannedResponse click"})}});jQuery(document).on("click",".tb-commentsCannedResponse-cannedResponse-menu",function(e){TBUtilities.Log("Comment Manager tb-commentsCannedResponse-cannedResponse-menu click");if(jQuery("#yt-comments-paginator").length>0)if(jQuery("#yt-comments-paginator").closest("form").length>0)jQuery("#yt-comments-paginator").closest("form").css("padding-bottom","400px");se();var t=M();var i=null;var a=TBGlobal.GetYouTubeUI();switch(a){case"studio":case"material":{var r=jQuery(this).closest(".tb-commentsCannedResponse-cannedResponse-menu-row").parent();i=r.find(".tb-commentsCannedResponse-cannedResponse-menu-list");break}case"default":{var r=jQuery(this).closest(".tb-commentsCannedResponse-cannedResponse-menu-row").parent();var o=r.siblings(".comment-renderer-action-menu");i=o.find(".tb-commentsCannedResponse-cannedResponse-menu-list");break}}var n=$(this).offset();var l=n.top-$(window).scrollTop()+20;var u=n.left-$(window).scrollLeft();var c=u+"px";var d=l+"px";TBUtilities.Log("left = "+c);TBUtilities.Log("top = "+d);jQuery(i).css({position:"fixed",top:d,left:c}).show();if(jQuery(i).hasClass("tb-hid")){jQuery(i).removeClass("tb-hid").show();var b="";try{var t=M();var a=TBGlobal.GetYouTubeUI();switch(a){case"studio":case"material":{commentItem=jQuery(this).closest(t.commentSelector);break}case"default":{commentItem=jQuery(this).closest(t.commentRendererSelector);break}}b=jQuery(commentItem).attr("data-cid")}catch(e){TBExtension.Log(e)}if(s.length>0&&jQuery(i).find(".tb-commentsCannedResponse-cannedResponses-container").find(".tb-commentsCannedResponse-menu-cannedResponse").length===0){var h=N();jQuery(i).find(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(i).find(".tb-commentsCannedResponse-cannedResponses-container").html(h)}var y=TBGlobal.host+TBGlobal.apiUrls.topicsGetCommentAudienceSuggestedTopic+"?commentId="+b;TBExtension.Get(y,"CRTBCannedResponseGetCommentAudienceSuggestedTopic",b)}e.stopPropagation()});jQuery(document).on("click",".tb-commenter-action-icon",function(e){TubeBuddyCommentManager.ActionDropDownClicked(this);e.stopPropagation()});jQuery(document).on("click",".tb-video-commenter-info-close",function(e){TubeBuddyCommentManager.ModalClose(this)});jQuery(document).on("mouseenter",".tb-commenter-action-icon",function(){TubeBuddyCommentManager.HighlightUser(this,true)});jQuery(document).on("mouseleave",".tb-commenter-action-icon",function(){TubeBuddyCommentManager.HighlightUser(this,false)});jQuery(document).on("mouseenter",".HPa, .Wv",function(){TubeBuddyCommentManager.HighlightTubeBuddyIcon(this,true)});jQuery(document).on("mouseleave",".HPa, .Wv",function(){TubeBuddyCommentManager.HighlightTubeBuddyIcon(this,false)});jQuery(document).on("click",".tb-commenter-show-campaigns",function(){TubeBuddyCommentManager.ShowCannedResponses(this);e.stopPropagation()});jQuery(document).on("click",".tb-commenter-insert-campaign",function(){TubeBuddyCommentManager.InsertCannedResponse(this);e.stopPropagation()});jQuery(document).on("click",".yJa, #watch-discussion",function(e){TubeBuddyCommentManager.HideAllModals()});jQuery(document).on("click",".tb-video-commenter-info",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-commenter-campaign-dropdown-close",function(e){TubeBuddyCommentManager.HideCannedResponses(this)});jQuery(document).on("click",".tb-commenter-manage-campaigns",function(e){e.stopPropagation()})};var ue=function(){jQuery(document.body).on("CRTBCannedResponseGetCommentAudienceSuggestedTopic",function(e,t){try{if(t.success){var i=JSON.parse(t.response);var a=TBGlobal.GetYouTubeUI();var r=null;switch(a){case"studio":case"material":{var o=jQuery("[data-cid='"+t.data+"']");r=jQuery(o).find(".tb-commentsCannedResponse-topicgenerator-input:first");break}case"default":{var o=jQuery(".comment-renderer[data-cid='"+t.data+"']");var r=jQuery(o).find(".tb-commentsCannedResponse-topicgenerator-input");break}}v=i.CanAdd;jQuery(r).removeAttr("disabled");jQuery(r).attr("checked",i.IsSuggestedTopic)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCommentAudienceSuggestedTopic"})}});jQuery(document.body).on("CRTBCannedResponseGetCannedResponses",function(e,t){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeIn();try{if(t.success){s=JSON.parse(t.response);var i=N();jQuery(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(".tb-commentsCannedResponse-cannedResponses-container").html(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCannedResponses"})}});jQuery(document.body).on("CRTBLoadCommentManagerTemplate",function(e,t){TubeBuddyCommentManager.CRTBLoadCommentManagerTemplateCallback(t)});jQuery(document.body).on("CRTBCommentManagerRedirectUrl",function(e,t){TubeBuddyCommentManager.CRTBCommentManagerRedirectUrlCallback(t)});jQuery(document.body).on("CRTBCommentManagerChannelUrlGet",function(e,t){TubeBuddyCommentManager.CRTBCommentManagerChannelUrlGetCallBack(t)});jQuery(document.body).on("CRTBCommentManagerGetHistoryByProfileId",function(e,t){TubeBuddyCommentManager.CRTBCommentManagerGetHistoryByProfileIdCallback(t)})};return{Initialize:function(){u=false;var e=window.location.href;if(e.indexOf("youtube.com/watch")>0&&y==false){TBUtilities.Log("setting embedded comment manager timer");p=setTimeout(TubeBuddyCommentManager.CheckEmbeddedComments,2e3);return}Q=null;if(TBGlobal.IsAuthenticated()){y=false;if(!a){TBUtilities.Log("not initialized, about to");le();ue();_();TBGlobal.AddProfileUpdateListener(ie);a=true}else{TBUtilities.Log("re-populating content");G()}}},PopulateDropDowns:function(){R()},NewCommentsLoaded:function(){H()},ModalClose:function(e){W(e)},HideAllModals:function(){J()},InsertCannedResponse:function(e){K(e)},ShowCannedResponses:function(e){ee(e)},HideCannedResponses:function(e){ae(e)},CRTBLoadCommentManagerTemplateCallback:function(e){q(e)},CRTBCommentManagerRedirectUrlCallback:function(e){Y(e)},CheckEmbeddedComments:function(){ne()}}}();var TubeBuddyThumbnailCreator=function(){var e=false;var t;var i;var a;var r;var o;var n;var s=[];var l=1;var u=false;var c=null;var d=null;var b;var h=false;var y=false;var p=false;var m=null;var f=null;var g=null;var v=false;var T=null;var j=null;var Q=null;var k=function(){var e=TBGlobal.host+"/ModuleManager/ThumbnailCreator/ThumbnailCreator?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/thumbnailcreator.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/thumbnailcreator.html"}TBExtension.Get(e,"CRTBLoadThumbnailCreatorTemplate")};var B=function(){n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();jQuery(".tb-thumbnail-creator-step4-success-download").removeClass("tb-hid");n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()};var C=function(e){if(e==false){n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}jQuery(".tb-thumbnail-settings-preview-container").unblock();O(4);jQuery("#tb-thumbnail-creator-step4-success").removeClass("tb-hid");jQuery(".upload-thumb-img").each(function(){if(jQuery(this).attr("src").indexOf(t)>0)jQuery(this).attr("src","https://i.ytimg.com/vi/"+t+"/0.jpg?time="+Math.random())});if(window.location.href.indexOf("my_videos")>-1){var i=jQuery("div[data-video-id='"+t+"']");if(i&&v==false){var a=jQuery(i).find("img:first");if(a){jQuery(a).attr("src","https://i.ytimg.com/vi/"+t+"/default.jpg?time="+Math.random())}}}if(window.location.href.indexOf("edit?o=U&video_id=")>-1){var a=jQuery(".custom-thumb-selectable").find("img:first");if(a){jQuery(a).attr("src","https://i.ytimg.com/vi/"+t+"/0.jpg?time="+Math.random())}}var r=TBGlobal.GetYouTubeUI();if(r==="studio"){jQuery(".ytcp-img-with-fallback").each(function(){if(jQuery(this).attr("src")&&jQuery(this).attr("src").indexOf(t)>0)jQuery(this).attr("src","https://i.ytimg.com/vi/"+t+"/0.jpg?time="+Math.random())})}if(TBGlobal.CanAccessLevel1Tools()){B()}else{jQuery(".tb-thumbnail-creator-step4-success-download-upgrade").removeClass("tb-hid")}};var w=function(e){n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll();jQuery(".tb-thumbnail-settings-container").unblock();var i="There was an error with YouTube's API and we were unable to publish your thumbnail";jQuery("#tb-thumbnail-settings-steps-container").show();jQuery("#tb-thumbnail-settings-size-container").hide();if(e){if(e.response==413){jQuery("#tb-thumbnail-settings-steps-container").hide();jQuery("#tb-thumbnail-settings-size-container").show();i="YouTube did not allow us to publish the video because the file size is too big.\n\nYou could try making the image less complex (smaller background image, fewer colors, etc).\n\nIf it still fails, you will need to create this Thumbnail outside of TubeBuddy, sorry!"}else if(e.response==403){i="Failed to access the image. Try again and if that fails, you can refresh the page and then build the thumbnail again from scratch.\n\nIf it still fails, email your video id to support@tubebuddy.com and we'll see if we can help..."}}B();O(3);jQuery(".tb-thumbnail-settings-error-message").html(i);jQuery("#tb-thumbnail-settings-error-link").attr("href","https://www.youtube.com/edit?o=U&video_id="+t);jQuery(".tb-thumbnail-settings-error-container").show();jQuery(".tb-thumbnail-settings-preview-container").hide()};var A=function(){var e=[];var t=K();var i=new fabric.Image.filters.Brightness({brightness:t});e.push(i);var a=ee();var r=new fabric.Image.filters.Contrast({contrast:a});e.push(r);return e};var x=function(){var e=jQuery(".metadata-app[data-video-id]:first").attr("data-video-id");if(e){n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var t=n.toDataURL("image/png");TubeBuddyYouTubeActions.PostCustomThumbnailStudio(e,t).then(function(e){C(false)}).catch(function(e){w(e)})}};var I=function(){jQuery(document).on("click","#tb-thumbnail-creator-container .tb-module-close",function(){P()});window.addEventListener("message",function(e){if(e.origin!=="https://www.youtube.com")return;if(e.data.tbevent&&e.data.tbevent==="ScreenCapResponse"){if(e.data.imageUrl!=null){j=e.data.imageUrl;_()}else{TBUtilities.Alert("There was a problem capturing a still image from your video.  Please try again.")}}},false);jQuery(document).on("click",".tb-thumbnail-creator-download-step3",function(){try{n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var e=document.createElement("a");var i=n.toDataURL("image/png");var a=E(i.replace(/^data:image\/(png|jpg);base64,/,""));var r=URL.createObjectURL(a);e.download=t+".png";e.innerHTML="download";e.href=r;e.setAttribute("type","hidden");document.body.appendChild(e);e.click();e.remove()}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] tb-thumbnail-creator-download-step3"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}});jQuery(document).on("keypress","#tb-thumbnail-settings-tab-youtube-competitors-preview-search",function(e){if(e.which===13){F(jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-search").val())}});jQuery(document).on("click","#tb-thumbnail-settings-tab-youtube-competitors-preview-search-button",function(e){F(jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-search").val())});jQuery(document).on("click","#backgroundImageUploadFake",function(e){jQuery("#backgroundImageUpload").click()});jQuery(document).on("click",".tb-thumbnail-creator-brandings-uploadEnabled",function(e){jQuery("#imgLoader").click()});jQuery(document).on("click",".tb-thumbnail-publish-button-seo-studio",function(e){try{n.discardActiveObject();n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var t=n.toDataURL("image/png");jQuery(this).closest(".tb-module-template").hide();_seoStudioCallback(true,t)}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] tb-thumbnail-creator-download-step3"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-backgroundSelect-uploaded-image-delete",function(e){e.stopPropagation();var t=jQuery(this).attr("data-image-id");TBUtilities.Log("deleting image = "+t);TBUtilities.Confirm("Are you sure you want to delete this image?",function(){var e=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-type");if(e=="uploaded"){var i=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-uploaded-id");if(t==i){jQuery("#tb-thumbnail-creator-backgroundSelect-stock-image-default").click()}}var a={Id:t};var r=TBGlobal.host+TBGlobal.apiUrls.brandingsDeleteBackgroundImage;TBExtension.Post(r,JSON.stringify(a),"CRTBThumbnailCreatorDeleteBackgroundImage",null,{contentType:"application/json"})},function(){})});jQuery(document).on("change","#backgroundImageUpload",function(e){if(TBGlobal.CanAccessLevel1Tools()==false){TBGlobal.ShowUpgradePage("upload an image","thumbnailgenerator");return}var i=document.getElementById("backgroundImageUpload").value;var a=i.match(/\.([^\.]+)$/)[1];a=a.toLowerCase();switch(a){case"png":case"bmp":case"gif":case"jpg":break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#backgroundImageUpload").val("");return}var r=e.target.files[0].size;if(r>8388608){TBUtilities.Alert("The maximum image file size is 8MB. Please select a smaller image.");jQuery("#backgroundImageUpload").val("");return}var o=new FileReader;o.readAsDataURL(e.target.files[0]);o.onloadend=function(e){jQuery(".tb-thumbnail-creator-backgroundSelect-uploading").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").addClass("tb-hid");var i=e.target.result;var r="";switch(a){case"png":r=i.replace("data:image/png;base64,","");break;case"bmp":r=i.replace("data:image/bmp;base64,","");break;case"gif":r=i.replace("data:image/gif;base64,","");break;case"jpg":r=i.replace("data:image/jpeg;base64,","");break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#backgroundImageUpload").val("");return}jQuery(".tb-thumbnail-creator-font-uploading").removeClass("tb-hid");var o={ImageData:r,ImageExt:a,VideoId:t};var n=TBGlobal.host+TBGlobal.apiUrls.brandingsAddBackgroundImage;TBExtension.Post(n,JSON.stringify(o),"CRTBThumbnailCreatorUploadBackgroundImage",null,{contentType:"application/json"})}});jQuery(document).on("click",".tb-thumbnail-creator-preview-tab-header",function(){jQuery("#tb-thumbnail-creator-tab-header-preview").find(".tb-thumbnail-creator-tabs-menu-item-container").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(this).addClass("tb-thumbnail-creator-tabs-selected-menu-item");var e=jQuery(this).attr("data-tab");switch(e){case"tb-thumbnail-creator-tab-youtube":{jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").hide();break}case"tb-thumbnail-creator-tab-facebook":{jQuery(".tb-thumbnail-settings-tab-youtube-competitors").hide();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").show();break}case"tb-thumbnail-creator-tab-twitter":{jQuery(".tb-thumbnail-settings-tab-youtube-competitors").hide();jQuery(".tb-thumbnail-settings-tab-twitter").show();jQuery(".tb-thumbnail-settings-tab-facebook").hide();break}}});jQuery(document).on("click",".tb-thumbnail-creator-close",function(){if(_seoStudioCallback){_seoStudioCallback(true,null);_seoStudioCallback=null}TubeBuddyMenu.HideBackground();jQuery(this).closest(".tb-module-template").hide()});jQuery(document).on("click",".tb-thumbnail-creator-setting-backgroundOption, .tb-thumbnail-creator-setting-bg-tab",function(){var e=jQuery(this).attr("data-type");M(e);return false});jQuery(document).on("click",".tb-thumbnail-creator-next",function(e){if(l<=3&&l>0){l++;O(l)}});jQuery(document).on("click",".tb-thumbnail-creator-previous",function(e){if(l<=3&&l>0){l--;O(l,l+1)}});jQuery(document).on("click",".tb-thumbnail-creator-reload",function(e){location.reload()});jQuery(document).on("click","#nextframe",function(){P();var e=c.getCurrentTime();var t=30;var i=1;var a=1/t*i;var r=e+a;c.seekTo(r)});jQuery(document).on("click","#prevframe",function(){P();var e=c.getCurrentTime();var t=30;var i=1;var a=1/t*i;var r=e-a;c.seekTo(r)});jQuery(document).on("click",".tb-thumbnail-creator-tab",function(e){var t=jQuery(this).attr("data-tab-id");O(parseInt(t));return false});jQuery(document).on("click",".tb-thumbnail-creator-layer-add",function(){TBUtilities.Log("TubeBuddyThumbnailCreator - tb-thumbnail-creator-layer-add - click");var e=jQuery(this).attr("data-type");TBUtilities.Log(e);n.discardActiveObject().renderAll();n.renderAll();jQuery(".tb-thumbnail-creator-layer-add").removeClass("tb-thumbnail-creator-layer-add--active");jQuery(this).addClass("tb-thumbnail-creator-layer-add--active");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-options-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-button").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-template-upgrade").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-frame-upgrade").addClass("tb-hid");me();switch(e){case"text":{jQuery("#tb-thumbnail-creator-text").val("Enter Text Here");jQuery(".tb-thumbnail-creator-format-btn--active").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-add-text").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-text-container").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-text").focus();jQuery("#tb-thumbnail-creator-text").select();jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");te(100);jQuery(".tb-thumbnail-creator-addlayer-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-add-text").removeClass("tb-hid");break}case"image":{fe();jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");te(100);ie(0);ae(0);jQuery(".tb-thumbnail-creator-layer-branding-container").removeClass("tb-hid");break}case"template":{if(TBGlobal.CanAccessLevel1Tools()){jQuery(".tb-thumbnail-creator-layer-template-container").removeClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-layer-template-upgrade").removeClass("tb-hid")}break}case"shape":{jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");te(100);jQuery(".tb-thumbnail-creator-add-shape").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape").removeClass("tb-thumbnail-creator-layer-shape-selected");jQuery("#tb-thumbnail-creator-shapes-selection").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-add-shape").removeClass("tb-hid");break}case"emoji":{fe();jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");te(100);ie(0);ae(0);jQuery(".tb-thumbnail-creator-layer-emoji-container").removeClass("tb-hid");U("people");TBExtension.GetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),"CRTBThumbnailCreatorReadRecentEmoji");break}case"frame":{jQuery(".tb-thumbnail-creator-layer-frame-container").removeClass("tb-hid");te(100);ie(0);ae(0);if(TBGlobal.CanAccessLevel1Tools()){jQuery("#tb-thumbnail-creator-layer-frame-upgrade").addClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-layer-frame-upgrade").removeClass("tb-hid")}}}});jQuery(document).on("click",".tb-thumbnail-creator-add-text",function(e){var t=new fabric.IText("",{left:100,top:100});t.set({fill:$(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});t.fontFamily=se();t.set({fontSize:le(),text:jQuery("#tb-thumbnail-creator-text").val()});if(jQuery(".tb-thumbnail-creator-bold").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("fontWeight","bold")}if(jQuery(".tb-thumbnail-creator-underline").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textDecoration","underline")}if(jQuery(".tb-thumbnail-creator-outline").hasClass("tb-thumbnail-creator-format-btn--active")){t.set({stroke:"#000000",strokeWidth:3})}if(jQuery(".tb-thumbnail-creator-outline-white").hasClass("tb-thumbnail-creator-format-btn--active")){t.set({stroke:"#FFFFFF",strokeWidth:3})}if(jQuery(".tb-thumbnail-creator-leftAlign").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textAlign","left")}if(jQuery(".tb-thumbnail-creator-centerAlign").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textAlign","center")}if(jQuery(".tb-thumbnail-creator-rightAlign").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textAlign","right")}t.set("opacity",X());n.add(t);he();jQuery(".tb-thumbnail-creator-layer-text-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container-opacity").addClass("tb-hid")});jQuery(document).on("click",".tb-thumbnail-creator-delete-all",function(e){TBUtilities.Confirm("Are you sure you want to delete all layers?",function(){n.forEachObject(function(e){if(e.id=="background"){if(e.selectable==true){n.remove(e)}}else{if(e.lockMovementY==false||e.lockMovementX==false){n.remove(e)}}});n.renderAll();he()},function(){})});jQuery(document).on("change","#tb-thumbnail-creator-lockBackground",function(e){var t=jQuery(this).is(":checked");m.selectable=!t;he()});jQuery(document).on("click",".tb-thumbnail-creator-delete",function(e){var t=J();if(t){n.remove(t);he()}});jQuery(document).on("click",".tb-thumbnail-creator-front",function(e){var t=J();if(t){n.bringToFront(t)}});jQuery(document).on("click",".tb-thumbnail-creator-underline",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");var t=J();if(t&&t.get("type")=="i-text"){if(t.getTextDecoration()==""){t.set("textDecoration","underline")}else{t.set("textDecoration","")}n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-opacity",function(e){var t=J();var i=X();re(i);if(t!=null){t.set("opacity",i);n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-brightness",function(e){var t=J();if(t!=null&&t.get("type")=="image"){var i=K();oe(i);jQuery.each(t.filters,function(e,a){if(typeof a.brightness!="undefined"){a.brightness=i;t.applyFilters(n.renderAll.bind(n))}})}});jQuery(document).on("change",".tb-thumbnail-creator-contrast",function(e){var t=J();if(t!=null&&t.get("type")=="image"){var i=ee();ne(i);jQuery.each(t.filters,function(e,a){if(typeof a.contrast!="undefined"){a.contrast=i;t.applyFilters(n.renderAll.bind(n))}})}});jQuery(document).on("click",".tb-thumbnail-creator-outline",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");if(jQuery(".tb-thumbnail-creator-outline-white").hasClass("tb-thumbnail-creator-format-btn--active")){jQuery(".tb-thumbnail-creator-outline-white").removeClass("tb-thumbnail-creator-format-btn--active")}var t=J();if(t&&t.get("type")=="i-text"){if(t.stroke==null||t.stroke=="#FFFFFF"){t.set({stroke:"#000000",strokeWidth:3})}else{t.set({stroke:null,strokeWidth:0})}n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-outline-white",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");if(jQuery(".tb-thumbnail-creator-outline").hasClass("tb-thumbnail-creator-format-btn--active")){jQuery(".tb-thumbnail-creator-outline").removeClass("tb-thumbnail-creator-format-btn--active")}var t=J();if(t&&t.get("type")=="i-text"){if(t.stroke==null||t.stroke=="#000000"){t.set({stroke:"#FFFFFF",strokeWidth:3})}else{t.set({stroke:null,strokeWidth:0})}n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-bold",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");var t=J();if(t&&t.get("type")=="i-text"){if(t.fontWeight&&t.fontWeight=="bold"){t.set("fontWeight","normal")}else{t.set("fontWeight","bold")}n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-leftAlign",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-centerAlign").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-rightAlign").removeClass("tb-thumbnail-creator-format-btn--active");var t=J();if(t&&t.get("type")=="i-text"){t.set("textAlign","left");n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-centerAlign",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-leftAlign").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-rightAlign").removeClass("tb-thumbnail-creator-format-btn--active");var t=J();if(t&&t.get("type")=="i-text"){t.set("textAlign","center");n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-rightAlign",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-leftAlign").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-centerAlign").removeClass("tb-thumbnail-creator-format-btn--active");var t=J();if(t&&t.get("type")=="i-text"){t.set("textAlign","right");n.renderAll()}});jQuery(document).on("click","#tb-thumbnail-creator-lockLayer-toggle",function(){var e=jQuery(this).attr("data-is-locked");var t=J();t.lockMovementX=!e;t.lockMovementY=!e;n.renderAll();if(e){jQuery(this).removeAttr("data-is-locked");jQuery(this).attr("title","lock layer");jQuery(this).find("i").toggleClass("tb-hid")}else{jQuery(this).attr("data-is-locked",true);jQuery(this).attr("title","unlock layer");jQuery(this).find("i").toggleClass("tb-hid")}});jQuery(document).on("click",".tb-thumbnail-creator-back",function(e){var t=J();if(jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")){var i=null;var a=n.getObjects();for(var r=0;r<a.length;r++){if(a[r].id=="background"){i=a[r]}}if(i){var o=n.getObjects().indexOf(i);n.moveTo(t,o+1)}else{t.sendToBack()}}else{t.sendToBack()}});jQuery(document).on("click",".tb-thumbnail-creator-upload",function(e){TBUtilities.Log("TubeBuddyThumbnailCreator - tb-thumbnail-creator-upload - click");TBUtilities.Confirm("Are you sure you want to publish this thumbnail?",function(){try{n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();jQuery("#tb-thumbnail-creator-container").find(".subnav").addClass("tb-hid");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ThumbnailGenerator_Use,"thumbnailgenerator")}catch(e){TBUtilities.LogError({Exception:e,Location:"[CreateThumbnail] [addAction]"})}n.discardActiveObject();var e='<span class="tb-spinner"></span>'+'<span style="margin-left:10px; font-size: 130%">Publishing Thumbnail...</span>';jQuery(".tb-thumbnail-settings-preview-container").block({message:e,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});jQuery(".tb-thumbnail-creator-previous").addClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");var i=n.toDataURL("image/png");i=i.replace("data:image/png;base64,","");TBUtilities.Log("TubeBuddyThumbnailCreator - tb-thumbnail-creator-upload - uploading to server");TBUtilities.Log("TubeBuddyThumbnailCreator - imageData length = "+i.length);if(v==true){x()}else{var a=TBGlobal.host+TBGlobal.apiUrls.thumbnailAdd;var r={VideoId:t,ImageData:i};TBExtension.Post(a,JSON.stringify(r),"CRTBThumbnailCreatorPostThumbnail",null,{contentType:"application/json"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] tb-thumbnail-creator-upload click"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}},function(){})});jQuery(document).on("change","#imgLoader",function(e){if(h){var t=new FileReader;t.readAsDataURL(e.target.files[0]);var i=e.target.files[0].size;if(i>2621440){TBUtilities.Alert("The maximum image file size is 2.5MB. Please select a smaller image.");jQuery("#imgLoader").val("");return}t.onloadend=function(e){jQuery(".tb-thumbnail-creator-uploading").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").addClass("tb-hid");var t={ImageData:e.target.result};var i=TBGlobal.host+TBGlobal.apiUrls.brandingsAdd;TBExtension.Post(i,JSON.stringify(t),"CRTBThumbnailCreatorPostBranding",null,{contentType:"application/json"})}}else{TBGlobal.ShowUpgradePage("upload more than a single custom image","thumbnailgenerator");try{document.getElementById("imgLoader").value=""}catch(e){}}});jQuery(document).on("change","#fontUpload",function(e){var t=document.getElementById("fontUpload").value;var i=t.match(/\.([^\.]+)$/)[1];i=i.toLowerCase();switch(i){case"ttf":break;default:TBUtilities.Alert("Only .ttf file types are allowed.");this.value=""}var a=new FileReader;a.readAsDataURL(e.target.files[0]);a.onloadend=function(e){jQuery(".tb-thumbnail-creator-font-uploading").removeClass("tb-hid");var i={FontData:e.target.result,FileName:t};var a=TBGlobal.host+TBGlobal.apiUrls.brandingsFontAdd;TBExtension.Post(a,JSON.stringify(i),"CRTBThumbnailCreatorPostThumbnailFontBranding",null,{contentType:"application/json"})}});jQuery(document).on("change","#tb-thumbnail-creator-picker-text",function(){var e=J();if(e&&e.get("type")==="i-text"){e.set("fill",$());n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-font",function(){var e=J();var t=se();if(t=="spacer"){return}if(t=="upload"){jQuery(".tb-thumbnail-creator-layer-container ").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").removeClass("tb-hid");return}if(t=="upgrade"){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.thumbnails);return}if(e&&e.get("type")==="i-text"){e.fontFamily=t;n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-font-size",function(){var e=J();if(e&&e.get("type")==="i-text"){e.set("fontSize",le());n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-font-upload-container",function(){jQuery("#fontUpload").click()});jQuery(document).on("click",".tb-thumbnail-creator-branding-delete",function(){var e=jQuery(this).attr("data-branding-id");TBUtilities.Confirm("Are you sure you want to delete this image?",function(){try{var t=n.getObjects();for(var i=0;i<t.length;i++){if(t[i].id==e){n.remove(t[i])}}n.renderAll();if(e){var a=TBGlobal.host+TBGlobal.apiUrls.brandingsDelete;TBExtension.Post(a,JSON.stringify({Id:e}),"CRTBThumbnailCreatorBrandingDelete",null,{contentType:"application/json"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] tb-thumbnail-creator-branding-delete click"})}},function(){})});jQuery(document).on("click",".tb-thumbnail-creator-filter-tab",function(){if(jQuery(this).hasClass("tb-thumbnail-creator-filter-tab-disabled")){return}var e=jQuery(this).attr("data-tab-id");jQuery(".tb-thumbnail-creator-filter-tab").removeClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab").addClass("tb-thumbnail-creator-filter-tab-inactive");switch(e){case"opacity":{jQuery(".tb-thumbnail-creator-filter-tab-opacity").addClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab-opacity").removeClass("tb-thumbnail-creator-filter-tab-inactive");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container-opacity").removeClass("tb-hid");break}case"brightness":{jQuery(".tb-thumbnail-creator-filter-tab-brightness").addClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab-brightness").removeClass("tb-thumbnail-creator-filter-tab-inactive");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container-brightness").removeClass("tb-hid");break}case"contrast":{jQuery(".tb-thumbnail-creator-filter-tab-contrast").addClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab-contrast").removeClass("tb-thumbnail-creator-filter-tab-inactive");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container-contrast").removeClass("tb-hid");break}}return false});jQuery(document).on("click",".tb-thumbnail-creator-layer-option",function(e){Qe()});jQuery(document).on("click","#tb-thumbnail-creator-set-opacity",function(){jQuery(".tb-thumbnail-creator-filter-container-opacity").removeClass("tb-hid")});jQuery(document).on("click","#tb-thumbnail-creator-set-brightness",function(){jQuery(".tb-thumbnail-creator-filter-container-brightness").removeClass("tb-hid")});jQuery(document).on("click","#tb-thumbnail-creator-set-contrast",function(){jQuery(".tb-thumbnail-creator-filter-container-contrast").removeClass("tb-hid")});jQuery(document).on("click",".tb-thumbnail-creator-shadow",function(){var e=J();var t=jQuery(this).attr("data-shadow-color");if(e.shadow&&e.shadow.color==t){e.setShadow({color:null,blur:0,offsestX:0,offsetY:0});jQuery(this).removeClass("tb-thumbnail-creator-format-btn--active").focusout()}else{e.setShadow({color:t,blur:20,offsestX:-3,offsetY:-3});jQuery(".tb-thumbnail-creator-shadow").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(this).addClass("tb-thumbnail-creator-format-btn--active")}n.renderAll()});jQuery(document).on("click",".tb-thumbnail-creator-image-tab",function(){var e=jQuery(this).attr("data-tab-id");switch(e){case"custom":{jQuery(".tb-thumbnail-creator-image-tab-custom").addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-creator-image-tab-stock").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-brandings-container").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-brandings-container-stock").addClass("tb-hid");break}case"stock":{jQuery(".tb-thumbnail-creator-image-tab-stock").addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-creator-image-tab-custom").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-brandings-container").addClass("tb-hid");jQuery("#tb-thumbnail-creator-brandings-container-stock").removeClass("tb-hid");break}}return false});jQuery(document).on("click",".tb-thumbnail-creator-image-tab-emoji",function(){var e=jQuery(this).attr("data-tab-id");jQuery(".tb-thumbnail-creator-image-tab-emoji").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(this).addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-creator-emoji-container").hide();jQuery(".tb-thumbnail-creator-emoji-container-"+e).show();U(e);return false});jQuery(document).on("click",".tb-thumbnail-creator-upgrade-license",function(e){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.thumbnails)});jQuery(document).on("click",".tb-thumbnail-creator-border",function(){if(!TBGlobal.CanAccessLevel1Tools()){return}var e=jQuery(this)[0];var t=e.getAttribute("src");fabric.Image.fromURL(t,function(e){n.add(e);var t=720/e.height;e.set({left:0,top:0,scaleY:t,scaleX:t});e.set({opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});e.setCoords();n.bringToFront(e);n.renderAll();he();var i=A();jQuery.each(i,function(t,i){e.filters.push(i)});e.applyFilters(n.renderAll.bind(n));n.setActiveObject(e);jQuery(".tb-thumbnail-creator-back").click()},{crossOrigin:"anonymous"});n.renderAll();jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");return false});jQuery(document).on("click",".tb-thumbnail-creator-branding-stock",function(){var e=jQuery(this)[0];var t=e.getAttribute("src");fabric.Image.fromURL(t,function(e){n.add(e);if(e.width>1280&&e.height>720){var t=1280/e.width;var i=720/e.height;e.set({left:n.width/2,top:n.height/2,scaleY:i,scaleX:i})}else{e.set({left:n.width/2,top:n.height/2,scaleY:2,scaleX:2})}e.set({opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});e.setCoords();n.bringToFront(e);n.renderAll();he();var a=A();jQuery.each(a,function(t,i){e.filters.push(i)});e.applyFilters(n.renderAll.bind(n));n.setActiveObject(e)},{crossOrigin:"anonymous",padding:5});n.renderAll();jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");return false});jQuery(document).on("click",".tb-branding-image",function(){var e=jQuery(this)[0];var t=e.getAttribute("data-branding-id");var i;var a=false;if(t){var r=TBUtilities.GetInArray(s,"Id",t);i=r.Image}else{a=true;i=b}fabric.Image.fromURL(i,function(e){e.id=t;n.add(e);e.set({opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});var i=e.width;var a=e.height;if(i>1280&&a>720){var r=1280/e.width;var o=720/e.height;e.set({scaleY:o,scaleX:o})}n.bringToFront(e);n.renderAll();var s=A();jQuery.each(s,function(t,i){e.filters.push(i)});e.applyFilters(n.renderAll.bind(n));n.setActiveObject(e);he();e.setCoords()},{crossOrigin:"anonymous",padding:5});n.renderAll();jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");return false});jQuery(document).on("keyup","#tb-thumbnail-creator-text",function(){var e=J();if(e&&e.type=="i-text"){e.set("text",jQuery(this).val());n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-backgroundSelect-stock-image",function(){var e=jQuery(this).attr("data-src-url");var t=jQuery(this).attr("id");var i=jQuery(this).attr("data-image-type");if(e){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src",e);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-standard");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-image-type");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-type",i);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-uploaded-id");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").width(640);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").height(360);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-image-height");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-image-width");switch(i){case"uploaded":{jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").width("");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").height("");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-uploaded-id",t);var a=new Image;a.onload=function(){var e=this.width;var t=this.height;jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-height",t);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-width",e);if(e>640){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").width(640)}else if(t>360){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").height(360)}};a.src=e;break}case"stock":{jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");break}case"thumbnail":{jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");var r=jQuery(this).attr("data-standard");if(typeof r!==typeof undefined&&r!==false){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-standard",r);if(r=="true"){jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("style","width:640;height:360px;cursor: pointer; background-size:cover;background-position:center;background-image:url("+e+"?"+(new Date).getTime()+")")}else{jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("style","width:1280px;height:319px;cursor: pointer; background-size:cover;background-position:center;background-image:url("+e+"?"+(new Date).getTime()+")")}}break}}}});jQuery(document).on("click",".tb-thumbnail-creator-step4-success-download",function(){try{n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var e=document.createElement("a");var i=n.toDataURL("image/png");var a=E(i.replace(/^data:image\/(png|jpg);base64,/,""));var r=URL.createObjectURL(a);e.download=t+".png";e.innerHTML="download";e.href=r;e.setAttribute("type","hidden");document.body.appendChild(e);e.click();e.remove()}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] tb-thumbnail-creator-step4-success-download"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-step4-success-download-upgrade-link",function(){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.thumbnails)});jQuery(document).on("click",".tb-thumbnail-creator-save-template",function(){if(TBGlobal.CanAccessLevel1Tools()){let r=window.prompt("What would you like the name of the template to be?","My Thumbnail Template");if(r!=null){var e=new fabric.Canvas("tb-thumbnail-canvas-clone");n.forEachObject(function(t){if(t.id!="background"){t.zindex=n.getObjects().indexOf(t);TBUtilities.Log(t.zindex);var i=fabric.util.object.clone(t);e.add(i)}});e.renderAll();var t=JSON.stringify(e.toJSON(["zindex"]));TBUtilities.Log(t);var i=TBGlobal.host+TBGlobal.apiUrls.thumbnailAddTemplate;var a={Template:t,Name:r,IsHighRes:true};TBExtension.Post(i,JSON.stringify(a),"CRTBThumbnailCreatorPostTemplate",null,{contentType:"application/json"})}}else{TBGlobal.ShowUpgradePage("save Thumbnail Templates","thumbnailgenerator")}});jQuery(document).on("click",".tb-thumbnail-creator-canvastemplate-container",function(){var e=jQuery(this).attr("data-template-id");if(e){var t=TBUtilities.GetInArray(g,"Id",e);if(t){var i='<span class="tb-spinner"></span>'+'<span style="margin-left:10px; font-size: 130%">Loading Template...</span>';jQuery("#tb-thumbnail-creator-step2").block({message:i,css:{padding:"30px 20px;",border:"2px solid #77889",backgroundColor:"transparent"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});var a=TBGlobal.host+TBGlobal.apiUrls.thumbnailGetTemplate+"?id="+t.Id;TBExtension.Get(a,function(e,t,i){if(e===true){var a=jQuery.parseJSON(i.Template);var r=a.objects.length;var o=0;var s=new Array;var l=new fabric.Canvas("tb-thumbnail-canvas-clone");l.loadFromJSON(i.Template,l.renderAll.bind(l),function(e,t){o++;l.renderAll();var a=fabric.util.object.clone(t);s.push(a);if(o>=r){function u(e,t){if(e.zindex&&t.zindex){return parseInt(e.zindex)-parseInt(t.zindex)}}s.sort(u);jQuery.each(s,function(e,t){if(i.IsHighRes==false){t.set({top:t.getTop()*2,left:t.getLeft()*2,scaleY:t.getScaleY()*2,scaleX:t.getScaleX()*2})}t.set({transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});n.add(t)});n.renderAll();he();n.forEachObject(function(e){if(e.type==="image"&&e.filters.length){e.applyFilters(function(){e.canvas.renderAll()})}})}})}else{TBUtilities.Alert("There was an error retrieving the template... Please try again.")}jQuery("#tb-thumbnail-creator-step2").unblock()},null,{dataType:"json"})}}});jQuery(document).on("click",".tb-thumbnail-creator-canvastemplate-delete",function(e){e.stopPropagation();var t=jQuery(this).attr("data-template-id");TBUtilities.Confirm("Are you sure you want to delete this template?",function(){try{if(t){var e=TBGlobal.host+TBGlobal.apiUrls.thumbnailDeleteTemplate;var i={Id:t};TBExtension.Post(e,JSON.stringify(i),"CRTBThumbnailCreatorDeleteTemplate",null,{contentType:"application/json"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] tb-thumbnail-creator-canvastemplate-delete click"})}},function(){})});jQuery(document).on("change","#tb-thumbnail-creator-picker-shapes",function(){var e=J();if(e){var t=e.datashapetype;var i=e.get("type");switch(i){case"line":{e.setStroke(Z());n.renderAll();break}case"group":{var a=e.getObjects();jQuery.each(a,function(e,t){switch(t.get("type")){case"triangle":{t.set("fill",Z());break}case"line":{t.set("stroke",Z());break}}});n.renderAll();break}case"triangle":case"rect":case"circle":case"arrow":case"polygon":{if(t&&t.indexOf("outline")!=-1){e.set("stroke",Z())}else{e.set("fill",Z())}n.renderAll();break}}}});jQuery(document).on("click",".tb-thumbnail-creator-layer-shape",function(){var e=jQuery(this).attr("data-shape-type");if(!e){TBUtilities.Alert("Please select a shape to add");return}switch(e){case"rectangle":{n.add(new fabric.Rect({left:n.width/2,top:n.height/2,fill:Z(),width:200,height:200,opacity:X(),datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"circle":{n.add(new fabric.Circle({left:n.width/2,top:n.height/2,fill:Z(),radius:100,opacity:X(),datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"line":{n.add(new fabric.Line([200,200,400,400],{left:n.width/2,top:n.height/2,stroke:Z(),datashapetype:e,strokeWidth:10,opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"triangle":{n.add(new fabric.Triangle({left:n.width/2,top:n.height/2,fill:Z(),width:200,height:200,opacity:X(),datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"star":{var t=S(5,100,50);var i=new fabric.Polygon(t,{fill:Z(),left:n.width/2,top:n.height/2,datashapetype:e,opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"},false);n.add(i);break}case"rectangle-outline":{n.add(new fabric.Rect({left:n.width/2,top:n.height/2,fill:"transparent",width:200,height:200,opacity:X(),stroke:Z(),strokeWidth:15,datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"circle-outline":{n.add(new fabric.Circle({left:n.width/2,top:n.height/2,fill:"transparent",radius:100,opacity:X(),stroke:Z(),strokeWidth:15,datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"triangle-outline":{n.add(new fabric.Triangle({left:n.width/2,top:n.height/2,width:200,height:200,opacity:X(),fill:"transparent",stroke:Z(),strokeWidth:15,datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"star-outline":{var t=S(5,100,50);var i=new fabric.Polygon(t,{left:n.width/2,top:n.height/2,fill:"transparent",stroke:Z(),strokeWidth:15,datashapetype:e,opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"},false);n.add(i);break}case"arrow":{var a=[50,100,200,200];var r=R(a);var o=V(a);var s=new fabric.Group([r,o]);s.setControlVisible("tr",false);s.setControlVisible("tl",false);s.setControlVisible("br",false);s.setControlVisible("bl",false);s.setControlVisible("ml",false);s.setControlVisible("mr",false);s.set({opacity:X(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});n.add(s);break}}he();jQuery(".tb-thumbnail-creator-layer-shape-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape").removeClass("tb-thumbnail-creator-layer-shape-selected");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container-opacity").addClass("tb-hid")});jQuery(document).on("click",".tb-thumbnail-creator-branding-stock-emoji",function(){T=jQuery(this).attr("src");TBExtension.GetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),"CRTBThumbnailCreatorGetRecentEmoji")})};var U=function(e){if(jQuery(".tb-thumbnail-creator-emoji-container-"+e).find(".tb-thumbnail-creator-branding-stock-emoji").length==0){var t="";switch(e){case"people":{t=L(1,1011,e);t+=L(2508,2666,e);break}case"activity":{t=L(1276,1620,e);break}case"flags":{t=L(2198,2464,e);break}case"food":{t=L(1177,1275,e);break}case"nature":{t=L(1012,1176,e);break}case"symbols":{t=L(1925,2197,e);t+=L(2465,2465,e);t+=L(2469,2469,e);t+=L(2498,2507,e);break}case"travel":{t=L(1621,1740,e);break}case"objects":{t=L(1741,1924,e);break}}jQuery(".tb-thumbnail-creator-emoji-container-"+e).empty();jQuery(".tb-thumbnail-creator-emoji-container-"+e).append(t)}};var L=function(e,t,i){var a="";for(var r=e;r<=t;r++){var o='<img crossorigin="anonymous" class="tb-thumbnail-creator-branding-stock tb-thumbnail-creator-branding-stock-emoji" data-loaded="0" src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/'+i+"/"+r+'.png" />';a+=o}return a};var S=function(e,t,i){var a=Math.PI/2*3;var r=t;var o=t;var n=Math.PI/e;var s=[];var l=0;for(var u=0;u<e;u++){var c=r+Math.cos(l)*t;var d=o+Math.sin(l)*t;s.push({x:c,y:d});l+=n;c=r+Math.cos(l)*i;d=o+Math.sin(l)*i;s.push({x:c,y:d});l+=n}return s};var G=function(e){var t=e.split(","),i=t[0].match(/:(.*?);/)[1],a=atob(t[1]),r=a.length,o=new Uint8Array(r);while(r--){o[r]=a.charCodeAt(r)}return new Blob([o],{type:i})};var E=function(e,t,i){t=t||"";i=i||512;var a=atob(e);var r=[];for(var o=0;o<a.length;o+=i){var n=a.slice(o,o+i);var s=new Array(n.length);for(var l=0;l<n.length;l++){s[l]=n.charCodeAt(l)}var u=new Uint8Array(s);r.push(u)}var c=new Blob(r,{type:t});return c};var R=function(e){var t=60,i=e[0],a=e[1],r=e[2],o=e[3],n=r-i,s=o-a,l=Math.atan2(s,n);l*=180/Math.PI;l+=90;var u=new fabric.Triangle({angle:l,fill:Z(),top:o,left:r,height:t,width:t,originX:"center",originY:"center",transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});return u};var V=function(e){var t=new fabric.Line(e,{strokeWidth:7,stroke:Z(),originX:"center",originY:"center",lockScalingX:true,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});t.setControlVisible("tr",false);t.setControlVisible("tl",false);t.setControlVisible("br",false);t.setControlVisible("bl",false);t.setControlVisible("ml",false);t.setControlVisible("mr",false);return t};var M=function(e){d=e;p=true;jQuery("#tb-thumbnail-creator-step1-complete").removeClass("tb-hid");P();jQuery(".tb-thumbnail-creator-bg-tabs-content").addClass("tb-hid");jQuery("#tb-thumbnail-bg-tab-header").find(".tb-thumbnail-creator-tabs-selected-menu-item").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-tab-"+d).removeClass("tb-hid");jQuery("#tb-tab-header-"+d).addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-backgroundSelect-still").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-color").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-stock").addClass("tb-hid");jQuery(".tb-thumbnail-creator-next").prop("disabled",false);jQuery(".tb-thumbnail-creator-next").removeClass("tb-thumbnail-creator-button-disabled");jQuery(".tb-thumbnail-creator-backgroundSelect-option-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-option-prompt").addClass("tb-hid");switch(e){case"still":{jQuery("#tb-thumbnail-creator-backgroundSelect-still").removeClass("tb-hid");c.playVideo();break}case"color":{jQuery(".tb-thumbnail-creator-backgroundSelect-color").removeClass("tb-hid");break}case"stock":{var t=TBGlobal.host+TBGlobal.apiUrls.brandingsGetBackgroundImages;TBExtension.Get(t,"CRTBThumbnailCreatorGetBackgroundImages");jQuery(".tb-thumbnail-creator-backgroundSelect-stock").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-image").css("width","115px","height","64px");break}}};var P=function(){try{c.pauseVideo()}catch(e){}};var D=function(){n.discardActiveObject();F(i);jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();document.getElementById("tb-thumbnail-fb-preview").innerHTML="";document.getElementById("tb-thumbnail-tw-preview").innerHTML="";var e=document.createElement("div");e.setAttribute("style","width:474px;height:268px; background-size:cover;background-position:center;background-image:url("+n.toDataURL("image/png")+")");document.getElementById("tb-thumbnail-fb-preview").appendChild(e);var t=document.createElement("img");t.setAttribute("src",n.toDataURL("image/png"));t.setAttribute("style","width:506px;height:336px; border-radius:.85714em;");document.getElementById("tb-thumbnail-tw-preview").appendChild(t)};var F=function(e){jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").empty();jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-loading").show();jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-search").val(e);TubeBuddyYouTubeActions.GetVideoSearchResults(e,function(e){jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-loading").hide();n.discardActiveObject();var a=jQuery("#tb-thumbnail-creator-video-template-this-video").html();var s=a.formatTemplate(t,"https://www.youtube.com/watch?v="+t,ke(i,45),o?o+" views":"",ke(TBGlobal.Profile().Title,45),"https://www.youtube.com/channel/"+TBGlobal.CurrentChannelId(),ke(r,200),n.toDataURL("image/png"));if(e!=null&&e.length>0){var l=jQuery("#tb-thumbnail-creator-video-template").html();jQuery.each(e,function(e,t){var i=l.formatTemplate(t.id,"https://www.youtube.com/watch?v="+t.id,ke(t.title,45),t.views,ke(t.channelName,30),t.channelUrl,ke(t.description,200));jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview:visible").append(i)});jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").prepend(s)}else{jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").prepend(s);var u=jQuery("#tb-thumbnail-creator-video-template-no-videos").html();jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").prepend(u)}})};var O=function(e,t){TBUtilities.Log("TubeBuddyThumbnailCreator - setStep");TBUtilities.Log("setting step - "+e);TBUtilities.Log("previousStep step - "+t);if(e!=1&&p==false){return}jQuery(".tb-thumbnail-settings-container").find(".tb-thumbnail-settings-tab").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step-tabs").find(".tb-tab-header").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-container").find(".subnav").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-all-layer-options").addClass("tb-hid");jQuery(".tb-thumbnail-creator-all-layer-option, .tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-add").removeClass("tb-thumbnail-creator-layer-add--active");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-download-step3").hide();jQuery(".tb-thumbnail-publish-button-seo-studio").addClass("tb-hid");switch(e){case 1:{jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="1"]').addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-step1").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").addClass("tb-hid");jQuery(".tb-thumbnail-creator-next").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step2-complete").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step3-complete").addClass("tb-hid");l=1;break}case 2:{try{if(t&&t==3){}else{_()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] setbackground on page "+window.location.href});TBUtilities.Alert("There was a problem capturing a still image from your video.\n\nThis can happen if YouTube just finished processing a new upload.\n\nPlease try again in a couple minutes or select a different background type.");Te();ge(true);O(1);return}jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="2"]').addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-step2").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-next").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");jQuery(".tb-thumbnail-creator-all-layer-option").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-step2-complete").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step3-complete").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-container-default").removeClass("tb-hid");he();if(_seoStudioCallback){jQuery(".tb-thumbnail-creator-next").addClass("tb-hid");jQuery(".tb-thumbnail-publish-button-seo-studio").removeClass("tb-hid")}l=2;break}case 3:{jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="3"]').addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-step3").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-next").addClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-step2-complete").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-tab-header-preview").find(".tb-thumbnail-creator-tabs-menu-item-container").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-preview-tab-header-youtube").addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").hide();jQuery(".tb-thumbnail-creator-preview-video-title").text(i);l=3;D();jQuery(".tb-thumbnail-settings-error-message").text("");jQuery(".tb-thumbnail-settings-error-container").hide();jQuery(".tb-thumbnail-settings-preview-container").show();if(v==true){jQuery(".tb-thumbnail-settings-tab-youtube").find(".yt-lockup-meta-info").hide()}if(TBGlobal.CanAccessLevel1Tools()){N()}break}case 4:{jQuery(".tb-thumbnail-creator-step4-publish-failed").hide();var a=window.location.href;if(a.indexOf("youtube.com/upload")>0||v==true||Q!==null){jQuery(".tb-thumbnail-creator-reload-container").addClass("tb-hid")}jQuery("#tb-thumbnail-creator-step3-complete").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-container").find(".subnav").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step3-complete").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-step4").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").addClass("tb-hid");jQuery(".tb-thumbnail-creator-next").addClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");l=4;break}}};var N=function(){jQuery(".tb-thumbnail-creator-download-step3").show()};var _=function(){TBUtilities.Log("TubeBuddyThumbnailCreator - setBackground");TBUtilities.Log(d);if(m){n.remove(m);n.renderAll()}n.setZoom(1);switch(d){case"still":{P();c.setSize(1280,720);var e=TBGlobal.GetYouTubeUI();TBUtilities.Log("TBLayout - TBLoadLayoutTemplate YouTubeUI = "+e);var i=null;switch(e){case"material":case"default":{i=ve();break}case"studio":{if(j==null){var a={};a.tbevent="ScreenCapRequest";var r=document.getElementById("screenshotPlayer");r.contentWindow.postMessage(a,"https://www.youtube.com");return}else{i=j;j=null}break}}try{if(TBGlobal.CanAccessLevel2Tools){var o={ImageData:i,ImageExt:"",VideoId:t};var s=TBGlobal.host+TBGlobal.apiUrls.brandingsAddStilFrameImage;TBExtension.Post(s,JSON.stringify(o),"",null,{contentType:"application/json"})}}catch(e){}fabric.Image.fromURL(i,function(e){e.setOptions({width:1280,height:720});n.add(e);m=e;m.id="background";m.sendToBack();m.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked");n.setZoom(n.getZoom()/2)},{crossOrigin:"anonymous"});break}case"color":{n.setZoom(n.getZoom()/2);P();var l=q();m=new fabric.Rect({width:1280,height:720,fill:l});n.add(m);m.sendToBack();m.id="background";m.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked");break}case"stock":{n.setZoom(n.getZoom()/2);var u=jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").first().attr("data-image-type");TBUtilities.Log("image type = "+u);switch(u){case"uploaded":{TBUtilities.Log("setting uploaded");stockImageSrc=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src");var b=parseInt(jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-height"));var h=parseInt(jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-width"));TBUtilities.Log("image height ="+b);TBUtilities.Log("image width ="+h);var y=1280/h;var p=720/b;var f=document.getElementById("tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview-tag");var g=f.clientWidth;var v=f.clientHeight;fabric.Image.fromURL(stockImageSrc,function(e){e.set({scaleX:y,scaleY:y});n.add(e);m=e;m.id="background";m.sendToBack();m.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")},{crossOrigin:"anonymous"});break}case"stock":{TBUtilities.Log("setting stock");stockImageSrc=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src");fabric.Image.fromURL(stockImageSrc,function(e){e.set({width:1280,height:720});n.add(e);m=e;m.id="background";m.sendToBack();m.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")},{crossOrigin:"anonymous"});break}case"thumbnail":{TBUtilities.Log("setting thumbnail");stockImageSrc=jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src");var T=jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-standard");fabric.Image.fromURL(TBGlobal.host+TBGlobal.apiUrls.thumbnailGetImageFromUrl+"?url="+stockImageSrc+"&t"+(new Date).getTime()+"&standard="+T,function(e){e.set({width:1280,height:720});n.add(e);m=e;m.id="background";m.sendToBack();m.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")},{crossOrigin:"anonymous"});break}}break}}n.renderAll()};var H=function(){try{j=null;jQuery("#tb-thumbnail-creator-container").css("left","28%");jQuery(".tb-thumbnail-creator-step4-publish-failed").hide();TBGlobal.AddUserDebugInfo("Opening ThumbnailCreator");jQuery('input[value="youtubecompetitor"]').prop("checked",true);jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").hide();jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid");jQuery(".tb-thumbnail-settings-tab-video-title").text(i);jQuery(".tb-thumbnail-settings-tab-video-title").attr("title",i);jQuery(".tb-thumbnail-settings-tab-video-title").attr("href","https://www.youtube.com/watch?v="+t);jQuery(".tb-thumbnail-settings-tab-video-by").text(TBGlobal.Profile().Title);jQuery(".tb-thumbnail-settings-tab-video-by").attr("href","https://www.youtube.com/channel/"+TBGlobal.CurrentChannelId());jQuery("#tb-thumbnail-creator-tw-preview-video-link").attr("href","https://youtu.be/"+t);jQuery("#tb-thumbnail-creator-tw-preview-video-link").text("youtu.be/"+t);jQuery(".tb-thumbnail-creator-image-tab-custom").click();Te();d="default";p=false;jQuery("#tb-thumbnail-creator-step1-complete").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-option-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-option-prompt").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-uploading").addClass("tb-hid");jQuery(".tb-thumbnail-publish-button-seo-studio").addClass("tb-hid");jQuery("#tb-thumbnail-still-frame-background").addClass("tb-thumbnail-creator-setting-backgroundOption--disabled");jQuery(".tb-thumnail-creator-video-loading").removeClass("tb-hid");jQuery(".tb-thumnail-creator-video-loading").removeClass("tb-hid");jQuery("#screenshotPlayer").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-template-upgrade").addClass("tb-hid");jQuery("#tb-thumbnail-thumbnail").attr("src",a);jQuery("#tb-thumbnail-title").attr("href","https://www.youtube.com/watch?v="+t);jQuery("#tb-thumbnail-title").text(i);jQuery(".tb-thumbnail-creator-next").prop("disabled",true);jQuery(".tb-thumbnail-creator-next").addClass("tb-thumbnail-creator-button-disabled");jQuery("#tb-thumbnail-creator-container").show();if(n){n.clear().renderAll()}else{n=new fabric.Canvas("tb-thumbnail-canvas",{preserveObjectStacking:true});n.observe("object:selected",pe);n.observe("selection:cleared",ye);n.backgroundColor="black"}ce();O(1);jQuery("#tb-thumbnail-creator-picker-text").spectrum({color:"#F00",showInput:true,preferredFormat:"hex",replacerClassName:"tb-thumbnail-creator-text-fill-btn",containerClassName:"tb-thumbnail-creator-background-select-custom tb-thumbnail-creator-color-picker--shadow",appendTo:"#tb-thumbnail-creator-container"});jQuery("#tb-thumbnail-creator-picker-solidColor").spectrum({color:"#666",showInput:true,showButtons:false,flat:true,containerClassName:"tb-thumbnail-creator-background-select-custom",preferredFormat:"hex",appendTo:"#tb-thumbnail-creator-container",move:function(e){jQuery("#tb-thumbnail-creator-backgroundSelect-color-preview").css("background-color",e.toHexString())}});jQuery(".sp-dragger").css("top","5px").css("left","5px");jQuery("#tb-thumbnail-creator-picker-shapes").spectrum({showInput:true,color:"#FF0000",preferredFormat:"hex",replacerClassName:"tb-thumbnail-creator-shape-fill-btn",containerClassName:"tb-thumbnail-creator-background-select-custom tb-thumbnail-creator-color-picker--shadow",appendTo:"#tb-thumbnail-creator-container"});jQuery("#tb-thumbnail-creator-backgroundSelect-color-preview").css("background-color","#666");var e=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);if(e||t===null){jQuery('#tb-thumbnail-creator-backgroundSelect option[value="still"]').hide();jQuery(".tb-thumbnail-creator-still-loading").hide()}else{jQuery(".tb-thumbnail-creator-still-loading").show();jQuery("#tb-thumbnail-creator-still-option-label").html("Still frame from video");jQuery('#tb-thumbnail-creator-backgroundSelect option[value="still"]').show();ge(false)}if(v==true){jQuery('.tb-thumbnail-creator-setting-backgroundOption[data-type="still"]').hide();jQuery('#tb-thumbnail-creator-backgroundSelect option[value="still"]').hide();jQuery(".tb-thumbnail-creator-setting-backgroundOption-first-or").hide();jQuery(".tb-thumbnail-creator-still-loading").hide()}var r=TBGlobal.CurrentChannelId()+"-channelThumbnail";var o=lscache.get(r);if(o!=null){b=o;W(o)}else{TBYouTubeApi.GetChannelDetails(TBGlobal.CurrentChannelId(),"id, snippet",function(e){try{if(e){b=e.Snippet.Thumbnails.ThumbnailDefault;lscache.set(r,b,43800);W(b)}}catch(e){}},null)}z();if(TBGlobal.CanAccessLevel1Tools()){de();jQuery(".tb-thumbnail-creator-font-upgrade").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upgraded").removeClass("tb-hid");Y()}be();var s=TBGlobal.Profile().TwitterAccounts;if(s&&s.length>0){jQuery("#tb-thumbnail-creator-tw-preview-twitter-name").text("@"+s[0].ScreenName);jQuery("#tb-thumbnail-creator-tw-preview-twitter-handle").text(s[0].Handle);jQuery("#tb-thumbnail-creator-tw-preview-avatar").attr("style","background-image: url("+s[0].ThumbnailUrl+")");jQuery("#tb-thumbnail-creator-tw-preview-avatar-placeholder").addClass("tb-hid")}var l=TBGlobal.Profile().FacebookAccounts;if(l&&l.length>0){jQuery("#tb-thumbnail-creator-fb-preview-fb-name").text(l[0].Name);jQuery("#tb-thumbnail-creator-fb-preview-avatar").attr("style","background-image: url("+l[0].ThumbnailUrl+")");jQuery("#tb-thumbnail-creator-fb-preview-avatar-placeholder").addClass("tb-hid")}jQuery("#tb-thumbnail-creator-backgroundSelect-stock-current-thumbnail").remove();jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src",TBGlobal.host+"/images/backgrounds/bg5-med.png");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-type","stock");jQuery("#tb-thumbnail-creator-abtestlink").attr("href",TBGlobal.host+"/channel/abtestcreate/"+TBGlobal.CurrentChannelId()+"?videoid="+t+"&videotitle="+i+"&videothumbnail="+encodeURI("https://img.youtube.com/vi/"+t+"/mqdefault.jpg"));if(v==false&&t!=null){TBYouTubeApi.GetVideoDetails(t,"snippet,contentDetails,statistics",ue)}if(_seoStudioCallback){jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="3"]').addClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="3"]').removeClass("tb-hid")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] prepareDialog"})}};var W=function(e){if(e&&jQuery("#tb-thumbnail-creator-brandings-container").find("#tb-thumbnail-creator-channelThumbnail").length==0){var t=jQuery("#tb-thumbnail-creator-brandingChannelImageTemplate").html();var i=t.formatTemplate("tb-thumbnail-creator-channelThumbnail",e);jQuery("#tb-thumbnail-creator-brandings-container").append(i);var a=jQuery("#tb-thumbnail-creator-brandings-container").find("#"+"tb-thumbnail-creator-channelThumbnail").first()[0];a.addEventListener("dragstart",TubeBuddyThumbnailCreator.HandleDragStart,false);a.addEventListener("dragend",TubeBuddyThumbnailCreator.HandleDragEnd,false)}};var z=function(){WebFont.load({google:{families:["Permanent Marker","Archivo Black","Press Start 2P","Coda","Anton","Knewave"]}})};var Y=function(){WebFont.load({google:{families:["Creepster","Black Ops One","Sigmar One","Luckiest Guy","Rubik Mono One"]}})};var J=function(){return n._activeObject};var $=function(){return jQuery("#tb-thumbnail-creator-picker-text").spectrum("get").toHexString()};var q=function(){return jQuery("#tb-thumbnail-creator-picker-solidColor").spectrum("get").toHexString()};var Z=function(){return jQuery("#tb-thumbnail-creator-picker-shapes").spectrum("get").toHexString()};var X=function(){try{var e=jQuery(".tb-thumbnail-creator-opacity").val();return e*.01}catch(e){return 1}};var K=function(){try{var e=jQuery(".tb-thumbnail-creator-brightness").val();return Math.round(e)}catch(e){return 0}};var ee=function(){try{var e=jQuery(".tb-thumbnail-creator-contrast").val();return Math.round(e)}catch(e){return 1}};var te=function(e){try{jQuery(".tb-thumbnail-creator-opacity").val(e);re(X())}catch(e){}};var ie=function(e){try{jQuery(".tb-thumbnail-creator-brightness").val(e);oe(e)}catch(e){}};var ae=function(e){try{jQuery(".tb-thumbnail-creator-contrast").val(e);ne(ee())}catch(e){}};var re=function(e){try{var t=e*100;jQuery(".tb-thumbnail-creator-opacity-percentage").text(Math.round(t)+" %")}catch(e){}};var oe=function(e){try{var t=0;var i=" ";if(e>0){t=Math.floor(e/255*100);i="+"+t+" %"}else if(e<0){t=Math.floor(e/-255*100);i="-"+t+" %"}else{i="0"}if(t==0){i="0"}jQuery(".tb-thumbnail-creator-brightness-display").text(i)}catch(e){}};var ne=function(e){try{var t=0;var i=" ";if(e>0){t=Math.floor(e/255*100);i="+"+t+" %"}else if(e<0){t=Math.floor(e/-255*100);i="-"+t+" %"}else{i="0"}if(t==0){i="0"}jQuery(".tb-thumbnail-creator-contrast-percentage").text(i)}catch(e){}};var se=function(){return jQuery(".tb-thumbnail-creator-font").val()};var le=function(){var e=jQuery(".tb-thumbnail-creator-font-size").val();if(e){return parseInt(e)}else{return 12}};var ue=function(e){try{var t=jQuery("<img />");t.attr("class","tb-thumbnail-creator-backgroundSelect-stock-image tb-margin-bottom10 tb-margin-left5 tb-cursor-pointer");t.attr("style","width:115px;height:64px;");t.attr("src",e.snippet.thumbnails.thumbnailMedium+"?"+(new Date).getTime());t.attr("data-image-type","thumbnail");if(e.snippet.thumbnails.thumbnailStandard){t.attr("data-src-url",e.snippet.thumbnails.thumbnailStandard);t.attr("data-standard","true")}else{t.attr("data-src-url",e.snippet.thumbnails.thumbnailHigh);t.attr("data-standard","false")}t.attr("id","tb-thumbnail-creator-backgroundSelect-stock-current-thumbnail");jQuery("#tb-thumbnail-creator-backgroundSelect-upload").after(t);jQuery(".tb-thumbnail-settings-tab-video-description").html(e.snippet.description);if(e.statistics.ViewCount){jQuery(".tb-thumbnail-settings-tab-video-views").text(TBUtilities.FormatNumberWithCommas(e.statistics.ViewCount)+" views")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] getVideoDetailsCallback"})}};var ce=function(){try{var e=TBGlobal.host+TBGlobal.apiUrls.brandingsGetAll;TBExtension.Get(e,"CRTBThumbnailLoadBrandings")}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] loadBrandings"})}};var de=function(e){try{var t=TBGlobal.host+TBGlobal.apiUrls.brandingsGetAllFonts;TBExtension.Get(t,"CRTBThumbnailLoadBrandingsFonts",e)}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] loadBrandingFonts"})}};var be=function(){try{if(TBGlobal.CanAccessLevel1Tools()){var e=TBGlobal.host+TBGlobal.apiUrls.thumbnailGetTemplateList;TBExtension.Get(e,"CRTBThumbnailLoadTemplates",null)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailCreator] loadTemplates"})}};var he=function(){if(n==null){jQuery(".tb-thumbnail-creator-delete-all").attr("disabled",true);return}if(n.getObjects()==null){jQuery(".tb-thumbnail-creator-delete-all").addClass("tb-hid");return}var e=0;n.forEachObject(function(t){if(t.id=="background"){if(t.selectable==true){e++}}else{e++}});if(e==0){jQuery(".tb-thumbnail-creator-delete-all").attr("disabled",true)}else{jQuery(".tb-thumbnail-creator-delete-all").attr("disabled",false)}};var ye=function(e){jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-options-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid")};var pe=function(e){jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-options-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-add").removeClass("tb-thumbnail-creator-layer-add--active");jQuery(".tb-thumbnail-creator-shadow").removeClass("tb-thumbnail-creator-format-btn--active");if(e.target){var t=n._activeObject;e.target.set({transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});n.renderAll();jQuery(".tb-thumbnail-creator-layer-selected-title").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-options-container").css("top","124px","left","164px");jQuery(".tb-thumbnail-creator-layer-options-container").removeClass("tb-hid");if(e.target.lockMovementY==true||e.target.lockMovementX==true){jQuery("#tb-thumbnail-creator-lockLayer").attr("checked",true);jQuery("#tb-thumbnail-creator-lockLayer-locked").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-toggle").attr("data-is-locked",true);jQuery("#tb-thumbnail-creator-lockLayer-toggle").attr("title","unlock layer");jQuery("#tb-thumbnail-creator-lockLayer-locked").addClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-unlocked").removeClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-lockLayer").attr("checked",false);jQuery("#tb-thumbnail-creator-lockLayer-unlocked").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-toggle").removeAttr("data-is-locked");jQuery("#tb-thumbnail-creator-lockLayer-toggle").attr("title","lock layer");jQuery("#tb-thumbnail-creator-lockLayer-unlocked").addClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-locked").removeClass("tb-hid")}if(t&&t.shadow&&t.shadow.color!=null){jQuery("#tb-thumbnail-creator-shadow-"+t.shadow.color).addClass("tb-thumbnail-creator-format-btn--active")}try{if(t&&t.opacity){var i=t.opacity*100;te(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] canvasObjectSelected"})}me();var a=e.target.datashapetype;switch(e.target.type){case"i-text":{jQuery(".tb-thumbnail-creator-add-text").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-text-container").removeClass("tb-hid");jQuery("#tb-thumbnail-insert-text-button").addClass("tb-thumbnail-creator-layer-add--active");if(n._activeObject&&n._activeObject.stroke=="#000000"){jQuery(".tb-thumbnail-creator-outline").addClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-outline").removeClass("tb-thumbnail-creator-format-btn--active")}if(n._activeObject&&n._activeObject.stroke=="#FFFFFF"){jQuery(".tb-thumbnail-creator-outline-white").addClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-outline-white").removeClass("tb-thumbnail-creator-format-btn--active")}if(n._activeObject&&n._activeObject.fontWeight=="normal"){jQuery(".tb-thumbnail-creator-bold").removeClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-bold").addClass("tb-thumbnail-creator-format-btn--active")}if(e.target.getTextDecoration()!="underline"){jQuery(".tb-thumbnail-creator-underline").removeClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-underline").addClass("tb-thumbnail-creator-format-btn--active")}jQuery(".tb-thumbnail-creator-font").val(n._activeObject.fontFamily);jQuery("#tb-thumbnail-creator-text").val(n._activeObject.text);jQuery("#tb-thumbnail-creator-picker-text").spectrum("set",n._activeObject.fill);break}case"triangle":case"line":case"rect":case"circle":case"arrow":case"group":case"polygon":{jQuery("#tb-thumbnail-creator-shapes-selection").addClass("tb-hid");jQuery(".tb-thumbnail-creator-add-shape").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape-container").removeClass("tb-hid");var r=n._activeObject.fill;if(a&&a.indexOf("outline")!=-1){r=e.target.getStroke()}jQuery("#tb-thumbnail-creator-picker-shapes").spectrum("set",r);break}case"image":{try{if(e.target.filters.length==0){ie(0);ae(0);var o=A();jQuery.each(o,function(t,i){e.target.filters.push(i)});e.target.applyFilters(n.renderAll.bind(n))}jQuery.each(e.target.filters,function(e,t){if(typeof t.brightness!="undefined"){ie(t.brightness)}if(typeof t.contrast!="undefined"){ae(t.contrast)}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] canvasObjectSelected"})}fe();break}}}};var me=function(){jQuery("#tb-thumbnail-creator-set-brightness").attr("disabled","disabled");jQuery("#tb-thumbnail-creator-set-contrast").attr("disabled","disabled")};var fe=function(){jQuery("#tb-thumbnail-creator-set-brightness").removeAttr("disabled");jQuery("#tb-thumbnail-creator-set-contrast").removeAttr("disabled")};var ge=function(e){jQuery("#screenshotPlayer").width(640).height(360);if(c&&e==false){try{c.setSize(640,360);jQuery(".tb-thumbnail-creator-still-loading").hide();jQuery(".tb-thumbnail-creator-still-loading").closest(".tb-thumbnail-creator-setting-backgroundOption").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");jQuery("#tb-thumbnail-still-frame-background").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");c.loadVideoById(t,0,"highres");P();je()}catch(e){}}else{if(c){c.destroy()}c=new YT.Player("screenshotPlayer",{height:"360",width:"640",videoId:t,enablejsapi:true,playerVars:{showinfo:0,origin:window.location.href,html5:1,rel:0},events:{onReady:TubeBuddyThumbnailCreator.OnPlayerReady,onStateChange:TubeBuddyThumbnailCreator.OnPlayerStateChange,onPlaybackQualityChange:TubeBuddyThumbnailCreator.OnPlayerPlaybackQualityChange}})}};var ve=function(){jQuery("#screenshotPlayer").contents().find(".video-stream").attr("crossorigin","anonymous");var e=null;var t=jQuery("#screenshotPlayer").contents().find(".html5-main-video:first");var i=t[0];var a=jQuery("#tb-thumbnail-temp-canvas")[0];var r=a.getContext("2d");a.width=1280;a.height=720;r.fillRect(0,0,1280,720);r.drawImage(i,0,0,a.width,a.height);e=a.toDataURL();return e};var Te=function(){jQuery("#tb-thumbnail-temp-canvas").remove();var e=document.createElement("canvas");e.id="tb-thumbnail-temp-canvas";e.style.display="none";var t=document.getElementById("tb-thumbnail-temp-canvas-container");t.appendChild(e)};var je=function(){jQuery(".tb-thumnail-creator-video-loading").addClass("tb-hid");jQuery("#screenshotPlayer").removeClass("tb-hid")};var Qe=function(){jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid")};var ke=function(e,t){if(e&&t){return e.length>t?e.substring(0,t-3)+"...":e}else{return""}};var Be=function(){jQuery(document.body).on("CRTBThumbnailCreatorGetRecentEmoji",function(e,t){TBUtilities.Log("CRTBThumbnailCreatorGetRecentEmoji response");TBUtilities.Log(t);var i=new Array;if(t.value){i=JSON.parse(t.value)}if(i.indexOf(T)==-1){i.unshift(T)}i=i.slice(0,7);TBExtension.SetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),JSON.stringify(i),"CRTBThumbnailCreatorSetRecentEmoji");TBExtension.GetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),"CRTBThumbnailCreatorReadRecentEmoji")});jQuery(document.body).on("CRTBThumbnailCreatorReadRecentEmoji",function(e,t){TBUtilities.Log("CRTBThumbnailCreatorReadRecentEmoji response");TBUtilities.Log(t);var i=new Array;if(t.value){i=JSON.parse(t.value)}if(i.length>0){jQuery(".tb-thumbnail-creator-layer-emoji-recent-container").show();jQuery(".tb-thumbnail-creator-layer-emoji-recent").empty();jQuery(".tb-thumbnail-creator-emoji-container").removeClass("tb-thumbnail-creator-emoji-container--no-recent");jQuery.each(i,function(e,t){var i=t;var a='<img crossorigin="anonymous" class="tb-thumbnail-creator-branding-stock tb-thumbnail-creator-branding-stock-emoji" src='+i+" />";jQuery(".tb-thumbnail-creator-layer-emoji-recent").append(a)})}else{jQuery(".tb-thumbnail-creator-emoji-container").addClass("tb-thumbnail-creator-emoji-container--no-recent")}});jQuery(document.body).on("CRTBThumbnailCreatorDeleteBackgroundImage",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorDeleteBackgroundImage");TBUtilities.Log(t.success);var i=TBGlobal.host+TBGlobal.apiUrls.brandingsGetBackgroundImages;TBExtension.Get(i,"CRTBThumbnailCreatorGetBackgroundImages")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorDeleteBackgroundImage"})}});jQuery(document.body).on("CRTBThumbnailCreatorUploadBackgroundImage",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorUploadBackgroundImage");TBUtilities.Log(t.success);jQuery(".tb-thumbnail-creator-backgroundSelect-uploading").addClass("tb-hid");if(t.success){var i=TBGlobal.host+TBGlobal.apiUrls.brandingsGetBackgroundImages;TBExtension.Get(i,"CRTBThumbnailCreatorGetBackgroundImages")}else{jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-disabled").addClass("tb-hid");TBUtilities.Alert("There was an error uploading your image.  Please make sure the image is larger than 1280 x 720 and that the file type is .png.")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorUploadBackgroundImage"})}});jQuery(document.body).on("CRTBThumbnailCreatorGetBackgroundImages",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorGetBackgroundImages");TBUtilities.Log(t.success);jQuery(".tb-thumbnail-creator-backgroundSelect-uploaded-image").remove();jQuery(".tb-thumbnail-creator-backgroundSelect-uploaded-image-delete:visible").remove();if(t.success){var i=jQuery.parseJSON(t.response);var a=TBGlobal.host+"/images/icons/x.png";jQuery.each(i,function(e,t){var i=jQuery("#tb-thumbnail-creator-backgroundSelect-uploaded-image-template").html();var r=i.formatTemplate("tb-thumbnail-creator-backgroundSelect-stock-image tb-thumbnail-creator-backgroundSelect-uploaded-image","width:115px;height:64px;cursor: pointer; margin-bottom: 10px; margin-left: 5px; background-size:cover;background-position:center;background-image:url("+t.ImageUrl+");float:left",t.ImageUrl,t.Id,"uploaded",a);jQuery("#tb-thumbnail-creator-backgroundSelect-upload").after(r)});if(i.length>=5){jQuery(".tb-thumbnail-creator-backgroundSelect-upload-disabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").addClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-disabled").addClass("tb-hid")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorGetBackgroundImages"})}});jQuery(document.body).on("CRTBThumbnailCreatorGetVideo",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorGetVideo");TBUtilities.Log(t.success);if(t.success){var i=jQuery.parseJSON(t.response)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorGetVideo"})}});jQuery(document.body).on("CRTBLoadThumbnailCreatorTemplate",function(e,t){try{TBUtilities.Log("CRTBLoadThumbnailCreatorTemplate");TBUtilities.Log(t.success);if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(Q){Q.parent().append(t.response)}else{jQuery("body").append(t.response)}Ce()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBLoadThumbnailCreatorTemplate"})}});jQuery(document.body).on("CRTBThumbnailCreatorPostThumbnail",function(e,i){try{TBUtilities.Log("CRTBThumbnailCreatorPostThumbnail");TBUtilities.Log(i);if(i.response==413){w(i)}else if(i.success){C(true)}else{TBUtilities.Log("API publish failed, trying post to UI");n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var a=n.toDataURL("image/png");TubeBuddyYouTubeActions.PostCustomThumbnailStudio(t,a).then(function(e){C(false)}).catch(function(e){w(e)})}}catch(e){w();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorPostThumbnail"})}});jQuery(document.body).on("CRTBThumbnailCreatorBrandingDelete",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorBrandingDelete");TBUtilities.Log(t);ce()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorBrandingDelete"})}});jQuery(document.body).on("CRTBThumbnailCreatorPostBranding",function(e,t){try{jQuery(".tb-thumbnail-creator-image-tab-custom").click();TBUtilities.Log("CRTBThumbnailCreatorPostBranding");TBUtilities.Log(t);jQuery(".tb-thumbnail-creator-uploading").addClass("tb-hid");jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").removeClass("tb-hid");jQuery("#imgLoader").val("");ce()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorPostBranding"})}});jQuery(document.body).on("CRTBThumbnailLoadBrandings",function(e,t){try{TBUtilities.Log("CRTBThumbnailLoadBrandings");TBUtilities.Log(t.success);if(t.success){jQuery("#tb-thumbnail-creator-brandings-container").find(".tb-thumbnail-creator-brandingImage-creator").remove();s=jQuery.parseJSON(t.response);if(TBGlobal.CanAccessLevel1Tools()==true){h=true;if(s.length>=20){y=true;h=false;jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").addClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").removeClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid")}}else if(TBGlobal.CanAccessLevel1Tools()==false){if(s.length<1){h=true}else{h=false}jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid")}jQuery.each(s,function(e,t){var i=jQuery("#tb-thumbnail-creator-brandingImage").html();var a=i.formatTemplate(t.Id,t.Image);jQuery("#tb-thumbnail-creator-brandings-container").append(a)})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailLoadBrandings"})}});jQuery(document.body).on("CRTBThumbnailLoadBrandingsFonts",function(e,t){try{TBUtilities.Log("CRTBThumbnailLoadBrandingsFonts");TBUtilities.Log(t.success);if(t.success){var i=jQuery.parseJSON(t.response);jQuery.each(i,function(e,t){var i=jQuery(".tb-thumbnail-creator-font option[value='"+t.Name+"']").length;if(i==0){var a="font-family:"+t.Name;jQuery(".tb-thumbnail-creator-font option:first").before(jQuery("<option></option>").attr("value",t.Name).attr("style",a).text(t.Name));var r="font-family:'"+t.Name+"';";r=r+"src: url("+t.Font+") format('truetype')";var o=document.createElement("style");o.type="text/css";if(o.styleSheet){o.styleSheet.cssText="@font-face {"+r+"}"}else{o.appendChild(document.createTextNode("@font-face {"+r+"}"))}document.getElementsByTagName("head")[0].appendChild(o)}});if(t.data){jQuery(".tb-thumbnail-creator-font").val(t.data)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailLoadBrandingsFonts"})}});jQuery(document.body).on("CRTBThumbnailCreatorPostThumbnailFontBranding",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorPostBranding");TBUtilities.Log(t.success);jQuery(".tb-thumbnail-creator-font-uploading").addClass("tb-hid");if(t.success){jQuery(".tb-thumbnail-creator-font-upload-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").val("");de(t.response.replace(/"/g,""));jQuery("#tb-thumbnail-insert-text-button").click()}else{TBUtilities.Alert("There was an error uploading your font. Please try again")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorPostThumbnailFontBranding"})}});jQuery(document.body).on("CRTBThumbnailCreatorGetYouTubeFeatures",function(e,t){try{if(t.success){TBUtilities.Log("CRTBThumbnailCreatorGetYouTubeFeatures");var i=jQuery.parseHTML(t.response);var a=jQuery(i).find(".account-feature-v2-grid-items").length;var r=jQuery(i).find('a[href*="138008"]').closest("li");if(r&&a>0){if(r.hasClass("account-features-v2-grid-item-green")){f=true}else{TBUtilities.Log("Thumbnails disabled");f=false}}else{var o=jQuery(i).find("tr.account-features-custom-thumbs").first();if(jQuery(o).find(".account-features-status-section").first().find(".status-green").length>0){f=true}else{f=false;TBUtilities.Log("Thumbnails disabled")}}}else{f=true}}catch(e){f=true;TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorGetYouTubeFeatures"})}if(f==false){jQuery(".tb-thumbnail-settings-container").empty();jQuery(".tb-thumbnail-settings-container").append("<div style='text-align:center; margin-top:120px; margin-bottom:120px;'> <img src='"+TBGlobal.host+"/images/icons/error.png' /> <b style='color:coral; font-size:20px;'>Your channel does not have custom thumbnails enabled.</b><br/><br /><br><br/>You need to <a target='new' href='https://www.youtube.com/verify'>Verify</a> your channel in order to enable thumbnails.</div>")}});jQuery(document.body).on("CRTBThumbnailCreatorGetVideoDetails",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorGetVideoDetails");TBUtilities.Log(t);var i=jQuery.parseHTML(DOMPurify.sanitize(t.response,DOMPurifyConfig));var a=jQuery(i).find("tr.account-features-custom-thumbs").first();if(jQuery(a).find(".account-features-status-section").first().find(".status-green").length>0){f=true}else{f=false}if(f==false){jQuery(".tb-thumbnail-settings-container").empty();jQuery(".tb-thumbnail-settings-container").append("<div style='text-align:center; margin-top:120px; margin-bottom:120px;'> <img src='"+TBGlobal.host+"/images/icons/error.png' /> <b style='color:coral; font-size:20px;'>Your channel does not have custom thumbnails enabled.</b><br/><br /><br><br/>You need to <a target='new' href='https://www.youtube.com/verify'>Verify</a> your channel in order to enable thumbnails.</div>")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorGetVideoDetails"})}});jQuery(document.body).on("CRTBThumbnailCreatorPostTemplate",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorPostTemplate");TBUtilities.Log(t);be()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorPostTemplate"})}});jQuery(document.body).on("CRTBThumbnailCreatorDeleteTemplate",function(e,t){try{TBUtilities.Log("CRTBThumbnailCreatorDeleteTemplate");TBUtilities.Log(t);be()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailCreatorDeleteTemplate"})}});jQuery(document.body).on("CRTBThumbnailLoadTemplates",function(e,t){try{TBUtilities.Log("CRTBThumbnailLoadTemplates");TBUtilities.Log(t.success);jQuery(".tb-thumbnail-creator-layer-template-has").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-template-hasNone").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-template-has").html("");if(t.success){g=jQuery.parseJSON(t.response);if(g.length>0){jQuery(".tb-thumbnail-creator-layer-template-has").removeClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-layer-template-hasNone").removeClass("tb-hid")}jQuery.each(g,function(e,t){var i=jQuery("#tb-thumbnail-creator-canvas-template-row").html();var a=i.formatTemplate(t.Id,ke(t.Name,30));jQuery(".tb-thumbnail-creator-layer-template-has").append(a)})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] CRTBThumbnailLoadTemplates"})}})};var Ce=function(){H()};return{Show:function(s,l,u,d,b,h){try{if(TBGlobal.IsAuthenticated()){t=s;i=l;a=u;r=d?d:"";o=b?b:"";v=false;_seoStudioCallback=null;TBGlobal.ClearUserDebugInfo();if(h){Q=h}else{Q=null}if(!e){Be();k();I();e=true;if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{TBExtension.Get("https://www.youtube.com/features?o=U"+TBGlobal.ClassicForceParam(),"CRTBThumbnailCreatorGetYouTubeFeatures",null)}}else{if(jQuery("#tb-thumbnail-creator-container").length===0){if(c){c.destroy();c=null}if(n){n.dispose();n=null}k()}else{Ce()}}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] Show"})}},ShowForLiveStream:function(){try{if(TBGlobal.IsAuthenticated()){v=true;t=jQuery(".metadata-app[data-video-id]:first").attr("data-video-id");i=jQuery(".video-settings-title").val();_seoStudioCallback=null;TBGlobal.ClearUserDebugInfo();if(!e){Be();k();I();e=true;TBExtension.Get("https://www.youtube.com/features","CRTBThumbnailCreatorGetYouTubeFeatures",null)}else{Ce()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] ShowForLiveStream"})}},ShowForSeoStudio:function(n,s,l,u,c,d){try{if(TBGlobal.IsAuthenticated()){t=n?n:null;i=s?s:null;a=l?l:null;r=u?u:"";o=c?c:"";v=false;_seoStudioCallback=d;TBGlobal.ClearUserDebugInfo();if(!e){Be();k();I();e=true;if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{TBExtension.Get("https://www.youtube.com/features?o=U"+TBGlobal.ClassicForceParam(),"CRTBThumbnailCreatorGetYouTubeFeatures",null)}}else{Ce()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailCreator] Show"})}},OnPlayerReady:function(e){jQuery(".tb-thumbnail-creator-still-loading").hide();jQuery(".tb-thumbnail-creator-still-loading").closest(".tb-thumbnail-creator-setting-backgroundOption").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");jQuery("#tb-tab-header-still").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");e.target.setPlaybackQuality("hd720");je()},OnPlayerStateChange:function(e){if(e.data==YT.PlayerState.BUFFERING){e.target.setPlaybackQuality("hd720")}},OnPlayerPlaybackQualityChange:function(e){var t=e.target.getPlaybackQuality();var i="hd720";TBUtilities.Log("Quality changed to: "+t);if(t!=="hd720"){TBUtilities.Log("Setting quality to "+i);e.target.setPlaybackQuality(i)}},GetVideoId:function(){return t},OnYouTubePlayerAPIReady:function(){u=true}}}();function onYouTubePlayerAPIReady(){TubeBuddyThumbnailCreator.OnYouTubePlayerAPIReady()}(function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,a=t.Image.filters,r=t.util.createClass;a.Contrast=r(a.BaseFilter,{type:"Contrast",initialize:function(e){e=e||{};this.contrast=e.contrast||0},applyTo:function(e){var t=e.getContext("2d"),i=t.getImageData(0,0,e.width,e.height),a=i.data,r=259*(this.contrast+255)/(255*(259-this.contrast));for(var o=0,n=a.length;o<n;o+=4){a[o]=r*(a[o]-128)+128;a[o+1]=r*(a[o+1]-128)+128;a[o+2]=r*(a[o+2]-128)+128}t.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}});t.Image.filters.Contrast.fromObject=function(e){return new t.Image.filters.Contrast(e)}})(typeof exports!=="undefined"?exports:this);var TubeBuddySearchRanking=function(){var e=false;var t="";var i;var a;var r=[];var o=0;var n=0;var s=[];var l=0;var u=0;var c=false;var d=true;var b;var h;var y={id:"",term:"",rank:-1,date:""};var p=function(){var e=TBGlobal.host+"/ModuleManager/SearchRanking/SearchRanking?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/searchranking.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/searchranking.html"}TBExtension.Get(e,"CRTBLoadSearchRankingTemplate")};var m=function(e,i){var a=[];jQuery.each(e,function(e,i){var r={VideoId:t,SearchTerm:i.term,Id:i.id};a.push(r)});var r=jQuery.param({Rankings:a});var o=TBGlobal.host+TBGlobal.apiUrls.searchRankGetMostRecentBeforeToday;TBExtension.Post(o,r,"CRSearchRankingGetMostRecentBeforeToday",{isCustom:i},{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})};var f=function(e){var i=TBGlobal.host+TBGlobal.apiUrls.searchRankAddRankings;var a=new Date;var r=a.getDate();var o=a.getMonth()+1;var n=a.getFullYear();var s=[];jQuery.each(e,function(e,i){var a={SearchDate:n+"-"+o+"-"+r,VideoId:t,SearchTerm:i.term,Rank:i.rank};s.push(a)});var l=jQuery.param({Rankings:s});TBExtension.Post(i,l,"CRSearchRankingNOTUSED",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})};function g(e,t){if(jQuery(e).children("th").length>0){return 99}if(jQuery(e).children("td").eq(t).html().indexOf("blue-pen.png")>0)return 1;if(jQuery(e).children("td").eq(t).html().indexOf("blue-tag.png")>0)return 0;if(jQuery(e).children("td").eq(t).attr("data-rank")){return jQuery(e).children("td").eq(t).attr("data-rank")}return jQuery(e).children("td").eq(t).text()}function v(e){return function(t,i){var a=g(t,e),r=g(i,e);a=a.toString().replace("N/R",999);r=r.toString().replace("N/R",999);if(a=="-")a=0;if(r=="-")r=0;a=a.toString().replace("+","");r=r.toString().replace("+","");if(jQuery.isNumeric(a)&&jQuery.isNumeric(r)){return a-r}else{return a.localeCompare(r)}}}var T=function(){jQuery(document).on("click",".tb-module-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-search-ranking-container").hide();jQuery("#tb-search-ranking-selected-term-container").hide()});jQuery(document).on("click","th",function(){var e=jQuery("#tb-search-ranking-table").eq(0);var t=e.find("tr").toArray().sort(v(jQuery(this).index()));if(d==true){this.asc=true}else{this.asc=!this.asc}if(!this.asc){t=t.reverse()}for(var i=0;i<t.length;i++){e.append(t[i])}});jQuery(document).on("click",".tb-search-term-row",function(){var e=jQuery(this).attr("data-tag-id");var i=TBUtilities.GetInArray(r,"id",e);if(!i){i=TBUtilities.GetInArray(s,"id",e)}jQuery("#tb-search-ranking-selected-term-click").hide();jQuery("#tb-search-ranking-selected-term-container").show();jQuery("#tb-search-ranking-selected-term").text(i.term);jQuery("tr").removeClass("tb-search-rankings-selected-row");jQuery(this).addClass("tb-search-rankings-selected-row");jQuery("#tb-search-ranking-selected-term-link").attr("href","https://www.youtube.com/results?search_query="+TBUtilities.GetUrlEncoded(i.term));jQuery("#tb-search-ranking-historical-loading").show();jQuery("#tb-search-ranking-historical-graph").hide();var a=TBGlobal.host+TBGlobal.apiUrls.searchRankGetHistory;var o=jQuery.param({VideoId:t,Term:i.term});TBExtension.Post(a,o,"CRSearchRankingGetSearchRankHistory",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})});jQuery(document).on("keydown","#tb-search-ranking-input",function(e){if(e.keyCode==13){jQuery("#tb-search-ranking-insert").trigger("click")}});jQuery(document).on("click",".tb-search-rankings-delete-tag",function(e){var i=jQuery(this).attr("data-tag-id");var a=TBUtilities.GetInArray(s,"id",i);$row=this;TBUtilities.Confirm("Are you sure you want to stop tracking this Search Term on this video?",function(){var r=TBGlobal.host+TBGlobal.apiUrls.searchTermRemove;var o=jQuery.param({VideoId:t,Term:a.term});TBExtension.Post(r,o,"CRSearchRankingRemoveSearchTermDONOTHING",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});jQuery($row).closest("tr").remove();TBUtilities.RemoveFromArray(s,"id",i);e.stopPropagation()},function(){e.stopPropagation();return});e.stopPropagation()});jQuery(document).on("click","#tb-search-ranking-insert",function(){if(!jQuery("#tb-search-ranking-input").val()){TBUtilities.Alert("Please enter a Search Term to track");return}var e=TBUtilities.GetInArray(r,"term",jQuery("#tb-search-ranking-input").val().toLowerCase().trim());if(e){TBUtilities.Alert("The Search Term you entered is already being tracked");return}if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("add Custom Search Term",TBGlobal.limitation.searchRanking);return}var i=TBGlobal.host+TBGlobal.apiUrls.searchTermAddSearchTerm;var a=jQuery.param({VideoId:t,Term:jQuery("#tb-search-ranking-input").val().trim()});TBExtension.Post(i,a,"CRSearchRankingAddTerm",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})})};var j=function(e){var t=e%10,i=e%100;if(t==1&&i!=11){return e+"st"}if(t==2&&i!=12){return e+"nd"}if(t==3&&i!=13){return e+"rd"}return e+"th"};var Q=function(){jQuery(document.body).on("CRTBLoadSearchRankingTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);I()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRTBLoadSearchRankingTemplate"})}});jQuery(document.body).on("CRSearchRankingAddTerm",function(e,i){try{if(i.success){var a=JSON.parse(i.response);if(a.Term=="TB_ERROR_SEARCH_TERM_EXISTS"){TBUtilities.Alert("The Search Term you entered is already being tracked for this video.");return}jQuery("#tb-search-ranking-input").val("");var r=C(a.Term,a.Id,null);w(r);l++;s.push(r);TubeBuddyYouTubeActions.GetVideoSearchRank(t,r.term,k,1,{id:r.id,isCustom:r.isCustom})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}});jQuery(document.body).on("CRSearchRankingGetTerms",function(e,i){try{if(i.success){var a=JSON.parse(i.response);l=a.length;jQuery.each(a,function(e,i){var a=C(i.Term,i.Id,null);s.push(a);w(a);TubeBuddyYouTubeActions.GetVideoSearchRank(t,a.term,k,1,{id:a.id,isCustom:a.isCustom})})}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}});jQuery(document.body).on("CRSearchRankingGetMostRecentBeforeToday",function(e,t){try{if(t.success){var i=r;if(t.data.isCustom==true){i=s}var a="<span class='tb-search-ranking-muted-text'>Does not show up in search results";var o="<span class='tb-search-ranking-muted-text'><span class='tb-search-ranking-bold-text'>{0}</span> in search results, {1}</span>";var n=JSON.parse(t.response);jQuery.each(i,function(e,t){var i=TBUtilities.GetInArray(n,"SearchTerm",t.term);var r=0;if(i){r=i.Rank}var s=t.rank;if(s==0){s=21}TBUtilities.Log(r,s,i);var l="";var u=0;if(r>0){if(r==s){l='<span> with <span class="tb-search-ranking-bold-text">no change</span> since last time.</span>'}else if(r<s){u=s-r;l='<span> which is <span class="tb-search-ranking-bold-text tb-search-ranking-red">'+u+'</span> position<span class="tb-search-ranking-s">s</span> worse than last time</span>'}else{u=r-s;l='<span> which is <span class="tb-search-ranking-bold-text tb-search-ranking-green">'+u+'</span> position<span class="tb-search-ranking-s">s</span> better than last time</span>'}}else{l="<span> with no history</span>"}var c="";if(t.rank==0){c=a}else{var d=j(t.rank);c=TBUtilities.ReplaceAll(o,"{0}",d,false,false);c=TBUtilities.ReplaceAll(c,"{1}",l,false,false)}jQuery(".rankDesc"+t.id).html(c);var b=t.rank;if(t.rank==0){b="NA"}jQuery(".rankDesc"+t.id).attr("data-rank",b);if(u==1){jQuery(".rankDesc"+t.id).find(".tb-search-ranking-s").hide()}});try{TBUtilities.AddAction({SearchTermCount:r.length},TBUtilities.ActionTypes.SearchRanking_View,"searchranking")}catch(e){TBUtilities.LogError({Exception:e,Location:"[SearchRanking] [addAction]"})}if(t.data.isCustom==false&&c==false){c=true;jQuery(".tb-search-ranking-sort-rank").click()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingGetMostRecentBeforeToday"})}});jQuery(document.body).on("CRSearchRankingGetSearchRankHistory",function(e,t){try{if(t.success){var i=JSON.parse(t.response);var a=false;if(i.length>=1){var r=[];var o=[];jQuery("#tb-search-rankings-start-date").text(i[0].SearchDateDisplay);jQuery.each(i,function(e,t){o.push(t.RankDisplay);r.push("");if(t.RankDisplay<21)a=true});if(i.length==1)jQuery.each(i,function(e,t){o.push(t.RankDisplay);r.push("")});var n={labels:r,datasets:[{label:"Position",fillColor:"rgba(108,200,97,.1)",strokeColor:"rgba(108,200,97,.8)",pointColor:"rgba(108,200,97,.8)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:o,minValue:0,min:0}]};if(a){jQuery("#tb-search-ranking-historical-graph").show();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").show();jQuery("#tb-search-ranking-no-history").hide();jQuery("#tb-search-ranking-no-rankings-ever").hide();jQuery("#tb-search-ranking-canvas").empty();jQuery("#tb-search-ranking-actual-chart").show();h=jQuery("#tb-search-ranking-canvas")[0].getContext("2d");if(b)b.destroy();b=new Chart(h).Line(n,{scaleShowHorizontalLines:false,showXLabels:parseInt(o/2.7)})}else{jQuery("#tb-search-ranking-historical-graph").show();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").hide();jQuery("#tb-search-ranking-no-history").hide();jQuery("#tb-search-ranking-no-rankings-ever").show();jQuery("#tb-search-ranking-actual-chart").hide()}}else{jQuery("#tb-search-ranking-historical-graph").show();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").hide();jQuery("#tb-search-ranking-no-history").show();jQuery("#tb-search-ranking-no-rankings-ever").hide();jQuery("#tb-search-ranking-actual-chart").hide()}}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingGetSearchRankHistory"})}})};var k=function(e,t,i,a){if(i==-1){A()}if(a.isCustom==true){u++;var t=TBUtilities.GetInArray(s,"id",a.id);t.rank=i;if(u>=l){f(s);m(s,a.isCustom)}}else{n++;var t=TBUtilities.GetInArray(r,"id",a.id);t.rank=i;if(n>=o){f(r);m(r,a.isCustom)}}};var B=function(e){try{jQuery('[data-tbtooltip!=""]').qtip({content:{attr:"data-tbtooltip"},style:{classes:"qtip-youtube-tubebuddy"}});jQuery("#tb-search-ranking-loading").hide();if(e.snippet.tags==null){jQuery("#tb-search-ranking-no-tags").show();return}if(e.snippet.tags.length==0){jQuery("#tb-search-ranking-no-tags").show();return}jQuery("#tb-search-rankings-ideas").css("display","inline-block");jQuery("#tb-search-ranking-head").css("display","flex");n=0;o=e.snippet.tags.length;jQuery.each(e.snippet.tags,function(e,i){var a=C(i,null,e);r.push(a);w(a);TubeBuddyYouTubeActions.GetVideoSearchRank(t,a.term,k,1,{id:a.id,isCustom:a.isCustom})})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] getVideoDetailsCallback"})}};var C=function(e,t,i){var a=true;var r=null;if(!t){a=false;r="tag"+i}else{a=true;r=t}var o={id:r,term:e,rank:0,isCustom:a};return o};var w=function(e){var t='<img src="'+TBGlobal.host+'/images/icons/blue-pen.png" style="height:12px; width:12px;" />';if(e.isCustom==false){t='<img src="'+TBGlobal.host+'/images/icons/blue-tag.png" style="height:12px; width:12px;" />'}var i='<span class="tb-spinner tb-margin-right-5"></span>';var a=i;var r="";r+='<tr data-tag-id="'+e.id+'" class="tb-search-term-row">';r+='<td style="width:37px; text-align:center;">'+t+"</td>";r+='<td style="width:100px; text-align:left;">'+e.term+(e.isCustom?'<img class="tb-search-rankings-delete-tag" data-tag-id="'+e.id+'" src="'+TBGlobal.host+'/images/icons/delete.png" style="height:8px; width:8px; padding-left:3px;" />':"")+"</td>";r+='<td class="tb-search-term-rank-cell rankDesc'+e.id+'">'+a+"</td>";r+="</tr>";if(e.isCustom){jQuery("#tb-search-ranking-body").prepend(r)}else{jQuery("#tb-search-ranking-body").append(r)}};var A=function(){jQuery(".tb-search-ranking-error").show()};var x=function(e,t,i){try{jQuery(".tb-search-ranking-settings-legacy-off").hide();jQuery(".tb-search-ranking-settings-container").show();if(true==true){r=[];jQuery("#tb-search-ranking-loading").show();jQuery("#tb-search-ranking-body").empty();jQuery("#tb-search-rankings-ideas").css("display","none");jQuery("#tb-search-ranking-head").css("display","none");jQuery("#tb-search-ranking-no-tags").hide();jQuery("#tb-search-ranking-video-thumbnail").attr("src",t);jQuery("#tb-search-ranking-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-search-ranking-video-link").text(i);jQuery("#tb-search-ranking-text").text("Pick a Winner")}else{jQuery(".tb-search-ranking-settings-container").hide();jQuery(".tb-search-ranking-settings-legacy-off").show()}r=[];o=0;n=0;s=[];l=0;u=0;c=false;d=true;jQuery("#tb-search-ranking-container").show();if(TBGlobal.CanAccessLevel1Tools()==false){jQuery(".tb-search-ranking-settings-upgrade").show();jQuery(".tb-search-ranking-settings-upgrade-link").attr("href",TBGlobal.host+"/account/upgrade?id="+TBGlobal.CurrentChannelId())}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] prepareDialog"})}};var I=function(){x(t,a,i);TBYouTubeApi.GetVideoDetails(t,"snippet",B);var e=TBGlobal.host+TBGlobal.apiUrls.searchTermGetForVideo+"?videoId="+t;TBExtension.Get(e,"CRSearchRankingGetTerms");jQuery("#tb-search-ranking-historical-graph").hide();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").hide();jQuery("#tb-search-ranking-no-history").hide();jQuery("#tb-search-ranking-no-rankings-ever").hide();jQuery("#tb-search-ranking-actual-chart").hide();jQuery("#tb-search-ranking-selected-term-click").show();jQuery(".tb-search-ranking-disclaimer").show()};return{Show:function(r,o,n){if(TBGlobal.IsAuthenticated()){t=r;i=n;a=o;if(!e){Q();p();T();e=true}else{I()}}}}}();var TubeBuddySocialMonitor=function(){var e=false;var t;var i;var a;var r;const o={selectedVideo:{videoId:"",videoTitle:"",videoThumbnail:"",videoUrl:"",twitterMatches:0,redditMatches:0}};const n=function(){if(TBGlobal.Profile().TwitterAccounts==null||TBGlobal.Profile().TwitterAccounts.length===0){jQuery(".tb-social-monitor-twitter-post__link-account").show();jQuery(".link-account-button").attr("href",TBGlobal.host+"/socialaccounts/twitteroauthredirect?redirectUrl="+encodeURIComponent(window.location));jQuery("#tb-social-monitor-twitter-results-loading").hide()}else{jQuery(".tb-results-tweet").remove();var e='"https://www.youtube.com/watch?v='+o.selectedVideo.videoId+'" OR "https://youtu.be/'+o.selectedVideo.videoId+'"';var t="https://twitter.com/i/search/timeline?f=tweets&vertical=default&src=tyah&reset_error_state=false&q="+TBUtilities.GetUrlEncoded(e);var i="https://twitter.com/search?f=tweets&vertical=default&q="+TBUtilities.GetUrlEncoded(e);jQuery("#tb-social-monitor-twitter-view-results").attr("href",i);try{TBExtension.Get(t,function(e,t,i){if(e===true){if(i&&i.items_html){var a=jQuery(i.items_html).find("li.js-stream-tweet");if(a&&a.prevObject.length>0){jQuery.each(a.prevObject,function(e,t){if(t.nodeName==="LI"){var i=jQuery(t).find("strong.fullname").text();var a=jQuery(t).find("span.username").text();var r=jQuery(t).find("img.avatar").attr("src");var o=jQuery(t).find("span._timestamp").text();var n=jQuery(t).find("p.tweet-text").html();var s=jQuery(t).find("div.tweet").attr("data-tweet-id");var l='<div class="tb-results-tweet tb-margin-bottom-10 tb-margin-top-10 tb-padding-bottom-10" style="display: flex; border-bottom: 1px solid #dadada;"><div class="tb-twitter-img"><img src="'+r+'" alt="twitter-avatar" class="tb-twitter-avatar tb-margin-top-5"></div><div class="tb-twitter-info tb-padding-left-20" style="width:80%;"><div class="tb-twitter-user"><p class="tb-font-size-sm tb-margin-bottom-5 tb-inline-block tb-font-color-gray">'+i+'</p><a href="https://twitter.com/'+a+'" target="_blank" class="tb-font-size-xs tb-font-cbold tb-mtb-5 tb-inline-block tb-margin-left-5 tb-font-color-gray">'+a+'</a><p class="tb-font-size-xs tb-mtb-5 tb-inline-block tb-margin-left-5 tb-font-color-gray">'+o+'</p><p class="tb-font-size-xs Emoji--forText" style="color: #424242;">'+n+'</p></div></div><div class="tb-tweet-icon-link tb-margin-right-10"><a href="https://twitter.com/'+a+"/status/"+s+'" target="_blank" class="tb-margin-left-5"><img src="{plugin_file_root}/images/icons/external-blue.png" alt="tweet-link" style="height: 13px; margin:auto;"></a></div></div>';l=TBUtilities.FixLocalHtml(l);jQuery("#tb-social-monitor-twitter-results").append(l).attr("data-account-id",t.Id)}})}else{jQuery("#tb-social-monitor-twitter-no-results").show()}}}else{jQuery("#tb-social-monitor-twitter-no-results").show()}jQuery("#tb-social-monitor-twitter-results-loading").hide()},null,{credentials:false,dataType:"json",headers:{DNT:1,"Upgrade-Insecure-Requests":1,Accept:"application/json, text/javascript, */*; q=0.01","X-Twitter-Active-User":"yes","X-Requested-With":"XMLHttpRequest"}})}catch(e){TBUtilities.Log(e)}}};const s=function(){jQuery(".tb-reddit-thread").remove();TBUtilities.AddAction(null,TBUtilities.ActionTypes.SocialMonitor_View,"socialmonitor");var e=`https://www.reddit.com/search?q=url:${o.selectedVideo.videoId}`;jQuery("#tb-social-monitor-reddit-view-results").attr("href",e);let t="https://www.reddit.com/search.json?q=url:"+o.selectedVideo.videoId+"&sort=new&t=all";const i=document.querySelector(".entries");try{TBExtension.Get(t,function(e,t,a){try{if(e===true){let e="";if(a.data.children.length<=0){jQuery("#tb-social-monitor-reddit-no-results").show()}jQuery.each(a.data.children,function(t,i){i=i.data;if(i.thumbnail=="self"||i.thumbnail=="spoiler"||i.thumbnail=="image"){var a="https://steamuserimages-a.akamaihd.net/ugc/928186106000880588/002E414E48823C388D2CCD094C9A8CB6D9F05FD1/"}else{a=i.thumbnail}var r=i.created_utc;var o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var n=new Date(r*1e3);var s=n.getFullYear();var l=o[n.getMonth()];var u=n.getDate();var c=l+" "+u+" "+s;e+=`<div class="tb-reddit-thread tb-margin-top-15 tb-border-bottom tb-padding-bottom-10">\n                <div class="tb-reddit-img tb-margin-left-10">\n                <img src="${a}" class="tb-reddit-thumbnail" alt="thumbnail">\n                </div>\n                <div class="tb-reddit-info tb-padding-left-20">\n                  <div class="tb-social-monitor-title">\n                  <a class="tb-font-size-lb tb-font-cbold" href="https://www.reddit.com${i.permalink}" target="_blank">${i.title}</a>\n                </div>\n                <div class="tb-reddit-sub">\n                <p class="tb-font-size-sx tb-margin-bottom-5" style="color: #6C7A89;">Posted by: <a href="https://www.reddit.com/user/${i.author}" target="_blank" class="tb-font-cbold tb-reddit-username">${i.author}</a>\n                  <span> ${c}</span>\n                </p>\n                <span class="tb-badge tb-badge-primary">\n                   <a href="https://www.reddit.com/r/${i.subreddit}" target="_blank" class="tb-badge-primary">${i.subreddit}</a>\n                </span>\n                <span class="tb-badge tb-badge-secondary tb-margin-left-10 tb-font-medium">score: ${i.score}</span>\n                </div>\n                </div>\n                <div class="tb-reddit-icon-link tb-margin-right-10"><a href="https://www.reddit.com${i.permalink}" target="_blank" class="tb-margin-left-5"><img src="{plugin_file_root}/images/icons/external-blue.png" alt="tweet-link" style="height: 13px; margin:auto;"></a></div>\n                </div>`;e=TBUtilities.FixLocalHtml(e)});i.innerHTML="";i.innerHTML=`${e}`}else{jQuery("#tb-social-monitor-reddit-no-results").show()}jQuery("#tb-social-monitor-reddit-results-loading").hide()}catch(e){TBUtilities.Log(e);jQuery("#tb-social-monitor-reddit-results-loading").hide()}},null,{dataType:"json",credentials:false})}catch(e){TBUtilities.Log(e)}};var l=function(){var e=TBGlobal.host+"/ModuleManager/socialMonitor/socialMonitor?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/socialmonitor.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/socialmonitor.html"}TBExtension.Get(e,"CRTBLoadSocialMonitorTemplate")};const u=function(e,t,i,a){o.selectedVideo.videoId=e;o.selectedVideo.videoTitle=t;o.selectedVideo.videoThumnbnail=i;o.selectedVideo.videoUrl=a;o.selectedVideo.twitterMatches=0;try{TBUtilities.Log("show content");jQuery("#tb-social-monitor-container").fadeIn();jQuery("#tb-social-monitor-video-thumbnail").attr("src",i);jQuery("#tb-social-monitor-video-link").text(t);jQuery("#tb-social-monitor-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-social-monitor-twitter-results").find(".tb-social-monitor-tweet").remove();jQuery("#tb-social-monitor-twitter-results-loading").show();jQuery("#tb-social-monitor-twitter-no-results").hide();jQuery("#tb-social-monitor-reddit-results").find(".search-result").remove();jQuery("#tb-social-monitor-reddit-results-loading").show();jQuery("#tb-social-monitor-reddit-no-results").hide();n();s()}catch(e){TBUtilities.LogError({Exception:e,Location:"[CRTBLoadSocialMonitorTemplate] show"})}};var c=function(){jQuery(document).on("click","#tb-social-monitor-close, .tb-social-monitor-closex, .tb-module-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-social-monitor-container").hide()});jQuery(document).on("click",".tb-tabs-menu-item-container",function(){try{jQuery(this).parent().find(".tb-tabs-selected-menu-item, .tb-tabs-selected-menu-icon").removeClass("tb-tabs-selected-menu-item tb-tabs-selected-menu-icon");jQuery(this).parents().find(".tb-tabs-content").addClass("tb-hid");jQuery(this).addClass("tb-tabs-selected-menu-item");jQuery(this).find(".tb-tabs-menu-item-icon").addClass("tb-tabs-selected-menu-icon");jQuery(this).parents().find("#"+jQuery(this).attr("data-tab-id")).removeClass("tb-hid")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyembedExplorer] tb-embed-explorer-tab-header [click]"})}})};var d=function(){jQuery(document.body).on("CRTBLoadSocialMonitorTemplate",function(e,r){try{if(r.success){r.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(r.response,DOMPurifyConfig));jQuery("body").append(r.response);u(t,i,a)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySocialMonitor] CRTBLoadSocialMonitorTemplate"})}})};return{Show:function(r,o,n){if(TBGlobal.IsAuthenticated()){t=r;i=o;a=n;if(!e){d();l();c();e=true}else{u(t,i,a)}}}}}();var Strategies=function(){var e=false;var t=function(){};var i=function(){var e=TBGlobal.host+"/ModuleManager/strategies/strategies?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/strategies.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/strategies.html"}TBExtension.Get(e,"CRTBLoadStrategiesTemplate")};var a=function(e,t,i,a){TBUtilities.CreateCookie("currentStrategy",JSON.stringify(r(e,t)));if(i)n(i,a)};var r=function(e,t){var i={strategyType:e,step:t};return i};var o=function(){try{var e=TBUtilities.GetCookie("currentStrategy");TBUtilities.RemoveCookie("currentStrategy");if(!e)return;e=JSON.parse(e);if(!e.strategyType||!e.step||isNaN(e.step))return;switch(e.strategyType){case Strategies.StrategyTypes.ViewsCardsToVideo:s(e.step);break}}catch(e){TBUtilities.LogError(e)}};var n=function(e,t){if(!t||t.length==0)t=e;if(!window.location.href.toLowerCase().includes(t.toLowerCase()))window.location=e;else o()};var s=function(e){};var l=function(){jQuery(document).on("click",".a",function(){})};var u=function(){jQuery(document.body).on("CRTBLoadStrategiesTemplate",function(e,i){try{if(i.success){i.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i.response,DOMPurifyConfig));jQuery("body").append(i.response);t()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyStrategies] CRTBLoadStrategiesTemplate"})}})};return{StartStrategy:function(e,t){switch(e){case Strategies.StrategyTypes.ViewsCardsToVideo:s(t);break}},Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();i();l();o();e=true}else{t()}}},StrategyTypes:{Unknown:"Unknown",ViewsCardsToVideo:"ViewsCardsToVideo"}}}();var TubeBuddyBulkThumbnail=function(){var e=false;var t={ids:0,playlist:1,search:2,all:3,recent:4};var i={action:"",validImage:false,overlayImageUrl:"",method:t.all,specificVideoIds:[],specificVideos:[],playlistId:"",validPlaylistIds:[],search:"",videoEntity:null,videos:[],destinationVideos:[],currentVideo:null,isStopped:false,totalDestinationVideos:0,failedVideos:[]};var a=function(){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [loadData]"})}};var r=function(){var e=TBGlobal.host+"/ModuleManager/bulkthumbnail/bulkthumbnail?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/bulkthumbnail.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/bulkthumbnail.html"}TBExtension.Get(e,"CRTBLoadBulkThumbnailTemplate")};var o=function(){jQuery(document).on("click","#tb-bulkthumbnail-error-copy",function(){jQuery(this).find("span").text("Copied");window.setTimeout(function(){jQuery("#tb-bulkthumbnail-error-copy").find("span").text("Copy video ids")},1500)});jQuery(document).on("click","#tb-bulkthumbnail-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("click",".tb-bulk-thumbnail-recent-url",function(){jQuery("#tb-bulkthumbnail-overlay").val(jQuery(this).text());$("#tb-bulkthumbnail-load").click()});jQuery(document).on("click","#tb-bulkthumbnail-close, .tb-bulkthumbnail-closex, .tb-module-close",function(){try{if(i.step==4)location.reload();TubeBuddyMenu.HideBackground();jQuery("#tb-bulkthumbnail-container").hide();jQuery("#tb-bulkthumbnail-overlay").val("");jQuery(".tb-bulk-thumbnail-action--selected").removeClass("tb-bulk-thumbnail-action--selected");jQuery("#tb-bulk-thumbnails-valid-image").hide();i.step=1}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [click] tb-bulkthumbnail-close"})}});jQuery(document).on("click","#tb-bulkthumbnail-method-ids, #tb-bulkthumbnail-method-playlist, #tb-bulkthumbnail-method-search, #tb-bulkthumbnail-method-full",function(e){i.method=parseInt(jQuery(this).attr("data-method"));TBUtilities.Log({StatusMethod:i.method});var t=jQuery("#tb-bulkthumbnail-input-playlist").playlistSelect().data("plugin_playlistSelect");switch(i.method){case 0:jQuery("#tb-bulkthumbnail-input-ids").removeAttr("disabled","disabled");t.disable();i.playlistId="";jQuery("#tb-bulkthumbnail-input-playlist").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").attr("disabled","disabled");break;case 1:jQuery("#tb-bulkthumbnail-input-ids").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").attr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;t.enable();t.showDropDown();break;case 2:jQuery("#tb-bulkthumbnail-input-ids").attr("disabled","disabled");t.disable();i.playlistId="";i.specificVideoIds.length=0;i.specificVideos.length=0;jQuery("#tb-bulkthumbnail-input-playlist").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").removeAttr("disabled","disabled");break;case 3:jQuery("#tb-bulkthumbnail-input-ids").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-playlist").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").attr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;break}});jQuery(document).on("dblclick",".overlayimg",function(e){var t=jQuery(this).attr("data-video-id");jQuery(this).parent().find(".tb-bulkthumbnails-video:first").trigger("dblclick")});jQuery(document).on("error",".overlayimg",function(e){jQuery(this).css("display","none")});jQuery(document).on("dblclick",".tb-bulkthumbnails-video",function(e){var t=jQuery(this).attr("data-video-id");if(i.action=="add"){if(!jQuery(this).parent().parent().find(".tb-bulkthumbnail-checkbox-include").prop("checked"))jQuery(this).parent().parent().find(".tb-bulkthumbnail-checkbox-include").trigger("click")}else if(i.action=="remove"){var a="https://s3-us-west-1.amazonaws.com/tubebuddy/videothumbnails/"+TBGlobal.CurrentChannelId()+"/"+t+"_0.jpg";jQuery(this).parent().find(".overlayimg:first").on("error",function(){jQuery(this).attr("src",TBGlobal.host+"/images/modules/thumbnail/nooverlaysfound.png");if(jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").prop("checked"))jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").trigger("click")}).on("load",function(){if(!jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").prop("checked"))jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").trigger("click")}).attr("src",a)}jQuery(this).parent().find(".overlayimg:first").css("display","inline-block")});jQuery(document).on("click","#tb-bulkthumbnail-load",function(e){if(jQuery("#tb-bulkthumbnail-overlay").val()==""||jQuery("#tb-bulkthumbnail-overlay").val()=="http://"||jQuery("#tb-bulkthumbnail-overlay").val()=="http:"){TBUtilities.Alert("Please enter a URL to an Image");return}jQuery("#tb-bulkthumbnail-overlay").prop("disabled",true);i.overlayImageUrl=jQuery("#tb-bulkthumbnail-overlay").val();if(!i.overlayImageUrl){jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview");return}jQuery("#tb-bulk-thumbnails-preview-container").show();jQuery("#tb-bulkthumbnail-source-preview-container").show();jQuery("#tb-bulkthumbnail-source-selection-container").addClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulk-thumbnails-preview-show").show();jQuery("#tb-bulk-thumbnail-loading-preview").show();jQuery("#tb-bulkthumbnail-upload-link").hide();c()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulkthumbnail-input-playlist",function(e){i.playlistId="";var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-bulkthumbnail-input-playlist-status").hide();return}if(t.indexOf("list=")>0){t=t.substring(t.indexOf("list=")+5)}if(t.length!=18&&t.length!=34||t.substring(0,2)!="PL"){jQuery("#tb-bulkthumbnail-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-bulkthumbnail-input-playlist-status").css("color","red")}else{jQuery("#tb-bulkthumbnail-input-playlist-status").text("Valid Playlist Id");jQuery("#tb-bulkthumbnail-input-playlist-status").css("color","green");i.playlistId=t}jQuery("#tb-bulkthumbnail-input-playlist-status").show()});jQuery(document).on("click","#playlist-select-type-manual",function(){var e=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").children("input");e.each(function(e,t){i.validPlaylistIds.push(jQuery(t).val())})});jQuery(document).on("keyup",".playlistSelectManualIds",function(){var e=jQuery(this).val();if(i.validPlaylistIds.indexOf(e)==-1){jQuery(".tb-playlist-select-manual-id-invalid").show()}else{jQuery(".tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery(".tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulkthumbnail-input-search",function(e){i.search=jQuery(this).val().trim()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulkthumbnail-input-ids",function(e){var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-bulkthumbnail-input-ids-status").hide();return}jQuery("#tb-bulkthumbnail-input-ids-status").show();i.specificVideoIds=[];if(t.indexOf(",")>-1){i.specificVideoIds=t.split(",")}else{i.specificVideoIds=t.split(" ")}for(var a=0;a<i.specificVideoIds.length;a++){i.specificVideoIds[a]=i.specificVideoIds[a].trim();i.specificVideoIds[a]=i.specificVideoIds[a].replace("https://www.youtube.com/watch?v=","");i.specificVideoIds[a]=i.specificVideoIds[a].replace("https://youtu.be/","");if(i.specificVideoIds[a].length!=11){i.specificVideoIds.splice(a,1);a--}}if(i.specificVideoIds.length==0){jQuery("#tb-bulkthumbnail-input-ids-status").text("No videos detected");jQuery("#tb-bulkthumbnail-input-ids-status").css("color","red")}else if(i.specificVideoIds.length==1){jQuery("#tb-bulkthumbnail-input-ids-status").text("1 video detected");jQuery("#tb-bulkthumbnail-input-ids-status").css("color","green");jQuery("#tb-bulkthumbnail-method-ids").prop("checked",true);jQuery("#tb-bulkthumbnail-method-ids").trigger("click")}else{jQuery("#tb-bulkthumbnail-input-ids-status").text(i.specificVideoIds.length+" videos detected");jQuery("#tb-bulkthumbnail-input-ids-status").css("color","green");jQuery("#tb-bulkthumbnail-method-ids").prop("checked",true);jQuery("#tb-bulkthumbnail-method-ids").trigger("click")}});jQuery(document).on("click",".tb-bulkthumbnail-checkbox-include",function(){try{if(jQuery(this).is(":checked")){if(!TBGlobal.CanAccessLevel2Tools()&&jQuery("#tb-bulkthumbnail-destination-list").find(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length>1){jQuery(this).prop("checked",false);TBGlobal.ShowUpgradePage("update thumbnails in bulk (more than 1 video at a time)","bulkthumbnailoverlays");return}if(i.action=="remove"){var e=jQuery(this).attr("data-video-id");var t="https://s3-us-west-1.amazonaws.com/tubebuddy/videothumbnails/"+TBGlobal.CurrentChannelId()+"/"+e+"_0.jpg";jQuery(this).parentsUntil(".tb-bulkthumbnail-destination-row").find(".overlayimg").attr("src",t).css("background",'url("")')}jQuery(this).closest(".tb-bulkthumbnail-destination-row").find(".overlayimg").css("display","inline-block")}else{jQuery(this).closest(".tb-bulkthumbnail-destination-row").find(".overlayimg").css("display","none")}jQuery("#tb-bulkthumbnail-destination-selected-count").text(jQuery("#tb-bulkthumbnail-destination-list").find(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [click] tb-bulkthumbnail-checkbox-include"})}});jQuery(document).on("click","#tb-bulkthumbnail-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()&&i.videos.length>1){TBGlobal.ShowUpgradePage("update thumbnails in bulk (more than 1 video at a time)","bulkthumbnailoverlays");return}jQuery(".tb-bulkthumbnail-checkbox-include:visible").prop("checked",false);jQuery(".tb-bulkthumbnail-checkbox-include:visible").trigger("click")});jQuery(document).on("change","#tb-bulkthumbnail-position, #tb-bulkthumbnail-background",function(){c()});jQuery(document).on("change","#tb-bulk-thumbnail-upload-input",function(e){if(TBGlobal.CanAccessLevel2Tools()==false){TBGlobal.ShowUpgradePage("upload an image","bulkthumbnailoverlays");return}if(jQuery(this)[0].files[0]){var t=jQuery(this)[0].files[0].size;if(t>10485760){jQuery(this).wrap("<form>").closest("form").get(0).reset();jQuery(this).unwrap();alertify.alert("Sorry, you need to select a file less than 10MB")}var i=new FileReader;i.readAsDataURL(e.target.files[0]);i.onloadend=function(e){var t=e.target.result;var i=t.replace("data:image/png;base64,","");var a={ImageData:i,ImageExt:"png"};var r=TBGlobal.host+TBGlobal.apiUrls.thumbnailUploadBulkOverlayImage;TBExtension.Post(r,JSON.stringify(a),"CRTBBulkThumbnailUploadOverlay",null,{contentType:"application/json"})}}});jQuery(document).on("click","#tb-bulk-thumbnail-upload-input",function(){if(TBGlobal.CanAccessLevel2Tools()==false){TBGlobal.ShowUpgradePage("upload an image","bulkthumbnailoverlays");return}});jQuery(document).on("change",".tb-bulk-thumbnails-source",function(){var e=jQuery(this).val();i.overlayImageUrl="";jQuery("#tb-bulkthumbnail-overlay-preview").attr("src","");jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-overlay-preview").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulkthumbnail-overlay").val();jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulk-thumbnail-upload-input").parent().trigger("reset");if(e=="onweb"){u();jQuery("#tb-bulkthumbnail-overlay").val("");jQuery("#tb-bulk-thumbnails-source-web").show();jQuery("#tb-bulk-thumbnails-source-computer").hide();jQuery("#tb-bulkthumbnail-overlay").focus()}else if(e=="upload"){jQuery("#tb-bulk-thumbnails-source-web").hide();jQuery("#tb-recent-image-urls").hide();jQuery("#tb-bulk-thumbnails-source-computer").show();jQuery("#tb-bulk-thumbnail-upload-input").change()}else{jQuery("#tb-bulk-thumbnails-source-web").hide();jQuery("#tb-recent-image-urls").hide();jQuery("#tb-bulk-thumbnails-source-computer").hide()}});jQuery(document).on("click",".tb-bulkthumbnail-more-info",function(){TBGlobal.ShowUpgradePage("update thumbnails in bulk (more than 1 video at a time)","bulkthumbnailoverlays")});jQuery(document).on("click","#tb-bulkthumbnail-select-no-checkboxes",function(){jQuery(".tb-bulkthumbnail-checkbox-include:visible").prop("checked",true);jQuery(".tb-bulkthumbnail-checkbox-include:visible").trigger("click")});jQuery(document).on("click","#tb-bulkthumbnail-stop",function(){i.isStopped=true;jQuery("#tb-bulkthumbnail-stop").hide();jQuery("#tb-bulkthumbnail-close").show();jQuery("#tb-bulkthumbnail-working").hide();jQuery("#tb-bulkthumbnail-stopped").show()});jQuery(document).on("click",".tb-bulkthumbnail-action",function(){jQuery(".tb-bulk-thumbnail-action--selected").removeClass("tb-bulk-thumbnail-action--selected");i.action=jQuery(this).attr("data-action-type");jQuery(this).addClass("tb-bulk-thumbnail-action--selected");jQuery("#tb-bulk-thumbnails-valid-image").hide();if(jQuery(this).attr("data-action-type")=="add"){jQuery("#tb-bulkthumbnails-add-description").show();jQuery("#tb-bulk-thumbnails-source-image").show()}else{i.overlayImageUrl="";jQuery(".overlayimg").attr("src","").css("background",'url("")');jQuery("#tb-bulkthumbnail-overlay-preview").attr("src","");jQuery("#tb-bulkthumbnails-add-description").hide();jQuery("#tb-bulk-thumbnails-source-image").hide();jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview")}});jQuery(document).on("click","#tb-bulkthumbnail-kickoff",function(){if(!jQuery("#tb-bulkthumbnail-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to run these bulk actions.");return}i.step=4;jQuery("#tb-bulkthumbnail-status").show();jQuery("#tb-bulkthumbnail-confirm").hide();jQuery("#tb-bulkthumbnail-stop").show();jQuery("#tb-bulkthumbnail-back").hide();jQuery("#tb-bulkthumbnail-kickoff").hide();jQuery("#tb-bulkthumbnail-continue").hide();h()});jQuery(document).on("keyup","#tb-bulkthumbnail-overlay, #tb-bulkthumbnail-kickoff",function(e){if(e.keyCode==13){$("#tb-bulkthumbnail-load").click()}});jQuery(document).on("click","#tb-bulkthumbnail-continue, #tb-bulkthumbnail-kickoff",function(){try{if(i.step==1){if(!i.action){TBUtilities.Alert("You must select an action to continue (Add Overlay or Remove Overlay)");return}if(i.action=="add"&&i.overlayImageUrl.length==0){TBUtilities.Alert("You must select an overlay image");return}if(!i.validImage&&(i.action=="add"||i.action=="replace")){TBUtilities.Alert("You must enter a valid image (and click Load)");return}jQuery("#tb-bulkthumbnail-loading-videos").show();jQuery("#tb-bulkthumbnail-destination-list").hide();jQuery("#tb-bulkthumbnail-source").hide();jQuery("#tb-bulkthumbnail-method").show();jQuery("#tb-bulkthumbnail-back").show();i.overlayImageUrl=jQuery("#tb-bulkthumbnail-overlay").val();jQuery(".overlayimg").attr("src",i.overlayImageUrl).css("background","url("+i.overlayImageUrl+")");TBUtilities.Log(i);i.step=2}else if(i.step==2){switch(parseInt(i.method)){case 0:if(i.specificVideoIds.length==0){jQuery("#tb-bulkthumbnail-input-ids-status").css("color","red");jQuery("#tb-bulkthumbnail-input-ids-status").text("No videos detected");jQuery("#tb-bulkthumbnail-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Video IDs "+JSON.stringify(i.specificVideoIds));d();break;case 1:var e=jQuery("#tb-bulkthumbnail-input-playlist").playlistSelect().data("plugin_playlistSelect");var t=e.getSelectedPlaylistIds();if(t.length>0){i.playlistId=t.join(",")}if(t.length>=2){TBUtilities.Alert("Please select only one playlist");return}if(i.playlistId==""){jQuery("#tb-bulkthumbnail-input-playlist-status").css("color","red");jQuery("#tb-bulkthumbnail-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-bulkthumbnail-input-playlist-status").show();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Playlist ["+i.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(i.playlistId,null,v);break;case 2:if(i.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Search ["+i.search+"]");jQuery("#tb-bulkthumbnail-destination").show();TBYouTubeApi.GetChannelVideosSearch(i.search,null,v);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var a=null;if(jQuery("#tb-bulkthumbnail-onlyLoadFirstPage").is(":checked")){var r=/^\+?\d+$/.test(jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").val());if(r==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}a=parseInt(jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").val());if(a<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,v,null,a,null);break}jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-destination").show();jQuery("#tb-bulkthumbnail-destination-list").hide();jQuery("#tb-bulkthumbnail-loading-videos").show();i.step=3}else if(i.step==3){if(jQuery(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length==0&&i.destinationVideos.length==0){TBUtilities.Alert("Please select at least 1 video to run add a Thumbnail Overlay on (check the box next to the video).");return}i.destinationVideos=[];jQuery(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").each(function(){if(jQuery(this).is(":checked")){var e=jQuery(this).attr("data-video-id");jQuery.each(i.videos,function(t,a){if(a.id==e){i.destinationVideos.push(a);TBGlobal.AddUserDebugInfo("Selected Destination Video: https://www.youtube.com/watch?v="+e)}})}});var o="Please confirm that you want to";switch(i.action){case"add":o+=" ADD an image overlay on top of the <b>"+i.destinationVideos.length+"</b> Video Thumbnail";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break;case"replace":o+=" REPLACE all existing image overlays with a new image overlay of the <b>"+i.destinationVideos.length+"</b> Video";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break;case"remove":o+=" REMOVE all existing image overlays from the <b>"+i.destinationVideos.length+"</b> Video Thumbnail";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break;case"original":o+=' SET the current thumbnail as the "original" (and lose the previously saved "original" thumbnail) of the <b>'+i.destinationVideos.length+"</b> Video";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break}jQuery("#tb-bulkthumbnail-confirmation-text").html(o);jQuery("#tb-bulkthumbnail-queue-list").empty();jQuery("#tb-bulkthumbnail-completed-list").empty();jQuery("#tb-bulkthumbnail-destination-selected-count").text(i.destinationVideos.length);jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-confirm-checkbox").prop("checked",false);i.step=4;jQuery("#tb-bulkthumbnail-destination").hide();jQuery("#tb-bulkthumbnail-confirm").show();jQuery("#tb-bulkthumbnail-kickoff").show();jQuery("#tb-bulkthumbnail-continue").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [click] #tb-bulkthumbnail-continue, #tb-bulkthumbnail-kickoff"})}});jQuery(document).on("click","#tb-bulkthumbnail-back",function(){jQuery("#tb-bulkthumbnail-continue").show();if(i.step==2){jQuery("#tb-bulkthumbnail-source").show();jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-back").hide();i.step=1}else if(i.step==3){i.step=2;jQuery("#tb-bulkthumbnail-destination").hide();jQuery("#tb-bulkthumbnail-method").show();jQuery("#tb-bulkthumbnail-destination-selected-count").text("0");i.specificVideoIds.length=0;i.specificVideos.length=0;jQuery("#tb-bulkthumbnail-input-ids").val("");jQuery("#tb-bulkthumbnail-input-ids-status").hide()}else if(i.step==4){i.step=3;jQuery("#tb-bulkthumbnail-destination").show();jQuery("#tb-bulkthumbnail-confirm").hide();jQuery("#tb-bulkthumbnail-kickoff").hide();jQuery("#tb-bulkthumbnail-continue").show()}})};var n=function(e){if(e.width==0){i.validImage=false;jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-invalid").show();jQuery("#tb-bulkthumbnail-invalid").html('<img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:3px;" /> Sorry, we could not find a valid image at the URL you provided. <br><a href="'+e.src+'" target="_blank">'+e.src+"</a>");jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false)}else if(!(e.width==1280&&e.height==720||e.width==1920&&e.height==1080)){i.validImage=false;jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false);jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-invalid").show();jQuery("#tb-bulkthumbnail-invalid").html('<img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:3px;" /> Sorry, the image you selected is <b>not the correct size</b>. (must be 1280x720 or 1920x1080)')}else{i.validImage=true;jQuery("#tb-bulk-thumbnails-valid-image").show();jQuery("#tb-bulkthumbnail-invalid").hide();jQuery("#tb-bulkthumbnail-overlay-preview").on("load",function(){jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false);jQuery("#tb-bulkthumbnail-overlay-preview").show()}).attr("src",e.src);TBUtilities.Log("Writing out: "+"tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url"+" || VALUE: "+e.src);TBExtension.SetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url",e.src);if(jQuery("#tb-bulk-thumbnail-overlay-source-onweb").is(":checked"))s(jQuery("#tb-bulkthumbnail-overlay").val())}};var s=function(e){var t=l();if(t){if(t.map(function(e){return e.imageUrl}).indexOf(e)>-1){return}else if(t.length>=3){t.pop()}}else{t=[]}t.unshift({date:new Date,imageUrl:e});window.localStorage.setItem("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url",JSON.stringify(t));u()};var l=function(){var e=JSON.parse(window.localStorage.getItem("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url"));if(!e){return}else{return e}};var u=function(){jQuery("#tb-recent-image-urls").empty();var e=l();if(e){jQuery("#tb-recent-image-urls").append('<div id="tb-bulkthumbnail-recent-text">or select a recent URL</div>');jQuery(e).each(function(e,t){jQuery("#tb-recent-image-urls").append('<div class="tb-bulk-thumbnail-recent-url"><a style="text-decoration:none;">'+t.imageUrl+"</a></div>")});jQuery("#tb-recent-image-urls").show()}};var c=function(){if(!i.overlayImageUrl)return;if(jQuery("#tb-bulkthumbnail-overlay-preview").attr("src").length<0)jQuery("#tb-bulkthumbnail-overlay-preview").hide();jQuery("#tb-bulkthumbnail-invalid").hide();var e=new Image;e.onload=function(){n(e)};e.onerror=function(t){i.validImage=false;jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-invalid").show();jQuery("#tb-bulkthumbnail-invalid").html('<img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:3px;" /> Sorry, we could not find a valid image at the URL you provided. <br><a href="'+e.src+'" target="_blank">'+e.src+"</a>");jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false)};e.src=i.overlayImageUrl;TBUtilities.Log(i)};var d=function(){var e=i.specificVideoIds[0];i.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails, snippet, id",b)};var b=function(e){if(e!=null)i.specificVideos.push(e);if(i.specificVideoIds.length>0){d()}else{v(i.specificVideos)}};var h=function(){try{i.failedVideos=[];i.totalDestinationVideos=i.destinationVideos.length;i.hasFinished=false;i.errorCount=0;i.successCount=0;jQuery("#tb-bulkthumbnail-queue-list").empty();jQuery("#tb-bulkthumbnail-completed-list").empty();jQuery("#tb-bulkthumbnail-working").show();jQuery("#tb-bulkthumbnail-done").hide();jQuery("#tb-bulkthumbnail-stopped").hide();TBUtilities.Log(i);if(i.action=="add"){try{TBUtilities.AddAction({VideoCount:i.totalDestinationVideos,Data:"overlay = "+i.overlayImageUrl},TBUtilities.ActionTypes.BulkThumbnailOverlays_Add,"bulkthumbnailoverlays")}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailAddOverlay] [addAction]"})}}if(i.action=="remove"){try{TBUtilities.AddAction({VideoCount:i.totalDestinationVideos,Data:"overlay = "+i.overlayImageUrl},TBUtilities.ActionTypes.BulkThumbnailOverlays_Remove,"bulkthumbnailoverlays")}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailDeleteOverlay] [addAction]"})}}p();y()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [startProcessing]"})}};var y=function(){jQuery("#tb-bulkthumbnail-queue-list2").empty();jQuery("#tb-bulkthumbnail-queue-complete-list2").hide();var e=0;jQuery.each(i.destinationVideos,function(t,i){var a=jQuery(".tb-bulkthumbnail-processing-template2:last")[0].outerHTML;a=a.replace("#THUMBNAILURL#",i.snippet.thumbnails.default.url);a=a.replace("default.jpg","mqdefault.jpg");a=TBUtilities.ReplaceAll(a,"#VIDEOID#",i.id);a=a.replace("#VIDEOTITLE#",i.snippet.title);a=a.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);a=a.replace("display: none","display:flex");jQuery("#tb-bulkthumbnail-queue-list2").prepend(a);e++;if(e==3)return false});if(e==0){jQuery("#tb-bulkthumbnail-queue-complete-list2").show();jQuery("#tb-bulkthumbnail-queue-list2").hide()}else{jQuery("#tb-bulkthumbnail-queue-list2").show()}};var p=function(){try{if(i.isStopped)return;jQuery("#tb-bulkthumbnail-progress-container").html("Start &#707;");if(i.destinationVideos.length==0){jQuery("#tb-bulkthumbnail-status-count").html("<b>"+i.totalDestinationVideos+"</b> of <b>"+i.totalDestinationVideos+"</b> videos complete");jQuery("#tb-bulkthumbnail-progress-container").hide();if(i.currentVideo){if(!i.currentVideo.error)m(i.currentVideo);else f(i.currentVideo)}y();jQuery("#tb-bulkthumbnail-working").hide();jQuery("#tb-bulkthumbnail-done").show();jQuery("#tb-bulkthumbnail-stop").hide();jQuery("#tb-bulkthumbnail-close").show();return}if(i.currentVideo){if(!i.currentVideo.error)m(i.currentVideo);else f(i.currentVideo)}var e=i.destinationVideos[0].id;var t=TBUtilities.RemoveFromArray(i.destinationVideos,"id",e)[0];i.currentVideo=t;jQuery("#tb-bulkthumbnail-status-count").html("<b>"+parseInt(i.totalDestinationVideos-i.destinationVideos.length)+"</b> of <b>"+i.totalDestinationVideos+"</b> videos complete");jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+e+'">'+e+"</a> &#707;");y();TBGlobal.AddUserDebugInfo("Getting Video Details for: "+t.id);var a;if(i.action=="add"){a=TBGlobal.host+TBGlobal.apiUrls.thumbnailAddOverlay}else if(i.action=="remove"){a=TBGlobal.host+TBGlobal.apiUrls.thumbnailRemoveOverlay}jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+" Publishing Thumbnail  &#707;");var r={VideoId:t.id,OverlayUrl:i.overlayImageUrl};TBExtension.Post(a,JSON.stringify(r),"CRTBBulkThumbnailCreatorPostThumbnail",null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [processNextVideo]"});jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+"Error: "+e.message);TBUtilities.Alert('Sorry, there was an error: "'+e.message+'"');jQuery("#tb-bulkthumbnail-stop").trigger("click")}};var m=function(e){var t=jQuery(".tb-bulkthumbnail-processed-success:last")[0].outerHTML;t=t.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);t=t.replace("default.jpg","mqdefault.jpg");t=TBUtilities.ReplaceAll(t,"#VIDEOID#",e.id);t=t.replace("#VIDEOTITLE#",e.snippet.title);t=t.replace("#HREF#","https://www.youtube.com/edit?o=U&feature=vm&video_id="+e.id);t=t.replace("display:none","display:flex");jQuery("#tb-bulkthumbnail-completed-list2").prepend(t);jQuery("#tb-bulkthumbnail-completed-none-list2").hide();jQuery("#tb-bulkthumbnail-completed-list2").show();i.successCount++;jQuery("#tb-bulkthumbnail-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(i.successCount))};var f=function(e){try{jQuery("#tb-bulkthumbnail-error-copy-container").show();var t=jQuery("#tb-bulkthumbnail-error-copy").attr("data-clipboard-text");var a=[];if(t!=""){a=t.split(",");if(a.indexOf(e.id)==-1){a.push(e.id)}}else{a.push(e.id)}jQuery("#tb-bulkthumbnail-error-copy").attr("data-clipboard-text",a.join(","))}catch(e){}var r=jQuery(".tb-bulkthumbnail-processed-error:last")[0].outerHTML;r=r.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);r=r.replace("default.jpg","mqdefault.jpg");r=TBUtilities.ReplaceAll(r,"#VIDEOID#",e.id);r=r.replace("#VIDEOTITLE#",e.snippet.title);r=r.replace("#ERROR#",e.error);r=r.replace("#HREF#","https://www.youtube.com/edit?o=U&feature=vm&video_id="+e.id);r=r.replace("display:none","display:block");jQuery("#tb-bulkthumbnail-error-list2").prepend(r);jQuery("#tb-bulkthumbnail-error-list2").show();jQuery("#tb-bulkthumbnail-error-none-list2").hide();i.errorCount++;jQuery("#tb-bulkthumbnail-error-list2-count").text(TBUtilities.FormatNumberWithCommas(i.errorCount))};var g=function(e,t){i.currentVideo.error=t;p()};var v=function(e){try{if(e==null){if(i.method==0)TBUtilities.Alert("No valid Video IDs found");else if(i.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(i.method==2)TBUtilities.Alert("No videos matching your search");else if(i.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-bulkthumbnail-back").trigger("click");return}else if(e.length==0){if(i.method==0)TBUtilities.Alert("No valid Video IDs found");else if(i.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(i.method==2)TBUtilities.Alert("No videos matching your search");else if(i.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-bulkthumbnail-back").trigger("click");return}jQuery("#tb-bulkthumbnail-loading-videos").hide();i.videos=[];jQuery("#tb-bulkthumbnail-destination-list").empty();jQuery.each(e,function(e,t){if(t.id.videoId!=null){t.id=t.id.videoId}if(t.snippet.resourceId!=null)t.id=t.snippet.resourceId.videoId;if(t.snippet.tags==null)t.snippet.tags="";if(t.snippet!=null&&t.snippet.title=="Deleted video"&&t.snippet.thumbnails==null)return;i.videos.push(t);var a=jQuery(".tb-bulkthumbnail-destination-row:last")[0].outerHTML;a=a.replace("#VIDEOTITLE#",t.snippet.title);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",t.id);a=a.replace("#VIDEOTHUMBNAIL#",t.snippet.thumbnails.default.url+"?x="+Math.random());a=a.replace("#OVERLAYIMAGE",i.overlayImageUrl);if(t.status)a=a.replace("#PRIVACY#",t.status.privacy);a=a.replace("#TITLEDISPLAY#","display:none;");a=a.replace("#ENABLED#","");a=a.replace("#enabled#","");a=a.replace("#DISPLAYCHECKBOX#","");a=a.replace("#DISPLAYX#","display:none");jQuery("#tb-bulkthumbnail-destination-list").append(a)});jQuery("#tb-bulkthumbnail-destination").show();jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-destination-list").show();if(i.method==0||i.method==1)jQuery("#tb-bulkthumbnail-select-all-checkboxes").trigger("click")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [gotVideoList]"})}};var T=function(){jQuery(document.body).on("CRTBBulkThumbnailUploadOverlay",function(e,t){try{if(t.success){t.response=TBUtilities.ReplaceAll(t.response,'"',"");jQuery("#tb-bulkthumbnail-overlay").val(t.response);i.overlayImageUrl=t.response;jQuery("#tb-bulk-thumbnails-preview-container").show();jQuery("#tb-bulkthumbnail-source-preview-container").show();jQuery("#tb-bulkthumbnail-source-selection-container").addClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulk-thumbnails-preview-show").show();jQuery("#tb-bulk-thumbnail-loading-preview").show();jQuery("#tb-bulkthumbnail-upload-link").hide();c()}else{jQuery("#tb-bulk-thumbnail-upload-input").wrap("<form>").closest("form").get(0).reset();jQuery("#tb-bulk-thumbnail-upload-input").unwrap();alertify.alert("Sorry, image failed!<br><Br>Make sure you are selecting a valid image and that the size is 1280x720 or 1920x1080.")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] CRTBBulkThumbnailUploadOverlay"})}});jQuery(document.body).on("CRTBBulkThumbnailCreatorPostThumbnail",function(e,t){try{if(t.success&&(t.response=="Success"||t.response=='"Success"')){jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+" Successfully Published");var a=jQuery("div[data-video-id='"+i.currentVideo.id+"']");if(a){TBUtilities.Log("updating thumbnails");var r=jQuery(a).find("img:first");if(r){jQuery(r).attr("src","https://i.ytimg.com/vi/"+i.currentVideo.id+"/mqdefault.jpg?time="+Math.random())}}p()}else{jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+" Successfully Published");t.location="CRTBBulkThumbnailCreatorPostThumbnail";TBUtilities.LogError("Unable to bulk add thumbnails. Result: "+JSON.stringify(t));g(i.currentVideo.id,"Processing Failed")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] CRTBFRGetEditUrl"});g(i.currentVideo.id,"Post Exception")}});jQuery(document).on("change",".tb-bulkthumbnail-filter",function(){jQuery(".tb-bulkthumbnail-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="private"]').hide();jQuery('.tb-bulkthumbnail-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="public"]').hide();jQuery('.tb-bulkthumbnail-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="public"]').hide();jQuery('.tb-bulkthumbnail-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="public"]').hide();break}jQuery("#tb-bulkthumbnail-destination-selected-count").text(jQuery("#tb-bulkthumbnail-destination-list").find(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length)});jQuery(document.body).on("CRTBLoadBulkThumbnailTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);Q()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] CRTBLoadBulkThumbnailTemplate"})}})};jQuery(document.body).on("TBBulkThumbnailGetLastValue",function(e,t){TBUtilities.Log("Last Thumbnail URL");TBUtilities.Log(t);if(t)jQuery("#tb-bulkthumbnail-overlay").val(t.value)});var j=function(){try{jQuery("#tb-bulkthumbnail-error-copy-container").hide();jQuery("#tb-bulkthumbnail-error-copy").prop("data-clipboard-text","");var e=new ClipboardJS("#tb-bulkthumbnail-error-copy");jQuery("#tb-bulkthumbnail-selected-count").text("0");jQuery("#tb-bulkthumbnail-destination-selected-count").text("0");jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-status").hide();jQuery("#tb-bulkthumbnail-confirm").hide();jQuery("#tb-bulkthumbnail-bulk-description-updates-container").hide();jQuery("#tb-bulkthumbnail-featured-content-container").hide();jQuery("#tb-bulkthumbnail-kickoff").hide();jQuery("#tb-bulkthumbnail-summary-container").hide();jQuery(".tb-bulkthumbnail-filter").val("publicunlisted");jQuery("#tb-bulkthumbnail-featured-video-status-complete").hide();jQuery("#tb-bulkthumbnail-featured-video-status-processing").hide();jQuery("#tb-bulkthumbnail-bulk-descriptions-status-complete").hide();jQuery("#tb-bulkthumbnail-bulk-descriptions-status-processing").hide();jQuery("#tb-bulkthumbnail-success").hide();jQuery("#tb-bulkthumbnail-back").hide();jQuery("#tb-bulkthumbnail-container").fadeIn();jQuery("#tb-bulkthumbnail-methods-container").fadeIn();jQuery("#tb-bulkthumbnail-continue").show();jQuery("#tb-bulkthumbnail-close").hide();jQuery("#tb-bulkthumbnail-upload-link").show();jQuery("#tb-bulkthumbnail-none").hide();jQuery("#tb-bulkthumbnail-has").hide();jQuery("#tb-bulkthumbnail-destination").hide();jQuery("#tb-bulkthumbnail-source").show();jQuery("#tb-bulkthumbnail-input-ids").val("");jQuery("#tb-bulkthumbnail-input-ids-status").text("");jQuery("#tb-bulkthumbnail-method-full").prop("checked","checked");jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-bulkthumbnail-onlyLoadFirstPage").prop("checked",false);i.action="";i.validImage=false;i.overlayImageUrl="";jQuery("#tb-bulk-thumbnails-action").find("option").prop("selected",false);jQuery("#tb-bulk-thumbnails-action").eq(0).prop("selected",true);jQuery("#tb-bulkthumbnails-add-description").hide();jQuery("#tb-bulk-thumbnails-source-image").hide();jQuery("#tb-bulkthumbnail-overlay-preview").hide();jQuery("#tb-bulkthumbnail-overlay-preview").attr("src","");jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulkthumbnail-completed-list2").empty();jQuery("#tb-bulkthumbnail-error-list2").empty();jQuery("#tb-bulkthumbnail-error-list2").hide();jQuery("#tb-bulkthumbnail-error-none-list2").show();jQuery("#tb-bulkthumbnail-completed-list2-count").text("0");jQuery("#tb-bulkthumbnail-error-list2-count").text("0");var t=jQuery("#tb-bulk-thumbnail-upload-input");t.replaceWith(t.val("").clone(true));var a=jQuery("#tb-bulkthumbnail-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(e){i.playlistId=e}}).data("plugin_playlistSelect");jQuery("#tb-bulkthumbnail-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-bulkthumbnail-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");a.disable();TBExtension.GetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url","TBBulkThumbnailGetLastValue")}catch(e){TBUtilities.LogError({Exception:e,Location:"[V2VPromote] prepareDialog"})}};var Q=function(){TBGlobal.ClearUserDebugInfo();TBGlobal.AddUserDebugInfo("Opening BulkThumbnail");i.videoEntity=null;i.videos=[];i.destinationVideos=[];i.currentVideo=null;i.step=1;i.action="";i.specificVideoIds.length=0;i.specificVideos.length=0;i.method=3;a();j();c()};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){T();r();o();e=true}else{Q()}}}}}();var TubeBuddyCommentFilter=function(){var t=false;var i={isBasic:true,onlyQuestions:false,hasNoReplyFromAnyone:false,hasNoReplyFromMe:false,hasHasReplyFromMe:false,ratings:false,positive:false,negative:false,wordsFilter:false,words:"",startedBySomeoneElse:false,startedByMe:false,startedBy:true,profanity:false,links:false,onlyLinked:false,onlyYouTube:false,isShown:true,startedByWho:"me",replyTypeSelected:"meno",replyType:true,withType:true,withSelected:"questions",loadingMoreInterval:null,changeSortInterval:null,threadType:true,threadSelected:"youtube",needsFollowUp:false,loadRepliesTries:0,loadRepliesTimer:null,hideReadComments:true,pagesToLoad:0,currentPage:0,isPatreonSupporter:false,isSubscriber:false};var a;var r=[];var o=[];var n=false;var s=[];var l=false;var u=function(){var e=[];jQuery("span.load-comments").each(function(e,t){if(jQuery(this).first("a.show-more").length>0){jQuery(this).first("a.show-more")[0].click()}});if(jQuery(this).first("a.show-more").length>0){var t=setInterval(function(){TBUtilities.Log("CommentFilter checking for replies done");if(jQuery("a.show-more:visible").length==0){clearInterval(t);if(jQuery(".tb-comments-filter-basic").val()!="all"){j()}}},1500)}jQuery(".comment-entry").each(function(t,i){jQuery(this).find(".comment-item").each(function(){var t=jQuery(this).attr("data-cid");var i=jQuery(this).attr("data-vid");if(TBUtilities.GetInArray(r,"id",t)==null){r.push({YouTubeCommentId:t,YouTubeVideoId:i,read:false,fetched:false});e.push({YouTubeCommentId:t,YouTubeVideoId:i,read:false,fetched:false})}});TBUtilities.Log("populateMenus");jQuery(this).find(".show-add-options").each(function(e,t){if(jQuery(this).find(".tb-comment-mark-as-read").length==0){TBUtilities.Log("show-add-options");jQuery(this).find("tr").prepend('<td class="mod-button" tabindex="0"><div class="tb-comment-mark-as-read mod-button-content yt-uix-tooltip" style="padding:6px 8px 4px" data-tooltip-text="Hide Comment" aria-label="Hide Comment" aria-labelledby="yt-uix-tooltip20-arialabel" title="Hide Comment"><img class="tb-comments-read-image" style="opacity:.4" src="'+TBGlobal.host+'/images/icons/menu/hide.png" /></div></td>')}})});TBUtilities.Log(e);if(TBGlobal.CanAccessLevel1Tools()){var i=jQuery.param({Comments:e});TBExtension.Post(TBGlobal.host+TBGlobal.apiUrls.commentsGetReadComments,i,"TBCommentsGotRead",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}if(TBGlobal.Profile().HasPatreonIntegration){if(!n){jQuery("#tb-comment-filter-patreon-not-linked-container").hide();jQuery("#tb-comment-filter-patreon-linked-container").show()}c()}else if(!n){jQuery("#tb-comment-filter-patreon-not-linked-container").show();jQuery("#tb-comment-filter-patreon-linked-container").hide()}d()};var c=function(){TBUtilities.Log("Starting Patreon Populate");jQuery(".comment-entry").each(function(e,t){jQuery(this).find(".comment-item").each(function(){var e=jQuery(this).find("a:first").attr("href");TBUtilities.Log(t);var t=e.substring(e.lastIndexOf("/")+1);var i=jQuery(this).attr("data-vid");var a=jQuery(this);if(t.length!=24||t.substring(0,2)!="UC"){TBUtilities.Log("/user no channelid");var r="https://www.youtube.com"+e;TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(r,function(e){var t=TBUtilities.GetInArray(o,"ChannelId",e.channelId);if(t){if(a.find(".tb-comment-patreon-logo").length==0){a.find(".comment-text").first().prepend('<a href="https://www.patreon.com/user?u='+t.PatreonId+'" target="_blank"><img class="tb-comment-patreon-logo" src="'+TBGlobal.host+'/images/icons/patronbutton.png" /></a><br />')}}})}else{var n=TBUtilities.GetInArray(o,"ChannelId",t);if(n){if(jQuery(this).find(".tb-comment-patreon-logo").length==0){jQuery(this).find(".comment-text").first().prepend('<a href="https://www.patreon.com/user?u='+n.PatreonId+'" target="_blank"><img class="tb-comment-patreon-logo" src="'+TBGlobal.host+'/images/icons/patronbutton.png" /></a><br />')}}}});jQuery(this).find(".show-add-options").each(function(e,t){if(jQuery(this).find(".tb-comment-mark-as-read").length==0){TBUtilities.Log("show-add-options");jQuery(this).find("tr").prepend('<td class="mod-button" tabindex="0"><div class="tb-comment-mark-as-read mod-button-content yt-uix-tooltip" style="padding:6px 8px 4px" data-tooltip-text="Hide Comment" aria-label="Hide Comment" aria-labelledby="yt-uix-tooltip20-arialabel" title="Hide Comment"><img class="tb-comments-read-image" style="opacity:.4" src="'+TBGlobal.host+'/images/icons/menu/hide.png" /></div></td>')}})})};var d=function(){TBUtilities.Log("Starting Subscriber Populate");jQuery(".comment-entry").each(function(e,t){jQuery(this).find(".comment-item").each(function(){var e=jQuery(this).find("a:first").attr("href");TBUtilities.Log(t);var t=e.substring(e.lastIndexOf("/")+1);var i=jQuery(this).attr("data-vid");var a=jQuery(this);if(t.length!=24||t.substring(0,2)!="UC"){TBUtilities.Log("/user no channelid");var r="https://www.youtube.com"+e;TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(r,function(e){var t=false;if(e!=null&&s!=null){var i=s.indexOf(e.channelId);if(i!=-1){t=true}}else{var r}if(t){if(a.find(".tb-comment-subscriber-logo").length==0){a.find(".comment-text").first().prepend('<img class="tb-comment-subscriber-logo" src="'+TBGlobal.host+'/images/icons/subbutton.png" /> <br />')}}})}else{var o=false;if(s!=null){var n=s.indexOf(t);if(n!=-1){o=true}}if(o){if(jQuery(this).find(".tb-comment-subscriber-logo").length==0){jQuery(this).find(".comment-text").first().prepend('<img class="tb-comment-subscriber-logo" src="'+TBGlobal.host+'/images/icons/subbutton.png" /> <br />')}}}});jQuery(this).find(".show-add-options").each(function(e,t){if(jQuery(this).find(".tb-comment-mark-as-read").length==0){TBUtilities.Log("show-add-options");jQuery(this).find("tr").prepend('<td class="mod-button" tabindex="0"><div class="tb-comment-mark-as-read mod-button-content yt-uix-tooltip" style="padding:6px 8px 4px" data-tooltip-text="Hide Comment" aria-label="Hide Comment" aria-labelledby="yt-uix-tooltip20-arialabel" title="Hide Comment"><img class="tb-comments-read-image" style="opacity:.4" src="'+TBGlobal.host+'/images/icons/menu/hide.png" /></div></td>')}})})};var b=function(){jQuery(".video-dds").after(jQuery(".tb-comments-filter:last")[0].outerHTML);jQuery("#yt-comments-paginator").wrap('<div class="tb-comment-filter-show-more-wrap"></div>');jQuery("#yt-comments-paginator").after('<span id="tb-comment-pages-status" style="position:fixed; top:300px; display:none; left:0px; padding:10px 13px; border:solid 1px red; background-color:white; color:#444;"></span>');jQuery(".tb-comment-filter-show-more-wrap").after('<div style="text-align:center;"><img class="tb-height11" src="'+TBGlobal.host+'/images/branding/tb-icon-transparent.svg" style="position:relative; top:2px;" /> Number of pages to show on "Show More" click<Br> <select style="margin-top:5px;" id="tb-comments-show-how-many"><option value="1">1</option><option value="5">5</option><option value="10">10</option><option value="20">20</option><option value="50">50</option></select></div>');var e=TBUtilities.GetUrlParameter("tbfilter");if(e){jQuery(".tb-comments-filter-basic").val(e);jQuery(".tb-comments-filter-basic").trigger("change")}s=lscache.get("tbSubscriberCache"+TBGlobal.CurrentChannelId());u()};var h=function(){TBExtension.GetDbValue("HidePatreonMsg",function(e,t){n=t==true});if(TBGlobal.CanAccessLevel3Tools()===true){ManageSubscriberCache.RefreshSubscribersCache(TBGlobal.CurrentChannelId(),1e3)}var e=TBGlobal.host+TBGlobal.apiUrls.highlightGetHighlights+"?highlightType=1";TBUtilities.Log(e);TBExtension.Get(e,"TBCommentsGotPatron",1)};var y=function(){var e=TBGlobal.host+"/ModuleManager/commentfilter/commentfilter?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/commentfilter.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/commentfilter.html"}TBExtension.Get(e,"CRTBLoadCommentFilterTemplate")};var p=function(){TBUtilities.Log("lookForSort");if(!jQuery(".comments-wait").is(":visible")){clearInterval(i.changeSortInterval);j();return}};var m=function(){TBUtilities.Log("lookForMore");clearTimeout(i.loadingMoreInterval);if(jQuery("#yt-comments-paginator:visible").length==0&&i.loadRepliesTimer==null){if(i.needsFollowUp){v()}else{j()}u();TBUtilities.Log("lookForMore1");i.currentPage=0;jQuery("#tb-comment-pages-status").hide()}else if(jQuery("#yt-comments-paginator:visible").length==1&&jQuery("#yt-comments-paginator > .show-more").is(":visible")){if(i.needsFollowUp){v()}else{j()}u();TBUtilities.Log("lookForMore2");i.currentPage++;if(i.currentPage<i.pagesToLoad){jQuery("#yt-comments-paginator").trigger("click",[true]);jQuery("#tb-comment-pages-status").html('<img src="'+TBGlobal.host+'/images/general/loading1.gif" style="position:relative; top:2px;" /> Loading Page '+i.currentPage+" of "+i.pagesToLoad)}else{jQuery("#tb-comment-pages-status").hide()}}else{i.loadingMoreInterval=setTimeout(m,50)}};var f=function(){jQuery(".tb-comments-hide-read-count").text("("+jQuery(".tb-comment-is-read").length+")")};var g=function(){jQuery(document).on("click","#tb-comment-filter-patreon-hide",function(){$("#tb-comment-filter-patreon-not-linked-container").fadeOut();$("#tb-comment-filter-patreon-linked-container").fadeOut();TBExtension.SetDbValue("HidePatreonMsg",true)});jQuery(document).on("change",".tb-comments-hide-read-checkbox",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use the Hidden Comments tool",TBGlobal.limitation.commentFilters);return}TBUtilities.Log("checked.tb-comments-hide-read-checkbox");TBUtilities.Log(jQuery(this).is(":checked"));if(!jQuery(this).is(":checked")){jQuery(".tb-comment-is-read").each(function(){if(jQuery(this).parent().hasClass("comment-entry")){jQuery(this).parent().hide();jQuery(this).parent().find(".comment-item").hide()}else{jQuery(this).hide()}});i.hideReadComments=true}else{jQuery(".tb-comment-is-read").each(function(){if(jQuery(this).parent().hasClass("comment-entry")){jQuery(this).parent().find(".comment-item").show();jQuery(this).parent().show()}else{jQuery(this).show()}});i.hideReadComments=false}j();f()});jQuery(document).on("change",".tb-comments-filter-basic",function(){var e=window.location.href.indexOf("filter=all")==-1&&window.location.href.indexOf("filter=channel")==-1&&window.location.href.indexOf("filter")!=-1&&window.location.href.indexOf("filter&")==-1;if(e&&!TBGlobal.CanAccessLevel1Tools()){jQuery(".tb-comments-filter-basic").val("all");TBGlobal.ShowUpgradePage("use Comment Filters on individual videos",TBGlobal.limitation.commentFilters);return}i.isBasic=jQuery(this).val()!="advanced";if(i.isBasic)jQuery(".tb-comment-filter-advanced").hide();else jQuery(".tb-comment-filter-advanced").show();switch(jQuery(this).val()){case"all":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"notreplied":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=true;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"needfollowup":v();i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=true;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"replydisabled":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=true;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"questions":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=true;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"profanity":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=true;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"links":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=true;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"positive":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=true;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"negative":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=true;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"haswords":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=true;i.isPatreonSupporter=false;i.isSubscriber=false;break;case"patreon":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=true;i.isSubscriber=false;break;case"subscriber":i.startedByMe=false;i.startedBySomeoneElse=false;i.onlyLinked=false;i.onlyYouTube=false;i.hasNoReplyFromMe=false;i.hasHasReplyFromMe=false;i.hasNoReplyFromAnyone=false;i.needsFollowUp=false;i.onlyQuestions=false;i.positive=false;i.negative=false;i.profanity=false;i.links=false;i.wordsFilter=false;i.isPatreonSupporter=false;i.isSubscriber=true;break;case"advanced":if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use Advanced Comment Filters",TBGlobal.limitation.commentFilters);return}i.startedByWho=jQuery(".tb-comments-filter-started-by-select:first").val();i.startedByMe=i.startedByWho=="me"&&i.startedBy;i.startedBySomeoneElse=i.startedByWho=="else"&&i.startedBy;i.onlyLinked=jQuery(".tb-comments-filter-thread-select:first").val()=="linked";i.onlyYouTube=jQuery(".tb-comments-filter-thread-select:first").val()=="youtube";i.replyTypeSelected=jQuery(".tb-comments-filter-reply-select").val();i.hasNoReplyFromMe=i.replyTypeSelected=="meno"&&i.replyType;i.hasHasReplyFromMe=i.replyTypeSelected=="meyes"&&i.replyType;i.hasNoReplyFromAnyone=i.replyTypeSelected=="noone"&&i.replyType;i.needsFollowUp=i.replyTypeSelected=="followup"&&i.replyType;i.withSelected=jQuery(".tb-comments-filter-with-select").val();i.onlyQuestions=i.withSelected=="questions"&&i.withType;i.positive=i.withSelected=="positive"&&i.withType;i.negative=i.withSelected=="negative"&&i.withType;i.profanity=i.withSelected=="profanity"&&i.withType;i.links=i.withSelected=="links"&&i.withType;i.wordsFilter=i.withSelected=="words";i.isPatreonSupporter=i.withSelected=="patreon";i.isSubscriber=i.withSelected=="subscriber";break}if(i.wordsFilter)jQuery(".tb-comment-filter-words").show();else jQuery(".tb-comment-filter-words").hide();j()});jQuery(document).on("change",".tb-comments-filter-has-rating",function(){i.ratings=jQuery(this).is(":checked");j()});jQuery(document).on("click","[role=menuitem]",function(){i.changeSortInterval=setInterval(p,500)});jQuery(document).on("click",".tb-comment-mark-as-read",function(e){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use the Hidden Comments tool",TBGlobal.limitation.hideComments);return}TBUtilities.Log("tb-comment-mark-as-read: click");var t=jQuery(this).closest(".comment-item").attr("data-cid");var i=jQuery(this).closest(".comment-item").attr("data-vid");TBUtilities.Log("Comment Id: "+t);var a=jQuery(this).closest(".comment-item").hasClass("tb-comment-is-read");if(a==false){var r=jQuery.param({YouTubeCommentId:t,YouTubeChannelId:TBGlobal.CurrentChannelId(),YouTubeVideoId:i});TBExtension.Post(TBGlobal.host+TBGlobal.apiUrls.commentsMarkAsRead,r,"TBCommentsMarkedAsRead",{commentId:t},{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}else{var r=jQuery.param({YouTubeCommentId:t,YouTubeChannelId:TBGlobal.CurrentChannelId(),YouTubeVideoId:i});TBExtension.Post(TBGlobal.host+TBGlobal.apiUrls.commentsMarkAsUnRead,r,"TBCommentsMarkedAsUnRead",{commentId:t},{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}});jQuery(document).on("change",".tb-comments-filter-linked-comments",function(){i.onlyLinked=jQuery(this).is(":checked");j()});jQuery(document).on("change",".tb-comments-filter-started-by-select",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use Advanced Comment Filters",TBGlobal.limitation.commentFilters);return}i.startedByWho=jQuery(this).val();i.startedByMe=i.startedByWho=="me"&&i.startedBy;i.startedBySomeoneElse=i.startedByWho=="else"&&i.startedBy;j()});jQuery(document).on("change",".tb-comments-filter-thread-select",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use Advanced Comment Filters",TBGlobal.limitation.commentFilters);return}i.onlyLinked=jQuery(this).val()=="linked";i.onlyYouTube=jQuery(this).val()=="youtube";j()});jQuery(document).on("change",".tb-comments-filter-reply-select",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use Advanced Comment Filters",TBGlobal.limitation.commentFilters);return}i.replyTypeSelected=jQuery(this).val();i.hasNoReplyFromMe=i.replyTypeSelected=="meno"&&i.replyType;i.hasHasReplyFromMe=i.replyTypeSelected=="meyes"&&i.replyType;i.hasNoReplyFromAnyone=i.replyTypeSelected=="noone"&&i.replyType;i.needsFollowUp=i.replyTypeSelected=="followup"&&i.replyType;if(i.needsFollowUp){v()}else{j()}});jQuery(document).on("change",".tb-comments-filter-with-select",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use Advanced Comment Filters",TBGlobal.limitation.commentFilters);return}i.withSelected=jQuery(this).val();i.onlyQuestions=i.withSelected=="questions"&&i.withType;i.positive=i.withSelected=="positive"&&i.withType;i.negative=i.withSelected=="negative"&&i.withType;i.profanity=i.withSelected=="profanity"&&i.withType;i.links=i.withSelected=="links"&&i.withType;i.wordsFilter=i.withSelected=="words";if(i.wordsFilter)jQuery(".tb-comment-filter-words").show();else jQuery(".tb-comment-filter-words").hide();j()});jQuery(document).on("change",".tb-comments-filter-with",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("use Advanced Comment Filters",TBGlobal.limitation.commentFilters);return}i.withType=jQuery(this).is(":checked");i.onlyQuestions=i.withSelected=="questions"&&i.withType;i.positive=i.withSelected=="positive"&&i.withType;i.negative=i.withSelected=="negative"&&i.withType;i.profanity=i.withSelected=="profanity"&&i.withType;i.links=i.withSelected=="links"&&i.withType;j()});jQuery(document).on("click",".show-more, .tb-comment-filter-show-more-wrap",function(e,t){TBUtilities.Log("Show more clicked");if(!t)i.pagesToLoad=parseInt(jQuery("#tb-comments-show-how-many").val())+parseInt(i.currentPage);jQuery("#tb-comment-pages-status").html('<img src="'+TBGlobal.host+'/images/general/loading1.gif" style="position:relative; top:2px;" /> Loading Page 1 of '+i.pagesToLoad);jQuery("#tb-comment-pages-status").show();i.loadingMoreInterval=setTimeout(m,50)});jQuery(document).on("change",".tb-comments-filter-phrase",function(){i.wordsFilter=jQuery(this).is(":checked");i.words=jQuery(".tb-comment-filter-words:first").val();j()});jQuery(document).on("keypress change keyup paste",".tb-comment-filter-words",function(){i.words=jQuery(this).val();TBUtilities.Log("update");TBUtilities.Log(a==null);if(a!=null){clearTimeout(a);a=null}a=setTimeout(j,1500)})};var v=function(){TBUtilities.Log("showHiddenReplies");i.loadRepliesTries=0;jQuery(".load-comments:visible").each(function(){jQuery(this).find("a.show-more:contains('View')").each(function(){jQuery(this)[0].click()})});clearTimeout(i.loadRepliesTimer);i.loadRepliesTimer=window.setTimeout(T,1e3)};var T=function(){TBUtilities.Log("checkForRepliesDoneLoading");try{i.loadRepliesTries++;var t=jQuery(".load-comments span.loading").length;var a=jQuery(".load-comments span.loading.hid").length;if(t==a||i.loadRepliesTries==20){j();i.loadRepliesTimer=null;clearTimeout(i.loadRepliesTimer)}else{i.loadRepliesTimer=window.setTimeout(T,1e3)}}catch(t){i.loadRepliesTimer=null;j();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentFilters] [checkForRepliesDoneLoading]"})}};var j=function(){TBUtilities.Log("applyFilter");try{TBUtilities.Log("CALLER: "+j.caller);var e=window.location.href.indexOf("filter=all")==-1&&window.location.href.indexOf("filter=channel")==-1&&window.location.href.indexOf("filter")!=-1&&window.location.href.indexOf("filter&")==-1;jQuery(".tb-comment-filter-thinking:first").show();jQuery(".tb-comment-filter-highlighted").each(function(e,t){jQuery(this).replaceWith(jQuery(this).html())});var t=0;var a=0;var r=0;var o=false;jQuery(".comment-entry").each(function(e,r){var n=true;var s="";var l="";jQuery(this).find(".comment-text-content").each(function(e,t){s+=" "+jQuery(this).text()});jQuery(this).find(".user-name").each(function(e,t){l+=" "+jQuery(this).text()});if(i.onlyQuestions){o=true;var u="who ,what ,why ,where ,when ,how ,does ,can ,do ,does ,wat ,have ,has ,may ,must ,should ,would ,are ";var c=u.split(",");var d=false;jQuery(this).find(".comment-text-content").each(function(e,t){var i=jQuery(this).text();if(jQuery(this).closest(".comment-item").hasClass("channel-owner")==false){jQuery.each(c,function(e,t){d=d||i.trim().toLowerCase().indexOf(t)==0||i.indexOf("?")>-1})}});if(!d)n=false}if(i.hasNoReplyFromAnyone){o=true;if(jQuery(this).find(".comment-text-content").length>1)n=false}if(i.isPatreonSupporter){o=true;if(jQuery(this).find(".tb-comment-patreon-logo").length==0)n=false}if(i.isSubscriber){o=true;if(jQuery(this).find(".tb-comment-subscriber-logo").length==0)n=false}if(i.hasNoReplyFromMe){o=true;if(jQuery(this).find(".channel-owner").length>0)n=false}if(i.hasHasReplyFromMe){o=true;if(jQuery(this).children().find(".channel-owner").length==0)n=false}if(i.needsFollowUp){o=true;if(jQuery(this).children().find(".reply").length==0||jQuery(this).children().find(".reply:last").hasClass("channel-owner")){n=false}}if(i.startedByMe){o=true;if(!jQuery(this).find(".yt-commentbox-top:first").hasClass("channel-owner"))n=false}if(i.startedBySomeoneElse){o=true;if(jQuery(this).find(".yt-commentbox-top:first").hasClass("channel-owner"))n=false}if(i.ratings){var b=false;jQuery(this).find(".like-count").each(function(e,t){var i=parseInt(jQuery(this).text());if(isNaN(i))i=0;if(i>2)b=true});if(!b)n=false}if(i.positive){o=true;var u="admire,admired,admires,admiring,adorable,adore,adored,adores,affection,affectionate,amuse,amused,amusement,amusements,astound,astounded,astounding,astoundingly,astounds,audacious,award,awarded,awards,beatific,beauties,beautiful,beautifully,beautify,beloved,best,blessing,bliss,blissful,blockbuster,breakthrough,captivated,celebrate,celebrated,celebrates,celebrating,charm,charming,cheery,classy,cool stuff,dearly,delight,delighted,delighting,delights,devoted,elated,elation,enrapture,enthral,enthusiastic,euphoria,excellence,excellent,excite,excited,excitement,exciting,exhilarated,exhilarates,exhilarating,exultant,exultantly,faithful,fan,fascinate,fascinated,fascinates,fascinating,ftw,gallant,gallantly,gallantry,genial,glad,glamorous,glamourous,glee,gleeful,good,goodness,gracious,grand,grateful,great,greater,greatest,haha,hahaha,hahahah,happiness,happy,heartfelt,heroic,humerous,impress,impressed,impresses,impressive,inspiring,joy,joyful,joyfully,joyous,jubilant,kudos,lawl,lol,lovable,love,loved,lovelies,lovely,loyal,loyalty,luck,luckily,lucky,marvel,marvelous,marvels,medal,merry,mirth,mirthful,mirthfully,nice,ominous,once-in-a-lifetime,paradise,perfect,perfectly,pleasant,pleased,pleasure,popular,praise,praised,praises,praising,prosperous,right direction,rigorous,rigorously,scoop,sexy,soothe,soothed,soothing,sparkle,sparkles,sparkling,splendid,successful,super,vibrant,vigilant,visionary,vitality,vivacious,wealth,winwin,won,woo,woohoo,worshiped,yummy,amazing,awesome,brilliant,ecstatic,euphoric,exuberant,fabulous,fantastic,fun,funnier,funny,godsend,heavenly,lifesaver,lmao,lmfao,masterpiece,masterpieces,miracle,overjoyed,rapturous,rejoice,rejoiced,rejoices,rejoicing,rofl,roflcopter,roflmao,rotfl,rotflmfao,rotflol,stunning,terrific,triumph,triumphant,win,winner,winning,wins,wonderful,wooo,woow,wow,wowow,wowww,breathtaking,hurrah,outstanding,superb,thrilled";var c=u.split(",");var d=false;jQuery.each(c,function(e,t){if(TBUtilities.CountMatches(s,t.trim(),true,true)>0){d=true;jQuery(r).find(".comment-text-content").each(function(e,i){TBUtilities.Log(jQuery(this).html()+"< this");jQuery(this).html(TBUtilities.ReplaceAll(jQuery(this).html(),t.trim(),'<span class="tb-comment-filter-highlighted" style="padding:2px 1px; background-color:#ffff66">'+t.trim()+"</span>",true,false))})}});if(!d)n=false}if(i.negative){o=true;var u="bastard,bastards,bitch,bitches,cock,cocksucker,wrong,cocksuckers,cunt,motherfucker,motherfucking,niggas,nigger,prick,slut,son-of-a-bitch,twat,ass,assfucking,asshole,skeptical,bullshit,catastrophic,damn,damned,damnit,dick,dickhead,fraud,frauds,fraudster,fraudsters,fraudulence,fraudulent,fuck,fucked,fucker,fuckers,fuckface,fuckhead,fucking,fucktard,fuked,fuking,hell,jackass,jackasses,piss,pissed,rape,rapist,scumbag,shit,shithead,shrew,torture,tortured,tortures,torturing,whore,wtf,abhor,abhorred,abhorrent,abhors,abuse,abused,abuses,abusive,acrimonious,agonise,agonised,agonises,agonising,agonize,agonized,agonizes,agonizing,anger,angers,angry,anguish,anguished,apathetic,apathy,apeshit,arrested,assassination,assassinations,awful,bad,badass,badly,bankrupt,bankster,betray,betrayal,betrayed,betraying,betrays,bloody,boring,brainwashing,bribe,can't stand,catastrophe,charged,charmless,chastise,chastised,chastises,chastising,cheat,cheated,cheater,cheaters,cheats,colluding,conspiracy,cover-up,crap,crime,criminal,criminals,crisis,cruel,cruelty,damage,damages,dead,deceit,deceitful,deceive,deceived,deceives,deceiving,deception,defect,defects,despair,despairing,despairs,desperate,desperately,despondent,destroy,destroyed,destroying,destroys,destruction,destructive,die,died,dipshit,dire,direful,disastrous,disgust,disgusted,disgusting,distrust,distrustful,does not work,douche,douchebag,dreadful,dumb,dumbass,evil,fag,faggot,faggots,fake,fakes,faking,falsified,falsify,fatalities,fatality,fed up,felonies,felony,fiasco,frenzy,frightening,fud,furious,goddamn,greed,green wash,green washing,greenwash,greenwasher,greenwashers,greenwashing,guilt,guilty,hate,hated,haters,hates,hating,heartbreaking,heartbroken,horrendous,horrible,horrific,horrified,humiliated,humiliation,hysteria,hysterical,hysterics,idiot,idiotic,illegal,imbecile,irate,irritate,irritated,irritating,jerk,kill,killed,killing,kills,liar,liars,loathe,loathed,loathes,loathing,loose,looses,loser,losing,loss,lost,lunatic,lunatics,mad,maddening,madly,madness,mediocrity,miserable,misleading,moron,murdering,murderous,nasty,no fun,not working,nuts,obnoxious,outrage,outraged,panic,panicked,panics,perjury,pissing,pseudoscience,racism,racist,racists,rant,ranter,ranters,rants,ridiculous,scandal,scandalous,scandals,screwed up,selfish,selfishness,shitty,sinful,slavery,spammer,spammers,suck,sucks,swindle,swindles,swindling,terrible,terribly,terrified,terror,terrorize,terrorized,terrorizes,trauma,traumatic,treason,treasonous,ugly,victim,victimize,victimized,victimizes,victimizing,victims,vile,violence,violent,vitriolic,wanker,warning,warnings,whitewash,withdrawal,woeful,worried,worry,worrying,worse,worsen,worsened,worsening,worsens,worst,wrathful";var c=u.split(",");var h=false;jQuery.each(c,function(e,t){if(TBUtilities.CountMatches(s,t.trim(),true,true)>0){h=true;jQuery(r).find(".comment-text-content").each(function(e,i){TBUtilities.Log(jQuery(this).html()+"< this");jQuery(this).html(TBUtilities.ReplaceAll(jQuery(this).html(),t.trim(),'<span class="tb-comment-filter-highlighted" style="padding:2px 1px; background-color:#ffff66">'+t.trim()+"</span>",true,false))})}});if(!h)n=false}if(i.profanity){o=true;var u="anal,anus,arse,ass,ballsack,balls,bastard,bitch,biatch,blowjob,blow job,bollock,bollok,boner,boob,butt,buttplug,clitoris,cock,coon,crap,cunt,dam,damn,dick,dildo,dyke,fag,feck,fellate,fellatio,felching,fuck,fucker,f u c k,fudgepacker,fudge packer,flange,Goddamn,God damn,homo,jerk,jizz,knobend,knob end,lmao,lmfao,muff,nigger,nigga,penis,piss,poop,prick,pube,pussy,queer,scrotum,sex,shit,,sh1t,slut,smegma,spunk,tit,tosser,turd,twat,vagina,wank,whore,wtf";var c=u.split(",");var d=false;jQuery.each(c,function(e,t){if(t.trim()=="")return;if(TBUtilities.CountMatches(s,t.trim(),true,true)>0){d=true;jQuery(r).find(".comment-text-content").each(function(e,i){TBUtilities.Log(jQuery(this).html()+"< this");jQuery(this).html(TBUtilities.ReplaceAll(jQuery(this).html(),t.trim(),'<span class="tb-comment-filter-highlighted" style="padding:2px 1px; background-color:#ffff66">'+t.trim()+"</span>",true,false))})}});if(!d)n=false}TBUtilities.Log("Check Links");if(i.links){o=true;TBUtilities.Log(s);if(s.indexOf("www")>-1)d=true;if(s.indexOf("http")>-1)d=true;if(s.indexOf(".com")>-1)d=true;if(s.indexOf(".net")>-1)d=true;if(s.indexOf(".edu")>-1)d=true;if(s.indexOf(".be")>-1)d=true;if(s.indexOf(".ly")>-1)d=true;if(s.indexOf(".gl")>-1)d=true;if(!d)n=false}if(i.wordsFilter&&i.words.length>2){var y=i.words.split(",");var p=false;TBUtilities.Log(y.length);jQuery.each(y,function(e,t){o=true;if(t.trim().length<3)return;if(TBUtilities.CountMatches(s,t.trim(),true,false)>0){p=true;jQuery(r).find(".comment-text-content").each(function(e,i){jQuery(this).html(TBUtilities.ReplaceAll(jQuery(this).html(),t.trim(),'<span class="tb-comment-filter-highlighted" style="padding:2px 1px; background-color:#ffff66">'+t.trim()+"</span>",true,false))})}if(TBUtilities.CountMatches(l,t.trim(),true,false)>0){p=true;jQuery(r).find(".user-name").each(function(e,i){jQuery(this).html(TBUtilities.ReplaceAll(jQuery(this).html(),t.trim(),'<span class="tb-comment-filter-highlighted" style="padding:2px 1px; background-color:#ffff66">'+t.trim()+"</span>",true,false))})}});if(!p)n=false}if(i.onlyLinked){o=true;if(jQuery(this)[0].outerHTML.indexOf("yt-commentbox-show-reply")>=0)n=false}if(i.onlyYouTube){o=true;if(jQuery(this)[0].outerHTML.indexOf("yt-commentbox-show-reply")==-1)n=false}if(i.hideReadComments){if(jQuery(this).hasClass(".tb-comment-is-read")){n=false}}if(n||!i.isShown){a++;jQuery(this).show()}else{t++;jQuery(this).hide()}});jQuery(".tb-comment-filter-thinking:first").hide();if(t===0)r=1;else r=t;try{TBUtilities.AddAction({FilteredCommentCount:r},TBUtilities.ActionTypes.CommentFilters_ApplyFilter,"commentfilters")}catch(e){TBUtilities.LogError({Exception:e,Location:"[FilterComment] [addAction]"})}var n='<span style="font-size:14px;">'+t+'</span> of <span style="font-size:14px;">'+(t+a)+"</span> threads filtered.";if(o)jQuery(".tb-comments-filter-how-many").show();else jQuery(".tb-comments-filter-how-many").hide();jQuery(".tb-comments-filter-how-many").html(n)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentFilters] [applyFilter]"})}};var Q=function(){jQuery(document.body).on("TBCommentsGotPatron",function(e,t){TBUtilities.Log("back:TBCommentsGotPatron");TBUtilities.Log(t);try{if(t.success){var i=JSON.parse(t.response);TBUtilities.Log(i);jQuery.each(i.PatreonAccounts,function(e,t){jQuery.each(t.Pledges,function(e,t){o.push(t)});c()})}}catch(e){}});jQuery(document.body).on("TBCommentsGotRead",function(e,t){TBUtilities.Log("back:TBCommentsGotRead");TBUtilities.Log(t);try{if(t.success){var i=JSON.parse(t.response);TBUtilities.Log(i);jQuery.each(i.Data,function(e,t){TBUtilities.Log("Read Comment: "+t);if(jQuery('.comment-item[data-cid="'+t+'"]').parent().hasClass("comment-entry")){TBUtilities.Log("Top Level");TBUtilities.Log("Childred: "+jQuery('.comment-item[data-cid="'+t+'"]').parent().find(".comment-item"));jQuery('.comment-item[data-cid="'+t+'"]').parent().find(".comment-item").hide();jQuery('.comment-item[data-cid="'+t+'"]').parent().hide()}else{TBUtilities.Log("Not Top Level");jQuery('.comment-item[data-cid="'+t+'"]').hide()}jQuery('.comment-item[data-cid="'+t+'"]').addClass("tb-comment-is-read");jQuery('.comment-item[data-cid="'+t+'"]').find(".tb-comments-read-image").css("opacity",".8");f()})}}catch(e){}});jQuery(document.body).on("TBCommentsMarkedAsRead",function(e,t){TBUtilities.Log("back:TBCommentsMarkedAsRead");TBUtilities.Log(t);try{if(t.success){TBUtilities.Log(t.data.commentId);TBUtilities.Log(jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').length);if(i.hideReadComments==true){TBUtilities.Log("settings.hideReadComments");if(jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').parent().hasClass("comment-entry")){TBUtilities.Log("Top Level");TBUtilities.Log("Childred: "+jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').parent().find(".comment-item"));jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').parent().find(".comment-item").hide();jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').parent().hide()}else{TBUtilities.Log("Not Top Level");jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').hide()}}jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').addClass("tb-comment-is-read");jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').find(".tb-comments-read-image").css("opacity",".8");f()}}catch(e){}});jQuery(document.body).on("TBCommentsMarkedAsUnRead",function(e,t){TBUtilities.Log("back:TBCommentsMarkedAsUnRead");TBUtilities.Log(t);try{if(t.success){TBUtilities.Log(t.data.commentId);TBUtilities.Log(jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').length);jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').removeClass("tb-comment-is-read");jQuery('.comment-item[data-cid="'+t.data.commentId+'"]').find(".tb-comments-read-image").css("opacity",".4");f()}}catch(e){}});jQuery(document.body).on("CRTBLoadCommentFilterTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);b()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentFilter] CRTBLoadCommentFilterTemplate"})}});jQuery(document.body).on("CRTBupdateCache",function(e,t){try{if(t.success){s=JSON.parse(t.response);lscache.set("tbSubscriberCache"+TBGlobal.CurrentChannelId(),s,2880)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentFilter] CRTBupdateCache"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!t){Q();h();y();g();t=true}else{b()}}}}}();var TubeBuddyPickAWinner=function(){var e=false;var t;var i;var a;var r=0;var o=function(){};var n=function(e){try{jQuery("#tb-pick-a-winner-commenter-winner-container").removeClass("tb-hid");jQuery(".tb-pick-a-winner-start").attr("disabled",false);jQuery(".tb-pick-a-winner-start").find(".tb-spinner").addClass("tb-hid");var t=jQuery("#tb-contains-text").prop("checked")?jQuery("#tb-comment-contains-text").val().toLowerCase():"";var i=e.filter(function(e){return e.Comment.toLowerCase().search(t)>-1});var a=c(0,i.length-1);var r=i[a];if(r){jQuery(".tb-pick-a-winner-commenter-winner-channelThumbnail").attr("src",r.AuthorProfileImageUrl);jQuery(".tb-pick-a-winner-commenter-winner-channelUrl").attr("href",r.AuthorChannelUrl+"/about");jQuery(".tb-pick-a-winner-commenter-winner-channelUrl").text(r.AuthorChannelName);jQuery(".tb-pick-a-winner-commenter-winner-comment").html(r.Comment);jQuery("#tb-pick-a-winner-description").hide();jQuery("#tb-pick-a-winner-text").text("Pick another Winner");jQuery("#tb-pick-a-winner-social").html('<div class="tb-spinner tb-loading-social"></div> ');var o="https://www.youtube.com/channel/"+r.AuthorChannelId;TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(o,s)}else{jQuery("#tb-pick-a-winner-commenter-winner-container").addClass("tb-hid");jQuery("#tb-pick-a-winner-no-comments-found-with-input-text").removeClass("tb-hid")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] getVideoCommentsCallback"})}};var s=function(e){var t=e.socialProfiles;if(t.length>0){jQuery.each(t,function(e,t){jQuery("#tb-pick-a-winner-social").append('<a target="_blank" href="https://youtube.com'+t.url+'"><img class="tb-margin-right3" src="'+t.image+'"/></a>')})}jQuery(".tb-loading-social").addClass("tb-hid")};var l=function(){var e=TBGlobal.host+"/ModuleManager/PickAWinner/PickAWinner?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/pickawinner.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/pickawinner.html"}TBExtension.Get(e,"CRTBLoadPickAWinnerTemplate")};var u=function(){jQuery(document).on("click",".tb-pick-a-winner-start",function(e){try{jQuery("#tb-pick-a-winner-no-comments-found-with-input-text").addClass("tb-hid");TBUtilities.AddAction(null,TBUtilities.ActionTypes.PickAWinner_Pick,"pickawinner")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] [addAction]"})}jQuery(".tb-pick-a-winner-start").attr("disabled",true);jQuery(".tb-pick-a-winner-start").find(".tb-spinner").removeClass("tb-hid");TBYouTubeApi.GetVideoComments(t,1e3,n)});jQuery(document).on("click","#tb-comment-contains-text",function(e){jQuery("#tb-contains-text").prop("checked",true);jQuery("#tb-random").prop("checked",false)});jQuery(document).on("click",".tb-module-close",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-pick-a-winner-container").hide();jQuery("#tb-contains-text").prop("checked",false);jQuery("#tb-comment-contains-text").val("");jQuery("#tb-pick-a-winner-no-comments-found-with-input-text").addClass("tb-hid");jQuery("#tb-random").prop("checked",true)})};var c=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var d=function(){jQuery(document.body).on("CRTBLoadPickAWinnerTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] CRTBLoadPickAWinnerTemplate"})}})};var b=function(e,t,i){try{TBGlobal.AddUserDebugInfo("Opening Pick a winner");jQuery(".tb-pick-a-winner-start-container").removeClass("tb-hid");jQuery(".tb-pick-a-winner-finish-container").addClass("tb-hid");jQuery(".tb-pick-a-winner-none").addClass("tb-hid");jQuery("#tb-pick-a-winner-video-thumbnail").attr("src",t);jQuery("#tb-pick-a-winner-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-pick-a-winner-video-link").text(i);jQuery("#tb-pick-a-winner-text").text("Pick a Winner");jQuery("#tb-pick-a-winner-container").show();jQuery("#tb-pick-a-winner-description").show();jQuery(".tb-pick-a-winner-start").attr("disabled",true);jQuery("#tb-pick-a-winner-commenter-winner-container").addClass("tb-hid");jQuery("#tb-pick-a-winner-none").addClass("tb-hid")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] prepareDialog"})}};var h=function(e){try{r=e.statistics.CommentCount;if(r>0){jQuery(".tb-pick-a-winner-start").attr("disabled",false);jQuery(".tb-pick-a-winner-start-container").removeClass("tb-hid")}else{jQuery(".tb-pick-a-winner-start-container").addClass("tb-hid");jQuery("#tb-pick-a-winner-none").removeClass("tb-hid")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] getVideoDetailsCallback"})}};var y=function(){b(t,a,i);TBYouTubeApi.GetVideoDetails(t,"statistics",h);TBGlobal.ClearUserDebugInfo()};return{Show:function(r,o,n){if(TBGlobal.IsAuthenticated()){t=r;a=o;i=n;if(!e){d();l();u();e=true}else{y()}}}}}();var TubeBuddyEditVideoUploadDefaults=function(){var e=false;var t=[];var i=[];var a=null;var r=0;var o=function(){var e=TBGlobal.host+"/ModuleManager/EditVideoUploadDefaults/EditVideoUploadDefaults?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/editvideouploaddefaults.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/editvideouploaddefaults.html"}TBExtension.Get(e,"CRTBLoadEditVideoUploadDefaultsTemplate")};var n=function(){var e=TBGlobal.host+TBGlobal.apiUrls.uploadDefaultsList;TBExtension.Get(e,"CREditVideoUploadDefaultsGetList")};var s=function(){try{if(r>=i.length){clearTimeout(a);a=null;return}jQuery(".video-settings-add-tag").val(i[r++]);jQuery(".video-settings-add-tag:first").focus();jQuery(".video-settings-title:first").focus();a=setTimeout(s,100)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUploads] addTagsOneAtATime"})}};var l=function(){jQuery(document).on("click",".tb-edit-video-upload-default-apply-button",function(){var e="0";try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.DefaultUploadProfiles_Apply,"defaultuploadprofiles");var a=jQuery(".tb-edit-video-upload-default-select").val();e+="["+a+"]";e+="["+t.length+"]";var o=TBUtilities.GetInArray(t,"Id",a);e+="["+o+"]";jQuery("[data-tab-id=basic-info]")[0].click();if(jQuery(".tb-edit-video-upload-defaults-title:first").is(":checked"))jQuery(".video-settings-title").val(o.Title);if(jQuery(".tb-edit-video-upload-defaults-description:first").is(":checked"))jQuery(".video-settings-description").val(o.Description);if(jQuery(".tb-edit-video-upload-defaults-advanced:first").is(":checked")){jQuery(".category-input").val(o.Category);jQuery(".license-input").val(o.License);jQuery(".video-settings-allow-comments").prop("checked",o.AllowComments);jQuery("[name=allow_comments_detail]").val(o.AllowCommentsDetail);jQuery("[name=allow_ratings]").prop("checked",o.UsersCanViewRatingsForThisVideo);jQuery("#yt-languagepicker-input-audio_language").attr("value",o.VideoLanguageAbbreviation);jQuery(".yt-languagepicker").find(".yt-uix-button-content").text(o.VideoLanguage);jQuery(".yt-languagepicker").find("[name=audio_language]").attr("value",o.VideoLanguageAbbreviation);jQuery("ul.yt-uix-languagepicker-language-list:first").find("li").removeClass("yt-uix-button-menu-item-selected");jQuery("ul.yt-uix-languagepicker-language-list:first").append('<li role="menuitem" data-value="'+o.VideoLanguageAbbreviation+'" class="yt-uix-languagepicker-menu-item yt-uix-button-menu-item-selected"><span class="yt-uix-button-menu-item">'+o.VideoLanguage+"</span></li>");jQuery("[name=captions_certificate_reason]").val(o.CaptionCertification);jQuery(".location-longitude").val(o.LocationLongitude);jQuery(".location-latitude").val(o.LocationLatitude);jQuery("[name=allow_public_stats]").prop("checked",o.VideoStatisticsPublic)}if(jQuery(".tb-edit-video-upload-defaults-monetization:first").is(":checked")){if(jQuery('[data-ng-model="formats.has_overlay_ads"]').is(":visible"))jQuery('[data-ng-model="formats.has_overlay_ads"]').prop("checked",o.OverlayInVideoAds);if(jQuery('[data-ng-model="formats.has_skippable_video_ads"]').is(":visible"))jQuery('[data-ng-model="formats.has_skippable_video_ads"]').prop("checked",o.SkippableVideoAds);e+="[A]";if(jQuery('[data-ng-model="isMonetizing"]').is(":visible")){jQuery('[data-ng-model="isMonetizing"]').prop("checked",o.MonetizeWithAds);if(o.MonetizeWithAds){jQuery('[data-ng-model="isMonetizing"]')[0].click()}}}if(jQuery(".tb-edit-video-upload-defaults-tags:first").is(":checked")){jQuery(".video-settings-tags").val(o.Tags);e+="[C]";i=[];if(o.Tags!=null&&o.Tags.length>0){if(o.Tags.indexOf(",")>-1){i=o.Tags.split(",")}else{i=o.Tags.match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)}}if(o.Tags==null||o.Tags.length==0){TBUtilities.Confirm("There are no tags in the Upload Default. Are you sure you want to remove all existing Tags?",function(){TubeBuddyEditVideo.SetTags(i)})}r=0;if(i.length>0){TubeBuddyEditVideo.SetTags(i)}}jQuery(".yt-uix-form-input-select").each(function(){jQuery(this).find(".yt-uix-form-input-select-value:first").text(jQuery(this).find(".yt-uix-form-input-select-element option:selected").text());jQuery(this).find(".yt-uix-form-input-select-element:first")[0].click()})}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyUploads] tb-edit-video-upload-default-apply-button [click] "+e})}});jQuery(document).on("click",".tb-edit-video-upload-defaults-toggle",function(){if(jQuery(".tb-edit-video-default-uploads-area:first").is(":visible")){jQuery(".tb-edit-video-default-uploads-area").slideUp();jQuery(".tb-edit-video-upload-defaults-toggle-arrow").html("&#9660;")}else{jQuery(".tb-edit-video-default-uploads-area").slideDown();jQuery(".tb-edit-video-upload-defaults-toggle-arrow").html("&#9650;")}});jQuery(document).on("click",".tb-edit-video-thumbnail-gen-create",function(){var e=TBUtilities.GetUrlParameter("video_id");var t="";if(jQuery("#creator-editor-title-link").length>0)t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";var a=jQuery(".video-settings-description").val();var r=jQuery(".video-view-count").find(".video-info-text").text().trim();TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyThumbnailCreator.Show(e,t,i,a,r)})};var u=function(){jQuery(document.body).on("CRTBLoadEditVideoUploadDefaultsTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);jQuery("#metadata-editor-pane").before(jQuery(".tb-upload-container:last")[0].outerHTML);jQuery("#metadata-editor-pane").before(jQuery(".tb-edit-video-thumbnail-gen-create-container:last")[0].outerHTML);n()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEditVideoUploadDefaults"+"] CRTBLoadEditVideoUploadDefaultsTemplate"})}});jQuery(document.body).on("CREditVideoUploadDefaultsGetList",function(e,i){try{if(i.success){jQuery.each(JSON.parse(i.response),function(e,i){t.push(i)});if(t.length>0){var a=jQuery(this).find(".tb-edit-video-upload-default-select:first");jQuery.each(t,function(e,t){a.append(jQuery("<option></option>").attr("value",t.Id).text(t.Name))});jQuery(".tb-uploads-no-upload-default-profiles").hide();jQuery(".tb-uploads-has-upload-default-profiles").show()}else{jQuery(".tb-uploads-no-upload-default-profiles").show();jQuery(".tb-uploads-has-upload-default-profiles").hide()}}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUploads] CRUploadDefaultsGetList"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();o();l();e=true}}}}}();var TubeBuddyCompetitorAnalysis=function(){var e=false;var t=[];var i={id:"",name:"",thumbnailUrl:"",subscribersTotal:0,subscribers30:0,viewsTotal:0,views30:0,views10Average:0};var a="";var r=function(){};var o=function(){var e=TBGlobal.host+"/ModuleManager/competitoranalysis/competitoranalysis?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/competitoranalysis.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/competitoranalysis.html"}TBExtension.Get(e,"CRTBLoadCompetitorAnalysisTemplate")};function n(e,t){return TBUtilities.ReplaceAll(jQuery(e).children("td").eq(t).text(),",","")}function s(e){return function(t,i){var a=n(t,e),r=n(i,e);return jQuery.isNumeric(a)&&jQuery.isNumeric(r)?a-r:a.localeCompare(r)}}var l=function(){jQuery("#tb-competitor-analysis-output").val("Channel Id\tName\tSubscribers Total\tSubscribers 30 Days\tViews Total\tViews 30 Days\tAvg Views Last 10 Videos\n");jQuery("#tb-competitor-analysis-table").find("tr").each(function(e,i){var a=jQuery(i).attr("data-channelid");if(a){var r=TBUtilities.GetInArray(t,"id",a);jQuery("#tb-competitor-analysis-output").val(jQuery("#tb-competitor-analysis-output").val()+r.id+"\t"+r.name+"\t"+r.subscribersTotal+"\t"+r.subscribers30+"\t"+r.viewsTotal+"\t"+r.views30+"\t"+r.views10Average+"\n")}})};var u=function(e){try{var i=TBUtilities.GetInArray(t,"id",e.Id);i.name=e.Snippet.Title;i.thumbnailUrl=data.Snippet.Thumbnails.ThumbnailDefault;i.subscribersTotal=e.Statistics.SubscriberCount;i.viewsTotal=e.Statistics.ViewCount;TubeBuddyStatFire.GetChannelStats(i.id,2,30,TubeBuddyCompetitorAnalysis.GotChannelStats)}catch(t){TBUtilities.LogError({Exception:t,Location:"[TubeBuddyLayout] gotChannelDetails [[[Channel Results: "+JSON.stringify(e)+"]]]"})}};var c=function(e){if(e){var i=TBUtilities.GetInArray(t,"id",e);if(i)return;var a={};a.id=e;t.push(a);TBYouTubeApi.GetChannelDetails(a.id,null,u,null)}};var d=function(){jQuery(document).on("click","#tb-competitor-analysis-load",function(){t=[];a="";var e=jQuery("#tb-competitor-analysis-import-text").val().split("\n");jQuery("#tb-competitor-analysis-output").val("Channel Id\tName\tSubscribers Total\tSubscribers 30 Days\tViews Total\tViews 30 Days\tAvg Views Last 10 Videos\n");jQuery.each(e,function(e,t){TubeBuddyYouTubeActions.GetChannelId(t.trim(),c)});jQuery("#tb-competitor-analysis-import").hide();jQuery("#tb-competitor-analysis-data-table").show();jQuery("#tb-competitor-analysis-loading-grid").show()});jQuery(document).on("click","#tb-competitor-analysis-reset",function(){jQuery("#tb-competitor-analysis-import").show();jQuery("#tb-competitor-analysis-data-table").hide();jQuery("#tb-competitor-analysis-table-body").empty();jQuery("#tb-competitor-analysis-data-export").hide()});jQuery(document).on("click",'[data-sort-cell="true"]',function(){var e=$(this).parents("table").eq(0);var t=e.find("tr:gt(1)").toArray().sort(s($(this).index()));this.asc=!this.asc;if(!this.asc){t=t.reverse()}for(var i=0;i<t.length;i++){e.append(t[i])}l()});jQuery(document).on("click",".tb-competitor-analysis-close, .tb-competitor-analysis-closex",function(){jQuery("#tb-competitor-analysis-container").hide();TubeBuddyMenu.HideBackground()})};var b=function(){jQuery("#tb-competitor-analysis-container").show();t=[]};var h=function(e,i){var a=0;if(i.length>0){jQuery.each(i,function(e,t){a+=t.ViewCount});a=a/(i.length*1)}var r=TBUtilities.GetInArray(t,"id",e);r.views10Average=parseInt(a);jQuery("[data-channelid="+e+"]").find(".last10:first").html(TBUtilities.FormatNumberWithCommas(r.views10Average));jQuery("#tb-competitor-analysis-output").val(jQuery("#tb-competitor-analysis-output").val()+e+"\t"+r.name+"\t"+r.subscribersTotal+"\t"+r.subscribers30+"\t"+r.viewsTotal+"\t"+r.views30+"\t"+r.views10Average+"\n");jQuery("#tb-competitor-analysis-data-export").show();l()};var y=function(e,i){var a=TBUtilities.GetInArray(t,"id",e);a.views30=i[i.length-1].ViewCount-i[i.length-2].ViewCount;a.subscribers30=i[i.length-1].SubscriberCount-i[i.length-2].SubscriberCount;if(isNaN(a.viewsTotal))a.viewsTotal=0;if(isNaN(a.views30))a.views30=0;if(isNaN(a.subscribersTotal))a.subscribersTotal=0;if(isNaN(a.subscribers30))a.subscribers30=0;jQuery("#tb-competitor-analysis-loading-grid").hide();var r;if(a.id==TBGlobal.CurrentChannelId())r='<tr class="competitor-table-me" data-channelid="'+a.id+'">';else r='<tr data-channelid="'+a.id+'">';r+='<td style="text-align:left;"><img src="'+a.thumbnailUrl+'" style="height:18px; width:18px; margin-right:3px; position:relative; top:1px;" /><a target="_blank" href="https://www.youtube.com/channel/'+a.id+'" style="position:relative; top:-3px">'+a.name+"</a>";r+="</td>";r+="<td>"+TBUtilities.FormatNumberWithCommas(a.subscribersTotal);r+="</td>";r+="<td>"+TBUtilities.FormatNumberWithCommas(a.subscribers30);r+="</td>";r+="<td>"+TBUtilities.FormatNumberWithCommas(a.viewsTotal);r+="</td>";r+="<td>"+TBUtilities.FormatNumberWithCommas(a.views30);r+="</td>";r+='<td class="last10"><img src="'+TBGlobal.host+'/images/general/loading1.gif" />';r+="</td>";r+="</tr>";jQuery("#tb-competitor-analysis-table-body").append(r);TubeBuddyStatFire.GetVideoStats(e,0,10,TubeBuddyCompetitorAnalysis.GotVideoStats)};var p=function(){jQuery(document.body).on("CRTBLoadCompetitorAnalysisTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCompetitorAnalysis] CRTBLoadCompetitorAnalysisTemplate"})}})};var b=function(){if(e){jQuery("#tb-best-time-to-publish-container").show();loadData()}else{TBUtilities.Alert("Still loading, please try again in a few seconds.")}};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){p();o();d();e=true}else{b()}}},GotChannelDetails:function(e,t){u(e,t)},GotChannelStats:function(e,t){y(e,t)},GotVideoStats:function(e,t){h(e,t)}}}();var TubeBuddyTagTranslator=function(){var e=false;var t="";var i=[];var a=[];var r=0;var o=0;var n=null;var s=null;var l=null;var u=false;var c;var d;var b={id:"",term:"",rank:-1,date:""};var s=null;var h=null;var y=function(){$("#languageGraph").highcharts({chart:{type:"column",style:{fontFamily:"CircularStd-Medium",color:"#424242",fontWeight:"normal"}},title:{text:null},colors:["rgba(74, 144, 226, 0.8)","rgba(108, 200, 97, 0.8)","rgba(255, 170, 54, 0.8)","rgba(250, 53, 53, 0.8)","rgba(128, 133, 233, 0.8)"],subtitle:{text:null},xAxis:{type:"category"},yAxis:{title:{text:null}},legend:{enabled:false},credits:{enabled:false},plotOptions:{series:{borderWidth:0,dataLabels:{formatter:function(){return this.x+"   "+this.y},enabled:true,format:"{point.y:.1f}%",color:"#424242",style:{fontSize:"13px",fontFamily:"CircularStd-Bold"}}}},tooltip:{headerFormat:'<span style="font-size:13px; font-family:"CircularStd-Medium",sans-serif;>{series.name}</span><br>',pointFormat:'<span style="color:{point.color};font-family:"CircularStd-Medium",sans-serif;">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'},series:[{name:"Language",colorByPoint:true,data:a}]});jQuery("#languageGraphLoading").hide();jQuery("#languageContainer").slideDown()};var p=function(){var e=TBGlobal.host+"/ModuleManager/TagTranslator/TagTranslator?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/tagtranslator.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/tagtranslator.html"}TBExtension.Get(e,"CRTBLoadTagTranslatorTemplate")};var m=function(){var e=TBGlobal.host+TBGlobal.apiUrls.dataGetChannelLanguageStatistics;TBExtension.Get(e,"CRTagTranslationGetLanguageData")};var f=function(){jQuery(document).on("click",".tb-tag-translator-close, .tb-tag-translator-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-tag-translator-container").hide()});jQuery(document).on("change",".tb-tag-translator-language",function(){var e=jQuery(this).val();if(e!="select"&&e!=n){n=e;r=0;jQuery("#tb-tag-translator-body").empty();try{TBUtilities.AddAction({TagCount:i.length},TBUtilities.ActionTypes.AutoTranslator_Use,"autotranslator");if(!u){TBUtilities.AddAction(null,TBUtilities.ActionTypes.LanguageAnalysis_Use,"languageanalysis");u=true}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TagTranslator] [addAction]"})}jQuery.each(i,function(e,t){v(t)})}});jQuery(document).on("click",".tb-tag-translator",function(){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.tagtranslator)});jQuery(document).on("click",".tb-tag-translator-translation",function(){var e=jQuery(this).attr("data-tag-translated");TBUtilities.AddDebug(e);if(s==null){jQuery(".video-settings-add-tag:first").val(e);jQuery(".video-settings-add-tag:first").focus();jQuery(".video-settings-title:first").focus();jQuery(".video-settings-add-tag").trigger("blur")}else if(typeof s==="function"){s(e)}else{s.closest(".upload-item").find(".video-settings-add-tag:first").val(e);s.closest(".upload-item").find(".video-settings-add-tag:first").focus();s.closest(".upload-item").find(".video-settings-title:first").focus();s.closest(".upload-item").find(".video-settings-add-tag").trigger("blur")}jQuery(this).attr("src",TBGlobal.host+"/images/icons/check.png");jQuery(this).removeClass("tb-tag-translator-translation");jQuery(this).css("cursor","default")});jQuery(document).on("click",".yt-chip",function(){var e=jQuery(this).find("span:first").text();if(!_isRepopulating){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyTagExplorer.ShowTagExplorer(e,jQuery(this))}})};var g=function(){jQuery(document.body).on("CRTBLoadTagTranslatorTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!l){jQuery("body").append(t.response)}else{l.append(t.response)}j()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagTranslator] CRTBLoadTagTranslatorTemplate"})}});jQuery(document.body).on("CRTagTranslationGetTranslation",function(e,t){try{if(t.success){var i=JSON.parse(t.response);if(i.Text==i.TranslatedText)jQuery('[data-tag-name="'+i.Text+'"]').html('<span style="font-size:14px; color:#999;">(same)</span>');else jQuery('[data-tag-name="'+i.Text+'"]').html('<img class="tb-tag-translator-translation" data-tag-translated="'+i.TranslatedText+'" style="height:14px; width:14px; position:relative; top:3px; cursor:pointer; margin-right:3px;" src="'+TBGlobal.host+'/images/icons/add2.png"  /> '+i.TranslatedText+' <a target="_blank" href="https://translate.google.com/#auto/'+n+"/"+i.Text+'" style="position:relative; top:02px; float:right;"><img style="height:13px; margin-right:5px;" src="'+TBGlobal.host+'/images/icons/external-blue.png" /></a> <a target="_blank" href="https://www.youtube.com/results?search_query='+i.TranslatedText+'" style="position:relative; top:02px; float:right"><img src="'+TBGlobal.host+'/images/icons/search-blue.png" style="height:13px; margin-right:5px;" /></a>')}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}});jQuery(document.body).on("CRTagTranslationGetLanguageData",function(e,t){try{if(t.success){a=[];var i=JSON.parse(t.response);jQuery.each(i,function(e,t){if(e>4)return;a.push({y:t.Percent*100,name:t.Language})});y()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}})};var v=function(e,t){var a="";a+='<tr data-tag="'+e+'" class="tb-search-term-row">';a+='<td style="font-size:14px; width:380px;">'+e+"</td>";if(t){a+='<td data-tag-name="'+e+'" class="tb-tag-translator-translated" style="font-size:14px; width:380px;">...</td>'}else{if(r==2&&!TBGlobal.CanAccessLevel3Tools()){a+='<td valign="top" data-tag-name="'+e+'" class="tb-tag-translator-translated" style="font-size:14px; width:380px; padding:15px; line-height:18px;" rowspan="'+(i.length-1)+'">Please <a class="tb-tag-translator">Upgrade your License</a> to view translations for the rest of your Tags. Thanks!</td>'}else if(TBGlobal.CanAccessLevel3Tools()||r<=1){a+='<td data-tag-name="'+e+'" class="tb-tag-translator-translated" style="font-size:14px; width:380px;"><span class="tb-spinner"></span></td>';var o=jQuery.param({Text:e,TargetLanguage:n});var s=TBGlobal.host+TBGlobal.apiUrls.translateGetTranslation;TBExtension.Post(s,o,"CRTagTranslationGetTranslation",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}}a+="</tr>";jQuery("#tb-tag-translator-body").append(a);r++};var T=function(e,t){try{s=t;i=[];jQuery("#tb-tag-translator-body").empty();jQuery(".tb-tag-translator-language").val("select");i=e;jQuery("#tb-tag-translator-no-tags").hide();jQuery.each(i,function(e,t){v(t,true)});jQuery("#tb-tag-translator-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagTranslator] prepareDialog"})}};var j=function(){try{m();T(h,s);jQuery("#tb-tag-translator-canvas-loading").hide();jQuery("#tb-tag-translator-canvas").hide();jQuery("#tb-tag-translator-no-history").hide();jQuery("#tb-tag-translator-no-rankings-ever").hide();jQuery("#tb-tag-translator-actual-chart").hide();jQuery("#tb-tag-translator-selected-term-click").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagTranslator] show"})}};return{Show:function(t,i,a){if(TBGlobal.IsAuthenticated()){h=t;s=i;if(a){l=a}else{l=null}if(!e){g();p();f();e=true}else if(e&&(a&&jQuery(".tb-tag-translator-modal").length===0)){p()}else{j()}}}}}();var TubeBuddyCopyToFacebook=function(){var e=false;var t=[];var i=null;var a=null;var r=null;var o=null;var n=null;var s=null;var l=null;var u=null;var c=null;var d=0;var b="-~-~~-~~~-~~-~-";var h=null;var y=false;var p="https://graph-video.facebook.com/v2.9/";var m=false;var f=null;var g=function(){var e=TBGlobal.host+"/ModuleManager/CopyToFacebook?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/copytofacebook.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/copytofacebook.html"}TBExtension.Get(e,"CRTBLoadCopyToFacebookTemplate")};var v=function(){var e=TBGlobal.host+TBGlobal.apiUrls.socialAccountsGetFacebook;TBExtension.Get(e,"CRTBCopyToFacebookLoadAccounts")};var T=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetLatestCopyToFacebook+"?videoId="+i;TBExtension.Get(e,"CRTBLoadLastPublish")};var j=function(){jQuery(document).on("change",'input[name="facebook-upload-option"]',function(e){if(jQuery(this).val()=="upload"){jQuery(".tb-copy-to-facebook-validation").show()}else{jQuery(".tb-copy-to-facebook-validation").hide()}});jQuery(document).on("change","#tb-copy-to-facebook-upload-input",function(e){var t=document.getElementById("tb-copy-to-facebook-upload-input").value;var i=t.match(/\.([^\.]+)$/)[1];i=i.toLowerCase();switch(i){case"3g2":case"3gp":case"3gpp":case"asf":case"avi":case"dat":case"divx":case"dv":case"flv":case"gif":case"m2ts":case"m4v":case"mkv":case"mod":case"mov":case"mp4":case"mpe":case"mpeg":case"mpeg4":case"mpg":case"mts":case"nsv":case"ogm":case"ogv":case"qt":case"tod":case"ts":case"vob":case"wmv":{jQuery(".tb-copy-to-facebook-validation").hide();jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);$("#namefile").html(t)}break;default:TBUtilities.Alert("Only 3g2, 3gp, 3gpp, asf, avi, dat, divx, dv, f4v, flv, gif, m2ts, m4v, mkv, mod, mov, mp4, mpe, mpeg, mpeg4, mpg, mts, nsv, ogm, ogv, qt, tod, ts, vob, and wmv formats are allowed.");jQuery("#tb-copy-to-facebook-upload-input").val("");return}var a=e.target.files[0].size;if(a>10737418240){TBUtilities.Alert("The maximum video file size is 10GB. Please select a smaller video file.");jQuery("#tb-copy-to-facebook-upload-input").val("");return}});jQuery(document).on("change",".tb-copy-to-facebook-video-settings-publish-option",function(e){var t=jQuery("input[name=scheduledPublishOption]:checked").val();if(t=="future"){jQuery(".tb-copy-to-facebook-video-settings-publish-options").show()}else{jQuery(".tb-copy-to-facebook-video-settings-publish-options").hide()}});jQuery(document).on("change",".tb-copy-to-facebook-accounts",function(e){var i=jQuery(".tb-copy-to-facebook-accounts").val();var a=TBUtilities.GetInArray(t,"Id",i);jQuery(".tb-copy-to-facebook-call-to-action").hide();if(a.SocialAccountType==1){jQuery(".tb-copy-to-facebook-video-settings-publish-option-future").prop("disabled",false);jQuery(".tb-copy-to-facebook-video-settings-publish-option-draft").prop("disabled",false);jQuery("#tb-copy-to-facebook-thumbnailContainer").removeClass("tb-hid");jQuery("input[name=facebook-upload-option]").prop("disabled",false);jQuery(".tb-copy-to-facebook-copy").prop("disabled",false);jQuery("#tb-copy-to-facebook-upload-input").prop("disabled",false)}else{jQuery(".tb-copy-to-facebook-video-settings-publish-option-now").prop("checked","checked");jQuery(".tb-copy-to-facebook-video-settings-publish-options").hide();jQuery("#tb-copy-to-facebook-thumbnailContainer").addClass("tb-hid");jQuery(".tb-copy-to-facebook-video-settings-publish-option-future").prop("disabled",true);jQuery(".tb-copy-to-facebook-video-settings-publish-option-draft").prop("disabled",true);jQuery(".tb-copy-to-facebook-api-update").show();var r=moment();var o=moment.utc();var n=new Date(o.format());n.setHours(0,0,0,0);var s=new Date("2018-08-01T00:00:00");if(n>=s){jQuery("input[name=facebook-upload-option]").prop("disabled",true);jQuery(".tb-copy-to-facebook-copy").prop("disabled",true);jQuery("#tb-copy-to-facebook-upload-input").prop("disabled",true)}}});jQuery(document).on("click",".tb-add-facebook-accounts",function(e){TBUtilities.Alert("Please link your Facebook account at TubeBuddy.com and then come back to YouTube and click Refresh");jQuery(this).hide();jQuery(".tb-copy-to-facebook-refresh").show();jQuery(".tb-add-facebook-account-div").hide()});jQuery(document).on("click",".tb-copy-to-facebook-refresh",function(e){jQuery(this).hide();jQuery(".tb-add-facebook-accounts").show();TubeBuddyCopyToFacebook.Show(i,a,o)});jQuery(document).on("click",".tb-module-close",function(e){y=true;jQuery(".tb-copy-to-facebook-settings-container").unblock();TubeBuddyMenu.HideBackground();jQuery("#tb-copy-to-facebook-container").hide();jQuery("#namefile").html("No file selected")});jQuery(document).on("click",".tb-copy-to-facebook-copy",function(e){var r=window.location.href;if(r.indexOf("youtube.com/upload")>0){if(!TBGlobal.CanPublishFacebookOnUploadScreen()){TBGlobal.ShowUpgradePage("use Publish To Facebook","publishtofacebook");return}}else{if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("use Publish To Facebook","publishtofacebook");return}}var o=jQuery("input[name='facebook-upload-option']:checked").val();switch(o){case"auto":{break}case"upload":{var n=document.getElementById("tb-copy-to-facebook-upload-input");if(n.files.length==0){TBUtilities.Alert("Please select a video file to Publish to Facebook",function(){jQuery("#tb-copy-to-facebook-upload-input").css({border:"#cc181e 1px solid"});return});return}break}}jQuery(".tb-copy-to-facebook-copy").text("Publishing to Facebook...");jQuery(".tb-copy-to-facebook-copy").attr("disabled",true);jQuery(".tb-copy-to-facebook-validation").hide();TBUtilities.AddAction(null,TBUtilities.ActionTypes.PublishToFacebook_Publish,"publishtofacebook");var s=jQuery(".tb-copy-to-facebook-accounts").val();var l=TBUtilities.GetInArray(t,"Id",s);if(l){var u=jQuery(".tb-copy-to-facebook-video-settings-title").val();var c=jQuery(".tb-copy-to-facebook-video-settings-description").val();var d=null;var b=jQuery("input:radio[name='scheduledPublishOption']:checked").val();if(l.SocialAccountType!=1){b="now"}switch(b){case"future":{var h=jQuery(".tb-copy-to-facebook-video-settings-publish-date").val();var y=jQuery("#tb-copy-to-facebook-video-settings-publish-time").val();var p=jQuery(".tb-copy-to-facebook-video-timezones").val();TBUtilities.Log("date = "+h);TBUtilities.Log("time = "+y);TBUtilities.Log("zone = "+p);TBUtilities.Log("date and time = "+h+" "+y);var m=moment.tz(h+" "+y,"MM/DD/YYYY HH:mm",p);d=m.unix();break}case"now":{d=null;break}case"draft":{d=-1;break}}var f=null;if(l.SocialAccountType==1&&jQuery("#tb-copy-to-facebook-useYouTubeThumbnail").is(":checked")){f=a}k(i,l.Id,u,c,f,d,!jQuery("#tb-copy-to-facebook-addToTimeline").is(":checked"))}})};var Q=function(e){TBUtilities.Alert(e)};var k=function(e,t,i,a,r,o,n){TBUtilities.Log("TubeBuddyCopyToFacebook - postVideoToFacebook");var s={VideoId:e,SocialAccountId:t,Title:i,Description:a,Thumbnail:r,PublishDate:o,AddToTimeLine:n};TBUtilities.Log(s);var l=jQuery("input[name='facebook-upload-option']:checked").val();switch(l){case"auto":{var u='<img src="'+TBGlobal.host+'/images/general/loading1.gif" />'+'<span style="margin-left:10px; font-size: 130%">Publishing To Facebook...</span>';jQuery(".tb-copy-to-facebook-settings-container").block({message:u,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});var c=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosPublishToFacebook;TBExtension.Post(c,JSON.stringify(s),"CRTBCopyToFacebookPublishToFacebook",null,{contentType:"application/json"});break}case"upload":{var u='<div><span class="tb-copy-to-facebook-publishing-message" style="margin-left:10px; font-size: 130%">Publishing To Facebook...</span></div><div><div class="tb-facebook-upload-progress"><div class="tb-facebook-upload-progress-bar"></div><div class="tb-facebook-upload-progress-percent">0%</div></div></div>';jQuery(".tb-copy-to-facebook-settings-container").block({message:u,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});if(r!=null){jQuery(".tb-copy-to-facebook-publishing-message").text("Creating Thumbnail...");var c=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetFacebookThumbnail+"?thumbnailUrl="+r;TBExtension.Get(c,"CRTBCopyToFacebookThumbnail",s)}else{B(s)}break}}};var B=function(e){jQuery(".tb-copy-to-facebook-publishing-message").text("Publishing To Facebook...");var i=document.getElementById("tb-copy-to-facebook-upload-input");d=0;h=null;s=TBUtilities.GetInArray(t,"Id",e.SocialAccountId);c=e;if(i.files.length){n=i.files[0];var a=new FormData;a.append("access_token",s.AccessToken);a.append("upload_phase","start");a.append("file_size",n.size);var r=p+s.ExternalId+"/videos";TBExtension.Post(r,a,function(e,t,i){try{if(e){l=i.upload_session_id;u=i.video_id;var a=U(n,i.start_offset,i.end_offset);if(a.size==0){x()}else{A(n,i.start_offset);C(a,i.start_offset)}}else{TBUtilities.LogFailedWebRequest({Location:"copyToFacebook.js|startUploadToFacebook",Data:t,Response:i});w("There was a problem publishing your video to Facebook.  Please try again...")}}catch(e){TBUtilities.LogError({Exception:e,Location:"copyToFacebook.js|startUploadToFacebook"});w("There was a problem publishing your video to Facebook.  Please try again...")}},null,{dataType:f,contentType:m})}else{w("Please select a video file to upload.")}};var C=function(e,t){if(y===true){TBUtilities.Log("Cancelling upload");return}let i=new FileReader;i.addEventListener("loadend",e=>{let a=i.result;var r=new FormData;r.append("access_token",s.AccessToken);r.append("upload_phase","transfer");r.append("start_offset",t);r.append("upload_session_id",l);r.append("video_file_chunk",a);var o=p+s.ExternalId+"/videos";TBExtension.Post(o,r,function(e,t,i){try{if(e){h=i;var a=U(n,i.start_offset,i.end_offset);if(a.size==0){x()}else{A(n,i.start_offset);C(a,i.start_offset,i.end_offset)}}else{TBUtilities.LogFailedWebRequest({Location:"copyToFacebook.js|sendChunk",Data:t,Response:i});d++;if(d<=4){var a=U(n,h.start_offset,h.end_offset);if(a.size==0){x()}else{A(n,h.start_offset);C(a,h.start_offset,h.end_offset)}}else{jQuery(".tb-copy-to-facebook-settings-container").unblock();jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);Q("There was a problem publishing your video to Facebook.  Please try again again...")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"copyToFacebook.js|sendChunk"});d++;if(d<=4){var a=U(n,h.start_offset,h.end_offset);if(a.size==0){x()}else{A(n,h.start_offset);C(a,h.start_offset,h.end_offset)}}else{jQuery(".tb-copy-to-facebook-settings-container").unblock();jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);Q("There was a problem publishing your video to Facebook.  Please try again again...")}}},null,{contentType:m,dataType:f})});i.readAsDataURL(e)};var w=function(e){jQuery(".tb-copy-to-facebook-settings-container").unblock();jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",true);Q(e)};var A=function(e,t){try{var i=n.size;var a=t/i*100;var r=Math.round(a)+"%";var o=jQuery(".tb-facebook-upload-progress-bar");o.css("width",r);var s=jQuery(".tb-facebook-upload-progress-percent");s.html(r)}catch(e){TBUtilities.Log(e)}};var x=function(e,t){var i=new FormData;i.append("access_token",s.AccessToken);i.append("upload_phase","finish");i.append("upload_session_id",l);i.append("title",c.Title);i.append("description",c.Description);i.append("no_story",c.AddToTimeLine);if(c.Thumbnail!=null){i.append("fb-thumb",c.Thumbnail)}if(c.PublishDate!=null){if(c.PublishDate==-1){i.append("unpublished_content_type","DRAFT");i.append("published","false")}else{i.append("scheduled_publish_time",c.PublishDate);i.append("unpublished_content_type","SCHEDULED");i.append("published","false")}}var a=p+s.ExternalId+"/videos";TBExtension.Post(a,i,function(e,t,i){try{if(e){I(true,i)}else{TBUtilities.LogFailedWebRequest({Location:"copyToFacebook.js|videoUploadComplete",Data:t,Response:i});I(false,i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"copyToFacebook.js|videoUploadComplete"});I(false,i)}},null,{contentType:m,dataType:f})};var I=function(e,i){try{TBUtilities.Log("TubeBuddyCopyToFacebook - clientSideFileUploadComplete");TBUtilities.Log(i);jQuery(".tb-copy-to-facebook-settings-container").unblock();if(e===true){jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);jQuery(".tb-copy-to-facebook-video-loaded-step1").addClass("tb-hid");jQuery(".tb-copy-to-facebook-video-loaded-complete").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-copy").addClass("tb-hid");var a=jQuery(".tb-copy-to-facebook-accounts").val();var r=TBUtilities.GetInArray(t,"Id",a);jQuery(".tb-copy-to-facebook-video-loaded-complete-link").attr("href","https://www.facebook.com/"+r.ExternalId+"/videos/"+u);jQuery(".tb-copy-to-facebook-video-loaded-complete-link").text("https://www.facebook.com/"+r.ExternalId+"/videos/"+u);jQuery(".tb-copy-to-facebook-validation").hide();jQuery(".tb-copy-to-facebook-close").text("Close")}else{throw"Failed to upload to facebook"}}catch(e){w("There was a problem publishing your video to Facebook.  Please try again...");TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] clientSideFileUploadComplete"})}};var U=function(e,t,i){var a=e.mozSlice?e.mozSlice:e.webkitSlice?e.webkitSlice:e.slice?e.slice:noop;return a.bind(e)(t,i)};var L=function(e,t,i){t=t||"";i=i||512;var a=atob(e);var r=[];for(var o=0;o<a.length;o+=i){var n=a.slice(o,o+i);var s=new Array(n.length);for(var l=0;l<n.length;l++){s[l]=n.charCodeAt(l)}var u=new Uint8Array(s);r.push(u)}var c=new Blob(r,{type:t});return c};var S=function(e,t,i){try{m=undefined;f="json";y=false;TBGlobal.AddUserDebugInfo("Opening publish to facebook");var a=t?t:"https://img.youtube.com/vi/"+e+"/mqdefault.jpg";if(TBGlobal.Profile().UserIdForLoginLink!=null)jQuery(".tb-copy-to-facebook-accounts-manage").attr("href",TBGlobal.host+"/account/integrations");else jQuery(".tb-copy-to-facebook-accounts-manage").attr("href",TBGlobal.host+"/account/integrations");jQuery("#tb-copy-to-facebook-container").show();jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-thumbnail").attr("src",a);jQuery(".tb-copy-to-facebook-start-container").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-finish-container").addClass("tb-hid");jQuery(".tb-copy-to-facebook-none").addClass("tb-hid");jQuery(".tb-copy-to-facebook-autherror").addClass("tb-hid");jQuery(".tb-copy-to-facebook-loading-video").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-video-loaded").addClass("tb-hid");jQuery("#tb-copy-to-facebook-video-thumbnail").attr("src",a);jQuery("#tb-copy-to-facebook-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-copy-to-facebook-video-link").text(i);jQuery("#tb-copy-to-facebook-text").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").addClass("tb-hid");jQuery(".tb-copy-to-facebook-private").addClass("tb-hid");jQuery(".tb-copy-to-facebook-license").addClass("tb-hid");jQuery(".tb-copy-to-facebook-length").addClass("tb-hid");jQuery(".tb-copy-to-facebook-video-settings-publish-option-now").prop("checked","checked");jQuery("#tb-copy-to-facebook-useYouTubeThumbnail").prop("checked","checked");jQuery(".tb-copy-to-facebook-video-loaded-step1").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-video-loaded-complete").addClass("tb-hid");jQuery(".tb-copy-to-facebook-start").attr("disabled",true);jQuery(".tb-copy-to-facebook-close").text("Cancel");jQuery(".tb-copy-to-facebook-published-template-container").empty();jQuery(".tb-copy-to-facebook-api-update").hide();var r=jQuery(".tb-copy-to-facebook-video-settings-publish-date").datepick({minDate:new Date});var o=new Date;var n=new Date(o);n.setDate(o.getDate()+1);jQuery(".tb-copy-to-facebook-video-settings-publish-date").datepick("setDate",n);var d=window.location.href;if(d.indexOf("youtube.com/upload")>0){jQuery("#addToTimeline").prop("checked",true);jQuery("#tb-copy-to-facebook-useYouTubeThumbnail").prop("checked",false)}else{jQuery("#addToTimeline").prop("checked",false)}jQuery(".tb-copy-to-facebook-video-settings-publish-options").hide();jQuery(".tb-copy-to-facebook-video-timezones").timezones();var b=jQuery(".tb-facebook-upload-progress-bar").css("width","0%");var h=jQuery(".tb-facebook-upload-progress-percent").html("");s=null;l=null;u=null;c=null;jQuery("#tb-copy-to-facebook-upload-input").val("");if(TBGlobal.Profile().LegacyEnabled==true){jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);jQuery(".tb-copy-to-facebook-upload-option").show();jQuery("input[name=facebook-upload-option][value=auto]").attr("checked","checked")}else{jQuery("input[name=facebook-upload-option][value=upload]").attr("checked","checked");jQuery(".tb-copy-to-facebook-upload-option").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] prepareDialog"})}};var G=function(e){try{jQuery(".tb-copy-to-facebook-loading-video").addClass("tb-hid");if(e==null){TBUtilities.Alert("There was an error loading your video.  Please try agian and if the error continues contact support@tubebuddy.com")}if(TBGlobal.Profile().LegacyEnabled==true&&e.contentDetails.durationInMinutes>=45){jQuery(".tb-copy-to-facebook-copy").addClass("tb-hid");jQuery(".tb-copy-to-facebook-length").removeClass("tb-hid")}else if(e.status.privacy=="public"||e.status.privacy=="unlisted"){jQuery(".tb-copy-to-facebook-video-loaded").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-video-settings-title").val(jQuery("<div>").html(e.snippet.title).text());var t=E(jQuery("<div>").html(e.snippet.description).text());jQuery(".tb-copy-to-facebook-video-settings-description").val(t);jQuery(".tb-copy-to-facebook-copy").removeClass("tb-hid");a=e.snippet.thumbnails.thumbnailHigh;r=e.fileDetails.FileName;if(r){jQuery(".tb-copy-to-facebook-upload-filename").text(r)}else{jQuery(".tb-copy-to-facebook-upload-filename-container").hide()}if(TBGlobal.Profile().LegacyEnabled==true){jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);jQuery(".tb-copy-to-facebook-upload-option").show();jQuery("input[name=facebook-upload-option][value=auto]").attr("checked","checked");jQuery(".tb-copy-to-facebook-validation").hide()}else{jQuery("input[name=facebook-upload-option][value=upload]").attr("checked","checked");jQuery(".tb-copy-to-facebook-upload-option").hide();jQuery(".tb-copy-to-facebook-validation").show()}}else{jQuery(".tb-copy-to-facebook-copy").addClass("tb-hid");jQuery(".tb-copy-to-facebook-private").removeClass("tb-hid");var i=window.location.href;if(i.indexOf("youtube.com/upload")>0){jQuery(".tb-copy-to-facebook-private-upload").removeClass("tb-hid")}else{jQuery(".tb-copy-to-facebook-private-upload").addClass("tb-hid")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] getVideoDetailsCallback"})}};var E=function(e){try{var t=e.indexOf(b);if(t>=0){var i=e.lastIndexOf(b);var a="";var r="";if(i>0&&i!=t){a=e.substring(0,t);r=e.substring(i+b.length,e.length)}else{r=e.substring(t+b.length,e.length)}e=a+r}}catch(e){TBUtilities.Log(e)}return e};var R=function(){jQuery(document.body).on("CRTBCopyToFacebookThumbnail",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);t.data.Thumbnail=i.Base64Data;B(t.data)}else{throw"Failed to convert thumbnail"}}catch(e){TBUtilities.LogError(e);w("There was a problem publishing your video to Facebook.  Please try again...")}});jQuery(document.body).on("CRTBCopyToFacebookPublishToFacebook",function(e,i){try{TBUtilities.Log("TubeBuddyCopyToFacebook - CRTBCopyToFacebookPublishToFacebook");TBUtilities.Log(i);jQuery(".tb-copy-to-facebook-settings-container").unblock();if(i.success){jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);jQuery(".tb-copy-to-facebook-video-loaded-step1").addClass("tb-hid");jQuery(".tb-copy-to-facebook-video-loaded-complete").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-copy").addClass("tb-hid");var a=jQuery(".tb-copy-to-facebook-accounts").val();var r=TBUtilities.GetInArray(t,"Id",a);jQuery(".tb-copy-to-facebook-video-loaded-complete-link").attr("href","https://www.facebook.com/"+r.ExternalId+"/videos/"+i.response.replace(/['"]+/g,""));jQuery(".tb-copy-to-facebook-video-loaded-complete-link").text("https://www.facebook.com/"+r.ExternalId+"/videos/"+i.response.replace(/['"]+/g,""));jQuery(".tb-copy-to-facebook-close").text("Close")}else{TBUtilities.Log("Failed to publish to FaceBook. Result: "+JSON.stringify(i));if(i.response==501){jQuery(".tb-copy-to-facebook-published-template-container").addClass("tb-hid");jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);jQuery(".tb-copy-to-facebook-autherror").removeClass("tb-hid")}else{throw"Failed to post to facebook"}}}catch(e){jQuery(".tb-copy-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-copy-to-facebook-copy").attr("disabled",false);Q("There was a problem publishing your video to Facebook.  Please try again later...");TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] CRTBCopyToFacebookPublishToFacebook"})}});jQuery(document.body).on("CRTBLoadCopyToFacebookTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);V()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] CRTBLoadCopyToFacebookTemplate"})}});jQuery(document.body).on("CRTBCopyToFacebookLoadAccounts",function(e,a){try{TBUtilities.Log("TubeBuddyCopyToFacebook - CRTBCopyToFacebookLoadAccounts");TBUtilities.Log(a);if(a.success){t=jQuery.parseJSON(a.response);if(t.length>0){jQuery(".tb-copy-to-facebook-none").addClass("tb-hid");jQuery(".tb-copy-to-facebook-start-container").removeClass("tb-hid");var r=jQuery(".tb-copy-to-facebook-accounts");r.empty();var o=null;jQuery.each(t,function(e,t){if(o==null&&t.SocialAccountType==1){o=t;r.append(jQuery("<option>").attr("value",t.Id).text(t.Name).prop("selected","selected"))}else{r.append(jQuery("<option>").attr("value",t.Id).text(t.Name))}});if(o!=null){jQuery("#tb-copy-to-facebook-thumbnailContainer").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-video-settings-publish-option-future").prop("disabled",false);jQuery(".tb-copy-to-facebook-video-settings-publish-option-draft").prop("disabled",false);jQuery("input[name=facebook-upload-option]").prop("disabled",false);jQuery(".tb-copy-to-facebook-copy").prop("disabled",false);jQuery("#tb-copy-to-facebook-upload-input").prop("disabled",false)}else{jQuery(".tb-copy-to-facebook-video-settings-publish-options").hide();jQuery(".tb-copy-to-facebook-video-settings-publish-option-now").prop("checked","checked");jQuery("#tb-copy-to-facebook-thumbnailContainer").addClass("tb-hid");jQuery(".tb-copy-to-facebook-video-settings-publish-option-future").prop("disabled",true);jQuery(".tb-copy-to-facebook-video-settings-publish-option-draft").prop("disabled",true);jQuery(".tb-copy-to-facebook-api-update").show();var n=moment();var s=moment.utc();var l=new Date(s.format());l.setHours(0,0,0,0);var u=new Date("2018-08-01T00:00:00");if(l>=u){jQuery(".tb-copy-to-facebook-copy").prop("disabled",true);jQuery("input[name=facebook-upload-option]").prop("disabled",true);jQuery("#tb-copy-to-facebook-upload-input").prop("disabled",true)}}TBYouTubeApi.GetVideoDetails(i,"snippet, contentDetails, status, fileDetails",G)}else{jQuery(".tb-copy-to-facebook-none").removeClass("tb-hid");jQuery(".tb-copy-to-facebook-start-container").addClass("tb-hid");jQuery(".tb-copy-to-facebook-copy").addClass("tb-hid")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] CRTBCopyToFacebookLoadAccounts"})}});jQuery(document.body).on("CRTBLoadLastPublish",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i!=""&&i!=null){var a=jQuery("#tb-copy-to-facebook-published-template").html();var r=a.formatTemplate(i);jQuery(".tb-copy-to-facebook-published-template-container").html(r)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyToFacebook] CRTBLoadLastPublish"})}})};var V=function(){S(i,a,o);v();T();TBGlobal.ClearUserDebugInfo()};return{Show:function(t,r,n){if(TBGlobal.IsAuthenticated()){i=t;a=r;o=n;if(!e){R();g();j();e=true}else{V()}}}}}();var TubeBuddyTagSorter=function(){var e=false;var t="";var i=[];var a=[];var r=0;var o=0;var n="fr";var s=null;var l=null;var u;var c;var d={id:"",term:"",rank:-1,date:""};var b;var a;var s;var h;var y=function(){var e=TBGlobal.host+"/ModuleManager/TagSorter/TagSorter?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/tagsorter.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/tagsorter.html"}TBExtension.Get(e,"CRTBLoadTagSorterTemplate")};var p=function(){jQuery(document).on("click",".tb-tag-sorter-close, .tb-tag-sorter-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-tag-sorter-container").hide()});jQuery(document).on("click",".tb-tag-sorter-apply",function(){var e=[];jQuery("#tb-tag-sorter-list").find("li").each(function(t,i){e.push(jQuery(this).find(".tb-tag-sorter-tag-name:first").text())});if(h&&typeof h==="function"){h(e)}else{if(s==null)TubeBuddyEditVideo.SetTags(e);else TubeBuddyUpload.SetTags(s,e)}TubeBuddyMenu.HideBackground();jQuery("#tb-tag-sorter-container").hide();try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.TagSorter_Sorted,"tagsorter")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TagSorter] [addAction]"})}});jQuery(document).on("click",".tb-tag-sorter-auto-sort",function(){jQuery("#tb-tag-sorter-list").empty();i.sort(function(e,t){var i=TBUtilities.GetInArray(a,"tag",e).rank;var r=TBUtilities.GetInArray(a,"tag",t).rank;if(i==null||i==0)i=999;else i=parseInt(i.toString().replace("#",""));if(r==null||r==0)r=999;else r=parseInt(r.toString().replace("#",""));i=parseInt(i);r=parseInt(r);return i==r?0:i>r?1:-1});var e=1;jQuery.each(i,function(t,i){var r="";var o=TBUtilities.GetInArray(a,"tag",i);if(o!=null){if(o.rank!=null&&o.rank!="")r='&nbsp;&nbsp;<span class="tb-tag-rank-value" style="background-color:#6CC861; color:white;line-height: 14px;font-size: 12px;padding: 1px 4px 1px 4px;border-radius: 2px;position: relative;font-family:"CircularStd-Bold", sans-serif;">'+o.rank+"</span>&nbsp;"}jQuery("#tb-tag-sorter-list").append('<li draggable="true"><span style="display:none; font-size:10px; font-weight:bold; background-color:#ffffcc; padding:1px;">(<span class="tb-tag-sorter-tag-order">'+e+"</span>|"+e+')</span> <span class="tb-tag-sorter-tag-name">'+i+"</span>"+r+"</li>");e++});$(".tb-sortable").sortable()});jQuery(document).on("click",".tb-tag-sorter",function(){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.tagsorter)});jQuery(document).on("sortupdate",".tb-sortable",function(e,t){var i=1;jQuery("#tb-tag-sorter-list").find("li").each(function(e,t){jQuery(this).find(".tb-tag-sorter-tag-order").text(i++)})});jQuery(document).on("click",".tb-sorter-remove-duplicates",function(e,t){jQuery(".tb-sorter-is-duplicate").remove();jQuery(this).remove();setTimeout(function(){jQuery(".tb-sorter-checkmark").fadeOut()},100)})};var m=function(){jQuery(document.body).on("CRTBLoadTagSorterTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!l){jQuery("body").append(t.response)}else{l.append(t.response)}g()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagSorter] CRTBLoadTagSorterTemplate"})}})};var f=function(e,t,r){try{i=e;a=t;s=r;jQuery("#tb-tag-sorter-list").empty();jQuery(".tb-sorter-auto-sort").hide();jQuery(".tb-sorter-remove-duplicates").hide();var o=1;var n=false;jQuery.each(i,function(e,a){var r="";var s=TBUtilities.GetInArray(t,"tag",a);if(s!=null){if(s.rank!=null&&s.rank!=""){r='&nbsp;&nbsp;<span class="tb-tag-rank-value" style="background-color:#6CC861; color:white;line-height: 14px;font-size: 12px;padding: 1px 4px 1px 4px;border-radius: 2px;position: relative;font-family:"CircularStd-Bold", sans-serif;">'+s.rank+"</span>&nbsp;";jQuery(".tb-sorter-auto-sort").show()}}var l=false;jQuery.each(i,function(t,i){if(e>t&&a.toLowerCase()==i.toLowerCase()){n=true;l=true}});if(!l)jQuery("#tb-tag-sorter-list").append('<li><span style="display:none; font-size:10px; font-weight:bold; background-color:#ffffcc; padding:1px;">(<span class="tb-tag-sorter-tag-order">'+o+"</span>|"+o+')</span> <span class="tb-tag-sorter-tag-name">'+a+"</span>"+r+"</li>");else jQuery("#tb-tag-sorter-list").append('<li class="tb-sorter-is-duplicate" style="background-color:#FA3535; color: white; "><span style="display:none; font-size:10px; font-weight:bold; background-color:#ffffcc; padding:1px;">(<span class="tb-tag-sorter-tag-order">'+o+"</span>|"+o+')</span> <span class="tb-tag-sorter-tag-name">'+a+"</span>"+r+"</li>");o++});if(n)jQuery(".tb-sorter-remove-duplicates").show();$(".tb-sortable").sortable();jQuery("#tb-tag-sorter-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] prepareDialog"})}};var g=function(){f(b,a,s)};return{Show:function(t,i,r,o,n){if(TBGlobal.IsAuthenticated()){b=t;a=i;s=r;h=o;if(n){l=n}else{l=null}if(!e||n&&jQuery(".tb-tag-sorter-modal").length===0){m();y();p();e=true}else{g()}}}}}();(function(e){var t,i=e();e.fn.sortable=function(a){var r=String(a);a=e.extend({connectWith:false},a);return this.each(function(){if(/^(enable|disable|destroy)$/.test(r)){var o=e(this).children(e(this).data("items")).attr("draggable",r=="enable");if(r=="destroy"){o.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s")}return}var n,s,o=e(this).children(a.items);var l=e("<"+(/^(ul|ol)$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');o.find(a.handle).mousedown(function(){n=true}).mouseup(function(){n=false});e(this).data("items",a.items);i=i.add(l);if(a.connectWith){e(a.connectWith).add(this).data("connectWith",a.connectWith)}o.attr("draggable","true").on("dragstart.h5s",function(i){if(a.handle&&!n){return false}n=false;var r=i.originalEvent.dataTransfer;r.effectAllowed="move";r.setData("Text","dummy");s=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){if(!t){return}t.removeClass("sortable-dragging").show();i.detach();if(s!=t.index()){t.parent().trigger("sortupdate",{item:t})}t=null}).not("a[href], img").on("selectstart.h5s",function(){this.dragDrop&&this.dragDrop();return false}).end().add([this,l]).on("dragover.h5s dragenter.h5s drop.h5s",function(r){if(!o.is(t)&&a.connectWith!==e(t).parent().data("connectWith")){return true}if(r.type=="drop"){r.stopPropagation();i.filter(":visible").after(t);t.trigger("dragend.h5s");return false}r.preventDefault();r.originalEvent.dataTransfer.dropEffect="move";if(o.is(this)){if(a.forcePlaceholderSize){l.height(t.outerHeight())}t.hide();e(this)[l.index()<e(this).index()?"after":"before"](l);i.not(l).detach()}else if(!i.is(this)&&!e(this).children(a.items).length){i.detach();e(this).append(l)}return false})})}})(jQuery);var TubeBuddySuggestedTags=function(){var t=false;var i=0;var a=[];var r=[];var o=[];var n;var s=[];var l=[];var u=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your","ain't","aren't","can't","could've","couldn't","didn't","doesn't","don't","hasn't","he'd","he'll","he's","how'd","how'll","how's","i'd","i'll","i'm","i've","isn't","it's","might've","mightn't","must've","mustn't","shan't","she'd","she'll","she's","should've","shouldn't","that'll","that's","there's","they'd","they'll","they're","they've","wasn't","we'd","we'll","we're","weren't","what'd","what's","when'd","when'll","when's","where'd","where'll","where's","who'd","who'll","who's","why'd","why'll","why's","won't","would've","wouldn't","you'd","you'll","you're","you've","http","https","com","net","org"];var c;var d;var b;var h;var y;var p;var m=function(){var e=TBGlobal.host+"/ModuleManager/SuggestedTags/SuggestedTags?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/suggestedtags.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/suggestedtags.html"}TBExtension.Get(e,"CRTBLoadSuggestedTagsTemplate")};var f=function(){jQuery(document).on("click",".tb-missing-token-oauth-relink",function(){var e=jstz.determine_timezone();var t=e.timezone;if(t!="undefined"){t.ambiguity_check()}var i=t.utc_offset;var a="";if(TBGlobal.Profile()!=null)a="&agencyid="+encodeURIComponent(TBGlobal.Profile().AgencyId);if(a==null)a="";var r=TBGlobal.host+"/oauth/AuthRedirect?channelid="+TBGlobal.CurrentChannelId()+"&redirectUrl="+encodeURIComponent(window.location)+"&timeZoneOffset="+encodeURIComponent(i)+a;window.location=r});jQuery(document).on("click",".tb-suggested-tags-upgrade-modal",function(){TBGlobal.ShowUpgradePage(null,"suggestedtags")});jQuery(document).on("dblclick",".tb-suggested-tags-header-expand-all",function(){jQuery(this).parent().parent().parent().find(".tb-suggested-tags-details").trigger("click")});jQuery(document).on("click",".tb-suggested-tags-close, .tb-suggested-tags-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-suggested-tags-container").hide()});jQuery(document).on("click",".suggested-tag",function(){var e=jQuery(this).attr("data-tag");if(e==null||e=="")return;jQuery(this).attr("src",TBGlobal.host+"/images/icons/check.png");jQuery(this).removeClass("suggested-tag");jQuery(this).addClass("suggested-tag-added");jQuery(this).parent().siblings(".tb-suggested-tags-tag").addClass("suggested-tag-added");if(p){p(e)}else{var t=b.parents(".basic-info-form-input");t.find(".video-settings-add-tag:first").val(e);t.find(".video-settings-add-tag:first").focus();t.find(".video-settings-title:first").focus();t.find(".video-settings-add-tag").trigger("blur")}if(jQuery("#tb-suggested-tags-inserted").is(":visible")==false){jQuery("#tb-suggested-tags-inserted").fadeIn().delay(3e3).fadeOut()}o.push(e)});jQuery(document).on("click",".tb-suggested-tags-details",function(){var e=jQuery(this).attr("data-tag");var t=jQuery(this).attr("data-tag-type");if(e==null||e=="")return;var i=".tb-suggested-tags-search-container";if(t=="related"){i=".tb-suggested-tags-related-container"}if(jQuery(this).attr("data-expanded")=="true"){jQuery(this).attr("data-expanded","false");var a=TBGlobal.host+"/images/icons/collapsed.png";jQuery(this).attr("src",a);var r=jQuery(i).find(".tb-suggested-tags-details-row[data-tag='"+e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")+"']");r.remove()}else{jQuery(this).attr("data-expanded","true");var a=TBGlobal.host+"/images/icons/expanded.png";jQuery(this).attr("src",a);var o=jQuery(i).find("tr[data-tag='"+e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")+"']");if(o){var n=null;var u=null;var d=null;var b=TBUtilities.CreateGuid();if(t=="related"){n=TBUtilities.GetInArray(l,"Tag",e);if(n){u=jQuery("#tb-suggested-tags-details-template-related").html().replace("<table>","").replace("</table>","").replace("<tbody>","").replace("</tbody>","")}}else{n=TBUtilities.GetInArray(s,"Tag",e);if(n){u=jQuery("#tb-suggested-tags-details-template-search").html().replace("<table>","").replace("</table>","").replace("<tbody>","").replace("</tbody>","")}}d=u.formatTemplate(e,b);if(d){o.after(d);v(e,i);var h=TBGlobal.host+TBGlobal.apiUrls.searchRankGetTagRankingsForToday;var y=jQuery.param({Tags:e,VideoId:c});TBExtension.Post(h,y,"CRSuggestedTagsGetTagRankingsForToday",b,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}}}})};var g=function(){o=[];jQuery(".yt-chip").each(function(){var e=jQuery(this).attr("title");if(e){o.push(e.toLowerCase())}})};var v=function(e,t){var i=jQuery("body")[0].outerHTML;var a=i.indexOf('PSUGGEST_TOKEN":"')+'PSUGGEST_TOKEN":"'.length;var r=i.indexOf('"',a);var o=i.substring(a,r);var n="https://clients1.google.com/complete/search?client=youtube&hl=en&gl=us&gs_rn=23&gs_ri=youtube&tok="+o+"&ds=yt&cp=15&gs_id=a&q="+TBUtilities.GetUrlEncoded(e)+"&callback=google.sbox.p50&gs_gbg=3no8d";TBExtension.Get(n,"CRGetRelatedTags",{tag:e,tagContainer:t})};var T=function(){i++;switch(i){case 1:{j();break}case 2:{w();break}case 3:{x();break}case 4:{var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGradeTags;TBExtension.Post(e,JSON.stringify(a),"CRTBSuggestedGradeTags","search",{contentType:"application/json"});break}case 5:{Q();break}case 6:{k();break}case 7:{B();break}case 8:{var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGradeTags;TBExtension.Post(e,JSON.stringify(r),"CRTBSuggestedGradeTags","related",{contentType:"application/json"});break}}};var j=function(){var e=TBUtilities.GetUrlParameter("video_id");if(!e)e=c;var t=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetVideoTrafficSearchTerms+"?videoId="+e;TBExtension.Get(t,"CRTBSuggestedTagsGetVideoTrafficSources")};var Q=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetChannelTrafficSearchTerms;TBExtension.Get(e,"CRTBSuggestedTagsGetChannelTrafficSources")};var k=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetVideoRelatedVideos+"?videoId="+c;TBExtension.Get(e,"CRTBSuggestedTagsGetRelatedVideos")};var B=function(){TBYouTubeApi.GetCurrentChannel(C)};var C=function(t){try{var i=t.Snippet.Title;var a=i.match(/\w+/g),o={},n=[],s,l;for(l=0;l<u.length;l++){o[u[l].trim()]=true}for(l=0;l<a.length;l++){s=a[l].trim().toLowerCase();if(!o[s]){n.push(s)}}for(l=0;l<n.length;l++){var c=n[l];if(c){r.push({Tag:c,Category:1,Source:"channelmeta",Views:null})}}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getCurrentChannelFromApiCallback"})}finally{T()}};var w=function(){var e=d.trim();e=e.replace("+","");e=e.replace("@","");e=e.replace("$","");e=e.replace("#","");e=e.replace("-","");e=e.replace('"',"");e=e.replace("*","");e=e.replace("..","");e=e.replace(/([\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2694-\u2697]|\uD83E[\uDD10-\uDD5D])/g,"");TubeBuddyYouTubeActions.GetSearchResults(c,e,A,1,null,undefined,"video")};var A=function(e){try{var t=TBGlobal.GetYouTubeUI();if(t=="default"&&e&&e.response&&e.response.indexOf('window["ytInitialData"]')>-1){t="material"}var i=new Array;switch(t){case"studio":case"material":{try{var r=e.response.indexOf('window["ytInitialData"] =');if(r!=-1){var o=TBUtilities.ParseResponseContextFromHtml(e.response);if(o.contents.twoColumnSearchResultsRenderer.primaryContents){var n=TBUtilities.GetVideoSearchCollectionIndex(o.contents.twoColumnSearchResultsRenderer.primaryContents.sectionListRenderer.contents);if(n!=null){jQuery.each(o.contents.twoColumnSearchResultsRenderer.primaryContents.sectionListRenderer.contents[n].itemSectionRenderer.contents,function(e,t){if(t.videoRenderer){i.push(t.videoRenderer.videoId)}})}}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getSearchResult material UI parse json"})}break}case"default":{var s=DOMPurify.sanitize(e.response,DOMPurifyConfig);jQuery(".item-section",s).find("li > div").each(function(){var e=jQuery(this).attr("data-context-item-id");if(e){i.push(e)}})}}if(i.length==0){T()}else{var l=0;jQuery.each(i,function(e,t){TubeBuddyYouTubeActions.GetVideoTags(t,function(e){jQuery.each(e,function(e,t){if(t.length>=2){a.push({Tag:t,Source:"videosearchresults",Views:null,Category:0})}});l++;if(l>=i.length){T()}})})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getSearchResult"})}};var x=function(){try{jQuery("#tb-suggested-tags-meta-loading").hide();var t=jQuery("#creator-editor-title-link").attr("title");var i=jQuery(".video-settings-description").text();if(typeof t==="undefined"){t=jQuery(".video-settings-title").val()}i=i.replace(/^(\[url=)?(https?:\/\/)?(www\.|\S+?\.)(\S+?\.)?\S+$\s*/gm,"");var r=t+i.substring(1,200);var o=r.match(/\w+/g),n={},s=[],l,c;for(c=0;c<u.length;c++){n[u[c].trim()]=true}for(c=0;c<o.length;c++){l=o[c].trim().toLowerCase();if(!n[l]){s.push(l)}}for(c=0;c<s.length;c++){var d=s[c];if(d){if(d.length>=2){a.push({Tag:d,Category:0,Source:"meta",Views:null})}}}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getUncommonWordsFromMeta"})}finally{T()}};var I=function(e,t,i,a){if(i>=0){var r={VideoId:c,SearchTerm:t,Rank:i};var o=jQuery.param({Rankings:[r]});var n=TBGlobal.host+TBGlobal.apiUrls.searchRankAddRankings;TBExtension.Post(n,o,"CRSuggestedTagsSearchRankingNOTUSED",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}if(i<=0){i="-"}var s=jQuery("#"+a);s.empty();s.append('<span style="color: #999; font-size:14px; line-height: 30px;" >Search Rank</span><br/>');s.append('<span">'+i+"</span>")};var U=function(){jQuery(document.body).on("CRTBSuggestedTagsGetTagScore",function(e,t){var i=null;try{if(t.success){i=jQuery.parseJSON(t.response)}i.sort(function(e,t){return t.Score-e.Score})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetTagScore"})}finally{h(i)}});jQuery(document.body).on("CRSuggestedTagsGetTagRankingsForToday",function(e,t){try{if(t.success){var i=JSON.parse(t.response);jQuery.each(i,function(e,i){if(i.Rank==-1){TubeBuddyYouTubeActions.GetVideoSearchRank(c,i.SearchTerm,function(e,i,a){I(c,i,a,t.data)})}else if(i.Rank>=0){I(c,i.SearchTerm,i.Rank,t.data)}})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRSuggestedTagsGetTagRankingsForToday"})}});jQuery(document.body).on("CRGetRelatedTags",function(e,t){try{if(t.success){var i=t.data.tag;var a=jQuery(t.data.tagContainer).find('td[data-origintag="'+i+'"]');var r=t.response.indexOf("[");var n=t.response.indexOf("{");var s=t.response.substring(r,n);s=TBUtilities.ReplaceAll(s,'"',"'");var l=s.match(/'[^']*'/g);a.empty();var u=0;var c=[];jQuery.each(l,function(e,t){if(u>=5){return false}var r=t.replace(/["']/g,"");r=r.replace("\\u0027","");r=r.replace("\\u0026","&");r=r.replace("&","&");if(r!=i&&c.indexOf(r)==-1){var n="suggested-tag";var s=TBGlobal.host+"/images/icons/add.png";if(o.indexOf(r)!=-1){n="suggested-tag-added";s=TBGlobal.host+"/images/icons/check.png"}var l=jQuery("#tb-suggested-tags-related-template").html();var d=l.formatTemplate(r,n,s);a.append(d);c.push(r);u++}});var d=jQuery(t.data.tagContainer).find('td[data-origintag="'+i+'"]');if(d.find(".tb-suggested-tags-tag").length==0){d.html('<span style="margin-top:5px;color: #999; font-size:14px; line-height: 30px">No Suggested Searches found</span>')}else{d.prepend('<span style="color: #999; font-size:14px; line-height: 30px;" >Auto-Suggested by YouTube Search</span><br/>')}}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRGetRelatedTags"})}});jQuery(document.body).on("CRTBLoadSuggestedTagsTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);L()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBLoadSuggestedTagsTemplate"})}});jQuery(document.body).on("CRTBSuggestedTagsGetVideoTrafficSources",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i.TrafficSearchTerms.length>0){jQuery.each(i.TrafficSearchTerms,function(e,t){if(t.SearchTerm.length>=2){a.push({Tag:t.SearchTerm,Source:"videosearchtraffic",Views:t.Views,Category:0})}})}}else{if(t.httpErrorCode==501){jQuery("#tb-suggested-tags-traffic-need-scope").show()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetVideoTrafficSources"})}finally{T()}});jQuery(document.body).on("CRTBSuggestedTagsGetChannelTrafficSources",function(e,t){try{jQuery("#tb-suggested-tags-related-loading").hide();if(t.success){var i=jQuery.parseJSON(t.response);if(i.TrafficSearchTerms.length>0){jQuery.each(i.TrafficSearchTerms,function(e,t){if(t.SearchTerm.length>=2){r.push({Tag:t.SearchTerm,Source:"channelsearchtraffic",Views:t.Views,Category:1})}})}}else{if(t.httpErrorCode==501){jQuery("#tb-suggested-tags-need-scope").show()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetVideoTrafficSources"})}finally{T()}});jQuery(document.body).on("CRTBSuggestedTagsGetRelatedVideos",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);var a=0;jQuery.each(i,function(e,t){TubeBuddyYouTubeActions.GetVideoTags(t.id,function(e){jQuery.each(e,function(e,t){if(t.length>=2){r.push({Tag:t,Category:1,Source:"relatedvideos",Views:null})}});a++;if(a>=i.length){T()}})})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetRelatedVideos"})}});jQuery(document.body).on("CRTBSuggestedGradeTags",function(e,t){try{if(t.success){if(t.data=="search"){jQuery("#tb-suggested-tags-search-body").empty()}else{jQuery("#tb-suggested-tags-related-body").empty()}var i=jQuery.parseJSON(t.response);var a=jQuery("#tb-suggested-tags-row-template").html().replace("<table>","").replace("</table>","").replace("<tbody>","").replace("</tbody>","");a=TBUtilities.FixLocalHtml(a);jQuery.each(i.GradedTags,function(e,i){if(i.Tag.length>=2){var r="display:none";if(i.IsCensored===true){r=""}var n="suggested-tag";var s=TBGlobal.host+"/images/icons/add.png";if(o.indexOf(i.Tag)!=-1){n="suggested-tag-added";s=TBGlobal.host+"/images/icons/check.png"}if(t.data=="search"){var l=i.Views==null||i.Views==0?"-":TBUtilities.FormatNumberAbbreviated(i.Views);var u=i.TopRankingVideosOccurrences==null||i.TopRankingVideosOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.TopRankingVideosOccurrences);var c=i.WordUsedInMetaOccurrences==null||i.WordUsedInMetaOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.WordUsedInMetaOccurrences);var d=a.formatTemplate(i.Tag,n,s,l,u,c,t.data,r);jQuery("#tb-suggested-tags-search-body").append(d)}else{var l=i.Views==null||i.Views==0?"-":TBUtilities.FormatNumberAbbreviated(i.Views);var b=i.WordUsedInChannelMetaOccurrences==null||i.WordUsedInChannelMetaOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.WordUsedInChannelMetaOccurrences);var h=i.TopRelatedOccurrences==null||i.TopRelatedOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.TopRelatedOccurrences);var d=a.formatTemplate(i.Tag,n,s,l,h,b,t.data,r);jQuery("#tb-suggested-tags-related-body").append(d)}}});switch(t.data){case"search":{jQuery(".tb-suggested-tags-search-loading").hide();s=i.GradedTags;if(i.GradedTags.length>0){jQuery(".tb-suggested-tags-search-container").show();if(TBGlobal.CanAccessLevel1Tools()==false){if(jQuery(".tb-suggested-tags-search-container").find(".tb-suggested-tags-search-container-list-upgrade").length==0){jQuery("#tb-suggested-tags-search-table").after('<div class="tb-suggested-tags-related-container-list-upgrade" style="text-align:center;margin-top:2px; padding-top:5px; padding-bottom:5px; font-size:12px; line-height:15px;"><br>Only '+i.GradedTags.length+" of "+i.TotalResults+' total results are shown. <br><br>Please consider <a style="cursor:pointer" class="tb-suggested-tags-upgrade-modal">Upgrading your License</a> to see all results.<br><br><br></div>')}}}else{jQuery(".tb-suggested-tags-search-none").show()}break}case"related":{jQuery(".tb-suggested-tags-related-loading").hide();l=i.GradedTags;if(i.GradedTags.length>0){jQuery(".tb-suggested-tags-related-container").show();if(TBGlobal.CanAccessLevel1Tools()==false){if(jQuery(".tb-suggested-tags-related-container").find(".tb-suggested-tags-related-container-list-upgrade").length==0){jQuery("#tb-suggested-tags-related-table").after('<div class="tb-suggested-tags-related-container-list-upgrade" style="text-align:center;margin-top:2px; padding-top:5px; padding-bottom:5px; font-size:12px; line-height:15px;"><br>Only '+i.GradedTags.length+" of "+i.TotalResults+' total results are shown. <br><Br>Please consider <a style="cursor:pointer" class="tb-suggested-tags-upgrade-modal">Upgrading your License</a> to see all results.<br><br><br></div>')}}}else{jQuery(".tb-suggested-tags-related-none").show()}break}}}jQuery(".tb-suggested-tags-key").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedGradeTags"})}finally{T()}})};var L=function(){try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.SuggestedTags_Use,"suggestedtags")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] [addAction]"})}jQuery("#tb-suggested-tags-need-scope").hide();jQuery("#tb-suggested-tags-container").show();jQuery(".tb-suggested-tags-search-loading").show();jQuery(".tb-suggested-tags-search-container").hide();jQuery(".tb-suggested-tags-related-loading").show();jQuery(".tb-suggested-tags-related-container").hide();jQuery(".tb-suggested-tags-related-none").hide();jQuery(".tb-suggested-tags-search-none").hide();jQuery(".tb-suggested-tags-related-container-list-upgrade").remove();jQuery(".tb-suggested-tags-search-container-list-upgrade").remove();jQuery(".tb-suggested-tags-key").hide();if(typeof n==="undefined"||n==null){g()}else{o=n}i=0;T()};var S=function(e,t){h=t;y=e;var i=jQuery("body")[0].outerHTML;var a=i.indexOf('PSUGGEST_TOKEN":"')+'PSUGGEST_TOKEN":"'.length;var r=i.indexOf('"',a);var o=i.substring(a,r);var n=0;var s=[];var l=[];jQuery.each(e,function(e,t){if(t.split(" ").length>1){l.push(t)}});jQuery.each(l,function(t,i){TubeBuddyYouTubeActions.GetYouTubeAutoComplete(o,i,function(t){n++;if(t&&t.length>0){s.push.apply(s,t)}if(n>=l.length){var i=TBGlobal.GetPrefCookieObject();var a={Region:"us",Tags:[],Language:"en"};if(i&&i.gl){a.Region=i.gl}if(i&&i.hl){a.Language=i.hl}var r=[];jQuery.each(s,function(t,i){if(jQuery.inArray(i,r)===-1&&jQuery.inArray(i,e)===-1){r.push(i)}});a.Tags=r;var o=TBGlobal.host+TBGlobal.apiUrls.tagScoreGet;TBExtension.Post(o,JSON.stringify(a),"CRTBSuggestedTagsGetTagScore",null,{contentType:"application/json"})}})})};return{Show:function(e,i,s,l,u){if(TBGlobal.IsAuthenticated()){a=[];r=[];o=[];c=e;d=i;b=s;n=l;p=u;if(!t){U();m();f();t=true}else{L()}}},GetTagSuggestions:function(e,i){if(!t){U()}S(e,i)}}}();var TubeBuddySunsetVideo=function(){var e=false;var t=null;var i=null;var a=null;var r=null;var o=function(){var e=TBGlobal.host+"/ModuleManager/SunsetVideo/SunsetVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/sunsetvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/sunsetvideo.html"}TBExtension.Get(e,"CRTBLoadYouTubeVideoScheduledActionTemplate")};var n=function(){jQuery(document).on("change","#tb-video-scheduled-action-removeFromPlaylistOptions",function(e){var t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){jQuery("#tb-video-scheduled-action-removeFromAllPlaylists").prop("disabled",false);jQuery("#tb-video-scheduled-action-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-video-scheduled-action-removeFromPlaylistIds").prop("disabled",false);jQuery("#tb-sunset-playlist-options").show()}else{jQuery("#tb-video-scheduled-action-removeFromAllPlaylists").prop("disabled",true);jQuery("#tb-video-scheduled-action-removeFromPlaylistIds").prop("disabled",true);jQuery("#tb-video-scheduled-action-input-ids").val("");jQuery("#tb-video-scheduled-action-input-ids").prop("disabled",true);t.disable();jQuery("#tb-sunset-playlist-options").hide()}});jQuery(document).on("change","#tb-video-scheduled-action-removeFromPlaylistIds",function(e){var t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");console.log(jQuery(this).is(":checked"));if(jQuery(this).is(":checked")){jQuery("#tb-sunset-playlists-wrapper").show();t.enable()}else{console.log("not");t.disable();jQuery("#tb-sunset-playlists-wrapper").hide()}});jQuery(document).on("change","#tb-video-scheduled-action-removeFromAllPlaylists",function(e){var t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){jQuery("#tb-video-scheduled-action-input-ids").val("");jQuery("#tb-video-scheduled-action-input-ids").prop("disabled",true);jQuery("#tb-sunset-playlists-wrapper").hide();t.disable()}else{}});jQuery(document).on("click",".tb-video-scheduled-action-upgrade-link",function(e){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.videoScheduledAction)});jQuery(document).on("click","#tb-video-scheduled-action-timepicker",function(e){TBUtilities.Log("aa");if(jQuery("#tb-video-scheduled-action-edit").find(".tp-timepicker_wrap").length>0){TBUtilities.Log("cc");if(jQuery("#tb-video-scheduled-action-edit").find(".tp-timepicker_wrap")[0].outerHTML.indexOf("tb-pickr-midnight")==-1){TBUtilities.Log("dd");jQuery("#tb-video-scheduled-action-edit").find(".tp-timepicker_wrap").append('<div style="clear:both;"></div><div class="tb-pickr-midnight" style="border-top:solid 1px #ccc; padding-top:3px; padding-left:1px; margin:0px 5px;">Set to <a class="tb-pickr-set-to-midnight">Midnight</a></div>')}}TBUtilities.Log("bb")});jQuery(document).on("click",".tb-pickr-set-to-midnight",function(e){jQuery("#tb-video-scheduled-action-edit").find(".tp-meridian").find("input").val("AM");jQuery("#tb-video-scheduled-action-edit").find(".tp-time").find("input").val("12");jQuery("#tb-video-scheduled-action-edit").find(".tp-mins").find("input").val("00")});jQuery(document).on("click",".tb-video-scheduled-action-close, .tb-video-scheduled-action-closex",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-video-scheduled-action-container").hide()});jQuery(document).on("click",".tb-video-scheduled-action-cancel",function(e){try{TBUtilities.Confirm("Are you sure you want to cancel this Sunset Video?",function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosDeleteYouTubeVideoScheduledAction;var i={Id:t};TBExtension.Post(e,JSON.stringify(i),"CRTBYouTubeVideoScheduledActionDelete",null,{contentType:"application/json"})},function(){})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] cancel click"})}});jQuery(document).on("click",".tb-video-scheduled-action-save",function(e){var t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");var i=t.getSelectedPlaylistIds();i=TBUtilities.ReplaceAll(i.join(",")," ","");if(i==null)i="";var a=i.trim();if(a==""&&jQuery("#tb-video-scheduled-action-removeFromPlaylistIds").is(":checked")&&jQuery("#tb-video-scheduled-action-removeFromPlaylistOptions").is(":checked")){TBUtilities.Alert("There was a problem validating your playlists.  Please check your playlists and try again...")}else{s()}})};var s=function(){TBUtilities.AddAction(null,TBUtilities.ActionTypes.SunsetVideos_Schedule,"sunsetvideos");try{jQuery(".tb-video-scheduled-action-save").text("Scheduling...");jQuery(".tb-video-scheduled-action-save").attr("disabled",true);var e=jQuery('.tb-video-scheduled-action-privacy:first input[name="privacy"]:checked').val();var a=jQuery("#tb-video-scheduled-action-datepicker").val();var r=d(jQuery("#tb-video-scheduled-action-timepicker").val());var o=jQuery("#tb-video-scheduled-action-timepicker").val();var n=jQuery("#tb-video-scheduled-action-timezone-select").val();var s=jQuery("#tb-video-scheduled-action-removeFromPlaylistOptions").is(":checked");var l=jQuery("#tb-video-scheduled-action-removeFromAllPlaylists").is(":checked");var u=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");var c=u.getSelectedPlaylistIds();var b=c.join(",");if(s==false){l=false;b=""}var h=jQuery("#tb-video-scheduled-action-emailreminder").is(":checked");var y=jQuery("#tb-video-scheduled-action-emailreminder-now").is(":checked");var p={Id:t,Type:0,VideoId:i,ActionType:e,Date:a,Time:r,TimeZoneId:n,RemoveFromAllPlaylists:l,PlaylistIdsToRemoveFrom:b,SendWarningEmail:h,SendWarningEmailNow:y,TimeRecent:o};TBUtilities.Log(p);TBExtension.SetDbValue("tb-sunset-recent-"+TBGlobal.CurrentChannelId(),p);var m=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosAddYouTubeVideoScheduledAction;TBExtension.Post(m,JSON.stringify(p),"CRTBYouTubeVideoScheduledActionAdd",null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] save click"});jQuery(".tb-video-scheduled-action-save").text("Schedule Sunset");jQuery(".tb-video-scheduled-action-save").attr("disabled",false)}};var l=function(){TBExtension.GetDbValue("tb-sunset-recent-"+TBGlobal.CurrentChannelId(),"TBSunsetGetRecent")};var u=function(){if(TBGlobal.CanAccessLevel2Tools()==true){if(i){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetYouTubeVideoScheduledAction+"?videoId="+i+"&type=0";TBExtension.Get(e,"CRTBYouTubeVideoScheduledActionGet")}}else{jQuery("#tb-video-scheduled-action-upgrade").removeClass("tb-hid").show();jQuery("#tb-video-scheduled-action-loading").addClass("tb-hid").hide();jQuery(".tb-video-scheduled-action-save").addClass("tb-hid").hide()}};var c=function(e){try{t=e.Id;jQuery("#tb-video-scheduled-action-timezone-select").val(e.TimeZoneId);var i=jQuery("#tb-video-scheduled-action-currentTemplate").html();var a="No playlist changes";if(e.RemoveFromAllPlaylists==true){a="Video will be removed from <span><strong>all</strong> playlists</span>"}else if(e.PlaylistIdsToRemoveFrom!=null&&e.PlaylistIdsToRemoveFrom!=""){var r=e.PlaylistIdsToRemoveFrom.split(",");if(e.PlaylistHtmlToRemoveFrom&&e.PlaylistHtmlToRemoveFrom!="(none)"){a='<div style="display: inline-block;">'+e.PlaylistHtmlToRemoveFrom+"</div>"}else{jQuery.each(r,function(e,t){a='<strong style="font-size:13px;"><a target="_blank" href="https://www.youtube.com/playlist?list='+t+'">'+t+"</a></strong>"})}}var o="We'll send you an email reminder the day before";if(e.SendWarningEmail==false){o="No reminder"}var n=i.formatTemplate(e.ActionLabel,e.LocalDate,b(e.LocalTime),jQuery("#tb-video-scheduled-action-timezone-select option:selected").text(),a,o);jQuery("#tb-video-scheduled-action-current").html(n);jQuery("#tb-video-scheduled-action-current").removeClass("tb-hid").show();jQuery(".tb-video-scheduled-action-cancel").removeClass("tb-hid").show();jQuery("#tb-video-scheduled-action-edit").addClass("tb-hid").hide();jQuery(".tb-video-scheduled-action-save").addClass("tb-hid").hide();jQuery(".tb-video-scheduled-action-close").text("Close")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] setScheduledAction"})}};var d=function(e){var t=e.split(":");if(t.length!=3){throw"invalid time format"}var i=t[0];var a=t[1];if(t[2].trim()=="PM"&&t[0]!=12){i=parseInt(i,10);i=i+12}if(t[2].trim()=="AM"&&t[0]==12)i=0;var r=parseInt(i,10)*60+parseInt(a,10);return r};var b=function(e){var t=Math.floor(e/60);var e=e%60;var i=t>=12?"PM":"AM";t=t%12;t=t?t:12;e=e<10?"0"+e:e;var a=t+":"+e+" "+i;return a};var h=function(){jQuery(document.body).on("TBSunsetGetRecent",function(e,t){TBUtilities.Log("Got TBSunsetGetRecent");TBUtilities.Log(t);if(t&&t.value){if(new Date(t.value.Date)<new Date)t.value.Date=new Date;jQuery("#tb-video-scheduled-action-timezone-select").val(t.value.TimeZoneId);jQuery("#tb-video-scheduled-action-datepicker").datepick("setDate",t.value.Date);jQuery("#tb-video-scheduled-action-emailreminder").prop("checked",t.value.SendWarningEmail);jQuery("#tb-video-scheduled-action-emailreminder-now").prop("checked",t.value.SendWarningEmailNow);var i=jQuery('.tb-video-scheduled-action-privacy input[name="privacy"][value="'+t.value.ActionType+'"]');if(i){i.prop("checked",true)}jQuery("#tb-video-scheduled-action-timepicker").val(t.value.TimeRecent);jQuery("#tb-video-scheduled-action-timepicker").timepicki({start_time:[t.value.TimeRecent.substring(0,2),t.value.TimeRecent.substring(5,7),t.value.TimeRecent.substring(10,12).toUpperCase()],increase_direction:"up"})}});jQuery(document.body).on("CRTBYouTubeVideoScheduledActionDelete",function(e,t){if(t.success){jQuery(".tb-video-scheduled-action-cancel").addClass("tb-hid").hide();jQuery("#tb-video-scheduled-action-current").html("");jQuery("#tb-video-scheduled-action-current").addClass("tb-hid").hide();jQuery("#tb-video-scheduled-action-edit").removeClass("tb-hid").show();jQuery(".tb-video-scheduled-action-save").removeClass("tb-hid").show()}});jQuery(document.body).on("CRTBYouTubeVideoScheduledActionAdd",function(e,t){jQuery(".tb-video-scheduled-action-save").text("Schedule Sunset");jQuery(".tb-video-scheduled-action-save").attr("disabled",false);if(t.success){try{var i=jQuery.parseJSON(t.response);if(i.LocalDate!=null){c(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] CRTBYouTubeVideoScheduledActionAdd"})}}else{TBUtilities.Alert("There was a problem saving your request.  Please try again...")}});jQuery(document.body).on("CRTBYouTubeVideoScheduledActionGet",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);jQuery("#tb-video-scheduled-action-loading").addClass("tb-hid").hide();jQuery("#tb-video-scheduled-action-loaded").removeClass("tb-hid").show();jQuery(".tb-video-scheduled-action-save").removeClass("tb-hid").show();jQuery(".tb-video-scheduled-action-cancel").addClass("tb-hid").hide();var a=jQuery("#tb-video-scheduled-action-datepicker").datepick({minDate:new Date,onSelect:function(e){try{var t=$(this).val();var i=24*60*60*1e3;var a=Math.abs((new Date(t).getTime()-(new Date).getTime())/i);if(a<=1){jQuery("#tb-video-scheduled-action-emailreminder").attr("checked",false);jQuery("#tb-video-scheduled-action-emailreminder").attr("disabled",true)}else{jQuery("#tb-video-scheduled-action-emailreminder").attr("disabled",false)}}catch(e){}}});var r=new Date;var o=new Date(r);o.setDate(r.getDate()+2);jQuery("#tb-video-scheduled-action-datepicker").datepick("setDate",o);if(!jQuery("#tb-video-scheduled-action-timepicker").attr("data-timepicki-tim")){jQuery("#tb-video-scheduled-action-timepicker").val("09 : 30 : AM");jQuery("#tb-video-scheduled-action-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}var n=jQuery("#tb-video-scheduled-action-timezone-select");n.empty();jQuery(i.TimeZones).each(function(){n.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});try{var s=jstz.determine_timezone();var u=s.timezone;if(u!="undefined"){u.ambiguity_check()}jQuery.each(i.TimeZones,function(e,t){if(t.DisplayName.indexOf(u.utc_offset)>0){n.val(t.Id)}})}catch(e){}jQuery("#tb-video-scheduled-action-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-video-scheduled-action-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-video-scheduled-action-input-ids").prop("disabled",true);if(i.LocalDate!=null){c(i)}else{setTimeout(l,100)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] CRTBYouTubeVideoScheduledActionGet"})}});jQuery(document.body).on("CRTBLoadYouTubeVideoScheduledActionTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] CRTBLoadYouTubeVideoScheduledActionTemplate"})}})};var y=function(){jQuery("#tb-video-scheduled-action-container").show();jQuery("#tb-video-scheduled-action-loading").removeClass("tb-hid").show();jQuery("#tb-video-scheduled-action-loaded").addClass("tb-hid").hide();jQuery("#tb-video-scheduled-action-current").addClass("tb-hid").hide();jQuery(".tb-video-scheduled-action-cancel").addClass("tb-hid").hide();jQuery(".tb-video-scheduled-action-upgrade").addClass("tb-hid").hide();jQuery(".tb-video-scheduled-action-save").removeClass("tb-hid").show();jQuery("#tb-video-scheduled-action-edit").removeClass("tb-hid").show();jQuery(".tb-video-scheduled-action-save").addClass("tb-hid").hide();jQuery("#tb-video-scheduled-action-emailreminder").attr("disabled",false);jQuery("#tb-video-scheduled-action-input-ids").val("");jQuery("#tb-video-scheduled-action-emailreminder").attr("checked",true);jQuery("#tb-video-scheduled-action-video-thumbnail").attr("src",r);jQuery("#tb-video-scheduled-action-video-link").text(a);jQuery("#tb-video-scheduled-action-video-link").attr("href","https://www.youtube.com/watch?v="+i);jQuery(".tb-video-scheduled-action-close").text("Cancel");jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true});var e=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");e.disable();u()};return{Show:function(t,s,l){if(TBGlobal.IsAuthenticated()){i=t;a=s;r=l?l:"https://img.youtube.com/vi/"+i+"/mqdefault.jpg";if(!e){h();o();n();e=true}else{y()}}}}}();var TubeBuddyGoLiveVideo=function(){var e=false;var t=null;var i=null;var a=null;var r=null;var o=function(){var e=TBGlobal.host+"/ModuleManager/GoLiveVideo/GoLiveVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/golivevideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/golivevideo.html"}TBExtension.Get(e,"CRTBLoadGoLiveVideoTemplate")};var n=function(){jQuery(document.body).on("TBGoLiveGetRecent",function(e,t){TBUtilities.Log("Got TBGoLiveGetRecent");TBUtilities.Log(t);if(t&&t.value){if(new Date(t.value.Date)<new Date)t.value.Date=new Date;jQuery("#tb-go-live-video-timezone-select").val(t.value.TimeZoneId);jQuery("#tb-go-live-video-datepicker").datepick("setDate",t.value.Date);jQuery("#tb-go-live-video-emailreminder").prop("checked",t.value.SendWarningEmail);jQuery("#tb-go-live-video-emailreminder-now").prop("checked",t.value.SendWarningEmailNow);var i=jQuery('.tb-go-live-video-privacy input[name="privacy"][value="'+t.value.ActionType+'"]');if(i){i.prop("checked",true)}jQuery("#tb-go-live-timepicker").val(t.value.TimeRecent);jQuery("#tb-go-live-timepicker").timepicki({start_time:[t.value.TimeRecent.substring(0,2),t.value.TimeRecent.substring(5,7),t.value.TimeRecent.substring(10,12).toUpperCase()],increase_direction:"up"})}});jQuery(document).on("change","#tb-go-live-video-addToPlaylists",function(e){if(jQuery(this).is(":checked")){var t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");t.enable();jQuery("#tb-go-live-playlist-options").show()}else{var t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");t.disable();jQuery("#tb-go-live-playlist-options").hide()}});jQuery(document).on("click","#tb-go-live-timepicker",function(e){if(jQuery("#tb-go-live-video-edit").find(".tp-timepicker_wrap").length>0)if(jQuery("#tb-go-live-video-edit").find(".tp-timepicker_wrap")[0].outerHTML.indexOf("tb-pickr-midnight")==-1)jQuery("#tb-go-live-video-edit").find(".tp-timepicker_wrap").append('<div style="clear:both;"></div><div class="tb-pickr-midnight" style="border-top:solid 1px #ccc; padding-top:3px; padding-left:1px; margin:15px 5px 0px 5px;">Set to <a class="tb-pickr-set-to-midnight">Midnight</a></div>')});jQuery(document).on("click",".tb-pickr-set-to-midnight",function(e){jQuery("#tb-go-live-video-edit").find(".tp-meridian").find("input").val("AM");jQuery("#tb-go-live-video-edit").find(".tp-time").find("input").val("12");jQuery("#tb-go-live-video-edit").find(".tp-mins").find("input").val("00")});jQuery(document).on("click",".tb-go-live-video-upgrade-link",function(e){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.videoScheduledAction)});jQuery(document).on("click",".tb-go-live-video-close, .tb-go-live-video-closex",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-go-live-video").hide()});jQuery(document).on("click",".tb-go-live-video-cancel",function(e){try{TBUtilities.Confirm("Are you sure you want to cancel this Scheduled Publish?",function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosDeleteYouTubeVideoScheduledAction;var i={Id:t};TBExtension.Post(e,JSON.stringify(i),"CRTBGoLiveVideoDelete",null,{contentType:"application/json"})},function(){})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddyGoLiveVideo] cancel click"})}});jQuery(document).on("click",".tb-go-live-video-save",function(e){var t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");var i=t.getSelectedPlaylistIds();i=TBUtilities.ReplaceAll(i.join(",")," ","");if(i==null)i="";var a=i.trim();if(a==""&&jQuery("#tb-go-live-video-addToPlaylists").is(":checked")){TBUtilities.Alert("There was a problem validating your playlists.  Please check your playlists and try again...")}else{u()}})};var s=function(e){var t=e.split(":");if(t.length!=3){throw"invalid time format"}var i=t[0];var a=t[1];if(t[2].trim()=="PM"&&t[0]!=12){i=parseInt(i,10);i=i+12}if(t[2].trim()=="AM"&&t[0]==12)i=0;var r=parseInt(i,10)*60+parseInt(a,10);return r};var l=function(e){var t=Math.floor(e/60);var e=e%60;var i=t>=12?"PM":"AM";t=t%12;t=t?t:12;e=e<10?"0"+e:e;var a=t+":"+e+" "+i;return a};var u=function(){TBUtilities.AddAction(null,TBUtilities.ActionTypes.ScheduleGoLive_Schedule,"schedulegolive");try{jQuery(".tb-go-live-video-save").text("Scheduling...");jQuery(".tb-go-live-video-save").attr("disabled",true);var e=jQuery('.tb-go-live-video-privacy:first input[name="privacy"]:checked');var a=e.val();var r=jQuery("#tb-go-live-video-datepicker").val();var o=s(jQuery("#tb-go-live-timepicker").val());var n=jQuery("#tb-go-live-timepicker").val();var l=jQuery("#tb-go-live-video-timezone-select").val();var u=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");var c=u.getSelectedPlaylistIds();var d="";if(c.length>0){d=c.join(",")}var b=jQuery("#tb-go-live-video-emailreminder").is(":checked");var h=jQuery("#tb-go-live-video-emailreminder-now").is(":checked");var y={Id:t,VideoId:i,Type:1,ActionType:a,Date:r,Time:o,TimeZoneId:l,PlayListIdsToAddTo:d,SendWarningEmail:b,SendWarningEmailNow:h,TimeRecent:n};TBExtension.SetDbValue("tb-go-live-recent-"+TBGlobal.CurrentChannelId(),y);var p=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosAddYouTubeVideoScheduledAction;TBExtension.Post(p,JSON.stringify(y),"CRTBGoLiveVideoAdd",null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddyGoLiveVideo] save click"});jQuery(".tb-go-live-video-save").text("Schedule Publish");jQuery(".tb-go-live-video-save").attr("disabled",false)}};var c=function(){if(TBGlobal.CanAccessLevel2Tools()==true){if(i){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetYouTubeVideoScheduledAction+"?videoId="+i+"&type=1";TBExtension.Get(e,"CRTBGoLiveVideoGet")}}else{jQuery("#tb-go-live-video-upgrade").removeClass("tb-hid").show();jQuery("#tb-go-live-video-loading").addClass("tb-hid").hide();jQuery(".tb-go-live-video-save").addClass("tb-hid").hide()}};var d=function(){TBExtension.GetDbValue("tb-go-live-recent-"+TBGlobal.CurrentChannelId(),"TBGoLiveGetRecent")};var b=function(e){try{t=e.Id;jQuery("#tb-go-live-video-timezone-select").val(e.TimeZoneId);var i=jQuery("#tb-go-live-video-currentTemplate").html();var a="No playlist changes";if(e.PlaylistIdsToAddTo!=null&&e.PlaylistIdsToAddTo!=""){var r=e.PlaylistIdsToAddTo.split(",");if(e.PlaylistHtmlToAddTo&&e.PlaylistHtmlToAddTo!="(none)"){a='<div style="display: inline-block;">'+e.PlaylistHtmlToAddTo+"</div>"}else{jQuery.each(r,function(e,t){a='<strong style="font-size:13px;"><a target="_blank" href="https://www.youtube.com/playlist?list='+t+'">'+t+"</a></strong><br>"})}}var o="We'll send you an email reminder the day before.";if(e.SendWarningEmail==false){o="No reminder"}var n=i.formatTemplate(e.ActionLabel,e.LocalDate,l(e.LocalTime),jQuery("#tb-go-live-video-timezone-select option:selected").text(),a,o);jQuery("#tb-go-live-video-current").html(n);jQuery("#tb-go-live-video-current").removeClass("tb-hid").show();jQuery(".tb-go-live-video-cancel").removeClass("tb-hid").show();jQuery("#tb-go-live-video-edit").addClass("tb-hid").hide();jQuery(".tb-go-live-video-save").addClass("tb-hid").hide();jQuery(".tb-go-live-video-close").text("Close")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddyGoLiveVideo] setScheduledAction"})}};var h=function(){jQuery(document.body).on("CRTBGoLiveVideoDelete",function(e,t){if(t.success){jQuery(".tb-go-live-video-cancel").addClass("tb-hid").hide();jQuery("#tb-go-live-video-current").html("");jQuery("#tb-go-live-video-current").addClass("tb-hid").hide();jQuery("#tb-go-live-video-edit").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").removeClass("tb-hid").show()}});jQuery(document.body).on("CRTBGoLiveVideoAdd",function(e,t){jQuery(".tb-go-live-video-save").text("Schedule Publish");jQuery(".tb-go-live-video-save").attr("disabled",false);if(t.success){try{var i=jQuery.parseJSON(t.response);if(i.LocalDate!=null){b(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddyGoLiveVideo] CRTBGoLiveVideoAdd"})}}else{TBUtilities.Alert("There was a problem saving your request.  Please try again...")}});jQuery(document.body).on("CRTBGoLiveVideoGet",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);jQuery("#tb-go-live-video-loading").addClass("tb-hid").hide();jQuery("#tb-go-live-video-loaded").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").removeClass("tb-hid").show();var a=jQuery("#tb-go-live-video-datepicker").datepick({minDate:new Date,onSelect:function(e){try{var t=$(this).val();var i=24*60*60*1e3;var a=Math.abs((new Date(t).getTime()-(new Date).getTime())/i);if(a<=1){jQuery("#tb-go-live-video-emailreminder").attr("checked",false);jQuery("#tb-go-live-video-emailreminder").attr("disabled",true)}else{jQuery("#tb-go-live-video-emailreminder").attr("disabled",false)}}catch(e){TBUtilities.Log(e)}}});var r=new Date;var o=new Date(r);o.setDate(r.getDate()+2);jQuery("#tb-go-live-video-datepicker").datepick("setDate",o);if(!jQuery("#tb-go-live-timepicker").attr("data-timepicki-tim")){jQuery("#tb-go-live-timepicker").val("09 : 30 : AM");jQuery("#tb-go-live-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}var n=jQuery("#tb-go-live-video-timezone-select");n.empty();jQuery(i.TimeZones).each(function(){n.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});try{var s=jstz.determine_timezone();var l=s.timezone;if(l!="undefined"){l.ambiguity_check()}jQuery.each(i.TimeZones,function(e,t){if(t.DisplayName.indexOf(l.utc_offset)>0){n.val(t.Id)}})}catch(e){TBUtilities.Log(e)}jQuery("#tb-go-live-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-go-live-video-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-go-live-video-input-ids").prop("disabled",true);if(i.LocalDate!=null){b(i)}else{setTimeout(d,100)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddyGoLiveVideo] CRTBGoLiveVideoGet"})}});jQuery(document.body).on("CRTBLoadGoLiveVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyGoLiveVideo] CRTBLoadGoLiveVideoTemplate"})}})};var y=function(){jQuery("#tb-go-live-video-container").show();jQuery("#tb-go-live-video-loading").removeClass("tb-hid").show();jQuery("#tb-go-live-video-loaded").addClass("tb-hid").hide();jQuery("#tb-go-live-video-current").addClass("tb-hid").hide();jQuery(".tb-go-live-video-cancel").addClass("tb-hid").hide();jQuery(".tb-go-live-video-upgrade").addClass("tb-hid").hide();jQuery(".tb-go-live-video-save").removeClass("tb-hid").show();jQuery("#tb-go-live-video-edit").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").addClass("tb-hid").hide();jQuery("#tb-go-live-video-emailreminder").attr("disabled",false);jQuery("#tb-go-live-video-input-ids").val("");jQuery("#tb-go-live-video-thumbnail").attr("src",r);jQuery("#tb-go-live-video-title").text(a);jQuery("#tb-go-live-video-title").attr("href","https://www.youtube.com/watch?v="+i);jQuery(".tb-go-live-video-close").text("Cancel");jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true});c()};return{Show:function(t,s,l){if(TBGlobal.IsAuthenticated()){i=t;a=s;r=l?l:"https://img.youtube.com/vi/"+i+"/mqdefault.jpg";if(!e){h();o();n();e=true}else{y()}}}}}();var TubeBuddyEnhancementsVideo=function(){var e=false;var t=function(){};var i=function(){var e=TBGlobal.host+"/ModuleManager/EnhancementsVideo/EnhancementsVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/enhancementsvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/enhancementsvideo.html"}TBExtension.Get(e,"CRTBLoadEnhancementsVideoTemplate")};var a=function(){};var r=function(){jQuery(document.body).on("CRTBLoadEnhancementsVideoTemplate",function(e,i){try{if(i.success){i.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i.response,DOMPurifyConfig));jQuery("body").append(i.response);t()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEnhancementsVideo] CRTBLoadEnhancementsVideoTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){r();i();a();e=true}else{t()}}}}}();var TubeBuddyAudioVideo=function(){var e=false;var t=function(){};var i=function(){var e=TBGlobal.host+"/ModuleManager/AudioVideo/AudioVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/audiovideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/audiovideo.html"}TBExtension.Get(e,"CRTBLoadAudioVideoTemplate")};var a=function(){};var r=function(){jQuery(document.body).on("CRTBLoadAudioVideoTemplate",function(e,i){try{if(i.success){i.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i.response,DOMPurifyConfig));jQuery("body").append(i.response);t()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAudioVideo] CRTBLoadAudioVideoTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){r();i();a();e=true}else{t()}}}}}();var TubeBuddyAnnotationsVideo=function(){var e=false;var t=null;var i=function(e,t){if(jQuery(".creator-editor-content").find(".tb-edit-video-annotations-container").length==0){jQuery(".creator-editor-content").after(jQuery(".tb-edit-video-annotations-container:last")[0].outerHTML);if(t)jQuery(".tb-video-annotations-title-input").val(t);else jQuery(".tb-video-annotations-title-input").val(jQuery("#creator-editor-title-link").attr("title"));if(e){jQuery(".tb-edit-video-annotations-template").prop("checked",true);jQuery(".tb-video-annotations-title-input").prop("disabled",false)}else{jQuery(".tb-edit-video-annotations-template").prop("checked",false);jQuery(".tb-video-annotations-title-input").prop("disabled",true)}}jQuery("#annotator-button-add").after(jQuery(".tb-edit-video-annotations-options-container:first")[0].outerHTML)};var a=function(){var e=TBGlobal.host+"/ModuleManager/AnnotationsVideo/AnnotationsVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/annotationsvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/annotationsvideo.html"}TBExtension.Get(e,"CRTBLoadAnnotationsVideoTemplate")};var r=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideo+"?videoid="+TBUtilities.GetUrlParameter("v");TBExtension.Get(e,"CRTBEditVideoAnnotationsLoadVideo",null)};var o=function(){jQuery(".tb-edit-video-annotations-working").show();TBYouTubeApi.GetVideoDetails(TBUtilities.GetUrlParameter("v"),null,n)};var n=function(e){TubeBuddyYouTubeActions.GetAnnotations(e,s)};var s=function(e){TubeBuddyYouTubeActions.DeleteAnnotations(TBUtilities.GetUrlParameter("v"),e,l)};var l=function(){jQuery(".tb-edit-video-annotations-working").hide();TBUtilities.Alert("Annotations successfully cleared!\n\nWe need to re-load the page for the changes to take effect.",function(){location.reload()})};var u=function(){jQuery(document).on("click",".tb-edit-video-annotations-apply-annotations-template",function(){TBUtilities.Alert("Sorry but YouTube has removed the ability to add or update Annotations. They are requesting that you use Cards or End Screens instead.");return;if(movie_player){movie_player.stopVideo()}TubeBuddyMenu.ShowBackgroundSticky();var e=TBUtilities.GetUrlParameter("v");var t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyAnnotationTemplates.Show(e,t,i)});jQuery(document).on("click",".tb-edit-video-annotations-clear-annotations",function(){if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all Annotations from this video?"))o()}else{TBUtilities.Confirm("Are you sure you want to remove all Annotations from this video?",o,null)}});jQuery(document).on("change",".tb-edit-video-annotations-template",function(){c()});jQuery(document).on("change",".tb-video-annotations-title-input",function(){c()});jQuery(document).on("keyup",".tb-video-annotations-title-input",function(e){if(e.keyCode==13){c()}})};var c=function(){try{TBUtilities.Log("TubeBuddyAnnotationsVideo - saveTemplateChanges");var e=jQuery(".tb-edit-video-annotations-template").prop("checked");var t=TBUtilities.GetUrlParameter("v");if(e&&!jQuery(".tb-video-annotations-title-input").val())jQuery(".tb-video-annotations-title-input").val(jQuery("#creator-editor-title-link").attr("title"));title=jQuery(".tb-video-annotations-title-input").val();var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleAnnotationTemplate;var a={Id:t,Enabled:e,Title:title};TBUtilities.Log(a);TBExtension.Post(i,JSON.stringify(a),"CRTBLoadEditVideoAnnotationsTemplateToggle",null,"application/json");jQuery(".tb-video-annotations-title-input").prop("disabled",!e);jQuery(".tb-video-annotations-changes-saved").hide();jQuery(".tb-video-annotations-changes-saved").show().delay(2e3).fadeOut()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsVideo] saveTemplateChanges"})}};var d=function(){jQuery(document.body).on("CRTBLoadAnnotationsVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);r()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsVideo] CRTBLoadAnnotationsVideoTemplate"})}});jQuery(document.body).on("CRTBEditVideoAnnotationsLoadVideo",function(e,a){try{TBUtilities.Log("TubeBuddyAnnotationsVideo - CRTBEditVideoAnnotationsLoadVideo callback");TBUtilities.Log(a);if(a.success){t=jQuery.parseJSON(a.response);i(t.IsAnnotationTemplate,t.AnnotationTemplateName)}else{jQuery(".tb-video-annotations-title-input").val(jQuery("#creator-editor-title-link").attr("title"));jQuery(".tb-edit-video-annotations-template").prop("checked",false);jQuery(".tb-video-annotations-title-input").prop("disabled",true)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsVideo] CRTBEditVideoAnnotationsLoadVideo"})}});jQuery(document.body).on("CRTBLoadEditVideoAnnotationsTemplateToggle",function(e,t){try{TBUtilities.Log("TubeBuddyAnnotationsVideo - CRTBLoadEditVideoAnnotationsTemplateToggle callback");TBUtilities.Log(t)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyAnnotationsVideo] CRTBLoadEditVideoAnnotationsTemplateToggle"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){d();a();u();e=true}}}}}();var TubeBuddyCardsVideo=function(){var e=false;var t=null;var i=null;var a=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideo+"?videoid="+TBUtilities.GetUrlParameter("v");TBExtension.Get(e,"CRTBEditVideoCardsLoadVideo",null)};var r=function(e,t){if(jQuery(".creator-editor-content").find(".tb-edit-video-cards-container").length==0){jQuery(".creator-editor-content").after(jQuery(".tb-edit-video-cards-container:last")[0].outerHTML);if(t)jQuery(".tb-video-cards-title-input").val(t);else jQuery(".tb-video-cards-title-input").val(jQuery("#creator-editor-title-link").attr("title"));if(e){jQuery(".tb-edit-video-cards-template").prop("checked",true);jQuery(".tb-video-cards-title-input").prop("disabled",false)}else{jQuery(".tb-edit-video-cards-template").prop("checked",false);jQuery(".tb-video-cards-title-input").prop("disabled",true)}}jQuery(".annotator-learn-more-container").after(jQuery(".tb-edit-video-cards-options-container:first")[0].outerHTML)};var o=function(){var e=TBGlobal.host+"/ModuleManager/CardsVideo/CardsVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/cardsvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/cardsvideo.html"}TBExtension.Get(e,"CRTBLoadCardsVideoTemplate")};var n=function(){jQuery(document).on("click",".tb-edit-video-cards-apply-cards-template",function(){TubeBuddyMenu.ShowBackgroundSticky();var e=TBUtilities.GetUrlParameter("v");var t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyCardTemplates.Show(e,t,i)});jQuery(document).on("click",".tb-edit-video-cards-clear-cards",function(){if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all Cards from this video?"))s()}else{TBUtilities.Confirm("Are you sure you want to remove all Cards from this video?",s,null)}});jQuery(document).on("change",".tb-edit-video-cards-template",function(){var e=jQuery(this).is(":checked");var t=TBUtilities.GetUrlParameter("v");var i=jQuery("#creator-editor-title-link").attr("title");var a=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleCardTemplate;var r={Id:t,Enabled:e,Title:i};TBExtension.Post(a,JSON.stringify(r),"CRTBLoadEditVideoCardsTemplateToggle",null,{contentType:"application/json"});if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.CardTemplates_Apply,"cardtemplates")});jQuery(document).on("change",".tb-edit-video-cards-template",function(){l()});jQuery(document).on("change",".tb-video-cards-title-input",function(){l()});jQuery(document).on("keyup",".tb-video-cards-title-input",function(e){if(e.keyCode==13){l()}})};var s=function(){jQuery(".tb-edit-video-cards-working").show();if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}TBUtilities.Log("Session token ="+i);TubeBuddyYouTubeActions.DeleteAllCards(TBUtilities.GetUrlParameter("v"),i,TubeBuddyCardsVideo.DeleteAllCardsCallBack)};var l=function(){try{TBUtilities.Log("TubeBuddyCardsVideo - saveTemplateChanges");var e=jQuery(".tb-edit-video-cards-template").prop("checked");var t=TBUtilities.GetUrlParameter("v");if(e&&!jQuery(".tb-video-cards-title-input").val())jQuery(".tb-video-cards-title-input").val(jQuery("#creator-editor-title-link").attr("title"));var i=jQuery(".tb-video-cards-title-input").val();var a=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleCardTemplate;var r={Id:t,Enabled:e,Title:i};TBUtilities.Log(r);TBExtension.Post(a,JSON.stringify(r),"CRTBLoadEditVideoCardTemplateToggle",null,{contentType:"application/json"});jQuery(".tb-video-cards-title-input").prop("disabled",!e);jQuery(".tb-video-cards-changes-saved").hide();jQuery(".tb-video-cards-changes-saved").show().delay(2e3).fadeOut();if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.CardTemplates_Apply,"cardtemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] saveTemplateChanges"})}};var u=function(){jQuery(document.body).on("CRTBLoadCardsVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);a()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBLoadCardsVideoTemplate"})}});jQuery(document.body).on("CRTBEditVideoCardsLoadVideo",function(e,i){try{if(i.success){t=jQuery.parseJSON(i.response);r(t.IsCardTemplate,t.CardTemplateName)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBEditVideoCardsLoadVideo"})}});jQuery(document.body).on("CRTBLoadEditVideoCardTemplateToggle",function(e,t){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBLoadEditVideoCardsTemplateToggle"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();o();n();e=true}}},DeleteAllCardsCallBack:function(){jQuery(".tb-edit-video-cards-working").hide();TBUtilities.Alert("Cards successfully cleared!\n\nWe need to re-load the page for the changes to take effect. Any unsaved changes on this page will be lost. ",function(){location.reload()})}}}();var TubeBuddyBackup=function(){var e=false;var t="";var i=0;var a;var r;var o;var n=function(){var e=TBGlobal.host+"/ModuleManager/backup/backup?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/backup.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/backup.html"}TBExtension.Get(e,"CRTBLoadBackupTemplate")};var s=function(){jQuery(document).on("click","#tb-backup-start-button",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("initiate a channel backup","channelbackup");return}var e=false;if($("input[name=tb-backupType]:checked").val()==1)e=true;var t=TBGlobal.host+TBGlobal.apiUrls.youtubeChannelKickOffExport+"?partial="+e;TBExtension.Post(t,null,"CRTBBackupKickoffComplete",null)});jQuery(document).on("click",".tb-backup-download",function(){if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("download your backup to CSV","channelbackup");return false}});jQuery(document).on("click",".tb-backup-download",function(){var e=document.createElement("form");e.target="_blank";e.method="POST";e.action=TBGlobal.host+"/youtubechannel/downloadbackup";var t=document.createElement("input");t.type="hidden";t.name="ChannelId";t.value=TBGlobal.CurrentChannelId();var i=document.createElement("input");i.type="hidden";i.name="Token";i.value=TBGlobal.GetToken();e.appendChild(t);e.appendChild(i);document.body.appendChild(e);e.submit()})};var l=function(e){jQuery("#tb-backup-thumbnail").attr("src",e.Snippet.Thumbnails.ThumbnailDefault);jQuery("#tb-backup-name").text(e.Snippet.Title);jQuery("#tb-backup-loading-count-total").text(TBUtilities.FormatNumberWithCommas(e.Statistics.VideoCount));t=e.id;i=e.Statistics.VideoCount;jQuery("#tb-backup-loading-channel").hide();jQuery("#tb-backup-loaded-channel").show()};var u=function(e){jQuery("#tb-backup-videos-count").text(TBUtilities.FormatNumberWithCommas(e.length)+" Videos")};var c=function(){TBYouTubeApi.GetChannelDetails(TBGlobal.CurrentChannelId(),null,l)};var d=function(){TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,u)};var b=function(){jQuery("#tb-backup-container").show();jQuery("#tb-backup-loading-channel").show();jQuery("#tb-backup-loaded-channel").hide();c();d()};var h=function(){};var y=function(){jQuery(document.body).on("CRTBLoadBackupTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBackup] CRTBLoadBackupTemplate"})}});jQuery(document.body).on("CRTBBackupKickoffComplete",function(e,t){try{if(t.success){if(t.response.length=='"493E38C7-75D6-4786-841B-1AD9C5E7F4F1"'.length){jQuery("#tb-backup-before-start").hide();jQuery("#tb-channel-info").addClass("tb-margin-top-40").removeClass("tb-margin-top-10");jQuery("#tb-backup-status").fadeIn("5000");jQuery("#tb-backup-status-link").attr("href",TBGlobal.host+"/channel/backup/"+TBGlobal.CurrentChannelId());jQuery("#tb-backup-status-link").text(TBGlobal.host+"/channel/backup/"+TBGlobal.CurrentChannelId())}else{TBUtilities.Alert("ERROR<br><Br> "+t.response)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBackup] CRTBBackupKickoffComplete"})}})};return{Show:function(t,i,l){if(TBGlobal.IsAuthenticated()){o=l;a=t;r=i;if(!e){y();n();s();e=true}else{b(a,r,o)}}}}}();var TubeBuddySubtitlesAndCCVideo=function(){var e=false;var t=function(){};var i=function(){var e=TBGlobal.host+"/ModuleManager/SubtitlesAndCCVideo/SubtitlesAndCCVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/subtitlesandvccideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/subtitlesandvccideo.html"}TBExtension.Get(e,"CRTBLoadSubtitlesAndCCVideoTemplate")};var a=function(){};var r=function(){jQuery(document.body).on("CRTBLoadSubtitlesAndCCVideoTemplate",function(e,i){try{if(i.success){i.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i.response,DOMPurifyConfig));jQuery("body").append(i.response);t()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySubtitlesAndCCVideo] CRTBLoadSubtitlesAndCCVideoTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){r();i();a();e=true}else{t()}}}}}();var TubeBuddyCTRCenter=function(){var e=false;var t={Videos:[],totals:[]};var i="All";var a="CtrAsc";var r="Lifetime";var o="All";var n=0;var s=[];var l;var u;var c="";var d=0;var b=0;var h={Videos:[],numVideosToExamine:25,daysToAnalyze:7,ChannelId:TBGlobal.CurrentChannelId()};var y=function(){var e=TBGlobal.host+"/ModuleManager/ctrcenter/ctrcenter?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/ctrcenter.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/ctrcenter.html"}TBExtension.Get(e,"CRTBLoadCTRCenterTemplate")};var p=function(e){b++;jQuery("#ctr-debug-text").val(jQuery("#ctr-debug-text").val()+b+") "+e+"\n\n")};var m=function(e){return new Promise(function(t,i){try{TBUtilities.Log("outside row XX");if(e.Videos.length>0&&e.Videos[0].DailyAnalytics){t(e);return}TBUtilities.Log("outside row YY");p("Getting first 7 day videos...");var a=e.Videos.length;var r=0;L("Getting 7 Day Stats CTR Data");jQuery.each(e.Videos,function(i,o){TBUtilities.Log("outside row ZZ");var n=[TBApiMetrics.VIEWS,TBApiMetrics.TOTAL_ESTIMATED_EARNINGS,TBApiMetrics.SUBSCRIBERS_NET_CHANGE,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.RATINGS_LIKES,TBApiMetrics.COMMENTS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR];p("Getting beActions.AnalyticsGetDailyVideoTotals(item.Id, moment(item.Dat...");TubeBuddyYouTubeActions.AnalyticsGetDailyVideoTotals(o.Id,moment(o.DatePublished).clone().add(-1,"days"),moment(o.DatePublished).clone().add(10,"days"),n).then(function(i){r++;TBUtilities.Log("outside row FFF");o.DailyAnalytics=[];jQuery.each(i.resultData,function(t,i){console.log("WITh watchwtime");console.log(i);if(!i.VIDEO_THUMBNAIL_IMPRESSIONS)i.VIDEO_THUMBNAIL_IMPRESSIONS=0;if(!i.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)i.VIDEO_THUMBNAIL_IMPRESSIONS_VTR=0;var a={Date:new Date(i.Date),Views:i.VIEWS,Impressions:i.VIDEO_THUMBNAIL_IMPRESSIONS,WatchPercentage:i.AVERAGE_WATCH_PERCENTAGE,WatchTime:i.AVERAGE_WATCH_TIME,Ctr:100*i.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(i.VIDEO_THUMBNAIL_IMPRESSIONS*i.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};TBUtilities.Log("outside row");if(o.DailyAnalytics.length<e.daysToAnalyze){TBUtilities.Log("added row");TBUtilities.Log(a);o.DailyAnalytics.push(a)}});if(r==a){t(e)}},function(i){r++;if(r==a){t(e)}})})}catch(i){p("EX: getDailyAnalyticsStats >>"+i);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR INNER - getDailyAnalyticsStats</b><p>"+i+"</p>");t(e)}})};var f=function(e){return new Promise(function(t,i){try{var a=e.Videos.length;var r=0;L("Getting 30-Day CTR Data");jQuery.each(e.Videos,function(i,o){var n=[TBApiMetrics.VIEWS,TBApiMetrics.TOTAL_ESTIMATED_EARNINGS,TBApiMetrics.SUBSCRIBERS_NET_CHANGE,TBApiMetrics.RATINGS_LIKES,TBApiMetrics.COMMENTS,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR];TubeBuddyYouTubeActions.AnalyticsGetDailyVideoTotals(o.Id,moment(new Date).clone().add(-31,"days"),moment(new Date).clone().add(0,"days"),n).then(function(i){r++;o.Last30Days=[];jQuery.each(i.resultData,function(e,t){TBUtilities.Log("HERE EARNINGS");TBUtilities.Log(t.TOTAL_ESTIMATED_EARNINGS);var i={Date:new Date(t.Date),Views:t.VIEWS,SubscribersNet:t.SUBSCRIBERS_NET_CHANGE,Earnings:t.TOTAL_ESTIMATED_EARNINGS,WatchPercentage:t.AVERAGE_WATCH_PERCENTAGE,WatchTime:t.AVERAGE_WATCH_TIME,Likes:t.RATINGS_LIKES,Comments:t.COMMENTS,Impressions:t.VIDEO_THUMBNAIL_IMPRESSIONS,CTR:100*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(t.VIDEO_THUMBNAIL_IMPRESSIONS*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};o.Last30Days.push(i)});if(r==a){t(e)}},function(i){r++;if(r==a){t(e)}})})}catch(e){p("EX: getFirst7DagetLast30DaysStatsysStats >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR - getLast30DaysStats</b><p>"+e+"</p>")}})};var g=function(e){return new Promise(function(t,i){try{if(e.Videos.length>0&&e.Videos[0].TrafficSourceAnalytics){t(e);return}var a=e.Videos.length;var r=0;L("Getting Traffic Sources CTR Data");p("Getting getTrafficSources");jQuery.each(e.Videos,function(i,o){try{var n=[TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR];r++;TubeBuddyYouTubeActions.AnalyticsGetSummaryVideoTrafficSourcesTotals(o.Id,moment(new Date).clone().add(-31,"days"),moment(new Date).clone().add(0,"days"),n).then(function(i){o.TrafficSourceAnalytics=[];jQuery.each(i.resultData,function(e,t){var i={VideoId:o.Id,TrafficSource:t.TrafficSource,Impressions:t.VIDEO_THUMBNAIL_IMPRESSIONS,CTR:100*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(t.VIDEO_THUMBNAIL_IMPRESSIONS*.01*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};TBUtilities.Log("analyticsRow >>>");o.TrafficSourceAnalytics.push(i)});TBUtilities.Log("c "+r+" > "+a);if(r==a){t(e)}},function(i){r++;if(r==a){t(e)}})}catch(i){r++;if(r==a){t(e)}}})}catch(e){p("EX: Get Traffic Sources >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR - Get Traffic Sources</b><p>"+e+"</p>")}})};var v=function(){try{p("buildOpporunitiesTable");jQuery("#tb-ctr-avg-select").text("Increase to Avg ("+d+"%)");var e="";var t=parseInt($("#tb-ctr-opportunity-duration").children("option:selected").val());if($("#tb-ctr-opportunity-potential").children("option:selected").val()=="avg"){jQuery("#tb-ctr-summary").html("See how many <b>additional</b> views, subs and earnings (in $USD) each video will bring over the next <b>"+$("#tb-ctr-opportunity-duration").children("option:selected").text()+"</b> if you're able to increase each video to your channel <b>average of "+d+"%</b>.")}else{jQuery("#tb-ctr-summary").html("See how many <b>additional</b> views, subs and earnings (in $USD) each video will bring over the next <b>"+$("#tb-ctr-opportunity-duration").children("option:selected").text()+"</b> if you're able to increase each video by <b>"+$("#tb-ctr-opportunity-potential").children("option:selected").text()+"</b>.")}var i=[];jQuery.each(h.Videos,function(e,a){var r=$("#tb-ctr-opportunity-potential").children("option:selected").val();if(r=="avg")multiplier=a.OpportunityCtrIncrease;else multiplier=r;if(multiplier<0)return;var o="+"+TBUtilities.FormatNumberWithCommas(parseInt(a.OpportunityViews*multiplier*t));var n=(a.OpportunitySubscribers>=0?"+":"")+TBUtilities.FormatNumberWithCommas(parseInt(a.OpportunitySubscribers*multiplier*t));var s=a.OpportunityEarnings*multiplier*t;var l=s-Math.floor(s);var u="+$"+TBUtilities.FormatNumberWithCommas(parseInt(Math.floor(s).toFixed(0)))+TBUtilities.ReplaceAll(l.toFixed(2),"0.",".")+" USD";console.log(u);if(s==0)u="+$0.00";var c=(100*multiplier).toFixed(2);var d=(100*a.OpportunityCtr).toFixed(2);u=TBUtilities.ReplaceAll(u,"$00","$0");i.push({Thumbnail:a.Thumbnail,Title:a.Title,Ctr:d,CtrIncrease:c,ViewsIncrease:o,EarningsIncrease:u,ViewsIncreaseNumber:parseInt(a.OpportunityViews*multiplier*t),EarningsIncreaseNumber:a.OpportunityEarnings*multiplier*t})});if(a=="Last30Asc"){TBUtilities.SortArray(i,"Ctr",true,true)}else if(a=="Last30Desc"){TBUtilities.SortArray(i,"Ctr",false,true)}else if(a=="OppAsc"){console.log("opp");TBUtilities.SortArrayTwoNumberColumns(i,"EarningsIncreaseNumber",true,"ViewsIncreaseNumber",true)}else{console.log("opp2");TBUtilities.SortArrayTwoNumberColumns(i,"EarningsIncreaseNumber",false,"ViewsIncreaseNumber",false)}jQuery.each(i,function(t,i){var a='<tr style="height:80px;">';a+='<td valign="top" style="border-bottom:solid 1px #ddd; width:375px; position:relative; padding-top:6px;">';a+='    <img src="'+i.Thumbnail+'" style="width: 120px; height:68px; position:absolute; top:7px; left:5px;" />';a+='    <div style="padding-left:135px; height:46px; overflow:hidden; padding-top:3px; font-size:14px; line-height:16px;">'+i.Title+" YO</div></td>";a+='<td style="width:125px;border-bottom:solid 1px #ddd; font-size:1.15em; text-align:center;">'+i.Ctr+'%<div style="font-size:11px; padding-top:3px">(+'+i.CtrIncrease+")</div></td>";a+='<td style="width:140px;border-bottom:solid 1px #ddd; text-align:right; padding-right:15px; font-size:1em; line-height:1.55em;"><div style="font-size:1.15em;">'+i.EarningsIncrease+"</div>"+i.ViewsIncrease+" Views</td>";a+="</tr>";e+=a});jQuery("#tb-ctr-opportunity-table-data").html(e)}catch(e){p("EX: buildOpportunitiesTable >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR buildOpportunitiesTable</b><p>"+e+"</p>")}};var T=function(e){try{p("fetchOpportunities");return new Promise(function(t,i){L("Getting Opportunities");var a=TBGlobal.host+"/api/clickmagnet/GetOpportunities";var r={ChannelId:TBGlobal.CurrentChannelId(),Videos:[]};var o=0;var n=0;jQuery.each(e.Videos,function(e,t){var i={Id:t.Id,DatePublished:t.DatePublished,Views:0,Ctr:0,Impressions:0,Subscribers:0,Likes:0,Comments:0,Clicks:0,Earnings:0};jQuery.each(t.Last30Days,function(e,a){i.Views+=a.Views||0;i.Impressions+=a.Impressions||0;i.Subscribers+=a.SubscribersNet||0;i.Likes+=a.Likes||0;i.Comments+=a.Comments||0;i.Clicks+=a.Clicks||0;i.Earnings+=a.Earnings||0;i.DatePublished=t.DatePublished;o+=a.Clicks||0;n+=a.Impressions||0});if(i.Impressions>0)i.Ctr=i.Clicks/(1*i.Impressions);r.Videos.push(i)});if(n>0)r.AvgCtr=o/(1*n);TBExtension.Post(a,JSON.stringify(r),function(i,a,r){p("back from fetchOpportunities");if(i===true){try{d=(JSON.parse(r).Data.AvgCtr*100).toFixed(2);var o=JSON.parse(r).Data.Videos;jQuery.each(e.Videos,function(e,t){var i=TBUtilities.GetInArray(o,"Id",t.Id);console.log("Match?");console.log(i);t.OpportunityViews=i.Views;t.OpportunitySubscribers=i.Subscribers;t.OpportunityEarnings=i.Earnings;t.OpportunityCtrIncrease=i.CtrIncrease;t.OpportunityCtr=i.Ctr});v()}catch{}}t(e)},null,{contentType:"application/json"})})}catch(e){p("EX: Fetch Opportunities >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR - Fetch Opportunities</b><p>"+e+"</p>")}};var j=function(){p("setupOpportunityFinder");L("Initializing");new Promise(function(e,t){try{Q(h).then(m).then(f).then(g).then(getVideoTotalStats).then(T).then(function(t){jQuery("#tb-ctr-of-loading").hide();jQuery("#tb-ctr-of-loaded").show();e(t)}).catch(function(e){t(e)})}catch(e){p("EX: setupOpportunityFinder >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR - setupOpportunityFinder</b><p>"+e+"</p>")}})};var Q=function(e){return new Promise(function(t,i){try{L("Loading recent uploads");TubeBuddyYouTubeActions.GetVideosListStudio(e.numVideosToExamine,true).then(function(i){p("Videos Retrieved: "+i.videosList.length);jQuery.each(i.videosList,function(t,i){e.Videos.push({Id:i.videoId,DatePublished:new Date(moment.unix(i.timePublishedSeconds)),Title:i.title,Thumbnail:i.thumbnailDetails.thumbnails[1].url,Views:i.metrics.viewCount});p(JSON.stringify(i))});t(e)},function(e){p("getVideosList A: "+e);S("FAILED TO LOAD VIDEOS (A)")}).catch(function(e){p("getVideosList B: "+e);S("FAILED TO LOAD VIDEOS (B)")})}catch(e){p("getVideosList C: "+e);S("FAILED TO LOAD VIDEOS (C)")}})};var k=function(e){return new Promise(function(t,i){try{var a=0;L("Getting Lifetime Analytics");jQuery.each(e.Videos,function(i,r){var o=moment(r.DatePublished).clone().add(-2,"days");var n=moment(new Date).clone().add(2,"days");var s=[TBApiMetrics.VIEWS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.TOTAL_ESTIMATED_EARNINGS,TBApiMetrics.RATINGS_LIKES,TBApiMetrics.COMMENTS,TBApiMetrics.SUBSCRIBERS_NET_CHANGE];TubeBuddyYouTubeActions.AnalyticsGetSummaryVideoTotals(r.Id,o,n,s).then(function(i){a++;var o=i.resultData;r.LifetimeAnalytics={Views:o.VIEWS,SubscribersNet:o.SUBSCRIBERS_NET_CHANGE,Earnings:o.TOTAL_ESTIMATED_EARNINGS,Likes:o.RATINGS_LIKES,Comments:o.COMMENTS,WatchPercentage:o.AVERAGE_WATCH_PERCENTAGE,WatchTime:o.AVERAGE_WATCH_TIME,Impressions:o.VIDEO_THUMBNAIL_IMPRESSIONS,CTR:100*o.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(o.VIDEO_THUMBNAIL_IMPRESSIONS*o.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};p("videoLifetimeAnalytics: "+r.Id+": "+JSON.stringify(r.LifetimeAnalytics));if(a==e.Videos.length){t(e)}},function(i){p("getLifetimeAnalytics A: "+i);S("FAILED TO PULL LIFETIME ANALYTICS (A)");a++;if(a==e.Videos.length){t(e)}}).catch(function(e){p("getLifetimeAnalytics B: "+e);S("FAILED TO PULL LIFETIME ANALYTICS (B)")})})}catch(e){p("getLifetimeAnalytics C: "+e);S("FAILED TO PULL LIFETIME ANALYTICS (C)")}}).catch(function(e){k("getLifetimeAnalytics D: "+e);S("FAILED TO PULL LIFETIME ANALYTICS (D)")})};var B=function(e){return new Promise(function(t,i){try{L("Getting Daily Analytics");var a=0;jQuery.each(e.Videos,function(i,r){var o=[TBApiMetrics.VIEWS,TBApiMetrics.TOTAL_ESTIMATED_EARNINGS,TBApiMetrics.SUBSCRIBERS_NET_CHANGE,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.RATINGS_LIKES,TBApiMetrics.COMMENTS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR];var n=moment(r.DatePublished).clone().add(-2,"days");var s=moment(r.DatePublished).clone().add(35,"days");TubeBuddyYouTubeActions.AnalyticsGetDailyVideoTotals(r.Id,n,s,o).then(function(i){a++;r.DailyAnalytics=[];var o=i.resultData;jQuery.each(o,function(e,t){if(!t.VIDEO_THUMBNAIL_IMPRESSIONS)t.VIDEO_THUMBNAIL_IMPRESSIONS=0;if(!t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR=0;var i={Date:new Date(t.Date),Views:t.VIEWS,Impressions:t.VIDEO_THUMBNAIL_IMPRESSIONS,Likes:t.RATINGS_LIKES,Comments:t.COMMENTS,WatchPercentage:t.AVERAGE_WATCH_PERCENTAGE,WatchTime:t.AVERAGE_WATCH_TIME,Ctr:100*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(t.VIDEO_THUMBNAIL_IMPRESSIONS*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};p("videoDailyAnalytics: "+r.Id+": "+JSON.stringify(i));if(i.Impressions>0||i.Views>0||i.WatchTime>0)r.DailyAnalytics.push(i)});if(a==e.Videos.length){t(e)}},function(i){p("getVideosFirst30DaysAnalytics A: "+i);S("FAILED TO PULL DAILY ANALYTICS (A)");a++;if(a==e.Videos.length){t(e)}}).catch(function(e){p("getVideosFirst30DaysAnalytics B: "+e);S("FAILED TO PULL DAILY ANALYTICS (B)")})})}catch(e){p("getVideosFirst30DaysAnalytics C: "+e);S("FAILED TO PULL DAILY ANALYTICS (C)")}}).catch(function(e){k("getVideosFirst30DaysAnalytics D: "+e);S("FAILED TO PULL DAILY ANALYTICS (D)")})};var C=function(e){return new Promise(function(t,i){try{var a=0;L("Getting Traffic Sources Analytics");jQuery.each(e.Videos,function(i,r){try{var o=[TBApiMetrics.VIEWS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME];a++;var n=moment(r.DatePublished).clone().add(-2,"days");var s=moment(new Date).clone().add(2,"days");TubeBuddyYouTubeActions.AnalyticsGetSummaryVideoTrafficSourcesTotals(r.Id,n,s,o).then(function(i){r.TrafficSourceAnalytics=[];jQuery.each(i.resultData,function(e,t){var i={VideoId:r.Id,Views:t.VIEWS,WatchPercentage:t.AVERAGE_WATCH_PERCENTAGE,WatchTime:t.AVERAGE_WATCH_TIME,TrafficSource:t.TrafficSource,Impressions:t.VIDEO_THUMBNAIL_IMPRESSIONS,CTR:100*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(t.VIDEO_THUMBNAIL_IMPRESSIONS*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};p("getTrafficSourcesAnalytics: "+r.Id+": "+JSON.stringify(i));r.TrafficSourceAnalytics.push(i)});if(a==e.Videos.length){t(e)}},function(i){p("getTrafficSourcesAnalytics A: "+i);S("FAILED TO PULL TRAFFIC SOURCE ANALYTICS (A)");a++;if(a==e.Videos.length){t(e)}}).catch(function(e){p("getTrafficSourcesAnalytics B: "+e);S("FAILED TO PULL TRAFFIC SOURCE ANALYTICS (B)")})}catch(i){p("getTrafficSourcesAnalytics C: "+i);S("FAILED TO PULL TRAFFIC SOURCE ANALYTICS (C)");a++;if(a==e.Videos.length){t(e)}}})}catch(e){p("getTrafficSourcesAnalytics D: "+e);S("FAILED TO PULL TRAFFIC SOURCE ANALYTICS (D)")}}).catch(function(e){p("getTrafficSourcesAnalytics E: "+e);S("FAILED TO PULL TRAFFIC SOURCE ANALYTICS (E)")})};var w=function(){try{p("buildAnalyticsTable");s=[];var e=[];jQuery.each(h.Videos,function(e,t){var i={Id:t.Id,Thumbnail:t.Thumbnail,Title:t.Title,Impressions:0,Clicks:0,CTR:0,Views:0,WatchPercentage:0,WatchTime:0,DatePublished:t.DatePublished};if(r=="Lifetime"){if(o=="All"){i.Impressions=t.LifetimeAnalytics.Impressions;i.CTR=t.LifetimeAnalytics.CTR;i.Clicks=t.LifetimeAnalytics.Clicks;i.Views=t.LifetimeAnalytics.Views;i.WatchPercentage=t.LifetimeAnalytics.WatchPercentage;i.WatchTime=t.LifetimeAnalytics.WatchTime}else{console.log(o);var a=TBUtilities.GetInArray(t.TrafficSourceAnalytics,"TrafficSource",o);console.log(a);i.Impressions=a.Impressions;i.Clicks=a.Clicks;i.Views=a.Views;i.WatchPercentage=a.WatchPercentage;i.WatchTime=a.WatchTime;if(i.Impressions>0)i.CTR=100*(i.Clicks/i.Impressions);else i.CTR=0}}else{var l=parseInt(r);if(t.DailyAnalytics.length<l){return}for(var u=0;u<l;u++){i.Impressions+=t.DailyAnalytics[u].Impressions;i.Clicks+=t.DailyAnalytics[u].Clicks;i.Views+=t.DailyAnalytics[u].Views;i.WatchPercentage+=t.DailyAnalytics[u].WatchPercentage;i.WatchTime+=t.DailyAnalytics[u].WatchTime}if(i.Impressions>0)i.CTR=100*(i.Clicks/i.Impressions);else i.CTR=0;i.WatchTime=i.WatchTime/l;i.WatchPercentage=i.WatchPercentage/l}if(i.WatchTime>0)i.WatchTimeMinutes=(i.WatchTime/1e3/60).toFixed(2);if(i.Impressions>n)s.push(i)});var t="";if(a=="CtrAsc"){t="% CTR";TBUtilities.SortArray(s,"CTR",true,true);jQuery.each(s,function(t,i){e.push(parseFloat(i.CTR))});jQuery("#tb-ctr-distribution-label").html("CTR Distribution")}else if(a=="CtrDesc"){t="% CTR";TBUtilities.SortArray(s,"CTR",false,true);jQuery.each(s,function(t,i){e.push(parseFloat(i.CTR))});jQuery("#tb-ctr-distribution-label").html("CTR Distribution")}else if(a=="ImpressionsAsc"){t=" Impressions";TBUtilities.SortArray(s,"Impressions",true,true);jQuery.each(s,function(t,i){e.push(i.Impressions)});jQuery("#tb-ctr-distribution-label").html("Impressions Distribution")}else if(a=="ImpressionsDesc"){t=" Impressions";TBUtilities.SortArray(s,"Impressions",false,true);jQuery.each(s,function(t,i){e.push(i.Impressions)});jQuery("#tb-ctr-distribution-label").html("Impressions Distribution")}else if(a=="ClicksAsc"){t=" Clicks";TBUtilities.SortArray(s,"Clicks",true,true);jQuery.each(s,function(t,i){e.push(i.Clicks)});jQuery("#tb-ctr-distribution-label").html("Clicks Distribution")}else if(a=="ClicksDesc"){t=" Clicks";TBUtilities.SortArray(s,"Clicks",false,true);jQuery.each(s,function(t,i){e.push(i.Clicks)});jQuery("#tb-ctr-distribution-label").html("Clicks Distribution")}else if(a=="ViewsAsc"){t=" Views";TBUtilities.SortArray(s,"Views",true,true);jQuery.each(s,function(t,i){e.push(i.Views)});jQuery("#tb-ctr-distribution-label").html("Views Distribution")}else if(a=="ViewsDesc"){t=" Views";TBUtilities.SortArray(s,"Views",false,true);jQuery.each(s,function(t,i){e.push(i.Views)});jQuery("#tb-ctr-distribution-label").html("Views Distribution")}else if(a=="DurationAsc"){t=" Duration";TBUtilities.SortArray(s,"WatchTime",true,true);jQuery.each(s,function(t,i){e.push(i.WatchTime)});jQuery("#tb-ctr-distribution-label").html("Duration Distribution")}else if(a=="DurationDesc"){t=" Duration";TBUtilities.SortArray(s,"WatchTime",false,true);jQuery.each(s,function(t,i){e.push(i.WatchTime)});jQuery("#tb-ctr-distribution-label").html("Duration Distribution")}jQuery(".tb-ctr-sort-item").hide();jQuery("#tb-ctr-"+a).show();jQuery("#tb-ctr-wl-data").html('<tr id="tb-ctr-wl-tr"></tr>');jQuery.each(s,function(e,t){try{var i='<tr style="height:77px;">';i+='<td valign="top" style="border-bottom:solid 1px #ddd; width:360px; position:relative;">';i+='    <img src="'+t.Thumbnail+'" style="width: 120px; height:68px; position:absolute; top:3px; left:5px;" />';i+='<span style="position: absolute; left: 135px; font-size:11px; top: 58px; color:#666;">Published: '+TBUtilities.ToShortDateString(t.DatePublished)+"</span>";i+='    <div style="padding-left:135px; height:46px; overflow:hidden; padding-top:6px; font-size:14px; line-height:16px;">'+t.Title+"</div></td>";i+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center;">'+TBUtilities.FormatNumberAbbreviated(t.Views)+"</td>";i+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center;"><span style="font-size:1.1em">'+V(t.WatchTime)+'</span><br><span style="padding-left:3px;font-size:.9em; opacity:.8">'+(100*t.WatchPercentage).toFixed(1)+"%</span></td>";i+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center;">'+TBUtilities.FormatNumberWithCommas(t.Impressions)+"</td>";i+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center;">'+TBUtilities.FormatNumberWithCommas(t.Clicks)+"</td>";i+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center; font-size:20px;">'+t.CTR.toFixed(2)+"%</td>";i+="</tr>";jQuery("#tb-ctr-wl-tr").before(i)}catch(e){console.log("ERR!");console.log(e)}});l=[];jQuery.each(s,function(e,t){l.push(t)});$("#tb-ctr-distribution").highcharts({credits:{enabled:false},title:{text:null},xAxis:[{title:{text:""},alignTicks:false,visible:false},{alignTicks:false,opposite:true,visible:false}],yAxis:[{title:{text:""}},{title:{text:""},opposite:true,visible:false}],tooltip:{useHTML:true,formatter:function(){if(this.series.name=="a")return mull;else{console.log(this.y+t+'<div style="font-size:10px; line-height:11px; width:100px; max-width:100px; overfow:hidden !important;"><img src="'+s[this.x].Thumbnail+'" style="height:50px; width:90px; margin-bottom:2px;" /><br>'+s[this.x].Title+"</div>");return'<div style="width:100px; overflow:hidden !important;">'+this.y+t+'<div style="font-size:10px; line-height:11px; width:100px; max-width:100px; overfow:hidden !important;"><img src="'+s[this.x].Thumbnail+'" style="height:50px; width:90px; margin-bottom:2px;" /><br>'+s[this.x].Title+"</div></div>"}}},series:[{title:"",name:null,type:"scatter",data:e,color:"#222",marker:{radius:2,symbol:"diamond"},showInLegend:false}]})}catch(e){p("EX: buildAnalyticsTable >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR - buildAnalyticsTable</b><p>"+e+"</p>")}};var A=function(){p("analyzeVideoElements");return new Promise(function(e,t){try{L("Analyzing Elements");var i=TBGlobal.host+"/api/clickmagnet/AnalyzeVideoElements";var a={ChannelId:TBGlobal.CurrentChannelId(),Videos:[]};jQuery.each(h.Videos,function(e,t){var i={Id:t.Id,DatePublished:t.DatePublished,Thumbnail:t.Thumbnail,Title:t.Title};a.Videos.push(i)});TBExtension.Post(i,JSON.stringify(a),function(t,i,a){e(h)},null,{contentType:"application/json"})}catch(e){p("analyzeVideoElements A: "+e);S("FAILED TO ANALYZE VIDEO ELEMENTS (A)",e)}}).catch(function(e){p("analyzeVideoElements B: "+e);S("FAILED TO VIDEO ELEMENTS (B)",e)})};var x=function(){p("calculateElementAnalysis");return new Promise(function(e,t){try{var i=TBGlobal.host+"/api/clickmagnet/CalculateElementAnalysis";var a={ChannelId:TBGlobal.CurrentChannelId(),Videos:[]};jQuery.each(h.Videos,function(e,t){var i={Id:t.Id,DatePublished:t.DatePublished,Thumbnail:t.Thumbnail,Title:t.Title,Clicks:t.LifetimeAnalytics.Clicks,Impressions:t.LifetimeAnalytics.Impressions};a.Videos.push(i)});TBExtension.Post(i,JSON.stringify(a),function(t,i,a){if(t===true){try{h.ElementData=JSON.parse(a).Data}catch(e){console.log(e)}}e(h)},null,{contentType:"application/json"})}catch(e){p("calculateElementAnalysis A: "+e);S("FAILED TO CALCULATE ELEMENT ANALYSIS (A)",e)}}).catch(function(e){p("calculateElementAnalysis B: "+e);S("FAILED TO CALCULATE ELEMENT ANALYSIS (B)",e)})};var I=function(){p("buildElementInspectorCharts");return new Promise(function(e,t){try{var i=h.ElementData;Highcharts.chart("tb-ctr-grid-face-counts",{chart:{type:"column"},title:{text:"Number of Faces in Thumbnail"},credits:{enabled:false},xAxis:{categories:['<p style="text-align:center">No Faces<br></p>','<p style="text-align:center">1 Face<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:25px;" /></p>','<p style="text-align:center">2 Faces<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:23px; margin-right:2px;" /><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:23px;" /></p>','<p style="text-align:center; position:relative;">3 Faces<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:20px; margin-right:2px;" /><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:20px;" /><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:20px; position:absolute; top:29px; left:11px;" /></p>','<p style="text-align:center; position:relative;">4+ Faces<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px; margin-right:2px;" /><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px; margin-right:2px;" /><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px;" /> <img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px; position:absolute; top:24px; left:20px;" /><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px; position:absolute; top:24px; left:0px;" /> <img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px; position:absolute; top:29px; left:33px;" /> <img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:14px; position:absolute; top:29px; left:16px;" /> </p>'],position:"center",align:"center",labels:{useHTML:true},crosshair:true,title:{enabled:false}},yAxis:{min:0,format:"{value:.1f}%",title:{text:"Click Through Rate"}},tooltip:{shared:true,useHTML:true,style:{pointerEvents:"auto"},formatter:function(){return R(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return E(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").CTR,type:"FaceCount0",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").CTR,type:"FaceCount1",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount1").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").CTR,type:"FaceCount2",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount2").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").CTR,type:"FaceCount3",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount3").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").CTR,type:"FaceCount4",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount4").VideoIds.length/(1*h.numVideosToExamine)))}]}]});Highcharts.chart("tb-ctr-grid-face-emotions",{chart:{type:"column"},title:{text:"Emotions of Faces in Thumbnail"},credits:{enabled:false},xAxis:{categories:['<p style="text-align:center">Happy<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/1.png" style="height:25px;" /></p>','<p style="text-align:center">Sad<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/35.png" style="height:25px;" /></p>','<p style="text-align:center">Surprised<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/53.png" style="height:25px;" /></p>','<p style="text-align:center">Calm<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/47.png" style="height:25px;" /></p>','<p style="text-align:center">Angry<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/45.png" style="height:25px;" /></p>','<p style="text-align:center">Confused<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/67.png" style="height:25px;" /></p>','<p style="text-align:center">Disgusted<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/40.png" style="height:25px;" /></p>','<p style="text-align:center">Mixed<br><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnsX00B9UECvbeBQYm8nU3xBeW3qfUxgMjZ6D8xqEdKDK6Jx0s&s" style="height:25px;" /></p>'],position:"center",align:"center",labels:{useHTML:true},crosshair:true,title:{enabled:false},formatter:function(){return this.value+"%"}},yAxis:{min:0,title:{text:"Click Through Rate"}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return R(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return E(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").CTR,type:"EmotionHappy",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").CTR,type:"EmotionSad",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").CTR,type:"EmotionSurprised",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").CTR,type:"EmotionCalm",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").CTR,type:"EmotionAngry",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").CTR,type:"EmotionConfused",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").CTR,type:"EmotionDisgusted",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").CTR,type:"EmotionMixed",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds.length/(1*h.numVideosToExamine)))}]}]});Highcharts.chart("tb-ctr-grid-face-attributes",{chart:{type:"column"},title:{text:"Attributes of Faces in Thumbnail"},credits:{enabled:false},xAxis:{categories:['<p style="text-align:center">Female<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:25px;" /></p>','<p style="text-align:center">Male<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/male.png" style="height:25px;" /></p>','<p style="text-align:center">Mixed<br>Gender<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:15px;" /><img src="https://www.tubebuddy.com/images/modules/clickmagnet/male.png" style="height:15px;" /></p>','<p style="text-align:center">Small<br>Faces<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:15px;" /></p>','<p style="text-align:center">Medium<br>Faces<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:25px;" /></p>','<p style="text-align:center">Large<br>Faces<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:35px;" /></p>','<p style="text-align:center">Mixed Size<br>Faces<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:18px;" /><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:29px;" /></p>'],position:"center",align:"center",labels:{useHTML:true},crosshair:true,title:{enabled:false},plotLines:[{color:"red",dashStyle:"ShortDash",value:2.5,width:2}]},yAxis:{min:0,format:"{value:.1f}%",title:{text:"Click Through Rate"}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return R(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return E(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","GenderFemale").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","GenderMale").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","GenderMale").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","GenderMale").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","GenderMale").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","GenderMale").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","GenderMale").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","GenderMale").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","GenderMixed").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds.length/(1*h.numVideosToExamine)))}]}]});Highcharts.chart("tb-ctr-grid-text-analysis",{chart:{type:"column"},title:{text:"Analysis of Text in Thumbnail"},credits:{enabled:false},xAxis:{categories:["0 Words","1-3<br/>Words","4-8<br/>Words","9-15<br/>Words","16+<br/>Words","Small<br/>Text","Medium<br/>Text","Large<br/>Text","Mixed<br>Size<br/>Text"],crosshair:true,title:{enabled:false},plotLines:[{color:"red",dashStyle:"ShortDash",value:4.5,width:2}]},yAxis:{min:0,format:"{value:.1f}%",title:{text:"Click Through Rate"}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return R(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return E(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount13").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount13").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount13").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount13").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount13").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount13").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount13").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount48").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount48").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount48").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount48").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount48").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount48").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount48").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount915").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount915").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount915").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount915").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount915").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount915").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount915").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount16").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount16").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount16").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount16").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount16").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount16").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount16").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","WordSizeSmall").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","WordSizeMedium").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").CTR,vids:TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").VideoIds,vidCount:TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").VideoIds.length,impressions:TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","WordSizeLarge").VideoIds.length/(1*h.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").CTR,vids:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").VideoIds,vidCount:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").VideoIds.length,impressions:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","WordSizeMixed").VideoIds.length/(1*h.numVideosToExamine)))}]}]});var a=[];var r=[];for(var o=1;o<20;o++){var n=TBUtilities.GetInArray(i,"AnalysisType","Words"+o);if(n){a.push(n.Key);r.push({y:n.CTR,vidCount:n.VideoIds.length,impressions:n.Impressions,vids:n.VideoIds,clicks:n.Clicks,color:"#4f9ce6",pointWidth:15+Math.min(20,75*(n.VideoIds.length/(1*h.numVideosToExamine)))})}}Highcharts.chart("tb-ctr-grid-word-analysis",{chart:{type:"column"},title:{text:"Analysis of Text in Thumbnail"},credits:{enabled:false},xAxis:{categories:a,crosshair:true,title:{enabled:false},labels:{rotation:-90},scrollbar:{enabled:true}},scrollbar:{enabled:true},yAxis:{min:0,format:"{value:.1f}%",title:{text:"Click Through Rate"}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return R(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return E(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:r,scrollbar:{enabled:true}}]});jQuery("#tb-ctr-faces-option").trigger("click");e(h)}catch(e){p("buildElementInspectorCharts A: "+e);S("FAILED TO BUILD ALEMENT INSPECTOR CHARTS (A)",e)}}).catch(function(e){p("buildElementInspectorCharts B: "+e);S("FAILED TO BUILD ALEMENT INSPECTOR CHARTS (B)",e)})};var U=function(){p("gatherAndProcessAllData");new Promise(function(e,t){try{Q(h).then(k).then(B).then(C).then(w).then(A).then(x).then(I).then(function(t){jQuery("#tb-ctr-gathering").hide();jQuery("#tb-ctr-gathered").show();e(t)}).catch(function(e){t(e)})}catch(e){p("EX: gatherAndProcessAllData >>"+e);$("#tb-ctr-error").show();$("#tb-ctr-error").html($("#tb-ctr-error").html()+"<br><Br><b>ERROR - setupWinnersAndLosers</b><p>"+e+"</p>")}})};var L=function(e){p(e);jQuery(".tb-ctr-status-label").html(e+"<br>"+jQuery(".tb-ctr-status-label").html())};var S=function(e,t){alert("Sorry, processing failed!"+b+"\n\n"+e+"\n\n"+t)};var G=function(){jQuery(document).on("click","#tb-ctr-gather-all-data",function(){jQuery("#tb-ctr-start").hide();jQuery("#tb-ctr-gathering").show();U()});jQuery(document).on("change","#tb-ctr-tf-select, #tb-ctr-ts-select, #tb-ctr-mi-select",function(){r=jQuery("#tb-ctr-tf-select").val();o=jQuery("#tb-ctr-ts-select").val();n=jQuery("#tb-ctr-mi-select").val();if(r!="Lifetime"){jQuery("#tb-ctr-ts-na").show();jQuery("#tb-ctr-ts-select").hide();jQuery("#tb-ctr-ts-select").val("All")}else{jQuery("#tb-ctr-ts-na").hide();jQuery("#tb-ctr-ts-select").show()}w()});jQuery(document).on("click","#tb-ctr-analytics-button",function(){jQuery("#tb-crt-title").text("Click Magnet - Advanced CTR Analytics");jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-analytics-container").show();$("#tb-ctrcenter-export").show();$("#tb-ctr-footer").show();$("#tb-ctr-back").show();w()});jQuery(document).on("click","#tb-ctr-element-inspector-button",function(){jQuery("#tb-crt-title").text("Click Magnet - Element Analysis");jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-element-inspector-container").show();$("#tb-ctrcenter-export").hide();$("#tb-ctr-footer").show();$("#tb-ctr-back").show()});jQuery(document).on("click",".tb-ctr-back-home",function(){jQuery("#tb-ctr-options").show();jQuery("#tb-ctr-analytics-container").hide();jQuery("#tb-ctr-element-inspector-container").hide();jQuery("#tb-ctr-opportunity-finder").hide();$("#tb-ctr-footer").hide()});jQuery(document).on("click","#tb-ctr-opportunity-finder-button",function(){c="Opportunity Finder";jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-opportunity-finder").show();jQuery("#tb-ctr-back").show();j()});jQuery(document).on("change","#tb-ctr-mi-select",function(){_filterImpressions=parseInt(jQuery(this).val());w()});jQuery(document).on("change","#tb-ctr-opportunity-potential",function(){v()});jQuery(document).on("change","#tb-ctr-opportunity-duration",function(){v()});jQuery(document).on("change","#tb-ctr-ts-select",function(){w();if(jQuery(this).children("option:selected").val()=="SUBSCRIBERS"){jQuery("#tb-ctr-traffic-source-label").text("CTR of your videos from your Subscribers.")}else if(jQuery(this).children("option:selected").val()=="YT_SEARCH"){jQuery("#tb-ctr-traffic-source-label").text("CTR of your videos in the YouTube Search results.")}});jQuery(document).on("click","#tb-ctrcenter-export",function(){var e="TubeBuddy - "+TBGlobal.CurrentChannelId()+" - ";e+="Time Frame ("+r+") Traffic Source ("+o+") Min Impressions ("+n+")";e+=" Date("+(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDay()+")";TBUtilities.DownloadArrayToCSV(l,e+".csv")});jQuery(document).on("click",".tb-ctr-sort-CTR",function(){jQuery(".tb-ctr-sort-CTR").css("font-weight","bold");jQuery(".tb-ctr-sort-Impressions").css("font-weight","normal");jQuery(".tb-ctr-sort-Clicks").css("font-weight","normal");jQuery(".tb-ctr-sort-Views").css("font-weight","normal");jQuery(".tb-ctr-sort-Duration").css("font-weight","normal");jQuery(".tb-ctr-sort-item").hide();if(a=="CtrAsc")a="CtrDesc";else a="CtrAsc";jQuery("#tb-ctr-"+a).show();w()});jQuery(document).on("click",".tb-ctr-sort-Duration",function(){jQuery(".tb-ctr-sort-CTR").css("font-weight","normal");jQuery(".tb-ctr-sort-Impressions").css("font-weight","normal");jQuery(".tb-ctr-sort-Clicks").css("font-weight","normal");jQuery(".tb-ctr-sort-Views").css("font-weight","normal");jQuery(".tb-ctr-sort-Duration").css("font-weight","bold");jQuery(".tb-ctr-sort-item").hide();if(a=="DurationAsc")a="DurationDesc";else a="DurationAsc";jQuery("#tb-ctr-"+a).show();w()});jQuery(document).on("click",".tb-ctr-sort-Views",function(){jQuery(".tb-ctr-sort-CTR").css("font-weight","normal");jQuery(".tb-ctr-sort-Impressions").css("font-weight","normal");jQuery(".tb-ctr-sort-Clicks").css("font-weight","normal");jQuery(".tb-ctr-sort-Views").css("font-weight","bold");jQuery(".tb-ctr-sort-Duration").css("font-weight","normal");jQuery(".tb-ctr-sort-item").hide();if(a=="ViewsAsc")a="ViewsDesc";else a="ViewsAsc";jQuery("#tb-ctr-"+a).show();w()});jQuery(document).on("click",".tb-ctr-sort-Clicks",function(){jQuery(".tb-ctr-sort-CTR").css("font-weight","normal");jQuery(".tb-ctr-sort-Impressions").css("font-weight","normal");jQuery(".tb-ctr-sort-Clicks").css("font-weight","bold");jQuery(".tb-ctr-sort-Views").css("font-weight","normal");jQuery(".tb-ctr-sort-Duration").css("font-weight","normal");jQuery(".tb-ctr-sort-item").hide();if(a=="ClicksAsc")a="ClicksDesc";else a="ClicksAsc";jQuery("#tb-ctr-"+a).show();w()});jQuery(document).on("click",".tb-ctr-sort-last-30",function(){jQuery(".tb-ctr-sort-opp").css("font-weight","normal");jQuery(".tb-ctr-sort-last-30").css("font-weight","bold");jQuery(".tb-ctr-sort-item").hide();if(a=="Last30Desc")a="Last30Asc";else a="Last30Desc";jQuery("#tb-ctr-"+a).show();v()});jQuery(document).on("click",".tb-ctr-sort-opp",function(){jQuery(".tb-ctr-sort-last-30").css("font-weight","normal");jQuery(".tb-ctr-sort-opp").css("font-weight","bold");jQuery(".tb-ctr-sort-item").hide();if(a=="OppAsc")a="OppDesc";else a="OppAsc";jQuery("#tb-ctr-"+a).show();v()});jQuery(document).on("click",".tb-ctr-sort-Impressions",function(){jQuery(".tb-ctr-sort-CTR").css("font-weight","normal");jQuery(".tb-ctr-sort-Impressions").css("font-weight","bold");jQuery(".tb-ctr-sort-Clicks").css("font-weight","normal");jQuery(".tb-ctr-sort-item").hide();if(a=="ImpressionsAsc")a="ImpressionsDesc";else a="ImpressionsAsc";jQuery("#tb-ctr-"+a).show();w()});jQuery(document).on("click",".tb-ctr-tab-option",function(){i=jQuery(this).attr("data-cr-option");jQuery(".tb-ctr-tab-option-selected").removeClass("tb-ctr-tab-option-selected");jQuery(".tb-ctr-tab-option-body-show").removeClass("tb-ctr-tab-option-body-show");jQuery(this).addClass("tb-ctr-tab-option-selected");jQuery(".tb-ctr-tab-option-body").hide();jQuery(this).find(".tb-ctr-tab-option-body").addClass("tb-ctr-tab-option-body-show");jQuery(".tb-cr-element-section").hide();jQuery("[data-tab-name="+i+"]").show();if(c=="Winners and Losers"){w()}})};var E=function(e){var t="";if(e.point.vidCount==0){t='<p style="text-align:center;"><span style="font-weight:100; color:#777;">none</span></p>'}else{t='<p style="text-align:center;"><span style="text-align:center; font-size:1.45em; line-height:1.5em;">'+e.y.toFixed(2)+'%</span><br><span style="font-weight:100; color:#777;">'+e.point.vidCount+" Video"+(e.point.vidCount==1?"":"s")+"</span></p>"}return t};var R=function(e){var t='<div style="font-size:1.3em; font-weight:800; max-width:400px; background:white;">'+e.y.toFixed(2)+"% CTR</div>";t+='<div style="margin-top:10px;">'+e.points[0].point.vidCount+" Matching Videos</div>";t+="<div>"+TBUtilities.FormatNumberWithCommas(e.points[0].point.impressions)+" Combined Impressions</div>";t+="<div>"+TBUtilities.FormatNumberWithCommas(e.points[0].point.clicks)+" Combined Clicks</div>";var i="";jQuery.each(e.points[0].point.vids,function(e,t){i+=t+","});if(e.points[0].point.vidCount>0)t+='<div style="background:white; margin-bottom:-5px; border-top:solid 1px #aaa;"><div style="font-weight:500; font-size:.9em; margin-top:5px; margin-bottom:5px;">Examples &nbsp; &nbsp; <a style="text-decoration:underline" target="_blank" href="https://www.tubebuddy.com/channel/CtrElementAnalysis?id='+TBGlobal.CurrentChannelId()+"&type="+e.points[0].point.type+"&ti="+e.points[0].point.impressions+"&tc="+e.points[0].point.clicks+"&ctr="+e.y.toFixed(2)+"&videos="+i+'">View All ('+e.points[0].point.vidCount+")</a></div>";jQuery.each(e.points[0].point.vids,function(e,i){if(e<4)t+='<img src="https://img.youtube.com/vi/'+i+'/maxresdefault.jpg" style="margin-right:5px; margin-bottom:0px; height: 45px;" />';if(e==1)t+="<br />"});t+="</div>";return t};var V=function(e){var t=Math.floor(e/1e3%60);var i=Math.floor(e/(1e3*60)%60);var a=Math.floor(e/(1e3*60*60)%24);a=a<10?"0"+a:a;i=i<10?"0"+i:i;t=t<10?"0"+t:t;if(a>0)return a+":"+i+":"+t;else return i+":"+t};var M=function(){jQuery("#tb-ctrcenter-container").show();p("prepareDialog")};var P=function(){jQuery(document.body).on("CRTBLoadCTRCenterTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(t.response);jQuery("body").append(t.response);p("__ CTR DEBUG __");M()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCTRCenter] CRTBLoadCTRCenterTemplate"})}})};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){P();y();G();e=true}else{M(_title,_thumbnail,_id)}}}}}();var TubeBuddyCardsUpdate=function(){var t={method:3,specificVideoIds:[],specificVideos:[],playlistId:"",validPlaylistIds:[],search:"",selectedVideo:{},currentVideo:null,isStopped:false,failedVideos:[],step:1,videosWithFoundCards:[],destinationVideos:[],hasFinished:false,errorCount:0,successCount:0,totalDestinationVideos:0,actionCardCount:0,imageConversionDic:{},searchQueue:[]};var i=false;var a=null;var r=function(){var e=TBGlobal.host+"/ModuleManager/cardsupdate/cardsupdate?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/cardsupdate.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/cardsupdate.html"}TBExtension.Get(e,"CRTBLoadCardsUpdateTemplate")};var o=function(){jQuery(document.body).on("CRTBUpdateGetImageBytes",function(e,i){try{if(i.success){var a=JSON.parse(i.response);t.imageConversionDic[i.data.Url]=a}else{t.imageConversionDic[i.data.Url]=""}var r=0;for(var o in t.imageConversionDic){var n=t.imageConversionDic[o];if(n!=null){r++}}if(Object.keys(t.imageConversionDic).length==r){u();c()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCards] CRTBGetImageBytes"})}});jQuery(document).on("click","#tb-cards-update-error-copy-container",function(){jQuery(this).attr("src","https://www.tubebuddy.com/images/icons/check.png");window.setTimeout(function(){jQuery("#tb-cards-update-error-copy").attr("src","https://www.tubebuddy.com/images/icons/copy.png")},1500)});jQuery(document).on("click","#tb-cards-update-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-cards-update-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-cards-update-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change",".tb-cards-update-target-select",function(){var e=jQuery(".tb-cards-update-target-select").val();switch(e){case"url":{break}default:{break}}});jQuery(document).on("change",".tb-cards-update-cardtype-select",function(){try{var e=jQuery(".tb-cards-update-cardtype-select").val();switch(e){case"video":{jQuery(".tb-cards-update-cardtype-video").show();jQuery(".tb-cards-update-cardtype-link").hide();jQuery(".tb-cards-update-target-select").val("videoUrl");break}case"link":{jQuery(".tb-cards-update-cardtype-video").hide();jQuery(".tb-cards-update-cardtype-link").show();jQuery(".tb-cards-update-target-select").val("url");jQuery(".tb-cards-update-http-options-input").attr("checked","checked");break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-cards-update-imagefile"})}});jQuery(document).on("change",".tb-cards-update-imagefile",function(){try{var e=jQuery(".tb-cards-update-imagefile").val().split(".").pop().toLowerCase();if(jQuery.inArray(e,["gif","png","jpg","jpeg"])==-1){TBUtilities.Alert("Invalid image file type.  Only .gif, .png, and .jpg are allowed");jQuery(".tb-cards-update-imagefile").val("");return}jQuery("#tb-cards-update-uploaded-file").text(jQuery(".tb-cards-update-imagefile").val().split("\\")[2]).show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-cards-update-imagefile"})}});jQuery(document).on("change",".tb-cards-update-filter",function(){jQuery(".tb-cards-update-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-cards-update-destination-row[data-privacy="private"]').hide();jQuery('.tb-cards-update-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-cards-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-cards-update-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-cards-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-cards-update-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-cards-update-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-cards-update-destination-row[data-privacy="public"]').hide();break}jQuery(".tb-cards-update-destination-selected-count").text(jQuery(".tb-cards-update-destination-row--selected").filter(":visible").length);jQuery(".tb-cards-update-destination-total-count").text(jQuery(".tb-cards-update-destination-row").filter(":visible").length)});jQuery(document).on("click",".tb-cards-update-destination-row",function(){try{if(!jQuery(this).hasClass("tb-cards-update-destination-row--selected")){jQuery(this).addClass("tb-cards-update-destination-row--selected");if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-cards-update-destination-row--selected").filter(":visible").length>1){jQuery(this).removeClass("tb-cards-update-destination-row--selected");TBGlobal.ShowUpgradePage("update cards in bulk (more than 1 video at a time)","bulkupdatecards");return}}else{jQuery(this).removeClass("tb-cards-update-destination-row--selected")}var e=p();t.actionCardCount=e;jQuery(".tb-cards-update-destination-selected-count").text(e);jQuery("tb-cards-update-destination-total-count").text(jQuery(".tb-cards-update-destination-row").filter(":visible").length);jQuery(".tb-cards-update-count").text(e);if(jQuery(".tb-cards-update-count").text()=="1")jQuery(".tb-cards-update-count-s").hide();else jQuery(".tb-cards-update-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [click] tb-cards-update-checkbox-include"})}});jQuery(document).on("click",".tb-cards-update-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("update cards in bulk (more than 1 video at a time)","bulkupdatecards");return}jQuery(".tb-cards-update-destination-row").addClass("tb-cards-update-destination-row--selected");var e=p();jQuery(".tb-cards-update-destination-selected-count").text(e);jQuery(".tb-cards-update-count").text(e);if(jQuery(".tb-cards-update-count").text()=="1")jQuery(".tb-cards-update-count-s").hide();else jQuery(".tb-cards-update-count-s").show()});jQuery(document).on("click",".tb-cards-update-select-no-checkboxes",function(){jQuery(".tb-cards-update-destination-row").removeClass("tb-cards-update-destination-row--selected");var e=p();jQuery(".tb-cards-update-destination-selected-count").text(e);jQuery(".tb-cards-update-count").text(e);if(jQuery(".tb-cards-update-count").text()=="1")jQuery(".tb-cards-update-count-s").hide();else jQuery(".tb-cards-update-count-s").show()});jQuery(document).on("click","input[name=tb-cards-update-target-option]",function(){jQuery(".tb-cards-update-target-input").prop("disabled",true);jQuery(".tb-cards-update-target-input").val("");jQuery(this).siblings(".tb-cards-update-target-input:first").prop("disabled",false)});jQuery(document).on("click",".tb-cards-update-action-option",function(){var e=jQuery(this).is(":checked");if(e){if(jQuery(this).hasClass("tb-cards-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-cards-update-imagefile:first").prop("disabled",false)}else{jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").prop("disabled",false);jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").val("")}}else{if(jQuery(this).hasClass("tb-cards-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-cards-update-imagefile:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-cards-update-imagefile:first").val("");jQuery("#tb-cards-update-uploaded-file").text("").hide()}else{jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").val("")}}});jQuery(document).on("click","#tb-cards-update-close, #tb-cards-update-cancel, .tb-cards-update-closex",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-cards-update-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] [click] tb-cards-close"})}});jQuery(document).on("click",".tb-cards-update-continue",function(){try{switch(t.step){case 1:{if(jQuery(".tb-cards-update-target-input-field").val()==""){TBUtilities.Alert("Enter your search criteria");return}var e=jQuery(".tb-cards-update-cardtype-select").val();var i=n();switch(e){case"video":{try{if(i.find(".tb-cards-update-action-video").is(":checked")==false&&i.find(".tb-cards-update-action-custom-message").is(":checked")==false&&i.find(".tb-cards-update-action-teaser-text").is(":checked")==false){TBUtilities.Alert("Please choose at least one update to make");return}var a;var r;if(i.find(".tb-cards-update-action-video").is(":checked")){var o=i.find(".tb-cards-update-action-video-input").val();r=I(o);if(!r){a=x(o)}if(!a&&r==false){TBUtilities.Alert("Invalid video id or playlist id to set to.  Make sure you have a valid YouTube URL");return}}if(i.find(".tb-cards-update-action-teaser").is(":checked")&&i.find(".tb-cards-update-action-teaser-input").val()==""){TBUtilities.Alert("Enter a TEASER TEXT");return}if(i.find(".tb-cards-update-action-custom-message").is(":checked")&&i.find(".tb-cards-update-action-custom-message-input").val()==""){TBUtilities.Alert("Enter a CUSTOM MESSAGE");return}var l=jQuery(".tb-cards-update-target-input-field").val();var u=I(l);var c;if(!u){c=x(l)}if(!c&&u==false){TBUtilities.Alert("Invalid video id or playlist id to search for.  Make sure you have a valid YouTube URL");return}s(2)}catch(e){TBUtilities.Alert("Invalid video id or playlist id.  Make sure you have a valid YouTube URL")}break}case"link":{if(i.find(".tb-cards-update-action-title").is(":checked")==false&&i.find(".tb-cards-update-action-teaser-text").is(":checked")==false&&i.find(".tb-cards-update-action-call").is(":checked")==false&&i.find(".tb-cards-update-action-url").is(":checked")==false&&i.find(".tb-cards-update-action-image").is(":checked")==false){TBUtilities.Alert("Please choose at least one update to make");return}if(i.find(".tb-cards-update-action-title").is(":checked")&&i.find(".tb-cards-update-action-title-input").val()==""){TBUtilities.Alert("Enter a TITLE");return}if(i.find(".tb-cards-update-action-teaser").is(":checked")&&i.find(".tb-cards-update-action-teaser-input").val()==""){TBUtilities.Alert("Enter a TEASER TEXT");return}if(i.find(".tb-cards-update-action-call").is(":checked")&&i.find(".tb-cards-update-action-call-input").val()==""){TBUtilities.Alert("Enter a CALL TO ACTION");return}if(i.find(".tb-cards-update-action-url").is(":checked")&&i.find(".tb-cards-update-action-url-input").val()==""){TBUtilities.Alert("Enter a URL");return}if(i.find(".tb-cards-update-action-image").is(":checked")&&i.find(".tb-cards-update-imagefile").val()==""){TBUtilities.Alert("Select an image to upload");return}s(2);break}}break}case 2:{switch(parseInt(t.method)){case 0:if(t.specificVideoIds.length==0){jQuery("#tb-cards-input-ids-status").css("color","red");jQuery("#tb-cards-input-ids-status").text("No videos detected");jQuery("#tb-cards-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&t.specificVideoIds.length>1){TBGlobal.ShowUpgradePage("update cards in bulk (more than 1 video at a time)","bulkupdatecards");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Video IDs "+JSON.stringify(t.specificVideoIds));k();break;case 1:var d=jQuery("#tb-cards-update-input-playlist").playlistSelect().data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();var b=d.getSelectedPlaylistIds();if(!b||b.length==0){TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)",function(){return});return}else if(b.length>=2){TBUtilities.Alert("Please select only one playlist",function(){return});return}if(b.length==1){var h=jQuery("#tb-cards-update-input-playlist").find(".playlistSelectTypeList").is(":checked");if(t.validPlaylistIds.indexOf(b[0])>-1||h&&b.length>0){t.playlistId=b.join(",")}else{d.showValidationWarning();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)",function(){return});return}}TBGlobal.AddUserDebugInfo("Video Selection Method: Playlist ["+t.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(t.playlistId,null,m,w);break;case 2:if(t.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Search ["+t.search+"]");jQuery("#tb-cards-destination").show();TBYouTubeApi.GetChannelVideosSearch(t.search,null,m,w);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var y=null;if(jQuery("#tb-cards-update-onlyLoadFirstPage").is(":checked")){var p=/^\+?\d+$/.test(jQuery("#tb-cards-update-onlyLoadFirstPage-number").val());if(p==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}y=parseInt(jQuery("#tb-cards-update-onlyLoadFirstPage-number").val());if(y<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,m,w,y,null,t.selectedVideo.id);break}jQuery(".tb-cards-update-loading-count").text("0");jQuery(".tb-cards-update-loading-count-total").text("?");jQuery(".tb-cards-update-loading-text").text("Loading your videos...");jQuery(".tb-cards-update-loading-text-search").text("");jQuery(".tb-cards-loading-count-container").show();jQuery(".tb-cards-update-loading-videos").show();jQuery(".tb-cards-update-no-videos").hide();s(3);break}case 3:{if(jQuery(".tb-cards-update-destination-row--selected").filter(":visible").length==0){TBUtilities.Alert("Please select at least 1 video to update cards.");return}t.destinationVideos=[];jQuery(".tb-cards-update-destination-row--selected").filter(":visible").each(function(){var e=jQuery(this).attr("data-video-id");jQuery.each(t.videosWithFoundCards,function(i,a){if(a.id==e){var r=TBUtilities.GetInArray(t.destinationVideos,"id",e);if(!r){t.destinationVideos.push(a)}}})});jQuery("#tb-cards-update-queue-list").empty();jQuery("#tb-cards-update-completed-list").empty();if(t.destinationVideos.length>=2e3){jQuery("#tb-cards-update-2k-warning").show()}else{jQuery("#tb-cards-update-2k-warning").hide()}s(4);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] [click] #tb-cards-continue, #tb-cards-kickoff"})}});jQuery(document).on("click",".tb-cards-update-kickoff",function(){if(!jQuery(".tb-cards-update-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to update the cards");return}try{TBUtilities.AddAction({VideoCount:t.videosWithFoundCards.length,CardCount:t.actionCardCount,Data:"method = "+t.method},TBUtilities.ActionTypes.BulkUpdateCards_Update,"bulkupdatecards")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [addAction]"})}jQuery(".tb-cards-update-status").show();jQuery(".tb-cards-update-confirm").hide();jQuery("#tb-cards-update-stop").show();jQuery(".tb-cards-update-cancel").hide();jQuery(".tb-cards-update-back").hide();jQuery(".tb-cards-update-kickoff").hide();jQuery(".tb-cards-update-continue").hide();jQuery("#tb-cards-update-close").hide();jQuery(".tb-cards-update-step-number").text("- Processing");l(function(){var e=n();if(e.find(".tb-cards-update-action-image").is(":checked")==false){jQuery.each(t.destinationVideos,function(e,i){jQuery.each(i.cards,function(e,i){switch(i.type){case"fundraising":case"merch":case"product":case"associated":{if(i.image_url){if(!t.imageConversionDic[i.image_url]){t.imageConversionDic[i.image_url]=null}}break}}})})}if(Object.keys(t.imageConversionDic).length>0){for(key in t.imageConversionDic){var i=TBGlobal.host+TBGlobal.apiUrls.imageGetBytes+"?url="+encodeURIComponent(key);TBExtension.Get(i,"CRTBUpdateGetImageBytes",{Url:key})}}else{u();c()}})});jQuery(document).on("click",".tb-cards-update-back",function(){if(t.step>1){var e=t.step;t.step=t.step-1;s(t.step,e)}});jQuery(document).on("click","#tb-cards-update-method-ids, #tb-cards-update-method-playlist, #tb-cards-update-method-search, #tb-cards-update-method-full",function(e){t.method=parseInt(jQuery(this).attr("data-method"));var i=jQuery("#tb-cards-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(e){t.playlistId=e}}).data("plugin_playlistSelect");switch(t.method){case 0:jQuery("#tb-cards-update-input-ids").removeAttr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").attr("disabled","disabled");jQuery("#tb-cards-update-input-search").attr("disabled","disabled");i.disable();break;case 1:jQuery("#tb-cards-update-input-ids").attr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-cards-update-input-search").attr("disabled","disabled");i.enable();i.showDropDown();break;case 2:jQuery("#tb-cards-update-input-ids").attr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").attr("disabled","disabled");jQuery("#tb-cards-update-input-search").removeAttr("disabled","disabled");i.disable();break;case 3:jQuery("#tb-cards-update-input-ids").attr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").attr("disabled","disabled");jQuery("#tb-cards-update-input-search").attr("disabled","disabled");i.disable();break}});jQuery(document).on("click",".playlistSelectTypeManual",function(){var e=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").find("input");e.each(function(e,i){t.validPlaylistIds.push(jQuery(i).val())})});jQuery(document).on("change keypress keyup paste keydown blur",".playlistSelectManualIds",function(){var e=jQuery(this).val();if(t.validPlaylistIds.indexOf(e)==-1){jQuery("#tb-playlist-select-manual-id-invalid").show()}else{jQuery("#tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery("#tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-cards-update-input-search",function(e){t.search=jQuery(this).val().trim()});jQuery(document).on("click","#tb-cards-update-stop",function(){t.isStopped=true;jQuery("#tb-cards-update-stop").hide();jQuery("#tb-cards-update-close").show();jQuery("#tb-cards-update-working").hide();jQuery("#tb-cards-update-stopped").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-cards-update-input-ids",function(e){var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-cards-update-input-ids-status").hide();return}jQuery("#tb-cards-update-input-ids-status").show();t.specificVideoIds=[];if(i.indexOf(",")>-1){t.specificVideoIds=i.split(",")}else{t.specificVideoIds=i.split(" ")}for(var a=0;a<t.specificVideoIds.length;a++){t.specificVideoIds[a]=t.specificVideoIds[a].trim();t.specificVideoIds[a]=t.specificVideoIds[a].replace("https://www.youtube.com/watch?v=","");t.specificVideoIds[a]=t.specificVideoIds[a].replace("https://youtu.be/","");if(t.specificVideoIds[a].length!=11){t.specificVideoIds.splice(a,1);a--}}if(t.specificVideoIds.length==0){jQuery("#tb-cards-update-input-ids-status").text("No videos detected");jQuery("#tb-cards-update-input-ids-status").css("color","red")}else if(t.specificVideoIds.length==1){jQuery("#tb-cards-update-input-ids-status").text("1 video detected");jQuery("#tb-cards-update-input-ids-status").css("color","green");jQuery("#tb-cards-update-method-ids").prop("checked",true);jQuery("#tb-cards-update-method-ids").trigger("click")}else{jQuery("#tb-cards-update-input-ids-status").text(t.specificVideoIds.length+" videos detected");jQuery("#tb-cards-update-input-ids-status").css("color","green");jQuery("#tb-cards-update-method-ids").prop("checked",true);jQuery("#tb-cards-update-method-ids").trigger("click")}})};var n=function(){var e=jQuery(".tb-cards-update-cardtype-select").val();var t=null;switch(e){case"video":{t=jQuery(".tb-cards-update-cardtype-video");break}case"link":{t=jQuery(".tb-cards-update-cardtype-link");break}}return t};var s=function(e,i){try{jQuery(".tb-cards-update-step1").hide();jQuery(".tb-cards-update-step2").hide();jQuery(".tb-cards-update-step3").hide();jQuery(".tb-cards-update-step4").hide();jQuery(".tb-cards-update-kickoff").hide();jQuery(".tb-cards-update-continue").hide();jQuery(".tb-cards-update-back").hide();jQuery("#tb-cards-update-stop").hide();jQuery("#tb-cards-update-done-close").hide();jQuery(".tb-cards-update-step-number").text("- Step "+e);switch(e){case 1:{jQuery(".tb-cards-update-step1").show();jQuery(".tb-cards-update-continue").show();t.step=1;break}case 2:{t.specificVideoIds=[];t.specificVideos=[];t.playlistId="";t.search="";jQuery(".tb-cards-update-step2").show();jQuery(".tb-cards-update-continue").show();jQuery(".tb-cards-update-back").show();jQuery("#tb-cards-update-input-ids").val("");jQuery("#tb-cards-update-input-playlist").val("");jQuery("#tb-cards-update-input-search").val("");jQuery("#tb-cards-update-input-ids-status").empty();jQuery("#tb-cards-update-input-playlist-status").empty();var a=jQuery("#tb-cards-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(e){t.playlistId=e}}).data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();jQuery("#tb-cards-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-cards-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");t.method&&t.method==1?a.enable():a.disable();t.step=2;break}case 3:{jQuery(".tb-cards-update-step3").show();jQuery(".tb-cards-update-continue").show();jQuery(".tb-cards-update-back").show();if(i&&i==4){}else{jQuery(".tb-cards-update-destination-list").empty();jQuery(".tb-cards-update-destination-list").hide();jQuery(".tb-cards-update-destination-selected-count").text("0");jQuery(".tb-cards-update-destination-total-count").text("0");jQuery(".tb-cards-update-count").text("0")}t.step=3;break}case 4:{jQuery(".tb-cards-update-step4").show();jQuery(".tb-cards-update-continue").hide();jQuery(".tb-cards-update-kickoff").show();jQuery(".tb-cards-update-back").show();jQuery(".tb-cards-update-confirm").show();jQuery(".tb-cards-update-status").hide();jQuery(".tb-cards-update-continue").hide();t.step=4;break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] showstep "})}};var l=function(e){var i=jQuery(".tb-cards-update-cardtype-select").val();var a;if(i=="video"){a=jQuery(".tb-cards-update-action-video-input").val()}var r=n();var o=0;var s=0;jQuery.each(t.destinationVideos,function(t,n){var l=v(n.cards);jQuery.each(n.cards,function(t,n){var u=l.find(e=>e.key===n.key);if(u){switch(i){case"video":{if(r.find(".tb-cards-update-action-video").is(":checked")){n.target_url=a}if(r.find(".tb-cards-update-action-teaser-text").is(":checked")){n.teaser_text=r.find(".tb-cards-update-action-teaser-input").val()}if(r.find(".tb-cards-update-action-custom-message").is(":checked")){n.custom_message=r.find(".tb-cards-update-action-custom-message-input").val()}break}case"link":{if(n.type.toLowerCase()=="merch"||n.type.toLowerCase()=="fundraising"||n.type.toLowerCase()=="associated"||n.type.toLowerCase()=="product"){if(r.find(".tb-cards-update-action-title").is(":checked")&&r.find(".tb-cards-update-action-title-input").val()!=""){n.title=r.find(".tb-cards-update-action-title-input").val()}if(r.find(".tb-cards-update-action-teaser-text").is(":checked")&&r.find(".tb-cards-update-action-teaser-input").val()!=""){n.teaser_text=r.find(".tb-cards-update-action-teaser-input").val()}if(r.find(".tb-cards-update-action-call").is(":checked")&&r.find(".tb-cards-update-action-call-input").val()!=""){n.custom_message=r.find(".tb-cards-update-action-call-input").val()}if(r.find(".tb-cards-update-action-url").is(":checked")&&r.find(".tb-cards-update-action-url-input").val()!=""){n.target_url=r.find(".tb-cards-update-action-url-input").val()}if(r.find(".tb-cards-update-action-image").is(":checked")&&r.find(".tb-cards-update-imagefile").val()!=""){o++;var c=new FileReader;var d=r.find(".tb-cards-update-imagefile")[0].files[0];c.addEventListener("load",function(){s++;n.imagefile=c.result;if(s===o){e()}},false);if(d){c.readAsDataURL(d)}}}break}}}})});if(o===0){e()}};var u=function(){TBUtilities.Log("startProcessing");try{t.totalDestinationVideos=t.destinationVideos.length;t.hasFinished=false;t.errorCount=0;t.successCount=0;jQuery("#tb-cards-update-update-queue-list").empty();jQuery("#tb-cards-update-completed-list").empty();jQuery("#tb-cards-update-queue-list2").empty();jQuery("#tb-cards-update-completed-list2").empty();jQuery("#tb-cards-update-error-list2").empty();jQuery("#tb-cards-update-error-list2").hide();jQuery("#tb-cards-update-error-none-list2").show();jQuery("#tb-cards-update-working").show();jQuery("#tb-cards-update-done").hide();jQuery("#tb-cards-update-done-close").hide();jQuery("#tb-cards-update-stopped").hide();jQuery.each(t.destinationVideos,function(e,i){jQuery.each(i.cards,function(e,i){switch(i.type){case"fundraising":case"merch":case"product":case"associated":{if(i.image_url&&t.imageConversionDic[i.image_url]){i.imagefile=t.imageConversionDic[i.image_url]}break}}})})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] [startProcessing]"})}};var c=function(){TBUtilities.Log("processNextVideo");try{jQuery("#tb-cards-update-progress-container").html("Start &rarr;");if(t.isStopped)return;if(t.destinationVideos.length==0&&t.hasFinished==false){t.hasFinished=true;jQuery("#tb-cards-update-status-count").html("<b>"+t.totalDestinationVideos+"</b> of <b>"+t.totalDestinationVideos+"</b> videos complete");jQuery("#tb-cards-update-progress-container").hide();if(t.currentVideo){if(!t.currentVideo.error)b(t.currentVideo.video);else h(t.currentVideo.video)}d();jQuery("#tb-cards-update-working").hide();jQuery("#tb-cards-update-done").show();jQuery("#tb-cards-update-done-close").show();jQuery("#tb-cards-update-stop").hide();jQuery("#tb-cards-update-close").show();return}var e=t.destinationVideos[0].id;if(t.currentVideo){if(!t.currentVideo.error)b(t.currentVideo.video);else h(t.currentVideo.video)}var i=TBUtilities.RemoveFromArray(t.destinationVideos,"id",e);t.currentVideo=i[0];jQuery("#tb-cards-update-status-count").html("<b>"+parseInt(t.totalDestinationVideos-t.destinationVideos.length)+"</b> of <b>"+t.totalDestinationVideos+"</b> videos complete");jQuery("#tb-cards-update-progress-container").html(jQuery("#tb-cards-update-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+e+'">'+e+"</a> &rarr;");d();TBGlobal.AddUserDebugInfo("Updating cards for video: "+t.currentVideo.id);y(t.currentVideo)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] [processNextVideo]"});jQuery("#tb-cards-update-progress-container").html(jQuery("#tb-cards-update-progress-container").html()+"Error: "+e.message);TBUtilities.Alert('Sorry, there was an error: "'+e.message+'"');jQuery("#tb-cards-update-stop").trigger("click");jQuery("#tb-cards-update-stop").trigger("click")}};var d=function(){TBUtilities.Log("showNextToBeProcessed");jQuery("#tb-cards-update-queue-list2").empty();jQuery("#tb-cards-update-queue-complete-list2").hide();var e=0;jQuery.each(t.destinationVideos,function(t,i){var a=i.video.snippet.thumbnails.thumbnailMedium?i.video.snippet.thumbnails.thumbnailMedium:i.video.snippet.thumbnails.default.url;var r=jQuery(".tb-cards-update-processing-template2:last")[0].outerHTML;r=r.replace("#THUMBNAILURL#",a);r=TBUtilities.ReplaceAll(r,"#VIDEOID#",i.id);r=r.replace("#VIDEOTITLE#",i.video.snippet.title);r=r.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);r=r.replace("display: none","display:flex");jQuery("#tb-cards-update-queue-list2").prepend(r);e++;if(e==3)return false});if(e==0){jQuery("#tb-cards-update-queue-complete-list2").show();jQuery("#tb-cards-update-queue-list2").hide()}else{jQuery("#tb-cards-update-queue-list2").show()}};var b=function(e){TBUtilities.Log("addCompletedSuccess");var i=e.snippet.thumbnails.thumbnailMedium?e.snippet.thumbnails.thumbnailMedium:e.snippet.thumbnails.default.url;var a=jQuery(".tb-cards-update-processed-success:last")[0].outerHTML;a=a.replace("#THUMBNAILURL#",i);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",e.id);a=a.replace("#VIDEOTITLE#",e.snippet.title);a=a.replace("#HREF#","https://www.youtube.com/cards?video_referrer=watch&v="+e.id);a=a.replace("display:none","display:flex");jQuery("#tb-cards-update-completed-list2").prepend(a);jQuery("#tb-cards-update-completed-none-list2").hide();jQuery("#tb-cards-update-completed-list2").show();t.successCount++;jQuery("#tb-cards-update-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(t.successCount))};var h=function(e){try{jQuery("#tb-cards-update-error-copy-container").show();var i=jQuery("#tb-cards-update-error-copy").attr("data-clipboard-text");var a=[];if(i!=""){a=i.split(",");if(a.indexOf(e.id)==-1){a.push(e.id)}}else{a.push(e.id)}jQuery("#tb-cards-update-error-copy").attr("data-clipboard-text",a.join(","))}catch(e){}TBUtilities.Log("addCompletedError");var r=e.snippet.thumbnails.thumbnailMedium?e.snippet.thumbnails.thumbnailMedium:e.snippet.thumbnails.default.url;var o=jQuery(".tb-cards-update-processed-error:last")[0].outerHTML;o=o.replace("#THUMBNAILURL#",r);o=TBUtilities.ReplaceAll(o,"#VIDEOID#",e.id);o=o.replace("#VIDEOTITLE#",e.snippet.title);o=o.replace("#ERROR#",e.error);o=o.replace("#HREF#","https://www.youtube.com/cards?video_referrer=watch&v="+e.id);o=o.replace("display:none","display:flex");jQuery("#tb-cards-update-error-list2").prepend(o);jQuery("#tb-cards-update-error-list2").show();jQuery("#tb-cards-update-error-none-list2").hide();t.errorCount++;jQuery("#tb-cards-update-error-list2-count").text(TBUtilities.FormatNumberWithCommas(t.errorCount))};var y=function(e){if(a==null){a=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}var t=0;jQuery.each(e.cards,function(i,r){t++;let o=TubeBuddyCards.CardCopyDelay()*t;setTimeout(function(){TubeBuddyYouTubeActions.UpdateCard(e.id,r,a,TubeBuddyCardsUpdate.CardUpdateCallback)},o)})};var p=function(){var e=0;jQuery(".tb-cards-update-destination-row").filter(":visible").each(function(){if(jQuery(this).hasClass("tb-cards-update-destination-row--selected")){var i=jQuery(this).attr("data-video-id");jQuery.each(t.videosWithFoundCards,function(t,a){if(a.id==i){e=e+a.cards.length}})}});return e};var m=function(e){try{if(e==null){if(t.method==0)TBUtilities.Alert("No valid Video IDs found");else if(t.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(t.method==2)TBUtilities.Alert("No videos matching your search");else if(t.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-cards-update-back").trigger("click");return}else if(e.length==0){if(t.method==0)TBUtilities.Alert("No valid Video IDs found");else if(t.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(t.method==2)TBUtilities.Alert("No videos matching your search");else if(t.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-cards-update-update-back").trigger("click");return}jQuery(".tb-cards-update-destination-list").empty();jQuery(".tb-cards-update-destination-list").hide();jQuery(".tb-cards-update-no-videos").hide();jQuery(".tb-cards-update-loading-videos").show();jQuery(".tb-cards-update-loading-text").html("Hang Tight!<br /><br />We are currently looking through the videos you selected to find Cards that match your search criteria. This generally takes a couple seconds per video meaning it may take up to 30 minutes per 1,000 videos you have.");jQuery(".tb-cards-loading-count-container").hide();jQuery("tb-cards-update-loading-text-search").text("");t.videosWithFoundCards=[];t.searchQueue=[];jQuery.each(e,function(e,i){if(i.id.videoId!=null){i.id=i.id.videoId}if(i.snippet.resourceId!=null)i.id=i.snippet.resourceId.videoId;if(i.snippet!==null&&i.snippet.title==="Deleted video"&&i.snippet.thumbnails===null)return;t.searchQueue.push(i)});f()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] [gotVideoList]"})}};var f=function(){if(t.searchQueue.length>0){var e=t.searchQueue.shift();var i="https://www.youtube.com/cards_ajax?v="+e.id+"&action_list=1";TBExtension.Get(i,function(i,a,r){if(i===true){jQuery(".tb-cards-update-loading-text-search").html("Searching cards for video https://youtube.com/watch?v="+e.id);var o=v(r.feature_templates);if(o.length>0){var n=TBUtilities.GetInArray(t.videosWithFoundCards,"id",e.id);if(!n){t.videosWithFoundCards.push({video:e,cards:o,id:e.id,error:""});var s=jQuery("#tb-cards-update-destination-template").html();var l=e.snippet.thumbnails.thumbnailMedium?e.snippet.thumbnails.thumbnailMedium:e.snippet.thumbnails.default.url;var u="matches";if(o.length==1){u="match"}var c=s.formatTemplate(e.id,l,"https://www.youtube.com/cards?feature=vm&v="+e.id,e.snippet.title,o.length,u,e.status.privacy);jQuery(".tb-cards-update-destination-list").prepend(c)}}}else{jQuery(".tb-cards-update-loading-text-search").html("Searching cards for video "+e.id)}if(t.searchQueue.length===0){g()}else{f()}},null,{dataType:"json"})}else{g()}};var g=function(){jQuery(".tb-cards-update-loading-videos").hide();if(t.videosWithFoundCards.length==0){jQuery(".tb-cards-update-no-videos").show();jQuery(".tb-cards-update-destination-list").hide();jQuery(".tb-cards-update-continue").hide()}else{jQuery(".tb-cards-update-destination-total-count").text(t.videosWithFoundCards.length);jQuery(".tb-cards-update-destination-list").show();jQuery(".tb-cards-update-continue").show();if(TBGlobal.CanAccessLevel2Tools()&&(t.method==0||t.method==1))jQuery("#tb-cards-update-select-all-checkboxes").trigger("click")}};var v=function(t){var i=jQuery(".tb-cards-update-target-select").val();var a=jQuery(".tb-cards-update-target-input-field").val().toUpperCase();var r=jQuery(".tb-cards-update-cardtype-select").val();console.log("searchField="+i);console.log("searchValue="+a);console.log("selectedCardType="+r);var o;var n;var s;if(r=="video"){s=jQuery(".tb-cards-update-target-select").val();o=I(jQuery(".tb-cards-update-target-input-field").val());n=x(jQuery(".tb-cards-update-target-input-field").val())}console.log("listIdToSearch="+o);console.log("videoIdToSearch="+n);console.log("searchType="+s);console.log("selectedCardType="+r);var l=new Array;try{jQuery.each(t,function(e,t){console.log(t);switch(r){case"video":{if(t.type=="playlist"||t.type=="video"){switch(s){case"videoUrl":{if(t.video_id==n){l.push(t);return true}break}case"playlistUrl":{if(t.playlist_id==o){l.push(t);return true}break}}}else{return true}break}case"link":{if(t.type=="product"||t.type=="associated"||t.type=="merch"||t.type=="fundraising"){if(i=="url"){if(T(t.target_url,a)==true){l.push(t);return true}}if(i=="title"){if(t.title&&t.title.toUpperCase()===a){l.push(t);return true}}if(i=="teaser"){if(t.teaser_text&&t.teaser_text.toUpperCase()===a){l.push(t);return true}}if(i=="call"){if(t.custom_message&&t.custom_message.toUpperCase()===a){l.push(t);return true}}}else{return true}break}}})}catch(t){BUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] searchCards"})}return l};var T=function(e,t){var i=false;TBUtilities.Log("doesUrlMatch");try{if(e&&t){if(jQuery(".tb-cards-update-http-options-input").is(":checked")){e=e.replace(/^http:\/\//i,"https://");t=t.replace(/^http:\/\//i,"https://");e=j(e);t=j(t);if(e.toUpperCase()===t.toUpperCase()){i=true}}else{if(e.toUpperCase()===t.toUpperCase()){i=true}}}}catch(e){TBUtilities.LogError(e)}TBUtilities.Log("doesUrlMatch - "+i);return i};var j=function(e){if(e.charAt(e.length-1)=="/"){e=e.substr(0,e.length-1)}return e};var Q=function(e,i,a,r){TBUtilities.Log("cardUpdateCallback");if(r)t.currentVideo.error=r;TBUtilities.RemoveFromArray(t.currentVideo.cards,"key",a.key);if(t.currentVideo.cards.length==0){c()}};var k=function(){var e=t.specificVideoIds[0];t.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails, snippet, id, status",B)};var B=function(e){if(e!=null)t.specificVideos.push(e);if(t.specificVideoIds.length>0){k()}else{m(t.specificVideos)}};var C=function(){jQuery(document.body).on("CRTBLoadCardsUpdateTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);A()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] CRTBLoadCardsTemplate"})}})};var w=function(e){if(e.totalCount-e.loaded>50){jQuery(".tb-cards-update-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-cards-update-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-cards-update-onlyLoadFirstPage-number").val())}jQuery(".tb-cards-update-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery(".tb-cards-update-loading-count"))}else{jQuery(".tb-cards-update-rendering").show();jQuery(".tb-cards-update-loading-count-container").hide()}};var A=function(){try{jQuery("#tb-cards-update-error-copy-container").hide();jQuery("#tb-cards-update-error-copy").prop("data-clipboard-text","");jQuery("#tb-cards-update-uploaded-file").text("").hide();var e=new ClipboardJS("#tb-cards-update-error-copy");jQuery(".tb-cards-update-cardtype-link").show();jQuery("#tb-cards-update-cardtype-select").val("link");jQuery("#tb-cards-update-target-select").val("url");jQuery(".tb-cards-update-cardtype-video").hide();t.destinationVideos=[];t.videosWithFoundCards=[];t.specificVideos=[];t.currentVideo=null;t.imageConversionDic={};t.is=false;t.searchQueue=[];jQuery('input[type="radio"][value="url"]').prop("checked",true);jQuery(".tb-cards-update-target-input").prop("disabled",true);jQuery(".tb-cards-update-target-url").prop("disabled",false);jQuery(".tb-cards-update-target-input").val("");jQuery(".tb-cards-update-action-input").val("");jQuery(".tb-cards-update-filter").val("all");jQuery(".tb-cards-update-action-input").prop("disabled",true);jQuery(".tb-cards-update-imagefile").val("");jQuery(".tb-cards-update-imagefile").prop("disabled",true);jQuery(".tb-cards-update-action-option").prop("checked","");jQuery(".tb-cards-kickoff").hide();jQuery(".tb-cards-update-confirm-checkbox").prop("checked","");jQuery(".tb-cards-update-no-videos").hide();jQuery(".tb-cards-update-loading-videos").show();jQuery(".tb-cards-update-loading-count").text("0");jQuery(".tb-cards-update-loading-count-total").text("?");jQuery(".tb-cards-update-loading-text-search").text("");jQuery(".tb-cards-update-loading-text").text("Loading your videos...");jQuery(".tb-cards-loading-count-container").show();jQuery(".tb-cards-update-target-input-field").val("");jQuery(".tb-cards-update-action-video-input").val("");jQuery("#tb-cards-update-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-cards-update-onlyLoadFirstPage").prop("checked",false);t.step=1;s(t.step);jQuery("#tb-cards-update-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdate] prepareDialog"})}};var x=function(e){var t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var i=e.match(t);return i&&i[7].length==11?i[7]:false};var I=function(e){var t=/list=([a-zA-Z0-9\-\_]+)&?/;var i=e.match(t);var a=i?i[1]:false;return a};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!i){C();r();o();i=true}else{A()}}},CardUpdateCallback:function(e,t,i,a){Q(e,t,i,a)}}}();